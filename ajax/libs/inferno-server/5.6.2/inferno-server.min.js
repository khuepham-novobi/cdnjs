!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("inferno"),require("stream")):"function"==typeof define&&define.amd?define(["exports","inferno","stream"],t):t((e.Inferno=e.Inferno||{},e.Inferno.Server=e.Inferno.Server||{}),e.Inferno,e.stream)}(this,function(e,b,t){"use strict";var r="a runtime error occured! Use Inferno in development environment to find the error.";function k(e){return w(e)||N(e)}function Q(e){return N(e)||!1===e||_(e)||w(e)}function C(e){return"function"==typeof e}function P(e){return"string"==typeof e}function $(e){return"number"==typeof e}function N(e){return null===e}function _(e){return!0===e}function w(e){return void 0===e}function M(e){throw e=e||r,new Error("Inferno Error: "+e)}function D(e,t){var r={};if(e)for(var n in e)r[n]=e[n];if(t)for(var o in t)r[o]=t[o];return r}var u=new RegExp(/["'&<>]/);function B(e){if(!u.test(e))return e;for(var t="",r="",n=0,o=0;o<e.length;o++){switch(e.charCodeAt(o)){case 34:r="&quot;";break;case 39:r="&#039;";break;case 38:r="&amp;";break;case 60:r="&lt;";break;case 62:r="&gt;";break;default:continue}n<o&&(t+=e.slice(n,o)),t+=r,n=o+1}return t+e.slice(n,o)}var n=/[A-Z]/g,o={};function s(e){return void 0!==o[e]?o[e]:o[e]=e.replace(n,"-$&").toLowerCase()+":"}var i=new RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),a={},c={};function I(e){return void 0!==c[e]||void 0===a[e]&&(i.test(e)?c[e]=!0:void(a[e]=!0))}var E=new Set(["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"]);function R(e){if(P(e))return e;var t,r="";for(t in e){var n=e[t];P(n)?r+=""+s(t)+n+";":$(n)&&(r+=""+s(t)+b.getNumberStyleValue(t,n)+";")}return r}function l(e){return function e(t,r,n,o){var u=t.flags,s=t.type,i=t.props||b.EMPTY_OBJ,a=t.children;if(0<(14&u)){if(4&u){if((p=new s(i,n)).$BS=!1,C(p.getChildContext)&&(v=p.getChildContext()),v=k(v)?n:D(n,v),p.props===b.EMPTY_OBJ&&(p.props=i),p.context=n,p.$UN=!1,C(p.componentWillMount)&&(p.$BR=!0,p.componentWillMount(),p.$BR=!1),p.$PSS){var c=p.state,l=p.$PS;if(null===c)p.state=l;else for(var h in l)c[h]=l[h];p.$PSS=!1,p.$PS=null}return Q(p=p.render(i,p.state,p.context))?"\x3c!--!--\x3e":P(p)?B(p):$(p)?p+"":e(p,t,v,!0)}return Q(p=s(i,n))?"\x3c!--!--\x3e":P(p)?B(p):$(p)?p+"":e(p,t,n,!0)}if(0<(481&u)){var d,p,f="<"+s,v=E.has(s);if(P(p=t.className)?f+=' class="'+B(p)+'"':$(p)&&(f+=' class="'+p+'"'),!N(i)){for(var m in i){var y=i[m];switch(m){case"dangerouslySetInnerHTML":d=y.__html;break;case"style":k(i.style)||(f+=' style="'+R(i.style)+'"');break;case"children":case"className":break;case"defaultValue":i.value||(f+=' value="'+(P(y)?B(y):y)+'"');break;case"defaultChecked":i.checked||(f+=' checked="'+y+'"');break;default:I(m)&&(P(y)?f+=" "+m+'="'+B(y)+'"':$(y)?f+=" "+m+'="'+y+'"':_(y)&&(f+=" "+m))}}"option"===s&&void 0!==i.value&&i.value===r.props.value&&(f+=" selected")}if(v)f+=">";else{if(f+=">",2&(r=t.childFlags))f+=e(a,t,n,!0);else if(12&r)for(var F=0,g=a.length;F<g;F++)f+=e(a[F],t,n,0===F);else d&&(f+=d);v||(f+="</"+s+">")}if(String(s).match(/[\s\n\/='"\0<>]/))throw f;return f}return 0<(16&u)?(o?"":"\x3c!----\x3e")+(""===a?" ":B(a)):(M(),"")}(e,{},{},!0)}var h=function(t){function e(e){t.call(this),this.collector=[Infinity],this.promises=[],this.pushQueue=this.pushQueue.bind(this),e&&this.renderVNodeToQueue(e,null,!1,null)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype._read=function(){setTimeout(this.pushQueue,0)},e.prototype.addToQueue=function(e,t){var r;k(t)?"string"==typeof e&&this.collector.length-1==0?this.push(e):"string"==typeof e&&"string"==typeof this.collector[this.collector.length-2]?this.collector[this.collector.length-2]+=e:this.collector.splice(-1,0,e):(r=this.promises[t].length-1,"string"==typeof this.promises[t][r]&&"string"==typeof e?this.promises[t][r]+=e:this.promises[t].push(e))},e.prototype.pushQueue=function(){var r,e=this.collector[0];"string"==typeof e?(this.push(e),this.collector.shift()):e&&("object"==typeof e||C(e))&&C(e.then)?(r=this,e.then(function(e){var t;(t=r.collector).splice.apply(t,[0,1].concat(r.promises[e])),r.promises[e]=null,setTimeout(r.pushQueue,0)}),this.collector[0]=null):Infinity===e&&this.emit("end")},e.prototype.renderVNodeToQueue=function(e,t,r,n){var o=this,u=e.flags,s=e.type,i=e.props||b.EMPTY_OBJ,a=e.children;if(0<(14&u))if(4&u){var c,l=new s(i,t);if(l.$BS=!1,w(l.getChildContext)||(c=l.getChildContext()),k(c)||(t=D(t,c)),l.props===b.EMPTY_OBJ&&(l.props=i),l.context=t,l.$UN=!1,C(l.componentWillMount)){if(l.$BR=!0,l.componentWillMount(),l.$PSS){var h=l.state,d=l.$PS;if(null===h)l.state=d;else for(var p in d)h[p]=d[p];l.$PSS=!1,l.$PS=null}l.$BR=!1}if(C(l.getInitialProps)&&(F=l.getInitialProps(l.props,l.context))){if(Promise.resolve(F)===F){var f=this.promises.push([])-1;return void this.addToQueue(F.then(function(e){return l.$PSS=!1,"object"==typeof e&&(l.props=D(l.props,e)),Q(e=l.render(l.props,l.state,l.context))?o.addToQueue("\x3c!--!--\x3e",f):P(e)?o.addToQueue(B(e),f):$(e)?o.addToQueue(e+"",f):o.renderVNodeToQueue(e,l.context,!0,f),setTimeout(o.pushQueue,0),f}),n)}l.props=D(l.props,F)}F=l.render(l.props,l.state,l.context),l.$PSS=!1,Q(F)?this.addToQueue("\x3c!--!--\x3e",n):P(F)?this.addToQueue(B(F),n):$(F)?this.addToQueue(F+"",n):this.renderVNodeToQueue(F,t,!0,n)}else Q(m=s(i,t))?this.addToQueue("\x3c!--!--\x3e",n):P(m)?this.addToQueue(B(m),n):$(m)?this.addToQueue(m+"",n):this.renderVNodeToQueue(m,t,!0,n);else if(0<(481&u)){var v,m,y="<"+s,F=E.has(s);if(P(m=e.className)?y+=' class="'+B(m)+'"':$(m)&&(y+=' class="'+m+'"'),!N(i))for(var g in i){var S=i[g];switch(g){case"dangerouslySetInnerHTML":v=S.__html;break;case"style":k(i.style)||(y+=' style="'+R(i.style)+'"');break;case"children":case"className":break;case"defaultValue":i.value||(y+=' value="'+(P(S)?B(S):S)+'"');break;case"defaultChecked":i.checked||(y+=' checked="'+S+'"');break;default:I(g)&&(P(S)?y+=" "+g+'="'+B(S)+'"':$(S)?y+=" "+g+'="'+S+'"':_(S)&&(y+=" "+g))}}if(y+=">",String(s).match(/[\s\n\/='"\0<>]/))throw y;if(F)this.addToQueue(y,n);else{if(2&(e=e.childFlags))return this.addToQueue(y,n),this.renderVNodeToQueue(a,t,!0,n),void this.addToQueue("</"+s+">",n);if(12&e){this.addToQueue(y,n),y="";for(var x=0,T=a.length;x<T;x++)this.renderVNodeToQueue(a[x],t,0===x,n)}v?this.addToQueue(y+v+"</"+s+">",n):F||this.addToQueue(y+"</"+s+">",n)}}else 0<(16&u)?this.addToQueue((r?"":"\x3c!----\x3e")+(""===a?" ":B(a)),n):M()},e}(t.Readable);function d(e){return new h(e)}var p=Promise.resolve(),f=function(t){function e(e){t.call(this),this.started=!1,this.initNode=e}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype._read=function(){var t=this;this.started||(this.started=!0,p.then(function(){return t.renderNode(t.initNode,null,!1)}).then(function(){t.push(null)}).catch(function(e){t.emit("error",e)}))},e.prototype.renderNode=function(e,t,r){var n=e.flags;return 0<(14&n)?this.renderComponent(e,t,4&n):0<(481&n)?this.renderElement(e,t):this.renderText(e,r)},e.prototype.renderComponent=function(e,o,t){var u=this,r=e.type,e=e.props;if(!t)return Q(t=r(e,o))?this.push("\x3c!--!--\x3e"):P(t)?this.push(B(t)):$(t)?this.push(t+""):this.renderNode(t,o,!1);var n,s=new r(e,o);return s.$BS=!1,C(s.getChildContext)&&(n=s.getChildContext()),k(n)||(o=D(o,n)),s.context=o,s.$BR=!0,Promise.resolve(s.componentWillMount&&s.componentWillMount()).then(function(){if(s.$PSS){var e=s.state,t=s.$PS;if(null===e)s.state=t;else for(var r in t)e[r]=t[r];s.$PSS=!1,s.$PS=null}s.$BR=!1;var n=s.render(s.props,s.state,s.context);return s.$PSS=!1,Q(n)?u.push("\x3c!--!--\x3e"):P(n)?u.push(B(n)):$(n)?u.push(n+""):u.renderNode(n,o,!1)})},e.prototype.renderChildren=function(e,r,t){var n=this;return 2&t?this.renderNode(e,r,!1):12&t?e.reduce(function(e,t){return e.then(function(e){return 0<(16&t.flags)&&e&&n.push("\x3c!----\x3e"),Promise.resolve(n.renderNode(t,r,!1)).then(function(){return!!(16&t.flags)})})},Promise.resolve(!1)):void 0},e.prototype.renderText=function(e,t){this.push((t?"\x3c!----\x3e":"")+(""===e.children?" ":B(e.children)))},e.prototype.renderElement=function(e,t){var r,n=this,o=e.type,u=e.props,s="<"+o,i=E.has(o),a=e.className;if(P(a)?s+=' class="'+B(a)+'"':$(a)&&(s+=' class="'+a+'"'),!N(u))for(var c in u){var l=u[c];switch(c){case"dangerouslySetInnerHTML":r=l.__html;break;case"style":k(u.style)||(s+=' style="'+R(u.style)+'"');break;case"children":case"className":break;case"defaultValue":u.value||(s+=' value="'+(P(l)?B(l):l)+'"');break;case"defaultChecked":u.checked||(s+=' checked="'+l+'"');break;default:if(I(c)){P(l)?s+=" "+c+'="'+B(l)+'"':$(l)?s+=" "+c+'="'+l+'"':_(l)&&(s+=" "+c);break}}}if(s+=">",this.push(s),String(o).match(/[\s\n\/='"\0<>]/))throw s;if(!i)return r?(this.push(r),void this.push("</"+o+">")):1&(i=e.childFlags)?void this.push("</"+o+">"):Promise.resolve(this.renderChildren(e.children,t,i)).then(function(){n.push("</"+o+">")})},e}(t.Readable);function v(e){return new f(e)}e.RenderQueueStream=h,e.RenderStream=f,e.renderToStaticMarkup=l,e.renderToString=l,e.streamAsStaticMarkup=v,e.streamAsString=v,e.streamQueueAsStaticMarkup=d,e.streamQueueAsString=d,Object.defineProperty(e,"__esModule",{value:!0})});
