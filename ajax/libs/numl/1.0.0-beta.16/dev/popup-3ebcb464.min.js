import{W as WidgetBehavior,f as fixPosition,r as resetScroll,c as deepQuery,a as scrollParentToChild,e as isFocusable,d as deepQueryAll}from"./index-a5c9c958.js";class PopupBehavior extends WidgetBehavior{static get params(){return{provideValue:!1,contextValue:!1,linkValue:!1,linkHostValue:!1}}init(){this.host.nuPopup=this,super.init(),this.setMod("popup",!0),this.on("mousedown",t=>{t.stopPropagation()}),this.on("click",t=>{t.stopPropagation()}),this.on("keydown",t=>{const{button:o}=this;"Escape"===t.key&&(o&&(this.close(),o.host.focus()),t.stopPropagation()),"Enter"!==t.key&&" "!==t.key||t.stopPropagation()}),this.on("mouseenter",()=>{this.button&&this.button.host.style.setProperty("--local-mark-color","transparent")}),this.on("mouseleave",()=>{this.button&&this.button.host.style.removeProperty("--local-mark-color")})}connected(){const{host:t}=this,o=t.nuContext.$shadowRoot;o&&bindGlobalEvents(o),this.setContext("popup",this),this.provideAction("close",t=>{this.close(),t&&this.doAction("close")}),this.linkContext("button",(t,o)=>{o&&o.unlinkPopup(this),t&&t.linkPopup(this)}),this.close(!0)}disconnected(){this.close(),this.button&&this.button.unlinkPopup(this),delete this.button}open(){const{host:t}=this;function o(){const o=deepQuery(t,"[is-current]");if(o&&(scrollParentToChild(t,o),isFocusable(o)))return o.focus(),!0;let e;return(e=isFocusable(t)?t:t.nuDeepQuery('input, [tabindex]:not([tabindex="-1"]):not([disabled])'))&&isFocusable(e)?(e.focus(),!0):void 0}this.isOpen||(t.nuUse("fixate").then(t=>t.start()),this.openEffect(!0),this.button&&this.button.host.nuSetAria("expanded",!0),fixPosition(t),this.emit("open",null),this.emit("toggle",null),resetScroll(t,!0),o()||setTimeout(o,100))}close(t=!1){const{host:o}=this;if(!this.isOpen)return;if(o.nuUse("fixate").then(t=>t.end()),this.openEffect(!1),t)return;this.button&&(this.button.set(!1),this.button.host.focus()),o.style.removeProperty("--transform"),this.emit("close",null),this.emit("toggle",null),resetScroll(o,!0);const e=o.nuDeepQuery("[is-popup]");e&&e.nuPopup.close()}openEffect(t){this.host.hidden=!t}get isOpen(){return!this.host.hidden}}function findParentPopup(t){const o=[];for(;t;){const e=t.NuAction;if(e&&e.popup){const t=e.popup.host;t&&o.push(t)}t=t.parentNode||t.host}return o}function handleOutside(t){if(t.nuPopupHandled)return;const o=findParentPopup(t.target);deepQueryAll(this===window?document:this,"[is-popup]").forEach(e=>{o.includes(e)||(e.nuPopup&&e.nuPopup.close(),t.nuPopupHandled=!0)})}function bindGlobalEvents(t){t.nuPopupEventsBinded||["mousedown","touchstart","focusin"].forEach(o=>{t.addEventListener(o,handleOutside.bind(t),{passive:!0}),t.nuPopupEventsBinded=!0})}bindGlobalEvents(window);export default PopupBehavior;