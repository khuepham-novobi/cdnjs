import{W as WidgetBehavior,i as isEqual,d as deepQueryAll,a as scrollParentToChild,b as BOOL_TYPE}from"./index-0338ddf6.js";class ListBoxBehavior extends WidgetBehavior{static get params(){return{input:!0,provideValue:!0}}init(){this.props.multiple=(t=>{const e=BOOL_TYPE(t);return e&&this.setAttr("type","array"),this.setAria("aria-multiselectable",e),e}),this.multiple=this.host.hasAttribute("multiple"),this.isPopup=this.host.hasAttribute("nu-popup"),this.isPopup&&this.forceLinkValue(),this.host.nuListBox=this,this.options=[],super.init(),this.setName("listbox"),this.setContext("listbox",this,!0),this.linkContext("button",t=>{t&&this.linkValue&&(t.listbox=this,t.popup&&t.setAria("haspopup","listbox"))}),this.on("keydown",this.onKeyDown.bind(this)),this.on("keyup",this.onKeyUp.bind(this))}connected(){super.connected(),setTimeout(()=>{!this.current&&this.options.length&&(this.current=this.options[0].value)})}setValue(t,e){this.multiple&&!Array.isArray(t)&&null!=t&&(t="string"==typeof t?t.split(/,/g).map(t=>t.trim()):[t]),isEqual(this.value,t)||super.setValue(t,e)}toggleOption(t,e){if(!this.multiple)return void this.setValue(t,e);if(!this.getOptionByValue(t))return;let i=[...this.value||[]];Array.isArray(i)||(i=[]),this.current=t,i.includes(t)?i.splice(i.indexOf(t),1):i.push(t),this.updateCurrent(),this.setValue(i,e)}onKeyUp(t){switch(t.key){case" ":t.stopPropagation(),t.preventDefault(),this.toggleOption(this.current),!this.multiple&&t.target===this.host&&this.isPopup&&this.use("popup").then(t=>t.close());break;default:return}t.nuListBoxHandled=!0}onKeyDown(t){const e=this.orderedOptions,i=this.currentOption;if(!e.length||i&&!e.includes(i))return;const s=e.indexOf(i);let o;switch(t.key){case"Home":if(!this.isEdgeMoveAllowed())return;o=e[0].value;break;case"End":if(!this.isEdgeMoveAllowed())return;o=e.slice(-1)[0].value;break;case"ArrowUp":if(s>0)o=e[s-1].value;else{if(-1!==s)return;o=e.slice(-1)[0].value}this.openPopup();break;case"ArrowDown":if(s<e.length-1)o=e[s+1].value;else{if(-1!==s)return;o=e[0].value}this.openPopup();break;case" ":return t.preventDefault(),void t.stopPropagation();case"Enter":this.setValue(this.current),t.target===this.host&&this.isPopup&&this.use("popup").then(t=>t.close());break;default:return}t.nuListBoxHandled=!0,setTimeout(()=>{null!=o&&(this.current=o),this.updateCurrent()}),t.preventDefault()}isEdgeMoveAllowed(){if(!this.isPopup)return!0;const t=this.host.nuPopup;return!t||t.isOpen}openPopup(){if(!this.isPopup)return;const t=this.host.nuPopup;t&&!t.isOpen&&this.button&&this.button.set(!0,!0)}addOption(t){this.options.includes(t)||(this.options.push(t),this.current||(this.multiple?(this.value||[]).includes(t.value):isEqual(this.value,t.value))&&(this.current=t.value))}get orderedOptions(){const t=this.options.map(t=>t.host);return deepQueryAll(this.host,"[nu-option]:not([disabled])").filter(e=>t.includes(e)).map(t=>this.options.find(e=>e.host===t)).filter(t=>t)}get currentOption(){return this.options.find(t=>isEqual(t.value,this.current))}removeOption(t){this.options.includes(t)&&(this.options.splice(this.options.indexOf(t),1),this.current===t.value&&(this.current=!1))}getOptionByValue(t){return this.options.find(e=>isEqual(e.value,t))}updateCurrent(){this.options.forEach(t=>{t.setCurrent()}),setTimeout(()=>{const t=this.currentOption;t&&scrollParentToChild(this.host,t.host)})}}export default ListBoxBehavior;