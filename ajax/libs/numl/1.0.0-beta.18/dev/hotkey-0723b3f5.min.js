import{l as log}from"./index-0338ddf6.js";class Leaf{constructor(e){this.children=[],this.parent=e}delete(e){const t=this.children.indexOf(e);return-1!==t&&(this.children=this.children.slice(0,t).concat(this.children.slice(t+1)),0===this.children.length&&this.parent.delete(this),!0)}add(e){return this.children.push(e),this}}class RadixTrie{constructor(e){this.parent=null,this.children={},this.parent=e||null}get(e){return this.children[e]}insert(e){let t=this;for(let i=0;i<e.length;i+=1){const n=e[i];let r=t.get(n);if(i===e.length-1)return r instanceof RadixTrie&&(t.delete(r),r=null),r||(r=new Leaf(t),t.children[n]=r),r;r instanceof Leaf&&(r=null),r||(r=new RadixTrie(t),t.children[n]=r),t=r}return t}delete(e){for(const t in this.children){if(this.children[t]===e){const e=delete this.children[t];return 0===Object.keys(this.children).length&&this.parent&&this.parent.delete(this),e}}return!1}}function isFormField(e){if(!(e instanceof HTMLElement))return!1;const t=e.nodeName.toLowerCase(),i=(e.getAttribute("type")||"").toLowerCase();return"select"===t||"textarea"===t||"input"===t&&"submit"!==i&&"reset"!==i&&"checkbox"!==i&&"radio"!==i||e.isContentEditable}function fireDeterminedAction(e){isFormField(e)?e.focus():e.click()}function expandHotkeyToEdges(e){return e.split(",").map(e=>e.split(" "))}function hotkey(e){return`${e.ctrlKey?"Control+":""}${e.altKey?"Alt+":""}${e.metaKey?"Meta+":""}${e.shiftKey&&e.key.toUpperCase()!==e.key?"Shift+":""}${e.key}`}const hotkeyRadixTrie=new RadixTrie,elementsLeaves=new WeakMap;let currentTriePosition=hotkeyRadixTrie,resetTriePositionTimer=null;function resetTriePosition(){resetTriePositionTimer=null,currentTriePosition=hotkeyRadixTrie}function keyDownHandler(e){if(e.defaultPrevented)return;if(e.target instanceof Node&&isFormField(e.target))return;null!=resetTriePositionTimer&&window.clearTimeout(resetTriePositionTimer),resetTriePositionTimer=window.setTimeout(resetTriePosition,1500);const t=currentTriePosition.get(hotkey(e));if(t)return currentTriePosition=t,t instanceof Leaf?(fireDeterminedAction(t.children[t.children.length-1]),e.preventDefault(),void resetTriePosition()):void 0;resetTriePosition()}function install(e,t){0===Object.keys(hotkeyRadixTrie.children).length&&document.addEventListener("keydown",keyDownHandler);const i=expandHotkeyToEdges(t||e.getAttribute("data-hotkey")||"").map(t=>hotkeyRadixTrie.insert(t).add(e));elementsLeaves.set(e,i)}function uninstall(e){const t=elementsLeaves.get(e);if(t&&t.length)for(const i of t)i&&i.delete(e);0===Object.keys(hotkeyRadixTrie.children).length&&document.removeEventListener("keydown",keyDownHandler)}function HotKeyBehavior(e,t){let i=!1;return{connected(){setTimeout(()=>{const n=e.nuRef||e;n.dataset.hotkey=(t||"").trim(),install(n),log("hotkey installed",n,n.dataset.hotkey),i=!0},300)},disconnected(){i&&(uninstall(e),log("hotkey uninstalled",e,t),i=!1)}}}export default HotKeyBehavior;