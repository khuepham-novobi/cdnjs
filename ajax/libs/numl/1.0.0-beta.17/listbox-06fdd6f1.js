import{W as t,i as e,d as s,a as i,b as n}from"./index-133d9ede.js";export default class extends t{static get params(){return{input:!0,provideValue:!0}}init(){this.props.multiple=t=>{const e=n(t);return e&&this.setAttr("type","array"),this.setAria("aria-multiselectable",e),e},this.multiple=this.host.hasAttribute("multiple"),this.isPopup=this.host.hasAttribute("nu-popup"),this.isPopup&&this.forceLinkValue(),this.host.nuListBox=this,this.options=[],super.init(),this.setName("listbox"),this.setContext("listbox",this,!0),this.linkContext("button",(t=>{t&&this.linkValue&&(t.listbox=this,t.popup&&t.setAria("haspopup","listbox"))})),this.on("keydown",this.onKeyDown.bind(this)),this.on("keyup",this.onKeyUp.bind(this))}connected(){super.connected(),setTimeout((()=>{!this.current&&this.options.length&&(this.current=this.options[0].value)}))}setValue(t,s){this.multiple&&!Array.isArray(t)&&null!=t&&(t="string"==typeof t?t.split(/,/g).map((t=>t.trim())):[t]),e(this.value,t)||super.setValue(t,s)}toggleOption(t,e){if(!this.multiple)return void this.setValue(t,e);if(!this.getOptionByValue(t))return;let s=[...this.value||[]];Array.isArray(s)||(s=[]),this.current=t,s.includes(t)?s.splice(s.indexOf(t),1):s.push(t),this.updateCurrent(),this.setValue(s,e)}onKeyUp(t){switch(t.key){case" ":t.stopPropagation(),t.preventDefault(),this.toggleOption(this.current),!this.multiple&&t.target===this.host&&this.isPopup&&this.use("popup").then((t=>t.close()));break;default:return}t.nuListBoxHandled=!0}onKeyDown(t){const e=this.orderedOptions,s=this.currentOption;if(!e.length||s&&!e.includes(s))return;const i=e.indexOf(s);let n;switch(t.key){case"Home":if(!this.isEdgeMoveAllowed())return;n=e[0].value;break;case"End":if(!this.isEdgeMoveAllowed())return;n=e.slice(-1)[0].value;break;case"ArrowUp":if(i>0)n=e[i-1].value;else{if(-1!==i)return;n=e.slice(-1)[0].value}this.openPopup();break;case"ArrowDown":if(i<e.length-1)n=e[i+1].value;else{if(-1!==i)return;n=e[0].value}this.openPopup();break;case" ":return t.preventDefault(),void t.stopPropagation();case"Enter":this.setValue(this.current),t.target===this.host&&this.isPopup&&this.use("popup").then((t=>t.close()));break;default:return}t.nuListBoxHandled=!0,setTimeout((()=>{null!=n&&(this.current=n),this.updateCurrent()})),t.preventDefault()}isEdgeMoveAllowed(){if(!this.isPopup)return!0;const t=this.host.nuPopup;return!t||t.isOpen}openPopup(){if(!this.isPopup)return;const t=this.host.nuPopup;t&&!t.isOpen&&this.button&&this.button.set(!0,!0)}addOption(t){this.options.includes(t)||(this.options.push(t),this.current||(this.multiple?(this.value||[]).includes(t.value):e(this.value,t.value))&&(this.current=t.value))}get orderedOptions(){const t=this.options.map((t=>t.host));return s(this.host,"[nu-option]:not([disabled])").filter((e=>t.includes(e))).map((t=>this.options.find((e=>e.host===t)))).filter((t=>t))}get currentOption(){return this.options.find((t=>e(t.value,this.current)))}removeOption(t){this.options.includes(t)&&(this.options.splice(this.options.indexOf(t),1),this.current===t.value&&(this.current=!1))}getOptionByValue(t){return this.options.find((s=>e(s.value,t)))}updateCurrent(){this.options.forEach((t=>{t.setCurrent()})),setTimeout((()=>{const t=this.currentOption;t&&i(this.host,t.host)}))}}
