import{W as WidgetBehavior,y as getFloatFromAttr,i as isEqual}from"./index-da59e341.js";const EVENT_MAP={mousemove:"onDragging",touchmove:"onDragging",mouseup:"onDragEnd",touchend:"onDragEnd",contextmenu:"onDragEnd"};class SliderBehavior extends WidgetBehavior{static get params(){return{input:!0}}init(){this.props.value=(t=>{this.setValue(getFloatFromAttr(t,0),!0)}),this.props.min=(t=>getFloatFromAttr(t,0)),this.props.max=(t=>getFloatFromAttr(t,100)),this.props.step=(t=>getFloatFromAttr(t,1)),super.init(),this.require("orient","active","focus","hover"),this.on("keydown",t=>{const e=this.step*(t.shiftKey?10:1);switch(t.key){case"ArrowUp":case"ArrowRight":this.setValue(this.value+e);break;case"ArrowDown":case"ArrowLeft":this.setValue(this.value-e);break;default:return}t.preventDefault()})}connected(){super.connected();const{host:t}=this;this.onDragStart=this.onDragStart.bind(this),this.onDragging=this.onDragging.bind(this),this.onDragEnd=this.onDragEnd.bind(this),t.nuSetContext("disabled",this.disabled),["mousedown","touchstart"].forEach(t=>{this.on(t,this.onDragStart,{passive:!0})})}changed(t,e){super.changed(t,e),this.isConnected&&["min","max"].includes(t)&&this.setValue(this.value)}onDragStart(t){this.disabled||(this.setValueByEvent(t),this.dragging=!0,Object.entries(EVENT_MAP).forEach(([t,e])=>{window.addEventListener(t,this[e],{passive:!0})}))}onDragging(t){this.dragging&&this.setValueByEvent(t)}onDragEnd(t){this.dragging&&(this.dragging=!1,Object.entries(EVENT_MAP).forEach(([t,e])=>{window.removeEventListener(t,this[e])}))}setValueByEvent(t){const{host:e}=this,s=e.getBoundingClientRect();let i;if(this.use("orient").then(t=>t.set(s.width>s.height?"h":"v")),s.width>s.height){const e=(t.pageX||t.touches&&t.touches.length&&t.touches[0].pageX)-window.scrollX;i=Math.max(0,Math.min(1,(e-s.x)/s.width))}else{const e=(t.pageY||t.touches&&t.touches.length&&t.touches[0].pageY)-window.scrollY;i=1-Math.max(0,Math.min(1,(e-s.y)/s.height))}this.setPercents(i)}setPercents(t){if(null==t)return;const e=this.min,s=this.max,i=this.step;this.setValue(Math.round(t*(s-e)/i)*i+e)}setValue(t,e){const{host:s}=this,i=this.min,n=this.max;t!=t&&(t=i),t<i&&(t=i),t>n&&(t=n),isEqual(t,this.value)||(this.value=t,s.style.setProperty("--local-offset",this.getOffset(t)),this.setAria("valuemin",i),this.setAria("valuemax",n),this.setAria("valuenow",t),e||this.emit("input",t),this.control())}getOffset(t){let e=this.min;return`${((t-e)/(this.max-e)*100).toFixed(2)}%`}}export default SliderBehavior;