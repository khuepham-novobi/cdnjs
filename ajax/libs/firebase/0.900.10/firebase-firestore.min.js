!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@firebase/app")):"function"==typeof define&&define.amd?define(["exports","@firebase/app"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).firebase=t.firebase||{},t.firebase.firestore=t.firebase.firestore||{}),t.firebase.app)}(this,function(t,e){"use strict";try{(function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function s(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var i="FirebaseError",r=function(t){function e(n,s,r){var a=t.call(this,s)||this;return a.code=n,a.customData=r,a.name=i,Object.setPrototypeOf(a,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(a,o.prototype.create),a}return function(t,e){function s(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}(e,t),e}(Error),o=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var s=e[0]||{},i=this.service+"/"+t,o=this.errors[t],a=o?function(t,e){return t.replace(u,function(t,n){var s=e[n];return null!=s?String(s):"<"+n+"?>"})}(o,s):"Error",h=this.serviceName+": "+a+" ("+i+").";return new r(i,h,s)},t}();var a,h,u=/\{\$([^}]+)}/g,c=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t}();function l(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var s=Array(t),i=0;for(e=0;e<n;e++)for(var r=arguments[e],o=0,a=r.length;o<a;o++,i++)s[i]=r[o];return s}!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(h||(h={}));var f={debug:h.DEBUG,verbose:h.VERBOSE,info:h.INFO,warn:h.WARN,error:h.ERROR,silent:h.SILENT},d=h.INFO,p=((a={})[h.DEBUG]="log",a[h.VERBOSE]="log",a[h.INFO]="info",a[h.WARN]="warn",a[h.ERROR]="error",a),g=function(t,e){for(var n=[],s=2;s<arguments.length;s++)n[s-2]=arguments[s];if(!(e<t.logLevel)){var i=(new Date).toISOString(),r=p[e];if(!r)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[r].apply(console,l(["["+i+"]  "+t.name+":"],n))}},m=function(){function t(t){this.name=t,this._logLevel=d,this._logHandler=g,this._userLogHandler=null}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in h))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),t.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?f[t]:t},Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,h.DEBUG],t)),this._logHandler.apply(this,l([this,h.DEBUG],t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,h.VERBOSE],t)),this._logHandler.apply(this,l([this,h.VERBOSE],t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,h.INFO],t)),this._logHandler.apply(this,l([this,h.INFO],t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,h.WARN],t)),this._logHandler.apply(this,l([this,h.WARN],t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,h.ERROR],t)),this._logHandler.apply(this,l([this,h.ERROR],t))},t}(),y=function(t,e){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function w(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],s=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var v,b="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},E=E||{},I=b||self;function T(){}function _(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function N(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var A="closure_uid_"+(1e9*Math.random()>>>0),S=0;function x(t,e,n){return t.call.apply(t.bind,arguments)}function D(t,e,n){if(!t)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,s),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function k(t,e,n){return(k=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?x:D).apply(null,arguments)}function R(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function L(){return Date.now()}function O(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Kb=function(t,n,s){for(var i=Array(arguments.length-2),r=2;r<arguments.length;r++)i[r-2]=arguments[r];return e.prototype[n].apply(t,i)}}function C(){this.j=this.j,this.i=this.i}C.prototype.j=!1,C.prototype.ja=function(){if(!this.j&&(this.j=!0,this.G(),0))(function(t){Object.prototype.hasOwnProperty.call(t,A)&&t[A]||(t[A]=++S)})(this)},C.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var V=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},U=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var s=t.length,i="string"==typeof t?t.split(""):t,r=0;r<s;r++)r in i&&e.call(n,i[r],r,t)};function P(t){return Array.prototype.concat.apply([],arguments)}function M(t){var e=t.length;if(0<e){for(var n=Array(e),s=0;s<e;s++)n[s]=t[s];return n}return[]}function q(t){return/^[\s\xa0]*$/.test(t)}var F,j=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function G(t,e){return-1!=t.indexOf(e)}function B(t,e){return t<e?-1:t>e?1:0}t:{var K=I.navigator;if(K){var $=K.userAgent;if($){F=$;break t}}F=""}function z(t,e,n){for(var s in t)e.call(n,t[s],s,t)}function H(t){var e={};for(var n in t)e[n]=t[n];return e}var W="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Y(t,e){for(var n,s,i=1;i<arguments.length;i++){for(n in s=arguments[i])t[n]=s[n];for(var r=0;r<W.length;r++)n=W[r],Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}}function X(t){return X[" "](t),t}X[" "]=T;var J,Q,Z=G(F,"Opera"),tt=G(F,"Trident")||G(F,"MSIE"),et=G(F,"Edge"),nt=et||tt,st=G(F,"Gecko")&&!(G(F.toLowerCase(),"webkit")&&!G(F,"Edge"))&&!(G(F,"Trident")||G(F,"MSIE"))&&!G(F,"Edge"),it=G(F.toLowerCase(),"webkit")&&!G(F,"Edge");function rt(){var t=I.document;return t?t.documentMode:void 0}t:{var ot="",at=(Q=F,st?/rv:([^\);]+)(\)|;)/.exec(Q):et?/Edge\/([\d\.]+)/.exec(Q):tt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Q):it?/WebKit\/(\S+)/.exec(Q):Z?/(?:Version)[ \/]?(\S+)/.exec(Q):void 0);if(at&&(ot=at?at[1]:""),tt){var ht=rt();if(null!=ht&&ht>parseFloat(ot)){J=String(ht);break t}}J=ot}var ut,ct={};function lt(t){return function(t,e){var n=ct;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,function(){for(var e=0,n=j(String(J)).split("."),s=j(String(t)).split("."),i=Math.max(n.length,s.length),r=0;0==e&&r<i;r++){var o=n[r]||"",a=s[r]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;e=B(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||B(0==o[2].length,0==a[2].length)||B(o[2],a[2]),o=o[3],a=a[3]}while(0==e)}return 0<=e})}if(I.document&&tt){var ft=rt();ut=ft||(parseInt(J,10)||void 0)}else ut=void 0;var dt=ut,pt=!tt||9<=Number(dt),gt=tt&&!lt("9"),mt=function(){if(!I.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{I.addEventListener("test",T,e),I.removeEventListener("test",T,e)}catch(t){}return t}();function yt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function wt(t,e){if(yt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,s=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(st){t:{try{X(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,s?(this.clientX=void 0!==s.clientX?s.clientX:s.pageX,this.clientY=void 0!==s.clientY?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:vt[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}yt.prototype.b=function(){this.defaultPrevented=!0},O(wt,yt);var vt={2:"touch",3:"pen",4:"mouse"};wt.prototype.b=function(){wt.X.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,gt)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(t){}};var bt="closure_listenable_"+(1e6*Math.random()|0),Et=0;function It(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function Tt(t){this.src=t,this.a={},this.b=0}function _t(t,e){var n=e.type;if(n in t.a){var s,i=t.a[n],r=V(i,e);(s=0<=r)&&Array.prototype.splice.call(i,r,1),s&&(It(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function Nt(t,e,n,s){for(var i=0;i<t.length;++i){var r=t[i];if(!r.Y&&r.listener==e&&r.capture==!!n&&r.ca==s)return i}return-1}Tt.prototype.add=function(t,e,n,s,i){var r=t.toString();(t=this.a[r])||(t=this.a[r]=[],this.b++);var o=Nt(t,e,s,i);return-1<o?(e=t[o],n||(e.Z=!1)):((e=new function(t,e,n,s,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!s,this.ca=i,this.key=++Et,this.Y=this.Z=!1}(e,this.src,r,!!s,i)).Z=n,t.push(e)),e};var At="closure_lm_"+(1e6*Math.random()|0),St={};function xt(t,e,n,s,i){if(s&&s.once)return function t(e,n,s,i,r){if(Array.isArray(n)){for(var o=0;o<n.length;o++)t(e,n[o],s,i,r);return null}s=Ut(s);return e&&e[bt]?e.wa(n,s,N(i)?!!i.capture:!!i,r):Dt(e,n,s,!0,i,r)}(t,e,n,s,i);if(Array.isArray(e)){for(var r=0;r<e.length;r++)xt(t,e[r],n,s,i);return null}return n=Ut(n),t&&t[bt]?t.va(e,n,N(s)?!!s.capture:!!s,i):Dt(t,e,n,!1,s,i)}function Dt(t,e,n,s,i,r){if(!e)throw Error("Invalid event type");var o=N(i)?!!i.capture:!!i;if(o&&!pt)return null;var a=Ct(t);if(a||(t[At]=a=new Tt(t)),(n=a.add(e,n,s,o,r)).proxy)return n;if(s=function(){var t=Ot,e=pt?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=s,s.src=t,s.listener=n,t.addEventListener)mt||(i=o),void 0===i&&(i=!1),t.addEventListener(e.toString(),s,i);else if(t.attachEvent)t.attachEvent(Rt(e.toString()),s);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(s)}return n}function kt(t){if("number"!=typeof t&&t&&!t.Y){var e=t.src;if(e&&e[bt])_t(e.c,t);else{var n=t.type,s=t.proxy;e.removeEventListener?e.removeEventListener(n,s,t.capture):e.detachEvent?e.detachEvent(Rt(n),s):e.addListener&&e.removeListener&&e.removeListener(s),(n=Ct(e))?(_t(n,t),0==n.b&&(n.src=null,e[At]=null)):It(t)}}}function Rt(t){return t in St?St[t]:St[t]="on"+t}function Lt(t,e){var n=t.listener,s=t.ca||t.src;return t.Z&&kt(t),n.call(s,e)}function Ot(t,e){if(t.Y)return!0;if(!pt){if(!e)t:{e=["window","event"];for(var n=I,s=0;s<e.length;s++)if(null==(n=n[e[s]])){e=null;break t}e=n}return Lt(t,e=new wt(e,this))}return Lt(t,new wt(e,this))}function Ct(t){return(t=t[At])instanceof Tt?t:null}var Vt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ut(t){return"function"==typeof t?t:(t[Vt]||(t[Vt]=function(e){return t.handleEvent(e)}),t[Vt])}function Pt(){C.call(this),this.c=new Tt(this),this.J=this,this.C=null}function Mt(t,e){var n,s=t.C;if(s)for(n=[];s;s=s.C)n.push(s);if(t=t.J,s=e.type||e,"string"==typeof e)e=new yt(e,t);else if(e instanceof yt)e.target=e.target||t;else{var i=e;Y(e=new yt(s,t),i)}if(i=!0,n)for(var r=n.length-1;0<=r;r--){var o=e.a=n[r];i=qt(o,s,!0,e)&&i}if(i=qt(o=e.a=t,s,!0,e)&&i,i=qt(o,s,!1,e)&&i,n)for(r=0;r<n.length;r++)i=qt(o=e.a=n[r],s,!1,e)&&i}function qt(t,e,n,s){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,r=0;r<e.length;++r){var o=e[r];if(o&&!o.Y&&o.capture==n){var a=o.listener,h=o.ca||o.src;o.Z&&_t(t.c,o),i=!1!==a.call(h,s)&&i}}return i&&!s.defaultPrevented}O(Pt,C),Pt.prototype[bt]=!0,(v=Pt.prototype).addEventListener=function(t,e,n,s){xt(this,t,e,n,s)},v.removeEventListener=function(t,e,n,s){!function t(e,n,s,i,r){if(Array.isArray(n))for(var o=0;o<n.length;o++)t(e,n[o],s,i,r);else i=N(i)?!!i.capture:!!i,s=Ut(s),e&&e[bt]?(e=e.c,(n=String(n).toString())in e.a&&-1<(s=Nt(o=e.a[n],s,i,r))&&(It(o[s]),Array.prototype.splice.call(o,s,1),0==o.length&&(delete e.a[n],e.b--))):e&&(e=Ct(e))&&(n=e.a[n.toString()],e=-1,n&&(e=Nt(n,s,i,r)),(s=-1<e?n[e]:null)&&kt(s))}(this,t,e,n,s)},v.G=function(){if(Pt.X.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],s=0;s<n.length;s++)It(n[s]);delete e.a[t],e.b--}}this.C=null},v.va=function(t,e,n,s){return this.c.add(String(t),e,!1,n,s)},v.wa=function(t,e,n,s){return this.c.add(String(t),e,!0,n,s)};var Ft=I.JSON.stringify;function jt(){this.b=this.a=null}var Gt,Bt=new(function(){function t(t,e){this.c=t,this.f=e,this.b=0,this.a=null}return t.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},t}())(function(){return new $t},function(t){t.reset()});function Kt(){var t=Yt,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function $t(){this.next=this.b=this.a=null}function zt(t){I.setTimeout(function(){throw t},0)}function Ht(t,e){Gt||function(){var t=I.Promise.resolve(void 0);Gt=function(){t.then(Xt)}}(),Wt||(Gt(),Wt=!0),Yt.add(t,e)}jt.prototype.add=function(t,e){var n=Bt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},$t.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},$t.prototype.reset=function(){this.next=this.b=this.a=null};var Wt=!1,Yt=new jt;function Xt(){for(var t;t=Kt();){try{t.a.call(t.b)}catch(t){zt(t)}var e=Bt;e.f(t),100>e.b&&(e.b++,t.next=e.a,e.a=t)}Wt=!1}function Jt(t,e){Pt.call(this),this.b=t||1,this.a=e||I,this.f=k(this.Za,this),this.g=L()}function Qt(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function Zt(t,e,n){if("function"==typeof t)n&&(t=k(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=k(t.handleEvent,t)}return 2147483647<Number(e)?-1:I.setTimeout(t,e||0)}O(Jt,Pt),(v=Jt.prototype).aa=!1,v.M=null,v.Za=function(){if(this.aa){var t=L()-this.g;0<t&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),Mt(this,"tick"),this.aa&&(Qt(this),this.start()))}},v.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=L())},v.G=function(){Jt.X.G.call(this),Qt(this),delete this.a};var te=function(t){function e(e,n){var s=t.call(this)||this;return s.g=e,s.h=n,s.b=null,s.c=!1,s.a=null,s}return function(t,e){function n(){this.constructor=t}y(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:function t(e){e.a=Zt(function(){e.a=null,e.c&&(e.c=!1,t(e))},e.h);var n=e.b;e.b=null,e.g.apply(null,n)}(this)},e.prototype.G=function(){t.prototype.G.call(this),this.a&&(I.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},e}(C);function ee(t){C.call(this),this.b=t,this.a={}}O(ee,C);var ne=[];function se(t,e,n,s){Array.isArray(n)||(n&&(ne[0]=n.toString()),n=ne);for(var i=0;i<n.length;i++){var r=xt(e,n[i],s||t.handleEvent,!1,t.b||t);if(!r)break;t.a[r.key]=r}}function ie(t){z(t.a,function(t,e){this.a.hasOwnProperty(e)&&kt(t)},t),t.a={}}function re(){this.a=!0}function oe(t,e,n,s){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var s=n[t];if(!(2>s.length)){var i=s[1];if(Array.isArray(i)&&!(1>i.length)){var r=i[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<i.length;o++)i[o]=""}}}return Ft(n)}catch(t){return e}}(t,n)+(s?" "+s:"")})}ee.prototype.G=function(){ee.X.G.call(this),ie(this)},ee.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},re.prototype.info=function(){};var ae={},he=null;function ue(){return he=he||new Pt}function ce(t){yt.call(this,ae.Fa,t)}function le(t){var e=ue();Mt(e,new ce(e,t))}function fe(t,e){yt.call(this,ae.STAT_EVENT,t),this.stat=e}function de(t){var e=ue();Mt(e,new fe(e,t))}function pe(t){yt.call(this,ae.Ga,t)}function ge(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return I.setTimeout(function(){t()},e)}ae.Fa="serverreachability",O(ce,yt),ae.STAT_EVENT="statevent",O(fe,yt),ae.Ga="timingevent",O(pe,yt);var me={NO_ERROR:0,$a:1,nb:2,mb:3,hb:4,lb:5,ob:6,Da:7,TIMEOUT:8,rb:9},ye={fb:"complete",Bb:"success",Ea:"error",Da:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",ib:"downloadprogress",Jb:"uploadprogress"};function we(){}function ve(t){var e;return(e=t.a)||(e=t.a={}),e}function be(){}we.prototype.a=null;var Ee,Ie={OPEN:"a",eb:"b",Ea:"c",qb:"d"};function Te(){yt.call(this,"d")}function _e(){yt.call(this,"c")}function Ne(){}function Ae(t,e,n,s){this.g=t,this.c=e,this.f=n,this.S=s||1,this.J=new ee(this),this.P=Se,t=nt?125:void 0,this.R=new Jt(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}O(Te,yt),O(_e,yt),O(Ne,we),Ee=new Ne;var Se=45e3,xe={},De={};function ke(t,e,n){t.H=1,t.i=Qe(ze(e)),t.j=n,t.I=!0,Re(t,null)}function Re(t,e){t.u=L(),Ce(t),t.l=ze(t.i);var n=t.l,s=t.S;Array.isArray(s)||(s=[String(s)]),fn(n.b,"t",s),t.D=0,t.a=rs(t.g,t.g.C?e:null),0<t.O&&(t.F=new te(k(t.Ca,t,t.a),t.O)),se(t.J,t.a,"readystatechange",t.Xa),e=t.B?H(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),le(1),function(t,e,n,s,i,r){t.info(function(){if(t.a)if(r)for(var o="",a=r.split("&"),h=0;h<a.length;h++){var u=a[h].split("=");if(1<u.length){var c=u[0];u=u[1];var l=c.split("_");o=2<=l.length&&"type"==l[1]?o+(c+"=")+u+"&":o+(c+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+s+") [attempt "+i+"]: "+e+"\n"+n+"\n"+o})}(t.c,t.m,t.l,t.f,t.S,t.j)}function Le(t,e,n){for(var s=!0;!t.A&&t.D<n.length;){var i=Oe(t,n);if(i==De){4==e&&(t.h=4,de(14),s=!1),oe(t.c,t.f,null,"[Incomplete Response]");break}if(i==xe){t.h=4,de(15),oe(t.c,t.f,n,"[Invalid Chunk]"),s=!1;break}oe(t.c,t.f,i,null),qe(t,i)}4==e&&0==n.length&&(t.h=1,de(16),s=!1),t.b=t.b&&s,s?0<n.length&&!t.V&&(t.V=!0,(e=t.g).a==t&&e.U&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),Jn(e),e.F=!0,de(11))):(oe(t.c,t.f,n,"[Invalid Chunked Response]"),Me(t),Pe(t))}function Oe(t,e){var n=t.D,s=e.indexOf("\n",n);return-1==s?De:(n=Number(e.substring(n,s)),isNaN(n)?xe:(s+=1)+n>e.length?De:(e=e.substr(s,n),t.D=s+n,e))}function Ce(t){t.T=L()+t.P,Ve(t,t.P)}function Ve(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=ge(k(t.Va,t),e)}function Ue(t){t.o&&(I.clearTimeout(t.o),t.o=null)}function Pe(t){0==t.g.v||t.A||ts(t.g,t)}function Me(t){Ue(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,Qt(t.R),ie(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function qe(t,e){try{var n=t.g;if(0!=n.v&&(n.a==t||vn(n.b,t)))if(n.I=t.N,!t.C&&vn(n.b,t)&&3==n.v){try{var s=n.ka.a.parse(e)}catch(t){s=null}if(Array.isArray(s)&&3==s.length){var i=s;if(0==i[0]){t:if(!n.j){if(n.a){if(!(n.a.u+3e3<t.u))break t;Zn(n),Gn(n)}Xn(n),de(18)}}else n.oa=i[1],0<n.oa-n.P&&37500>i[2]&&n.H&&0==n.o&&!n.m&&(n.m=ge(k(n.Sa,n),6e3));if(1>=wn(n.b)&&n.ea){try{n.ea()}catch(t){}n.ea=void 0}}else ns(n,11)}else if((t.C||n.a==t)&&Zn(n),!q(e))for(e=s=n.ka.a.parse(e),s=0;s<e.length;s++)if(i=e[s],n.P=i[0],i=i[1],2==n.v)if("c"==i[0]){n.J=i[1],n.ga=i[2];var r=i[3];null!=r&&(n.ha=r,n.c.info("VER="+n.ha));var o=i[4];null!=o&&(n.pa=o,n.c.info("SVER="+n.pa));var a=i[5];if(null!=a&&"number"==typeof a&&0<a){var h=1.5*a;n.D=h,n.c.info("backChannelRequestTimeoutMs_="+h)}h=n;var u=t.a;if(u){var c=u.a?u.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(c){var l=h.b;!l.a&&(G(c,"spdy")||G(c,"quic")||G(c,"h2"))&&(l.f=l.g,l.a=new Set,l.b&&(bn(l,l.b),l.b=null))}if(h.A){var f=u.a?u.a.getResponseHeader("X-HTTP-Session-Id"):null;f&&(h.na=f,Je(h.B,h.A,f))}}n.v=3,n.f&&n.f.ta(),n.U&&(n.N=L()-t.u,n.c.info("Handshake RTT: "+n.N+"ms"));var d=t;if((h=n).la=is(h,h.C?h.ga:null,h.fa),d.C){En(h.b,d);var p=d,g=h.D;g&&p.setTimeout(g),p.o&&(Ue(p),Ce(p)),h.a=d}else Yn(h);0<n.g.length&&$n(n)}else"stop"!=i[0]&&"close"!=i[0]||ns(n,7);else 3==n.v&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?ns(n,7):jn(n):"noop"!=i[0]&&n.f&&n.f.sa(i),n.o=0);le(4)}catch(t){}}function Fe(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(_(t)||"string"==typeof t)U(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(_(t)||"string"==typeof t){n=[];for(var s=t.length,i=0;i<s;i++)n.push(i)}else for(i in n=[],s=0,t)n[s++]=i;i=(s=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(_(t)){for(var e=[],n=t.length,s=0;s<n;s++)e.push(t[s]);return e}for(s in e=[],n=0,t)e[n++]=t[s];return e}(t)).length;for(var r=0;r<i;r++)e.call(void 0,s[r],n&&n[r],t)}}function je(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var s=0;s<n;s+=2)this.set(arguments[s],arguments[s+1])}else if(t)if(t instanceof je)for(n=t.L(),s=0;s<n.length;s++)this.set(n[s],t.get(n[s]));else for(s in t)this.set(s,t[s])}function Ge(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var s=t.a[e];Be(t.b,s)&&(t.a[n++]=s),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Be(i,s=t.a[e])||(t.a[n++]=s,i[s]=1),e++;t.a.length=n}}function Be(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(v=Ae.prototype).setTimeout=function(t){this.P=t},v.Xa=function(t){t=t.target;var e=this.F;e&&3==Pn(t)?e.f():this.Ca(t)},v.Ca=function(t){try{if(t==this.a)t:{var e=Pn(this.a),n=this.a.ua(),s=this.a.W();if(!(3>e||3==e&&!nt&&!this.a.$())){this.A||4!=e||7==n||le(8==n||0>=s?3:2),Ue(this);var i=this.a.W();this.N=i;var r=this.a.$();if(this.b=200==i,function(t,e,n,s,i,r,o){t.info(function(){return"XMLHTTP RESP ("+s+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+r+" "+o})}(this.c,this.m,this.l,this.f,this.S,e,i),this.b){if(this.U&&!this.C){e:{if(this.a){var o,a=this.a;if((o=a.a?a.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!q(o)){var h=o;break e}}h=null}if(!h){this.b=!1,this.h=3,de(12),Me(this),Pe(this);break t}oe(this.c,this.f,h,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,qe(this,h)}this.I?(Le(this,e,r),nt&&this.b&&3==e&&(se(this.J,this.R,"tick",this.Wa),this.R.start())):(oe(this.c,this.f,r,null),qe(this,r)),4==e&&Me(this),this.b&&!this.A&&(4==e?ts(this.g,this):(this.b=!1,Ce(this)))}else 400==i&&0<r.indexOf("Unknown SID")?(this.h=3,de(12)):(this.h=0,de(13)),Me(this),Pe(this)}}}catch(t){}},v.Wa=function(){if(this.a){var t=Pn(this.a),e=this.a.$();this.D<e.length&&(Ue(this),Le(this,t,e),this.b&&4!=t&&Ce(this))}},v.cancel=function(){this.A=!0,Me(this)},v.Va=function(){this.o=null;var t=L();0<=t-this.T?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.c,this.l),2!=this.H&&(le(3),de(17)),Me(this),this.h=2,Pe(this)):Ve(this,this.T-t)},(v=je.prototype).K=function(){Ge(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},v.L=function(){return Ge(this),this.a.concat()},v.get=function(t,e){return Be(this.b,t)?this.b[t]:e},v.set=function(t,e){Be(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},v.forEach=function(t,e){for(var n=this.L(),s=0;s<n.length;s++){var i=n[s],r=this.get(i);t.call(e,r,i,this)}};var Ke=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function $e(t,e){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof $e){this.a=void 0!==e?e:t.a,He(this,t.f),this.j=t.j,We(this,t.c),Ye(this,t.h),this.g=t.g,e=t.b;var n=new hn;n.c=e.c,e.a&&(n.a=new je(e.a),n.b=e.b),Xe(this,n),this.i=t.i}else t&&(n=String(t).match(Ke))?(this.a=!!e,He(this,n[1]||"",!0),this.j=Ze(n[2]||""),We(this,n[3]||"",!0),Ye(this,n[4]),this.g=Ze(n[5]||"",!0),Xe(this,n[6]||"",!0),this.i=Ze(n[7]||"")):(this.a=!!e,this.b=new hn(null,this.a))}function ze(t){return new $e(t)}function He(t,e,n){t.f=n?Ze(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function We(t,e,n){t.c=n?Ze(e,!0):e}function Ye(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.h=e}else t.h=null}function Xe(t,e,n){e instanceof hn?(t.b=e,function(t,e){e&&!t.f&&(un(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(cn(this,e),fn(this,n,t))},t)),t.f=e}(t.b,t.a)):(n||(e=tn(e,on)),t.b=new hn(e,t.a))}function Je(t,e,n){t.b.set(e,n)}function Qe(t){return Je(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^L()).toString(36)),t}function Ze(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function tn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,en),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function en(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}$e.prototype.toString=function(){var t=[],e=this.f;e&&t.push(tn(e,nn,!0),":");var n=this.c;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(tn(e,nn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(tn(n,"/"==n.charAt(0)?rn:sn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",tn(n,an)),t.join("")};var nn=/[#\/\?@]/g,sn=/[#\?:]/g,rn=/[#\?]/g,on=/[#\?@]/g,an=/#/g;function hn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function un(t){t.a||(t.a=new je,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var s=t[n].indexOf("="),i=null;if(0<=s){var r=t[n].substring(0,s);i=t[n].substring(s+1)}else r=t[n];e(r,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function cn(t,e){un(t),e=dn(t,e),Be(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Be((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Ge(t)))}function ln(t,e){return un(t),e=dn(t,e),Be(t.a.b,e)}function fn(t,e,n){cn(t,e),0<n.length&&(t.c=null,t.a.set(dn(t,e),M(n)),t.b+=n.length)}function dn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(v=hn.prototype).add=function(t,e){un(this),this.c=null,t=dn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},v.forEach=function(t,e){un(this),this.a.forEach(function(n,s){U(n,function(n){t.call(e,n,s,this)},this)},this)},v.L=function(){un(this);for(var t=this.a.K(),e=this.a.L(),n=[],s=0;s<e.length;s++)for(var i=t[s],r=0;r<i.length;r++)n.push(e[s]);return n},v.K=function(t){un(this);var e=[];if("string"==typeof t)ln(this,t)&&(e=P(e,this.a.get(dn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=P(e,t[n])}return e},v.set=function(t,e){return un(this),this.c=null,ln(this,t=dn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},v.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},v.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++){var s=e[n],i=encodeURIComponent(String(s));s=this.K(s);for(var r=0;r<s.length;r++){var o=i;""!==s[r]&&(o+="="+encodeURIComponent(String(s[r]))),t.push(o)}}return this.c=t.join("&")};var pn=function(){return function(t,e){this.b=t,this.a=e}}();function gn(t){this.g=t||mn,I.PerformanceNavigationTiming?t=0<(t=I.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(I.ia&&I.ia.ya&&I.ia.ya()&&I.ia.ya().Lb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var mn=10;function yn(t){return!!t.b||!!t.a&&t.a.size>=t.f}function wn(t){return t.b?1:t.a?t.a.size:0}function vn(t,e){return t.b?t.b==e:!!t.a&&t.a.has(e)}function bn(t,e){t.a?t.a.add(e):t.b=e}function En(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function In(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null!=t.a&&0!==t.a.size){var s=t.c;try{for(var i=w(t.a.values()),r=i.next();!r.done;r=i.next()){var o=r.value;s=s.concat(o.s)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return s}return M(t.c)}function Tn(){}function _n(t,e,n){var s=n||"";try{Fe(t,function(t,n){var i=t;N(t)&&(i=Ft(t)),e.push(s+n+"="+encodeURIComponent(i))})}catch(t){throw e.push(s+"type="+encodeURIComponent("_badmap")),t}}function Nn(t,e,n,s,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(s)}catch(t){}}gn.prototype.cancel=function(){var t,e;if(this.c=In(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=w(this.a.values()),s=n.next();!s.done;s=n.next()){s.value.cancel()}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},Tn.prototype.stringify=function(t){return I.JSON.stringify(t,void 0)},Tn.prototype.parse=function(t){return I.JSON.parse(t,void 0)};var An=I.JSON.parse;function Sn(t){Pt.call(this),this.headers=new je,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=xn,this.D=this.F=!1}O(Sn,Pt);var xn="",Dn=/^https?$/i,kn=["POST","PUT"];function Rn(t){return"content-type"==t.toLowerCase()}function Ln(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,On(t),Vn(t)}function On(t){t.u||(t.u=!0,Mt(t,"complete"),Mt(t,"error"))}function Cn(t){if(t.b&&void 0!==E&&(!t.s[1]||4!=Pn(t)||2!=t.W()))if(t.l&&4==Pn(t))Zt(t.za,0,t);else if(Mt(t,"readystatechange"),4==Pn(t)){t.b=!1;try{var e,n=t.W();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}if(!(e=s)){var i;if(i=0===n){var r=String(t.B).match(Ke)[1]||null;if(!r&&I.self&&I.self.location){var o=I.self.location.protocol;r=o.substr(0,o.length-1)}i=!Dn.test(r?r.toLowerCase():"")}e=i}if(e)Mt(t,"complete"),Mt(t,"success");else{t.h=6;try{var a=2<Pn(t)?t.a.statusText:""}catch(n){a=""}t.f=a+" ["+t.W()+"]",On(t)}}finally{Vn(t)}}}function Vn(t,e){if(t.a){Un(t);var n=t.a,s=t.s[0]?T:null;t.a=null,t.s=null,e||Mt(t,"ready");try{n.onreadystatechange=s}catch(t){}}}function Un(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(I.clearTimeout(t.m),t.m=null)}function Pn(t){return t.a?t.a.readyState:0}function Mn(t,e,n){t:{for(s in n){var s=!1;break t}s=!0}s||(n=function(t){var e="";return z(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Je(t,e,n))}function qn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Fn(t){this.pa=0,this.g=[],this.c=new re,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.V=this.i=this.O=this.l=null,this.Oa=this.R=0,this.La=qn("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Ha=qn("baseRetryDelayMs",5e3,t),this.Ra=qn("retryDelaySeedMs",1e4,t),this.Ma=qn("forwardChannelMaxRetries",2,t),this.ma=qn("forwardChannelRequestTimeoutMs",2e4,t),this.Na=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new gn(t&&t.concurrentRequestLimit),this.ka=new function(){this.a=new Tn},this.da=t&&t.fastHandshake||!1,this.Ia=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.S=!1),this.U=!this.da&&this.S&&t&&t.detectBufferingProxy||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null,(this.Ka=t&&t.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function jn(t){if(Bn(t),3==t.v){var e=t.R++,n=ze(t.B);Je(n,"SID",t.J),Je(n,"RID",e),Je(n,"TYPE","terminate"),Hn(t,n),(e=new Ae(t,t.c,e,void 0)).H=2,e.i=Qe(ze(n)),n=!1,I.navigator&&I.navigator.sendBeacon&&(n=I.navigator.sendBeacon(e.i.toString(),"")),!n&&I.Image&&((new Image).src=e.i,n=!0),n||(e.a=rs(e.g,null),e.a.ba(e.i)),e.u=L(),Ce(e)}ss(t)}function Gn(t){t.a&&(Jn(t),t.a.cancel(),t.a=null)}function Bn(t){Gn(t),t.j&&(I.clearTimeout(t.j),t.j=null),Zn(t),t.b.cancel(),t.h&&("number"==typeof t.h&&I.clearTimeout(t.h),t.h=null)}function Kn(t,e){t.g.push(new pn(t.Oa++,e)),3==t.v&&$n(t)}function $n(t){yn(t.b)||t.h||(t.h=!0,Ht(t.Ba,t),t.u=0)}function zn(t,e){var n;n=e?e.f:t.R++;var s=ze(t.B);Je(s,"SID",t.J),Je(s,"RID",n),Je(s,"AID",t.P),Hn(t,s),t.i&&t.l&&Mn(s,t.i,t.l),n=new Ae(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=Wn(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),bn(t.b,n),ke(n,s,e)}function Hn(t,e){t.f&&Fe({},function(t,n){Je(e,n,t)})}function Wn(t,e,n){n=Math.min(t.g.length,n);var s=t.f?k(t.f.Ja,t.f,t):null;t:for(var i=t.g,r=-1;;){var o=["count="+n];-1==r?0<n?(r=i[0].b,o.push("ofs="+r)):r=0:o.push("ofs="+r);for(var a=!0,h=0;h<n;h++){var u=i[h].b,c=i[h].a;if(0>(u-=r))r=Math.max(0,i[h].b-100),a=!1;else try{_n(c,o,"req"+u+"_")}catch(t){s&&s(c)}}if(a){s=o.join("&");break t}}return t=t.g.splice(0,n),e.s=t,s}function Yn(t){t.a||t.j||(t.T=1,Ht(t.Aa,t),t.o=0)}function Xn(t){return!(t.a||t.j||3<=t.o)&&(t.T++,t.j=ge(k(t.Aa,t),es(t,t.o)),t.o++,!0)}function Jn(t){null!=t.s&&(I.clearTimeout(t.s),t.s=null)}function Qn(t){t.a=new Ae(t,t.c,"rpc",t.T),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=ze(t.la);Je(e,"RID","rpc"),Je(e,"SID",t.J),Je(e,"CI",t.H?"0":"1"),Je(e,"AID",t.P),Hn(t,e),Je(e,"TYPE","xmlhttp"),t.i&&t.l&&Mn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=Qe(ze(e)),n.j=null,n.I=!0,Re(n,t)}function Zn(t){null!=t.m&&(I.clearTimeout(t.m),t.m=null)}function ts(t,e){var n=null;if(t.a==e){Zn(t),Jn(t),t.a=null;var s=2}else{if(!vn(t.b,e))return;n=e.s,En(t.b,e),s=1}if(t.I=e.N,0!=t.v)if(e.b)if(1==s){n=e.j?e.j.length:0,e=L()-e.u;var i=t.u;Mt(s=ue(),new pe(s,n,e,i)),$n(t)}else Yn(t);else if(3==(i=e.h)||0==i&&0<t.I||!(1==s&&function(t,e){return!(wn(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.g=e.s.concat(t.g),0):1==t.v||2==t.v||t.u>=(t.La?0:t.Ma)||(t.h=ge(k(t.Ba,t,e),es(t,t.u)),t.u++,0)))}(t,e)||2==s&&Xn(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),i){case 1:ns(t,5);break;case 4:ns(t,10);break;case 3:ns(t,6);break;default:ns(t,2)}}function es(t,e){var n=t.Ha+Math.floor(Math.random()*t.Ra);return t.f||(n*=2),n*e}function ns(t,e){if(t.c.info("Error code "+e),2==e){var n=null;t.f&&(n=null);var s=k(t.Ya,t);n||(n=new $e("//www.google.com/images/cleardot.gif"),I.location&&"http"==I.location.protocol||He(n,"https"),Qe(n)),function(t,e){var n=new re;if(I.Image){var s=new Image;s.onload=R(Nn,n,s,"TestLoadImage: loaded",!0,e),s.onerror=R(Nn,n,s,"TestLoadImage: error",!1,e),s.onabort=R(Nn,n,s,"TestLoadImage: abort",!1,e),s.ontimeout=R(Nn,n,s,"TestLoadImage: timeout",!1,e),I.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=t}else e(!1)}(n.toString(),s)}else de(2);t.v=0,t.f&&t.f.ra(e),ss(t),Bn(t)}function ss(t){t.v=0,t.I=-1,t.f&&(0==In(t.b).length&&0==t.g.length||(t.b.c.length=0,M(t.g),t.g.length=0),t.f.qa())}function is(t,e,n){var s=function(t){return t instanceof $e?ze(t):new $e(t,void 0)}(n);if(""!=s.c)e&&We(s,e+"."+s.c),Ye(s,s.h);else{var i=I.location;s=function(t,e,n,s){var i=new $e(null,void 0);return t&&He(i,t),e&&We(i,e),n&&Ye(i,n),s&&(i.g=s),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.V&&z(t.V,function(t,e){Je(s,e,t)}),e=t.A,n=t.na,e&&n&&Je(s,e,n),Je(s,"VER",t.ha),Hn(t,s),s}function rs(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Sn(t.Na)).F=t.C,e}function os(){}function as(){if(tt&&!(10<=Number(dt)))throw Error("Environmental error: no available transport.")}function hs(t,e){Pt.call(this),this.a=new Fn(e),this.o=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!q(t)&&(this.a.i=t),this.m=e&&e.supportsCrossDomainXhr||!1,this.l=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!q(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new ls(this)}function us(t){Te.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function cs(){_e.call(this),this.status=1}function ls(t){this.a=t}(v=Sn.prototype).ba=function(t,e,n,s){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?ve(this.H):ve(Ee),this.a.onreadystatechange=k(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(t){return void Ln(this,t)}t=n||"";var i=new je(this.headers);s&&Fe(s,function(t,e){i.set(e,t)}),s=function(t){t:{for(var e=Rn,n=t.length,s="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in s&&e.call(void 0,s[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.L()),n=I.FormData&&t instanceof I.FormData,!(0<=V(kn,e))||s||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Un(this),0<this.o&&((this.D=function(t){return tt&&lt(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=k(this.xa,this)):this.m=Zt(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Ln(this,t)}},v.xa=function(){void 0!==E&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,Mt(this,"timeout"),this.abort(8))},v.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,Mt(this,"complete"),Mt(this,"abort"),Vn(this))},v.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Vn(this,!0)),Sn.X.G.call(this)},v.za=function(){this.j||(this.A||this.l||this.g?Cn(this):this.Ua())},v.Ua=function(){Cn(this)},v.W=function(){try{return 2<Pn(this)?this.a.status:-1}catch(t){return-1}},v.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},v.Pa=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),An(e)}},v.ua=function(){return this.h},v.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(v=Fn.prototype).ha=8,v.v=1,v.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new Ae(this,this.c,t,void 0),s=this.l;if(this.O&&(s?Y(s=H(s),this.O):s=this.O),null===this.i&&(n.B=s),this.da)t:{for(var i=e=0;i<this.g.length;i++){var r=this.g[i];if(void 0===(r="__data__"in r.a&&"string"==typeof(r=r.a.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Wn(this,n,e),Je(i=ze(this.B),"RID",t),Je(i,"CVER",22),this.A&&Je(i,"X-HTTP-Session-Id",this.A),Hn(this,i),this.i&&s&&Mn(i,this.i,s),bn(this.b,n),this.Ia&&Je(i,"TYPE","init"),this.da?(Je(i,"$req",e),Je(i,"SID","null"),n.U=!0,ke(n,i,null)):ke(n,i,e),this.v=2}}else 3==this.v&&(t?zn(this,t):0==this.g.length||yn(this.b)||zn(this))},v.Aa=function(){if(this.j=null,Qn(this),this.U&&!(this.F||null==this.a||0>=this.N)){var t=2*this.N;this.c.info("BP detection timer enabled: "+t),this.s=ge(k(this.Ta,this),t)}},v.Ta=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,de(10),Gn(this),Qn(this))},v.Sa=function(){null!=this.m&&(this.m=null,Gn(this),Xn(this),de(19))},v.Ya=function(t){t?(this.c.info("Successfully pinged google.com"),de(2)):(this.c.info("Failed to ping google.com"),de(1))},(v=os.prototype).ta=function(){},v.sa=function(){},v.ra=function(){},v.qa=function(){},v.Ja=function(){},as.prototype.a=function(t,e){return new hs(t,e)},O(hs,Pt),hs.prototype.g=function(){this.a.f=this.f,this.m&&(this.a.C=!0);var t=this.a,e=this.o,n=this.b||void 0;de(0),t.fa=e,t.V=n||{},t.H=t.S,t.B=is(t,null,t.fa),$n(t)},hs.prototype.close=function(){jn(this.a)},hs.prototype.h=function(t){if("string"==typeof t){var e={};e.__data__=t,Kn(this.a,e)}else this.l?((e={}).__data__=Ft(t),Kn(this.a,e)):Kn(this.a,t)},hs.prototype.G=function(){this.a.f=null,delete this.f,jn(this.a),delete this.a,hs.X.G.call(this)},O(us,Te),O(cs,_e),O(ls,os),ls.prototype.ta=function(){Mt(this.a,"a")},ls.prototype.sa=function(t){Mt(this.a,new us(t))},ls.prototype.ra=function(t){Mt(this.a,new cs(t))},ls.prototype.qa=function(){Mt(this.a,"b")},as.prototype.createWebChannel=as.prototype.a,hs.prototype.send=hs.prototype.h,hs.prototype.open=hs.prototype.g,hs.prototype.close=hs.prototype.close,me.NO_ERROR=0,me.TIMEOUT=8,me.HTTP_ERROR=6,ye.COMPLETE="complete",be.EventType=Ie,Ie.OPEN="a",Ie.CLOSE="b",Ie.ERROR="c",Ie.MESSAGE="d",Pt.prototype.listen=Pt.prototype.va,Sn.prototype.listenOnce=Sn.prototype.wa,Sn.prototype.getLastError=Sn.prototype.Qa,Sn.prototype.getLastErrorCode=Sn.prototype.ua,Sn.prototype.getStatus=Sn.prototype.W,Sn.prototype.getResponseJson=Sn.prototype.Pa,Sn.prototype.getResponseText=Sn.prototype.$,Sn.prototype.send=Sn.prototype.ba;var fs=function(){return new as},ds=function(){return ue()},ps=me,gs=ye,ms=ae,ys={gb:0,jb:1,kb:2,Db:3,Ib:4,Fb:5,Gb:6,Eb:7,Cb:8,Hb:9,PROXY:10,NOPROXY:11,Ab:12,wb:13,xb:14,vb:15,yb:16,zb:17,bb:18,ab:19,cb:20},ws=be,vs=Sn;class bs{constructor(t){this.uid=t}t(){return null!=this.uid}i(){return this.t()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}bs.UNAUTHENTICATED=new bs(null),bs.o=new bs("google-credentials-uid"),bs.u=new bs("first-party-uid");const Es=new m("@firebase/firestore");function Is(){return Es.logLevel}function Ts(t,...e){if(Es.logLevel<=h.DEBUG){const n=e.map(As);Es.debug("Firestore (8.2.3): "+t,...n)}}function _s(t,...e){if(Es.logLevel<=h.ERROR){const n=e.map(As);Es.error("Firestore (8.2.3): "+t,...n)}}function Ns(t,...e){if(Es.logLevel<=h.WARN){const n=e.map(As);Es.warn("Firestore (8.2.3): "+t,...n)}}function As(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function Ss(t="Unexpected state"){const e="FIRESTORE (8.2.3) INTERNAL ASSERTION FAILED: "+t;throw _s(e),new Error(e)}function xs(t,e){t||Ss()}function Ds(t,e){return t}const ks={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Rs extends Error{constructor(t,e){super(e),this.code=t,this.message=e,this.name="FirebaseError",this.toString=(()=>`${this.name}: [code=${this.code}]: ${this.message}`)}}class Ls{constructor(t,e){this.user=e,this.type="OAuth",this.h={},this.h.Authorization="Bearer "+t}}class Os{constructor(){this.l=null}getToken(){return Promise.resolve(null)}_(){}T(t){this.l=t,t(bs.UNAUTHENTICATED)}I(){this.l=null}}class Cs{constructor(t){this.m=null,this.currentUser=bs.UNAUTHENTICATED,this.A=!1,this.R=0,this.l=null,this.forceRefresh=!1,this.m=(()=>{this.R++,this.currentUser=this.P(),this.A=!0,this.l&&this.l(this.currentUser)}),this.R=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.m):(this.m(null),t.get().then(t=>{this.auth=t,this.m&&this.auth.addAuthTokenListener(this.m)},()=>{}))}getToken(){const t=this.R,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.R!==t?(Ts("FirebaseCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(xs("string"==typeof e.accessToken),new Ls(e.accessToken,this.currentUser)):null):Promise.resolve(null)}_(){this.forceRefresh=!0}T(t){this.l=t,this.A&&t(this.currentUser)}I(){this.auth&&this.auth.removeAuthTokenListener(this.m),this.m=null,this.l=null}P(){const t=this.auth&&this.auth.getUid();return xs(null===t||"string"==typeof t),new bs(t)}}class Vs{constructor(t,e){this.V=t,this.g=e,this.type="FirstParty",this.user=bs.u}get h(){const t={"X-Goog-AuthUser":this.g},e=this.V.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t}}class Us{constructor(t,e){this.V=t,this.g=e}getToken(){return Promise.resolve(new Vs(this.V,this.g))}T(t){t(bs.u)}I(){}_(){}}class Ps{constructor(t,e,n,s,i,r){this.p=t,this.persistenceKey=e,this.host=n,this.ssl=s,this.forceLongPolling=i,this.v=r}}class Ms{constructor(t,e){this.projectId=t,this.database=e||"(default)"}get S(){return"(default)"===this.database}isEqual(t){return t instanceof Ms&&t.projectId===this.projectId&&t.database===this.database}}class qs{constructor(t,e){this.previousValue=t,e&&(e.D=(t=>this.C(t)),this.N=(t=>e.O(t)))}C(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.N&&this.N(t),t}}function Fs(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}qs.k=-1;class js{static M(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const s=Fs(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<e&&(n+=t.charAt(s[i]%t.length))}return n}}function Gs(t,e){return t<e?-1:t>e?1:0}function Bs(t,e,n){return t.length===e.length&&t.every((t,s)=>n(t,e[s]))}function Ks(t){return t+"\0"}class $s{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Rs(ks.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Rs(ks.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Rs(ks.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Rs(ks.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return $s.fromMillis(Date.now())}static fromDate(t){return $s.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3);return new $s(e,1e6*(t-1e3*e))}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}F(t){return this.seconds===t.seconds?Gs(this.nanoseconds,t.nanoseconds):Gs(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class zs{constructor(t){this.timestamp=t}static $(t){return new zs(t)}static min(){return new zs(new $s(0,0))}L(t){return this.timestamp.F(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}B(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}q(){return this.timestamp}}class Hs{constructor(t,e,n){void 0===e?e=0:e>t.length&&Ss(),void 0===n?n=t.length-e:n>t.length-e&&Ss(),this.segments=t,this.offset=e,this.U=n}get length(){return this.U}isEqual(t){return 0===Hs.K(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Hs?t.forEach(t=>{e.push(t)}):e.push(t),this.W(e)}limit(){return this.offset+this.length}j(t){return t=void 0===t?1:t,this.W(this.segments,this.offset+t,this.length-t)}G(){return this.W(this.segments,this.offset,this.length-1)}H(){return this.segments[this.offset]}J(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}Y(){return 0===this.length}X(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}Z(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}tt(){return this.segments.slice(this.offset,this.limit())}static K(t,e){const n=Math.min(t.length,e.length);for(let s=0;s<n;s++){const n=t.get(s),i=e.get(s);if(n<i)return-1;if(n>i)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class Ws extends Hs{W(t,e,n){return new Ws(t,e,n)}et(){return this.tt().join("/")}toString(){return this.et()}static nt(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new Rs(ks.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter(t=>t.length>0))}return new Ws(e)}static st(){return new Ws([])}}const Ys=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Xs extends Hs{W(t,e,n){return new Xs(t,e,n)}static it(t){return Ys.test(t)}et(){return this.tt().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Xs.it(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.et()}rt(){return 1===this.length&&"__name__"===this.get(0)}static ot(){return new Xs(["__name__"])}static ct(t){const e=[];let n="",s=0;const i=()=>{if(0===n.length)throw new Rs(ks.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let r=!1;for(;s<t.length;){const e=t[s];if("\\"===e){if(s+1===t.length)throw new Rs(ks.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[s+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Rs(ks.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,s+=2}else"`"===e?(r=!r,s++):"."!==e||r?(n+=e,s++):(i(),s++)}if(i(),r)throw new Rs(ks.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Xs(e)}static st(){return new Xs([])}}class Js{constructor(t){this.path=t}static ut(t){return new Js(Ws.nt(t))}static at(t){return new Js(Ws.nt(t).j(5))}ht(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}isEqual(t){return null!==t&&0===Ws.K(this.path,t.path)}toString(){return this.path.toString()}static K(t,e){return Ws.K(t.path,e.path)}static lt(t){return t.length%2==0}static _t(t){return new Js(new Ws(t.slice()))}}function Qs(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Zs(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function ti(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class ei{constructor(t){this.fields=t,t.sort(Xs.K)}ft(t){for(const e of this.fields)if(e.X(t))return!0;return!1}isEqual(t){return Bs(this.fields,t.fields,(t,e)=>t.isEqual(e))}}class ni{constructor(t){this.dt=t}static fromBase64String(t){const e=atob(t);return new ni(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new ni(e)}toBase64(){return t=this.dt,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.dt)}wt(){return 2*this.dt.length}L(t){return Gs(this.dt,t.dt)}isEqual(t){return this.dt===t.dt}}ni.Et=new ni("");const si=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ii(t){if(xs(!!t),"string"==typeof t){let e=0;const n=si.exec(t);if(xs(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const s=new Date(t);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:ri(t.seconds),nanos:ri(t.nanos)}}function ri(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function oi(t){return"string"==typeof t?ni.fromBase64String(t):ni.fromUint8Array(t)}function ai(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function hi(t){const e=ii(t.mapValue.fields.__local_write_time__.timestampValue);return new $s(e.seconds,e.nanos)}function ui(t){return null==t}function ci(t){return 0===t&&1/t==-1/0}function li(t){return"number"==typeof t&&Number.isInteger(t)&&!ci(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}function fi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?ai(t)?4:10:Ss()}function di(t,e){const n=fi(t);if(n!==fi(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return hi(t).isEqual(hi(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=ii(t.timestampValue),s=ii(e.timestampValue);return n.seconds===s.seconds&&n.nanos===s.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return oi(t.bytesValue).isEqual(oi(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return ri(t.geoPointValue.latitude)===ri(e.geoPointValue.latitude)&&ri(t.geoPointValue.longitude)===ri(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return ri(t.integerValue)===ri(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=ri(t.doubleValue),s=ri(e.doubleValue);return n===s?ci(n)===ci(s):isNaN(n)&&isNaN(s)}return!1}(t,e);case 9:return Bs(t.arrayValue.values||[],e.arrayValue.values||[],di);case 10:return function(t,e){const n=t.mapValue.fields||{},s=e.mapValue.fields||{};if(Qs(n)!==Qs(s))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===s[t]||!di(n[t],s[t])))return!1;return!0}(t,e);default:return Ss()}}function pi(t,e){return void 0!==(t.values||[]).find(t=>di(t,e))}function gi(t,e){const n=fi(t),s=fi(e);if(n!==s)return Gs(n,s);switch(n){case 0:return 0;case 1:return Gs(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=ri(t.integerValue||t.doubleValue),s=ri(e.integerValue||e.doubleValue);return n<s?-1:n>s?1:n===s?0:isNaN(n)?isNaN(s)?0:-1:1}(t,e);case 3:return mi(t.timestampValue,e.timestampValue);case 4:return mi(hi(t),hi(e));case 5:return Gs(t.stringValue,e.stringValue);case 6:return function(t,e){const n=oi(t),s=oi(e);return n.L(s)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),s=e.split("/");for(let t=0;t<n.length&&t<s.length;t++){const e=Gs(n[t],s[t]);if(0!==e)return e}return Gs(n.length,s.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=Gs(ri(t.latitude),ri(e.latitude));return 0!==n?n:Gs(ri(t.longitude),ri(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],s=e.values||[];for(let t=0;t<n.length&&t<s.length;++t){const e=gi(n[t],s[t]);if(e)return e}return Gs(n.length,s.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){const n=t.fields||{},s=Object.keys(n),i=e.fields||{},r=Object.keys(i);s.sort(),r.sort();for(let t=0;t<s.length&&t<r.length;++t){const e=Gs(s[t],r[t]);if(0!==e)return e;const o=gi(n[s[t]],i[r[t]]);if(0!==o)return o}return Gs(s.length,r.length)}(t.mapValue,e.mapValue);default:throw Ss()}}function mi(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Gs(t,e);const n=ii(t),s=ii(e),i=Gs(n.seconds,s.seconds);return 0!==i?i:Gs(n.nanos,s.nanos)}function yi(t){return function t(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(t){const e=ii(t);return`time(${e.seconds},${e.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?oi(e.bytesValue).toBase64():"referenceValue"in e?(s=e.referenceValue,Js.at(s).toString()):"geoPointValue"in e?`geo(${(n=e.geoPointValue).latitude},${n.longitude})`:"arrayValue"in e?function(e){let n="[",s=!0;for(const i of e.values||[])s?s=!1:n+=",",n+=t(i);return n+"]"}(e.arrayValue):"mapValue"in e?function(e){const n=Object.keys(e.fields||{}).sort();let s="{",i=!0;for(const r of n)i?i=!1:s+=",",s+=`${r}:${t(e.fields[r])}`;return s+"}"}(e.mapValue):Ss();var n,s}(t)}function wi(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.et()}`}}function vi(t){return!!t&&"integerValue"in t}function bi(t){return!!t&&"arrayValue"in t}function Ei(t){return!!t&&"nullValue"in t}function Ii(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ti(t){return!!t&&"mapValue"in t}class _i{constructor(t){this.proto=t}static empty(){return new _i({mapValue:{}})}field(t){if(t.Y())return this.proto;{let e=this.proto;for(let n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!Ti(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.J()])||null}}isEqual(t){return di(this.proto,t.proto)}}class Ni{constructor(t=_i.empty()){this.Tt=t,this.It=new Map}set(t,e){return this.At(t,e),this}delete(t){return this.At(t,null),this}At(t,e){let n=this.It;for(let e=0;e<t.length-1;++e){const s=t.get(e);let i=n.get(s);i instanceof Map?n=i:i&&10===fi(i)?(i=new Map(Object.entries(i.mapValue.fields||{})),n.set(s,i),n=i):(i=new Map,n.set(s,i),n=i)}n.set(t.J(),e)}Rt(){const t=this.Pt(Xs.st(),this.It);return null!=t?new _i(t):this.Tt}Pt(t,e){let n=!1;const s=this.Tt.field(t),i=Ti(s)?Object.assign({},s.mapValue.fields):{};return e.forEach((e,s)=>{if(e instanceof Map){const r=this.Pt(t.child(s),e);null!=r&&(i[s]=r,n=!0)}else null!==e?(i[s]=e,n=!0):i.hasOwnProperty(s)&&(delete i[s],n=!0)}),n?{mapValue:{fields:i}}:null}}function Ai(t){const e=[];return Zs(t.fields||{},(t,n)=>{const s=new Xs([t]);if(Ti(n)){const t=Ai(n.mapValue).fields;if(0===t.length)e.push(s);else for(const n of t)e.push(s.child(n))}else e.push(s)}),new ei(e)}class Si{constructor(t,e){this.key=t,this.version=e}}class xi extends Si{constructor(t,e,n,s){super(t,e),this.Vt=n,this.gt=!!s.gt,this.hasCommittedMutations=!!s.hasCommittedMutations}field(t){return this.Vt.field(t)}data(){return this.Vt}yt(){return this.Vt.proto}isEqual(t){return t instanceof xi&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.gt===t.gt&&this.hasCommittedMutations===t.hasCommittedMutations&&this.Vt.isEqual(t.Vt)}toString(){return`Document(${this.key}, ${this.version}, ${this.Vt.toString()}, {hasLocalMutations: ${this.gt}}), {hasCommittedMutations: ${this.hasCommittedMutations}})`}get hasPendingWrites(){return this.gt||this.hasCommittedMutations}}class Di extends Si{constructor(t,e,n){super(t,e),this.hasCommittedMutations=!(!n||!n.hasCommittedMutations)}toString(){return`NoDocument(${this.key}, ${this.version})`}get hasPendingWrites(){return this.hasCommittedMutations}isEqual(t){return t instanceof Di&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)}}class ki extends Si{toString(){return`UnknownDocument(${this.key}, ${this.version})`}get hasPendingWrites(){return!0}isEqual(t){return t instanceof ki&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)}}class Ri{constructor(t,e=null,n=[],s=[],i=null,r=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=r,this.endAt=o,this.bt=null}}function Li(t,e=null,n=[],s=[],i=null,r=null,o=null){return new Ri(t,e,n,s,i,r,o)}function Oi(t){const e=Ds(t);if(null===e.bt){let t=e.path.et();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(t=>(function(t){return t.field.et()+t.op.toString()+yi(t.value)})(t)).join(","),t+="|ob:",t+=e.orderBy.map(t=>(function(t){return t.field.et()+t.dir})(t)).join(","),ui(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=zi(e.startAt)),e.endAt&&(t+="|ub:",t+=zi(e.endAt)),e.bt=t}return e.bt}function Ci(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!Wi(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let i=0;i<t.filters.length;i++)if(n=t.filters[i],s=e.filters[i],n.op!==s.op||!n.field.isEqual(s.field)||!di(n.value,s.value))return!1;var n,s;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Xi(t.startAt,e.startAt)&&Xi(t.endAt,e.endAt)}function Vi(t){return Js.lt(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Ui extends class{}{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.rt()?"in"===e||"not-in"===e?this.vt(t,e,n):new Pi(t,e,n):"array-contains"===e?new ji(t,n):"in"===e?new Gi(t,n):"not-in"===e?new Bi(t,n):"array-contains-any"===e?new Ki(t,n):new Ui(t,e,n)}static vt(t,e,n){return"in"===e?new Mi(t,n):new qi(t,n)}matches(t){const e=t.field(this.field);return"!="===this.op?null!==e&&this.St(gi(e,this.value)):null!==e&&fi(this.value)===fi(e)&&this.St(gi(e,this.value))}St(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Ss()}}Dt(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class Pi extends Ui{constructor(t,e,n){super(t,e,n),this.key=Js.at(n.referenceValue)}matches(t){const e=Js.K(t.key,this.key);return this.St(e)}}class Mi extends Ui{constructor(t,e){super(t,"in",e),this.keys=Fi("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class qi extends Ui{constructor(t,e){super(t,"not-in",e),this.keys=Fi("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function Fi(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(t=>Js.at(t.referenceValue))}class ji extends Ui{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.field(this.field);return bi(e)&&pi(e.arrayValue,this.value)}}class Gi extends Ui{constructor(t,e){super(t,"in",e)}matches(t){const e=t.field(this.field);return null!==e&&pi(this.value.arrayValue,e)}}class Bi extends Ui{constructor(t,e){super(t,"not-in",e)}matches(t){if(pi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.field(this.field);return null!==e&&!pi(this.value.arrayValue,e)}}class Ki extends Ui{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.field(this.field);return!(!bi(e)||!e.arrayValue.values)&&e.arrayValue.values.some(t=>pi(this.value.arrayValue,t))}}class $i{constructor(t,e){this.position=t,this.before=e}}function zi(t){return`${t.before?"b":"a"}:${t.position.map(t=>yi(t)).join(",")}`}class Hi{constructor(t,e="asc"){this.field=t,this.dir=e}}function Wi(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Yi(t,e,n){let s=0;for(let i=0;i<t.position.length;i++){const r=e[i],o=t.position[i];if(s=r.field.rt()?Js.K(Js.at(o.referenceValue),n.key):gi(o,n.field(r.field)),"desc"===r.dir&&(s*=-1),0!==s)break}return t.before?s<=0:s<0}function Xi(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!di(t.position[n],e.position[n]))return!1;return!0}class Ji{constructor(t,e=null,n=[],s=[],i=null,r="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.Ct=n,this.filters=s,this.limit=i,this.limitType=r,this.startAt=o,this.endAt=a,this.Nt=null,this.xt=null,this.startAt,this.endAt}}function Qi(t,e,n,s,i,r,o,a){return new Ji(t,e,n,s,i,r,o,a)}function Zi(t){return new Ji(t)}function tr(t){return!ui(t.limit)&&"F"===t.limitType}function er(t){return!ui(t.limit)&&"L"===t.limitType}function nr(t){return t.Ct.length>0?t.Ct[0].field:null}function sr(t){for(const e of t.filters)if(e.Dt())return e.field;return null}function ir(t){return null!==t.collectionGroup}function rr(t){const e=Ds(t);if(null===e.Nt){e.Nt=[];const t=sr(e),n=nr(e);if(null!==t&&null===n)t.rt()||e.Nt.push(new Hi(t)),e.Nt.push(new Hi(Xs.ot(),"asc"));else{let t=!1;for(const n of e.Ct)e.Nt.push(n),n.field.rt()&&(t=!0);if(!t){const t=e.Ct.length>0?e.Ct[e.Ct.length-1].dir:"asc";e.Nt.push(new Hi(Xs.ot(),t))}}}return e.Nt}function or(t){const e=Ds(t);if(!e.xt)if("F"===e.limitType)e.xt=Li(e.path,e.collectionGroup,rr(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of rr(e)){const e="desc"===n.dir?"asc":"desc";t.push(new Hi(n.field,e))}const n=e.endAt?new $i(e.endAt.position,!e.endAt.before):null,s=e.startAt?new $i(e.startAt.position,!e.startAt.before):null;e.xt=Li(e.path,e.collectionGroup,t,e.filters,e.limit,n,s)}return e.xt}function ar(t,e,n){return new Ji(t.path,t.collectionGroup,t.Ct.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function hr(t,e){return Ci(or(t),or(e))&&t.limitType===e.limitType}function ur(t){return`${Oi(or(t))}|lt:${t.limitType}`}function cr(t){return`Query(target=${function(t){let e=t.path.et();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map(t=>{return`${(e=t).field.et()} ${e.op} ${yi(e.value)}`;var e}).join(", ")}]`),ui(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map(t=>(function(t){return`${t.field.et()} (${t.dir})`})(t)).join(", ")}]`),t.startAt&&(e+=", startAt: "+zi(t.startAt)),t.endAt&&(e+=", endAt: "+zi(t.endAt)),`Target(${e})`}(or(t))}; limitType=${t.limitType})`}function lr(t,e){return function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.ht(t.collectionGroup)&&t.path.X(n):Js.lt(t.path)?t.path.isEqual(n):t.path.Z(n)}(t,e)&&function(t,e){for(const n of t.Ct)if(!n.field.rt()&&null===e.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Yi(t.startAt,rr(t),e))&&(!t.endAt||!Yi(t.endAt,rr(t),e))}(t,e)}function fr(t){return(e,n)=>{let s=!1;for(const i of rr(t)){const t=dr(i,e,n);if(0!==t)return t;s=s||i.field.rt()}return 0}}function dr(t,e,n){const s=t.field.rt()?Js.K(e.key,n.key):function(t,e,n){const s=e.field(t),i=n.field(t);return null!==s&&null!==i?gi(s,i):Ss()}(t.field,e,n);switch(t.dir){case"asc":return s;case"desc":return-1*s;default:return Ss()}}class pr{constructor(t,e,n,s,i=zs.min(),r=zs.min(),o=ni.Et){this.target=t,this.targetId=e,this.Ot=n,this.sequenceNumber=s,this.kt=i,this.lastLimboFreeSnapshotVersion=r,this.resumeToken=o}Mt(t){return new pr(this.target,this.targetId,this.Ot,t,this.kt,this.lastLimboFreeSnapshotVersion,this.resumeToken)}Ft(t,e){return new pr(this.target,this.targetId,this.Ot,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}$t(t){return new pr(this.target,this.targetId,this.Ot,this.sequenceNumber,this.kt,t,this.resumeToken)}}function gr(t,e){if(t.Lt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ci(e)?"-0":e}}function mr(t){return{integerValue:""+t}}function yr(t,e){return li(e)?mr(e):gr(t,e)}class wr{constructor(){this.Bt=void 0}}function vr(t,e,n){return t instanceof Ir?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Tr?_r(t,e):t instanceof Nr?Ar(t,e):function(t,e){const n=Er(t,e),s=xr(n)+xr(t.qt);return vi(n)&&vi(t.qt)?mr(s):gr(t.Ut,s)}(t,e)}function br(t,e,n){return t instanceof Tr?_r(t,e):t instanceof Nr?Ar(t,e):n}function Er(t,e){return t instanceof Sr?vi(n=e)||n&&"doubleValue"in n?e:{integerValue:0}:null;var n}class Ir extends wr{}class Tr extends wr{constructor(t){super(),this.elements=t}}function _r(t,e){const n=Dr(e);for(const e of t.elements)n.some(t=>di(t,e))||n.push(e);return{arrayValue:{values:n}}}class Nr extends wr{constructor(t){super(),this.elements=t}}function Ar(t,e){let n=Dr(e);for(const e of t.elements)n=n.filter(t=>!di(t,e));return{arrayValue:{values:n}}}class Sr extends wr{constructor(t,e){super(),this.Ut=t,this.qt=e}}function xr(t){return ri(t.integerValue||t.doubleValue)}function Dr(t){return bi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class kr{constructor(t,e){this.field=t,this.transform=e}}class Rr{constructor(t,e){this.version=t,this.transformResults=e}}class Lr{constructor(t,e){this.updateTime=t,this.exists=e}static Kt(){return new Lr}static exists(t){return new Lr(void 0,t)}static updateTime(t){return new Lr(t)}get Qt(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Or(t,e){return void 0!==t.updateTime?e instanceof xi&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof xi}class Cr{}function Vr(t,e,n){return t instanceof Fr?function(t,e,n){let s=t.value;if(n.transformResults){const i=Br(t.fieldTransforms,e,n.transformResults);s=$r(t.fieldTransforms,s,i)}return new xi(t.key,n.version,s,{hasCommittedMutations:!0})}(t,e,n):t instanceof jr?function(t,e,n){if(!Or(t.Wt,e))return new ki(t.key,n.version);const s=Gr(t,e,n.transformResults?Br(t.fieldTransforms,e,n.transformResults):[]);return new xi(t.key,n.version,s,{hasCommittedMutations:!0})}(t,e,n):function(t,e,n){return new Di(t.key,n.version,{hasCommittedMutations:!0})}(t,0,n)}function Ur(t,e,n,s){return t instanceof Fr?function(t,e,n,s){if(!Or(t.Wt,e))return e;let i=t.value;const r=Kr(t.fieldTransforms,n,e);i=$r(t.fieldTransforms,i,r);const o=qr(e);return new xi(t.key,o,i,{gt:!0})}(t,e,s):t instanceof jr?function(t,e,n,s){if(!Or(t.Wt,e))return e;const i=qr(e),r=Gr(t,e,Kr(t.fieldTransforms,n,e));return new xi(t.key,i,r,{gt:!0})}(t,e,s):function(t,e){return Or(t.Wt,e)?new Di(t.key,zs.min()):e}(t,e)}function Pr(t,e){return function(t,e){let n=null;for(const s of t){const t=e instanceof xi?e.field(s.field):void 0,i=Er(s.transform,t||null);null!=i&&(n=null==n?(new Ni).set(s.field,i):n.set(s.field,i))}return n?n.Rt():null}(t.fieldTransforms,e)}function Mr(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Wt.isEqual(e.Wt)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Bs(t,e,(t,e)=>(function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Tr&&e instanceof Tr||t instanceof Nr&&e instanceof Nr?Bs(t.elements,e.elements,di):t instanceof Sr&&e instanceof Sr?di(t.qt,e.qt):t instanceof Ir&&e instanceof Ir}(t.transform,e.transform)})(t,e))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.jt.isEqual(e.jt))}function qr(t){return t instanceof xi?t.version:zs.min()}class Fr extends Cr{constructor(t,e,n,s=[]){super(),this.key=t,this.value=e,this.Wt=n,this.fieldTransforms=s,this.type=0}}class jr extends Cr{constructor(t,e,n,s,i=[]){super(),this.key=t,this.data=e,this.jt=n,this.Wt=s,this.fieldTransforms=i,this.type=1}}function Gr(t,e,n){let s;return s=e instanceof xi?e.data():_i.empty(),s=function(t,e){const n=new Ni(s);return t.jt.fields.forEach(e=>{if(!e.Y()){const s=t.data.field(e);null!==s?n.set(e,s):n.delete(e)}}),n.Rt()}(t),s=$r(t.fieldTransforms,s,n)}function Br(t,e,n){const s=[];xs(t.length===n.length);for(let i=0;i<n.length;i++){const r=t[i],o=r.transform;let a=null;e instanceof xi&&(a=e.field(r.field)),s.push(br(o,a,n[i]))}return s}function Kr(t,e,n,s){const i=[];for(const s of t){const t=s.transform;let r=null;n instanceof xi&&(r=n.field(s.field)),i.push(vr(t,r,e))}return i}function $r(t,e,n){const s=new Ni(e);for(let e=0;e<t.length;e++){const i=t[e];s.set(i.field,n[e])}return s.Rt()}class zr extends Cr{constructor(t,e){super(),this.key=t,this.Wt=e,this.type=2,this.fieldTransforms=[]}}class Hr extends Cr{constructor(t,e){super(),this.key=t,this.Wt=e,this.type=3,this.fieldTransforms=[]}}class Wr{constructor(t){this.count=t}}var Yr,Xr;function Jr(t){switch(t){case ks.OK:return Ss();case ks.CANCELLED:case ks.UNKNOWN:case ks.DEADLINE_EXCEEDED:case ks.RESOURCE_EXHAUSTED:case ks.INTERNAL:case ks.UNAVAILABLE:case ks.UNAUTHENTICATED:return!1;case ks.INVALID_ARGUMENT:case ks.NOT_FOUND:case ks.ALREADY_EXISTS:case ks.PERMISSION_DENIED:case ks.FAILED_PRECONDITION:case ks.ABORTED:case ks.OUT_OF_RANGE:case ks.UNIMPLEMENTED:case ks.DATA_LOSS:return!0;default:return Ss()}}function Qr(t){if(void 0===t)return _s("GRPC error has no .code"),ks.UNKNOWN;switch(t){case Yr.OK:return ks.OK;case Yr.CANCELLED:return ks.CANCELLED;case Yr.UNKNOWN:return ks.UNKNOWN;case Yr.DEADLINE_EXCEEDED:return ks.DEADLINE_EXCEEDED;case Yr.RESOURCE_EXHAUSTED:return ks.RESOURCE_EXHAUSTED;case Yr.INTERNAL:return ks.INTERNAL;case Yr.UNAVAILABLE:return ks.UNAVAILABLE;case Yr.UNAUTHENTICATED:return ks.UNAUTHENTICATED;case Yr.INVALID_ARGUMENT:return ks.INVALID_ARGUMENT;case Yr.NOT_FOUND:return ks.NOT_FOUND;case Yr.ALREADY_EXISTS:return ks.ALREADY_EXISTS;case Yr.PERMISSION_DENIED:return ks.PERMISSION_DENIED;case Yr.FAILED_PRECONDITION:return ks.FAILED_PRECONDITION;case Yr.ABORTED:return ks.ABORTED;case Yr.OUT_OF_RANGE:return ks.OUT_OF_RANGE;case Yr.UNIMPLEMENTED:return ks.UNIMPLEMENTED;case Yr.DATA_LOSS:return ks.DATA_LOSS;default:return Ss()}}(Xr=Yr||(Yr={}))[Xr.OK=0]="OK",Xr[Xr.CANCELLED=1]="CANCELLED",Xr[Xr.UNKNOWN=2]="UNKNOWN",Xr[Xr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Xr[Xr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Xr[Xr.NOT_FOUND=5]="NOT_FOUND",Xr[Xr.ALREADY_EXISTS=6]="ALREADY_EXISTS",Xr[Xr.PERMISSION_DENIED=7]="PERMISSION_DENIED",Xr[Xr.UNAUTHENTICATED=16]="UNAUTHENTICATED",Xr[Xr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Xr[Xr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Xr[Xr.ABORTED=10]="ABORTED",Xr[Xr.OUT_OF_RANGE=11]="OUT_OF_RANGE",Xr[Xr.UNIMPLEMENTED=12]="UNIMPLEMENTED",Xr[Xr.INTERNAL=13]="INTERNAL",Xr[Xr.UNAVAILABLE=14]="UNAVAILABLE",Xr[Xr.DATA_LOSS=15]="DATA_LOSS";class Zr{constructor(t,e){this.K=t,this.root=e||eo.EMPTY}Gt(t,e){return new Zr(this.K,this.root.Gt(t,e,this.K).copy(null,null,eo.zt,null,null))}remove(t){return new Zr(this.K,this.root.remove(t,this.K).copy(null,null,eo.zt,null,null))}get(t){let e=this.root;for(;!e.Y();){const n=this.K(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.Y();){const s=this.K(t,n.key);if(0===s)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}Y(){return this.root.Y()}get size(){return this.root.size}Ht(){return this.root.Ht()}Jt(){return this.root.Jt()}Yt(t){return this.root.Yt(t)}forEach(t){this.Yt((e,n)=>(t(e,n),!1))}toString(){const t=[];return this.Yt((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(", ")}}`}Xt(t){return this.root.Xt(t)}Zt(){return new to(this.root,null,this.K,!1)}te(t){return new to(this.root,t,this.K,!1)}ee(){return new to(this.root,null,this.K,!0)}ne(t){return new to(this.root,t,this.K,!0)}}class to{constructor(t,e,n,s){this.se=s,this.ie=[];let i=1;for(;!t.Y();)if(i=e?n(t.key,e):1,s&&(i*=-1),i<0)t=this.se?t.left:t.right;else{if(0===i){this.ie.push(t);break}this.ie.push(t),t=this.se?t.right:t.left}}re(){let t=this.ie.pop();const e={key:t.key,value:t.value};if(this.se)for(t=t.left;!t.Y();)this.ie.push(t),t=t.right;else for(t=t.right;!t.Y();)this.ie.push(t),t=t.left;return e}oe(){return this.ie.length>0}ce(){if(0===this.ie.length)return null;const t=this.ie[this.ie.length-1];return{key:t.key,value:t.value}}}class eo{constructor(t,e,n,s,i){this.key=t,this.value=e,this.color=null!=n?n:eo.RED,this.left=null!=s?s:eo.EMPTY,this.right=null!=i?i:eo.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,i){return new eo(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=s?s:this.left,null!=i?i:this.right)}Y(){return!1}Yt(t){return this.left.Yt(t)||t(this.key,this.value)||this.right.Yt(t)}Xt(t){return this.right.Xt(t)||t(this.key,this.value)||this.left.Xt(t)}min(){return this.left.Y()?this:this.left.min()}Ht(){return this.min().key}Jt(){return this.right.Y()?this.key:this.right.Jt()}Gt(t,e,n){let s=this;const i=n(t,s.key);return(s=i<0?s.copy(null,null,null,s.left.Gt(t,e,n),null):0===i?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.Gt(t,e,n))).ue()}ae(){if(this.left.Y())return eo.EMPTY;let t=this;return t.left.he()||t.left.left.he()||(t=t.le()),(t=t.copy(null,null,null,t.left.ae(),null)).ue()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.Y()||s.left.he()||s.left.left.he()||(s=s.le()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.he()&&(s=s._e()),s.right.Y()||s.right.he()||s.right.left.he()||(s=s.fe()),0===e(t,s.key)){if(s.right.Y())return eo.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.ae())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.ue()}he(){return this.color}ue(){let t=this;return t.right.he()&&!t.left.he()&&(t=t.de()),t.left.he()&&t.left.left.he()&&(t=t._e()),t.left.he()&&t.right.he()&&(t=t.we()),t}le(){let t=this.we();return t.right.left.he()&&(t=(t=(t=t.copy(null,null,null,null,t.right._e())).de()).we()),t}fe(){let t=this.we();return t.left.left.he()&&(t=(t=t._e()).we()),t}de(){const t=this.copy(null,null,eo.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}_e(){const t=this.copy(null,null,eo.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}we(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}Ee(){const t=this.Te();return Math.pow(2,t)<=this.size+1}Te(){if(this.he()&&this.left.he())throw Ss();if(this.right.he())throw Ss();const t=this.left.Te();if(t!==this.right.Te())throw Ss();return t+(this.he()?0:1)}}eo.EMPTY=null,eo.RED=!0,eo.zt=!1,eo.EMPTY=new class{constructor(){this.size=0}get key(){throw Ss()}get value(){throw Ss()}get color(){throw Ss()}get left(){throw Ss()}get right(){throw Ss()}copy(t,e,n,s,i){return this}Gt(t,e,n){return new eo(t,e)}remove(t,e){return this}Y(){return!0}Yt(t){return!1}Xt(t){return!1}Ht(){return null}Jt(){return null}he(){return!1}Ee(){return!0}Te(){return 0}};class no{constructor(t){this.K=t,this.data=new Zr(this.K)}has(t){return null!==this.data.get(t)}first(){return this.data.Ht()}last(){return this.data.Jt()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.Yt((e,n)=>(t(e),!1))}Ie(t,e){const n=this.data.te(t[0]);for(;n.oe();){const s=n.re();if(this.K(s.key,t[1])>=0)return;e(s.key)}}me(t,e){let n;for(n=void 0!==e?this.data.te(e):this.data.Zt();n.oe();)if(!t(n.re().key))return}Ae(t){const e=this.data.te(t);return e.oe()?e.re().key:null}Zt(){return new so(this.data.Zt())}te(t){return new so(this.data.te(t))}add(t){return this.copy(this.data.remove(t).Gt(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}Y(){return this.data.Y()}Re(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(t=>{e=e.add(t)}),e}isEqual(t){if(!(t instanceof no))return!1;if(this.size!==t.size)return!1;const e=this.data.Zt(),n=t.data.Zt();for(;e.oe();){const t=e.re().key,s=n.re().key;if(0!==this.K(t,s))return!1}return!0}tt(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){const e=new no(this.K);return e.data=t,e}}class so{constructor(t){this.Pe=t}re(){return this.Pe.re().key}oe(){return this.Pe.oe()}}const io=new Zr(Js.K);function ro(){return io}function oo(){return ro()}const ao=new Zr(Js.K);function ho(){return ao}const uo=new Zr(Js.K),co=new no(Js.K);function lo(...t){let e=co;for(const n of t)e=e.add(n);return e}const fo=new no(Gs);function po(){return fo}class go{constructor(t){this.K=t?(e,n)=>t(e,n)||Js.K(e.key,n.key):(t,e)=>Js.K(t.key,e.key),this.Ve=ho(),this.ge=new Zr(this.K)}static ye(t){return new go(t.K)}has(t){return null!=this.Ve.get(t)}get(t){return this.Ve.get(t)}first(){return this.ge.Ht()}last(){return this.ge.Jt()}Y(){return this.ge.Y()}indexOf(t){const e=this.Ve.get(t);return e?this.ge.indexOf(e):-1}get size(){return this.ge.size}forEach(t){this.ge.Yt((e,n)=>(t(e),!1))}add(t){const e=this.delete(t.key);return e.copy(e.Ve.Gt(t.key,t),e.ge.Gt(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.Ve.remove(t),this.ge.remove(e)):this}isEqual(t){if(!(t instanceof go))return!1;if(this.size!==t.size)return!1;const e=this.ge.Zt(),n=t.ge.Zt();for(;e.oe();){const t=e.re().key,s=n.re().key;if(!t.isEqual(s))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new go;return n.K=this.K,n.Ve=t,n.ge=e,n}}class mo{constructor(){this.pe=new Zr(Js.K)}track(t){const e=t.doc.key,n=this.pe.get(e);n?0!==t.type&&3===n.type?this.pe=this.pe.Gt(e,t):3===t.type&&1!==n.type?this.pe=this.pe.Gt(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.pe=this.pe.Gt(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.pe=this.pe.Gt(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.pe=this.pe.remove(e):1===t.type&&2===n.type?this.pe=this.pe.Gt(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.pe=this.pe.Gt(e,{type:2,doc:t.doc}):Ss():this.pe=this.pe.Gt(e,t)}be(){const t=[];return this.pe.Yt((e,n)=>{t.push(n)}),t}}class yo{constructor(t,e,n,s,i,r,o,a){this.query=t,this.docs=e,this.ve=n,this.docChanges=s,this.Se=i,this.fromCache=r,this.De=o,this.Ce=a}static Ne(t,e,n,s){const i=[];return e.forEach(t=>{i.push({type:0,doc:t})}),new yo(t,e,go.ye(e),i,n,s,!0,!1)}get hasPendingWrites(){return!this.Se.Y()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.De===t.De&&this.Se.isEqual(t.Se)&&hr(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.ve.isEqual(t.ve)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class wo{constructor(t,e,n,s,i){this.kt=t,this.xe=e,this.Oe=n,this.ke=s,this.Me=i}static Fe(t,e){const n=new Map;return n.set(t,vo.$e(t,e)),new wo(zs.min(),n,po(),ro(),lo())}}class vo{constructor(t,e,n,s,i){this.resumeToken=t,this.Le=e,this.Be=n,this.qe=s,this.Ue=i}static $e(t,e){return new vo(ni.Et,e,lo(),lo(),lo())}}class bo{constructor(t,e,n,s){this.Ke=t,this.removedTargetIds=e,this.key=n,this.Qe=s}}class Eo{constructor(t,e){this.targetId=t,this.We=e}}class Io{constructor(t,e,n=ni.Et,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}}class To{constructor(){this.je=0,this.Ge=Ao(),this.ze=ni.Et,this.He=!1,this.Je=!0}get Le(){return this.He}get resumeToken(){return this.ze}get Ye(){return 0!==this.je}get Xe(){return this.Je}Ze(t){t.wt()>0&&(this.Je=!0,this.ze=t)}tn(){let t=lo(),e=lo(),n=lo();return this.Ge.forEach((s,i)=>{switch(i){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:Ss()}}),new vo(this.ze,this.He,t,e,n)}en(){this.Je=!1,this.Ge=Ao()}nn(t,e){this.Je=!0,this.Ge=this.Ge.Gt(t,e)}sn(t){this.Je=!0,this.Ge=this.Ge.remove(t)}rn(){this.je+=1}on(){this.je-=1}cn(){this.Je=!0,this.He=!0}}class _o{constructor(t){this.un=t,this.an=new Map,this.hn=ro(),this.ln=No(),this._n=new no(Gs)}fn(t){for(const e of t.Ke)t.Qe instanceof xi?this.dn(e,t.Qe):t.Qe instanceof Di&&this.wn(e,t.key,t.Qe);for(const e of t.removedTargetIds)this.wn(e,t.key,t.Qe)}En(t){this.Tn(t,e=>{const n=this.In(e);switch(t.state){case 0:this.mn(e)&&n.Ze(t.resumeToken);break;case 1:n.on(),n.Ye||n.en(),n.Ze(t.resumeToken);break;case 2:n.on(),n.Ye||this.removeTarget(e);break;case 3:this.mn(e)&&(n.cn(),n.Ze(t.resumeToken));break;case 4:this.mn(e)&&(this.An(e),n.Ze(t.resumeToken));break;default:Ss()}})}Tn(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.an.forEach((t,n)=>{this.mn(n)&&e(n)})}Rn(t){const e=t.targetId,n=t.We.count,s=this.Pn(e);if(s){const t=s.target;if(Vi(t))if(0===n){const n=new Js(t.path);this.wn(e,n,new Di(n,zs.min()))}else xs(1===n);else this.Vn(e)!==n&&(this.An(e),this._n=this._n.add(e))}}gn(t){const e=new Map;this.an.forEach((n,s)=>{const i=this.Pn(s);if(i){if(n.Le&&Vi(i.target)){const e=new Js(i.target.path);null!==this.hn.get(e)||this.yn(s,e)||this.wn(s,e,new Di(e,t))}n.Xe&&(e.set(s,n.tn()),n.en())}});let n=lo();this.ln.forEach((t,e)=>{let s=!0;e.me(t=>{const e=this.Pn(t);return!e||2===e.Ot||(s=!1,!1)}),s&&(n=n.add(t))});const s=new wo(t,e,this._n,this.hn,n);return this.hn=ro(),this.ln=No(),this._n=new no(Gs),s}dn(t,e){if(!this.mn(t))return;const n=this.yn(t,e.key)?2:0;this.In(t).nn(e.key,n),this.hn=this.hn.Gt(e.key,e),this.ln=this.ln.Gt(e.key,this.pn(e.key).add(t))}wn(t,e,n){if(!this.mn(t))return;const s=this.In(t);this.yn(t,e)?s.nn(e,1):s.sn(e),this.ln=this.ln.Gt(e,this.pn(e).delete(t)),n&&(this.hn=this.hn.Gt(e,n))}removeTarget(t){this.an.delete(t)}Vn(t){const e=this.In(t).tn();return this.un.bn(t).size+e.Be.size-e.Ue.size}rn(t){this.In(t).rn()}In(t){let e=this.an.get(t);return e||(e=new To,this.an.set(t,e)),e}pn(t){let e=this.ln.get(t);return e||(e=new no(Gs),this.ln=this.ln.Gt(t,e)),e}mn(t){const e=null!==this.Pn(t);return e||Ts("WatchChangeAggregator","Detected inactive target",t),e}Pn(t){const e=this.an.get(t);return e&&e.Ye?null:this.un.vn(t)}An(t){this.an.set(t,new To),this.un.bn(t).forEach(e=>{this.wn(t,e,null)})}yn(t,e){return this.un.bn(t).has(e)}}function No(){return new Zr(Js.K)}function Ao(){return new Zr(Js.K)}const So={asc:"ASCENDING",desc:"DESCENDING"},xo={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class Do{constructor(t,e){this.p=t,this.Lt=e}}function ko(t,e){return t.Lt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Ro(t,e){return t.Lt?e.toBase64():e.toUint8Array()}function Lo(t){return xs(!!t),zs.$(function(t){const e=ii(t);return new $s(e.seconds,e.nanos)}(t))}function Oo(t,e){return function(t){return new Ws(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).et()}function Co(t){const e=Ws.nt(t);return xs(Jo(e)),e}function Vo(t,e){return Oo(t.p,e.path)}function Uo(t,e){const n=Co(e);if(n.get(1)!==t.p.projectId)throw new Rs(ks.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.p.projectId);if(n.get(3)!==t.p.database)throw new Rs(ks.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.p.database);return new Js(Fo(n))}function Po(t,e){return Oo(t.p,e)}function Mo(t){const e=Co(t);return 4===e.length?Ws.st():Fo(e)}function qo(t){return new Ws(["projects",t.p.projectId,"databases",t.p.database]).et()}function Fo(t){return xs(t.length>4&&"documents"===t.get(4)),t.j(5)}function jo(t,e,n){return{name:Vo(t,e),fields:n.proto.mapValue.fields}}function Go(t,e){let n;if(e instanceof Fr)n={update:jo(t,e.key,e.value)};else if(e instanceof zr)n={delete:Vo(t,e.key)};else if(e instanceof jr)n={update:jo(t,e.key,e.data),updateMask:function(t){const e=[];return t.fields.forEach(t=>e.push(t.et())),{fieldPaths:e}}(e.jt)};else{if(!(e instanceof Hr))return Ss();n={verify:Vo(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(t=>(function(t,e){const n=e.transform;if(n instanceof Ir)return{fieldPath:e.field.et(),setToServerValue:"REQUEST_TIME"};if(n instanceof Tr)return{fieldPath:e.field.et(),appendMissingElements:{values:n.elements}};if(n instanceof Nr)return{fieldPath:e.field.et(),removeAllFromArray:{values:n.elements}};if(n instanceof Sr)return{fieldPath:e.field.et(),increment:n.qt};throw Ss()})(0,t))),e.Wt.Qt||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:function(t,e){return ko(t,e.q())}(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Ss()}(t,e.Wt)),n}function Bo(t,e){const n=e.currentDocument?function(t){return void 0!==t.updateTime?Lr.updateTime(Lo(t.updateTime)):void 0!==t.exists?Lr.exists(t.exists):Lr.Kt()}(e.currentDocument):Lr.Kt(),s=e.updateTransforms?e.updateTransforms.map(e=>(function(t,e){let n=null;if("setToServerValue"in e)xs("REQUEST_TIME"===e.setToServerValue),n=new Ir;else if("appendMissingElements"in e){const t=e.appendMissingElements.values||[];n=new Tr(t)}else if("removeAllFromArray"in e){const t=e.removeAllFromArray.values||[];n=new Nr(t)}else"increment"in e?n=new Sr(t,e.increment):Ss();const s=Xs.ct(e.fieldPath);return new kr(s,n)})(t,e)):[];if(e.update){e.update.name;const i=Uo(t,e.update.name),r=new _i({mapValue:{fields:e.update.fields}});if(e.updateMask){const t=function(t){const e=t.fieldPaths||[];return new ei(e.map(t=>Xs.ct(t)))}(e.updateMask);return new jr(i,r,t,n,s)}return new Fr(i,r,n,s)}if(e.delete){const s=Uo(t,e.delete);return new zr(s,n)}if(e.verify){const s=Uo(t,e.verify);return new Hr(s,n)}return Ss()}function Ko(t,e){return{documents:[Po(t,e.path)]}}function $o(t,e){const n={structuredQuery:{}},s=e.path;null!==e.collectionGroup?(n.parent=Po(t,s),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Po(t,s.G()),n.structuredQuery.from=[{collectionId:s.J()}]);const i=function(t){if(0===t.length)return;const e=t.map(t=>(function(t){if("=="===t.op){if(Ii(t.value))return{unaryFilter:{field:Yo(t.field),op:"IS_NAN"}};if(Ei(t.value))return{unaryFilter:{field:Yo(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Ii(t.value))return{unaryFilter:{field:Yo(t.field),op:"IS_NOT_NAN"}};if(Ei(t.value))return{unaryFilter:{field:Yo(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Yo(t.field),op:function(t){return xo[t]}(t.op),value:t.value}}})(t));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}(e.filters);i&&(n.structuredQuery.where=i);const r=function(t){if(0!==t.length)return t.map(t=>(function(t){return{field:Yo(t.field),direction:function(t){return So[t]}(t.dir)}})(t))}(e.orderBy);r&&(n.structuredQuery.orderBy=r);const o=function(t,e){return t.Lt||ui(e)?e:{value:e}}(t,e.limit);return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt=Ho(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Ho(e.endAt)),n}function zo(t){let e=Mo(t.parent);const n=t.structuredQuery,s=n.from?n.from.length:0;let i=null;if(s>0){xs(1===s);const t=n.from[0];t.allDescendants?i=t.collectionId:e=e.child(t.collectionId)}let r=[];n.where&&(r=function t(e){return e?void 0!==e.unaryFilter?[function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Xo(t.unaryFilter.field);return Ui.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Xo(t.unaryFilter.field);return Ui.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Xo(t.unaryFilter.field);return Ui.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Xo(t.unaryFilter.field);return Ui.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Ss()}}(e)]:void 0!==e.fieldFilter?[function(t){return Ui.create(Xo(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Ss()}}(t.fieldFilter.op),t.fieldFilter.value)}(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(e=>t(e)).reduce((t,e)=>t.concat(e)):Ss():[]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(t=>(function(t){return new Hi(Xo(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))})(t)));let a=null;n.limit&&(a=function(t){let e;return ui(e="object"==typeof t?t.value:t)?null:e}(n.limit));let h=null;n.startAt&&(h=Wo(n.startAt));let u=null;return n.endAt&&(u=Wo(n.endAt)),Qi(e,i,o,r,a,"F",h,u)}function Ho(t){return{before:t.before,values:t.position}}function Wo(t){const e=!!t.before,n=t.values||[];return new $i(n,e)}function Yo(t){return{fieldPath:t.et()}}function Xo(t){return Xs.ct(t.fieldPath)}function Jo(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class Qo{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}class Zo{constructor(t){this.Sn=null,this.Dn=null,this.result=void 0,this.error=void 0,this.Cn=!1,this.Nn=!1,t(t=>{this.Cn=!0,this.result=t,this.Sn&&this.Sn(t)},t=>{this.Cn=!0,this.error=t,this.Dn&&this.Dn(t)})}catch(t){return this.next(void 0,t)}next(t,e){return this.Nn&&Ss(),this.Nn=!0,this.Cn?this.error?this.xn(e,this.error):this.On(t,this.result):new Zo((n,s)=>{this.Sn=(e=>{this.On(t,e).next(n,s)}),this.Dn=(t=>{this.xn(e,t).next(n,s)})})}kn(){return new Promise((t,e)=>{this.next(t,e)})}Mn(t){try{const e=t();return e instanceof Zo?e:Zo.resolve(e)}catch(t){return Zo.reject(t)}}On(t,e){return t?this.Mn(()=>t(e)):Zo.resolve(e)}xn(t,e){return t?this.Mn(()=>t(e)):Zo.reject(e)}static resolve(t){return new Zo((e,n)=>{e(t)})}static reject(t){return new Zo((e,n)=>{n(t)})}static Fn(t){return new Zo((e,n)=>{let s=0,i=0,r=!1;t.forEach(t=>{++s,t.next(()=>{++i,r&&i===s&&e()},t=>n(t))}),r=!0,i===s&&e()})}static $n(t){let e=Zo.resolve(!1);for(const n of t)e=e.next(t=>t?Zo.resolve(t):n());return e}static forEach(t,e){const n=[];return t.forEach((t,s)=>{n.push(e.call(this,t,s))}),this.Fn(n)}}class ta{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.Ln=new Qo,this.transaction.oncomplete=(()=>{this.Ln.resolve()}),this.transaction.onabort=(()=>{e.error?this.Ln.reject(new sa(t,e.error)):this.Ln.resolve()}),this.transaction.onerror=(e=>{const n=ha(e.target.error);this.Ln.reject(new sa(t,n))})}static open(t,e,n,s){try{return new ta(e,t.transaction(s,n))}catch(t){throw new sa(e,t)}}get Bn(){return this.Ln.promise}abort(t){t&&this.Ln.reject(t),this.aborted||(Ts("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(t){const e=this.transaction.objectStore(t);return new ra(e)}}class ea{constructor(t,e,n){this.name=t,this.version=e,this.qn=n,12.2===ea.Un(s())&&_s("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return Ts("SimpleDb","Removing database:",t),oa(window.indexedDB.deleteDatabase(t)).kn()}static Kn(){if("undefined"==typeof indexedDB)return!1;if(ea.Qn())return!0;const t=s(),e=ea.Un(t),n=0<e&&e<10,i=ea.Wn(t),r=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||r)}static Qn(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.jn)}static Gn(t,e){return t.store(e)}static Un(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static Wn(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async zn(t){return this.db||(Ts("SimpleDb","Opening database:",this.name),this.db=await new Promise((e,n)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=(t=>{const n=t.target.result;e(n)}),s.onblocked=(()=>{n(new sa(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))}),s.onerror=(e=>{const s=e.target.error;"VersionError"===s.name?n(new Rs(ks.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):n(new sa(t,s))}),s.onupgradeneeded=(t=>{Ts("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this.qn.Hn(e,s.transaction,t.oldVersion,this.version).next(()=>{Ts("SimpleDb","Database upgrade to version "+this.version+" complete")})})})),this.Jn&&(this.db.onversionchange=(t=>this.Jn(t))),this.db}Yn(t){this.Jn=t,this.db&&(this.db.onversionchange=(e=>t(e)))}async runTransaction(t,e,n,s){const i="readonly"===e;for(;;){0;try{this.db=await this.zn(t);const e=ta.open(this.db,t,i?"readonly":"readwrite",n),r=s(e).catch(t=>(e.abort(t),Zo.reject(t))).kn();return r.catch(()=>{}),await e.Bn,r}catch(t){const e="FirebaseError"!==t.name&&r<3;if(Ts("SimpleDb","Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class na{constructor(t){this.Xn=t,this.Zn=!1,this.ts=null}get Cn(){return this.Zn}get es(){return this.ts}set cursor(t){this.Xn=t}done(){this.Zn=!0}ns(t){this.ts=t}delete(){return oa(this.Xn.delete())}}class sa extends Rs{constructor(t,e){super(ks.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function ia(t){return"IndexedDbTransactionError"===t.name}class ra{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(Ts("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(Ts("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),oa(n)}add(t){return Ts("SimpleDb","ADD",this.store.name,t,t),oa(this.store.add(t))}get(t){return oa(this.store.get(t)).next(e=>(void 0===e&&(e=null),Ts("SimpleDb","GET",this.store.name,t,e),e))}delete(t){return Ts("SimpleDb","DELETE",this.store.name,t),oa(this.store.delete(t))}count(){return Ts("SimpleDb","COUNT",this.store.name),oa(this.store.count())}ss(t,e){const n=this.cursor(this.options(t,e)),s=[];return this.rs(n,(t,e)=>{s.push(e)}).next(()=>s)}os(t,e){Ts("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.cs=!1;const s=this.cursor(n);return this.rs(s,(t,e,n)=>n.delete())}us(t,e){let n;e?n=t:(n={},e=t);const s=this.cursor(n);return this.rs(s,e)}hs(t){const e=this.cursor({});return new Zo((n,s)=>{e.onerror=(t=>{const e=ha(t.target.error);s(e)}),e.onsuccess=(e=>{const s=e.target.result;s?t(s.primaryKey,s.value).next(t=>{t?s.continue():n()}):n()})})}rs(t,e){const n=[];return new Zo((s,i)=>{t.onerror=(t=>{i(t.target.error)}),t.onsuccess=(t=>{const i=t.target.result;if(!i)return void s();const r=new na(i),o=e(i.primaryKey,i.value,r);if(o instanceof Zo){const t=o.catch(t=>(r.done(),Zo.reject(t)));n.push(t)}r.Cn?s():null===r.es?i.continue():i.continue(r.es)})}).next(()=>Zo.Fn(n))}options(t,e){let n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.cs?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function oa(t){return new Zo((e,n)=>{t.onsuccess=(t=>{const n=t.target.result;e(n)}),t.onerror=(t=>{const e=ha(t.target.error);n(e)})})}let aa=!1;function ha(t){const e=ea.Un(s());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new Rs("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return aa||(aa=!0,setTimeout(()=>{throw t},0)),t}}return t}class ua{constructor(t,e,n,s,i){this.ls=t,this._s=e,this.fs=n,this.op=s,this.ds=i,this.ws=new Qo,this.then=this.ws.promise.then.bind(this.ws.promise),this.ws.promise.catch(t=>{})}static Es(t,e,n,s,i){const r=Date.now()+n,o=new ua(t,e,r,s,i);return o.start(n),o}start(t){this.Ts=setTimeout(()=>this.Is(),t)}As(){return this.Is()}cancel(t){null!==this.Ts&&(this.clearTimeout(),this.ws.reject(new Rs(ks.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}Is(){this.ls.Rs(()=>null!==this.Ts?(this.clearTimeout(),this.op().then(t=>this.ws.resolve(t))):Promise.resolve())}clearTimeout(){null!==this.Ts&&(this.ds(this),clearTimeout(this.Ts),this.Ts=null)}}function ca(t,e){if(_s("AsyncQueue",`${e}: ${t}`),ia(t))return new Rs(ks.UNAVAILABLE,`${e}: ${t}`);throw t}const la="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class fa{constructor(){this.Ps=[]}Vs(t){this.Ps.push(t)}gs(){this.Ps.forEach(t=>t())}}function da(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=ga(e)),e=pa(t.get(n),e);return ga(e)}function pa(t,e){let n=e;const s=t.length;for(let e=0;e<s;e++){const s=t.charAt(e);switch(s){case"\0":n+="";break;case"":n+="";break;default:n+=s}}return n}function ga(t){return t+""}function ma(t){const e=t.length;if(xs(e>=2),2===e)return xs(""===t.charAt(0)&&""===t.charAt(1)),Ws.st();const n=e-2,s=[];let i="";for(let n=0;n<e;){const e=t.indexOf("",n);switch((e<0||e>r)&&Ss(),t.charAt(e+1)){case"":const r=t.substring(n,e);let o;0===i.length?o=r:(o=i+=r,i=""),s.push(o);break;case"":i+=t.substring(n,e),i+="\0";break;case"":i+=t.substring(n,e+1);break;default:Ss()}n=e+2}return new Ws(s)}class ya{constructor(t,e){this.seconds=t,this.nanoseconds=e}}class wa{constructor(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}}wa.store="owner",wa.key="owner";class va{constructor(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}}va.store="mutationQueues",va.keyPath="userId";class ba{constructor(t,e,n,s,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=s,this.mutations=i}}ba.store="mutations",ba.keyPath="batchId",ba.userMutationsIndex="userMutationsIndex",ba.userMutationsKeyPath=["userId","batchId"];class Ea{constructor(){}static prefixForUser(t){return[t]}static prefixForPath(t,e){return[t,da(e)]}static key(t,e,n){return[t,da(e),n]}}Ea.store="documentMutations",Ea.PLACEHOLDER=new Ea;class Ia{constructor(t,e){this.path=t,this.readTime=e}}class Ta{constructor(t,e){this.path=t,this.version=e}}class _a{constructor(t,e,n,s,i,r){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=s,this.readTime=i,this.parentPath=r}}_a.store="remoteDocuments",_a.readTimeIndex="readTimeIndex",_a.readTimeIndexPath="readTime",_a.collectionReadTimeIndex="collectionReadTimeIndex",_a.collectionReadTimeIndexPath=["parentPath","readTime"];class Na{constructor(t){this.byteSize=t}}Na.store="remoteDocumentGlobal",Na.key="remoteDocumentGlobalKey";class Aa{constructor(t,e,n,s,i,r,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=s,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=r,this.query=o}}Aa.store="targets",Aa.keyPath="targetId",Aa.queryTargetsIndexName="queryTargetsIndex",Aa.queryTargetsKeyPath=["canonicalId","targetId"];class Sa{constructor(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n}}Sa.store="targetDocuments",Sa.keyPath=["targetId","path"],Sa.documentTargetsIndex="documentTargetsIndex",Sa.documentTargetsKeyPath=["path","targetId"];class xa{constructor(t,e,n,s){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=s}}xa.key="targetGlobalKey",xa.store="targetGlobal";class Da{constructor(t,e){this.collectionId=t,this.parent=e}}Da.store="collectionParents",Da.keyPath=["collectionId","parent"];class ka{constructor(t,e,n,s){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=s}}ka.store="clientMetadata",ka.keyPath="clientId";class Ra{constructor(t,e,n){this.bundleId=t,this.createTime=e,this.version=n}}Ra.store="bundles",Ra.keyPath="bundleId";class La{constructor(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n}}La.store="namedQueries",La.keyPath="name";const Oa=[...[...[...[...[va.store,ba.store,Ea.store,_a.store,Aa.store,wa.store,xa.store,Sa.store],ka.store],Na.store],Da.store],Ra.store,La.store];class Ca extends fa{constructor(t,e){super(),this.ys=t,this.ps=e}}function Va(t,e){const n=Ds(t);return ea.Gn(n.ys,e)}class Ua{constructor(t,e,n,s){this.batchId=t,this.bs=e,this.baseMutations=n,this.mutations=s}vs(t,e,n){const s=n.Ss;for(let n=0;n<this.mutations.length;n++){const i=this.mutations[n];i.key.isEqual(t)&&(e=Vr(i,e,s[n]))}return e}Ds(t,e){for(const n of this.baseMutations)n.key.isEqual(t)&&(e=Ur(n,e,0,this.bs));for(const n of this.mutations)n.key.isEqual(t)&&(e=Ur(n,e,0,this.bs));return e}Cs(t){let e=t;return this.mutations.forEach(n=>{const s=this.Ds(n.key,t.get(n.key));s&&(e=e.Gt(n.key,s))}),e}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),lo())}isEqual(t){return this.batchId===t.batchId&&Bs(this.mutations,t.mutations,(t,e)=>Mr(t,e))&&Bs(this.baseMutations,t.baseMutations,(t,e)=>Mr(t,e))}}class Pa{constructor(t,e,n,s){this.batch=t,this.Ns=e,this.Ss=n,this.xs=s}static from(t,e,n){xs(t.mutations.length===n.length);let s=uo;const i=t.mutations;for(let t=0;t<i.length;t++)s=s.Gt(i[t].key,n[t].version);return new Pa(t,e,n,s)}}class Ma{constructor(t){this.Os=t}}function qa(t,e){if(e.document)return function(t,e,n){const s=Uo(t,e.name),i=Lo(e.updateTime),r=new _i({mapValue:{fields:e.fields}});return new xi(s,i,r,{hasCommittedMutations:!!n})}(t.Os,e.document,!!e.hasCommittedMutations);if(e.noDocument){const t=Js._t(e.noDocument.path),n=Ka(e.noDocument.readTime);return new Di(t,n,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){const t=Js._t(e.unknownDocument.path),n=Ka(e.unknownDocument.version);return new ki(t,n)}return Ss()}function Fa(t,e,n){const s=ja(n),i=e.key.path.G().tt();if(e instanceof xi){const n=function(t,e){return{name:Vo(t,e.key),fields:e.yt().mapValue.fields,updateTime:ko(t,e.version.q())}}(t.Os,e),r=e.hasCommittedMutations;return new _a(null,null,n,r,s,i)}if(e instanceof Di){const t=e.key.path.tt(),n=Ba(e.version),r=e.hasCommittedMutations;return new _a(null,new Ia(t,n),null,r,s,i)}if(e instanceof ki){const t=e.key.path.tt(),n=Ba(e.version);return new _a(new Ta(t,n),null,null,!0,s,i)}return Ss()}function ja(t){const e=t.q();return[e.seconds,e.nanoseconds]}function Ga(t){const e=new $s(t[0],t[1]);return zs.$(e)}function Ba(t){const e=t.q();return new ya(e.seconds,e.nanoseconds)}function Ka(t){const e=new $s(t.seconds,t.nanoseconds);return zs.$(e)}function $a(t,e){const n=(e.baseMutations||[]).map(e=>Bo(t.Os,e));for(let t=e.mutations.length-1;t>=0;--t){const n=e.mutations[t];void 0!==(null==n?void 0:n.transform)&&(e.mutations[t-1].updateTransforms=n.transform.fieldTransforms,e.mutations.splice(t,1),--t)}const s=e.mutations.map(e=>Bo(t.Os,e)),i=$s.fromMillis(e.localWriteTimeMs);return new Ua(e.batchId,i,n,s)}function za(t){const e=Ka(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?Ka(t.lastLimboFreeSnapshotVersion):zs.min();let s;var i;return void 0!==t.query.documents?(xs(1===(i=t.query).documents.length),s=or(Zi(Mo(i.documents[0])))):s=function(t){return or(zo(t))}(t.query),new pr(s,t.targetId,0,t.lastListenSequenceNumber,e,n,ni.fromBase64String(t.resumeToken))}function Ha(t,e){const n=Ba(e.kt),s=Ba(e.lastLimboFreeSnapshotVersion);let i;i=Vi(e.target)?Ko(t.Os,e.target):$o(t.Os,e.target);const r=e.resumeToken.toBase64();return new Aa(e.targetId,Oi(e.target),n,r,e.sequenceNumber,s,i)}function Wa(t){const e=zo({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?ar(e,e.limit,"L"):e}class Ya{ks(t,e){return Xa(t).get(e).next(t=>{if(t)return{id:(e=t).bundleId,createTime:Ka(e.createTime),version:e.version};var e})}Ms(t,e){return Xa(t).put({bundleId:(n=e).id,createTime:Ba(Lo(n.createTime)),version:n.version});var n}Fs(t,e){return Ja(t).get(e).next(t=>{if(t)return{name:(e=t).name,query:Wa(e.bundledQuery),readTime:Ka(e.readTime)};var e})}$s(t,e){return Ja(t).put(function(t){return{name:t.name,readTime:Ba(Lo(t.readTime)),bundledQuery:t.bundledQuery}}(e))}}function Xa(t){return Va(t,Ra.store)}function Ja(t){return Va(t,La.store)}class Qa{constructor(){this.Ls=new Za}Bs(t,e){return this.Ls.add(e),Zo.resolve()}qs(t,e){return Zo.resolve(this.Ls.getEntries(e))}}class Za{constructor(){this.index={}}add(t){const e=t.J(),n=t.G(),s=this.index[e]||new no(Ws.K),i=!s.has(n);return this.index[e]=s.add(n),i}has(t){const e=t.J(),n=t.G(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new no(Ws.K)).tt()}}class th{constructor(){this.Us=new Za}Bs(t,e){if(!this.Us.has(e)){const n=e.J(),s=e.G();t.Vs(()=>{this.Us.add(e)});const i={collectionId:n,parent:da(s)};return eh(t).put(i)}return Zo.resolve()}qs(t,e){const n=[],s=IDBKeyRange.bound([e,""],[Ks(e),""],!1,!0);return eh(t).ss(s).next(t=>{for(const s of t){if(s.collectionId!==e)break;n.push(ma(s.parent))}return n})}}function eh(t){return Va(t,Da.store)}const nh={Ks:!1,Qs:0,Ws:0,js:0};class sh{constructor(t,e,n){this.Gs=t,this.zs=e,this.Hs=n}static Js(t){return new sh(t,sh.Ys,sh.Xs)}}async function ih(t){if(t.code!==ks.FAILED_PRECONDITION||t.message!==la)throw t;Ts("LocalStore","Unexpectedly lost primary lease")}sh.Ys=10,sh.Xs=1e3,sh.Zs=new sh(41943040,sh.Ys,sh.Xs),sh.ti=new sh(-1,0,0);class rh{constructor(t,e){this.ei=t,this.ni=e,this.si={}}get(t){const e=this.ei(t),n=this.si[e];if(void 0!==n)for(const[e,s]of n)if(this.ni(e,t))return s}has(t){return void 0!==this.get(t)}set(t,e){const n=this.ei(t),s=this.si[n];if(void 0!==s){for(let n=0;n<s.length;n++)if(this.ni(s[n][0],t))return void(s[n]=[t,e]);s.push([t,e])}else this.si[n]=[[t,e]]}delete(t){const e=this.ei(t),n=this.si[e];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.ni(n[s][0],t))return 1===n.length?delete this.si[e]:n.splice(s,1),!0;return!1}forEach(t){Zs(this.si,(e,n)=>{for(const[e,s]of n)t(e,s)})}Y(){return ti(this.si)}}class oh{constructor(){this.ii=new rh(t=>t.toString(),(t,e)=>t.isEqual(e)),this.ri=!1}oi(t){const e=this.ii.get(t);return e?e.readTime:zs.min()}ci(t,e){this.ui(),this.ii.set(t.key,{ai:t,readTime:e})}hi(t,e=null){this.ui(),this.ii.set(t,{ai:null,readTime:e})}li(t,e){this.ui();const n=this.ii.get(e);return void 0!==n?Zo.resolve(n.ai):this._i(t,e)}getEntries(t,e){return this.fi(t,e)}apply(t){return this.ui(),this.ri=!0,this.di(t)}ui(){}}function ah(t,e,n){const s=t.store(ba.store),i=t.store(Ea.store),r=[],o=IDBKeyRange.only(n.batchId);let a=0;const h=s.us({range:o},(t,e,n)=>(a++,n.delete()));r.push(h.next(()=>{xs(1===a)}));const u=[];for(const t of n.mutations){const s=Ea.key(e,t.key.path,n.batchId);r.push(i.delete(s)),u.push(t.key)}return Zo.Fn(r).next(()=>u)}function hh(t){let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Ss();e=t.noDocument}return JSON.stringify(e).length}class uh{constructor(t,e,n,s){this.userId=t,this.Ut=e,this.wi=n,this.Ei=s,this.Ti={}}static Ii(t,e,n,s){xs(""!==t.uid);const i=t.t()?t.uid:"";return new uh(i,e,n,s)}mi(t){let e=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return lh(t).us({index:ba.userMutationsIndex,range:n},(t,n,s)=>{e=!1,s.done()}).next(()=>e)}Ai(t,e,n,s){const i=fh(t),r=lh(t);return r.add({}).next(o=>{xs("number"==typeof o);const a=new Ua(o,e,n,s),h=function(t,e,n){const s=n.baseMutations.map(e=>Go(t.Os,e)),i=n.mutations.map(e=>Go(t.Os,e));return new ba(e,n.batchId,n.bs.toMillis(),s,i)}(this.Ut,this.userId,a),u=[];let c=new no((t,e)=>Gs(t.et(),e.et()));for(const t of s){const e=Ea.key(this.userId,t.key.path,o);c=c.add(t.key.path.G()),u.push(r.put(h)),u.push(i.put(e,Ea.PLACEHOLDER))}return c.forEach(e=>{u.push(this.wi.Bs(t,e))}),t.Vs(()=>{this.Ti[o]=a.keys()}),Zo.Fn(u).next(()=>a)})}Ri(t,e){return lh(t).get(e).next(t=>t?(xs(t.userId===this.userId),$a(this.Ut,t)):null)}Pi(t,e){return this.Ti[e]?Zo.resolve(this.Ti[e]):this.Ri(t,e).next(t=>{if(t){const n=t.keys();return this.Ti[e]=n,n}return null})}Vi(t,e){const n=e+1,s=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return lh(t).us({index:ba.userMutationsIndex,range:s},(t,e,s)=>{e.userId===this.userId&&(xs(e.batchId>=n),i=$a(this.Ut,e)),s.done()}).next(()=>i)}gi(t){const e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return lh(t).us({index:ba.userMutationsIndex,range:e,reverse:!0},(t,e,s)=>{n=e.batchId,s.done()}).next(()=>n)}yi(t){const e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return lh(t).ss(ba.userMutationsIndex,e).next(t=>t.map(t=>$a(this.Ut,t)))}pi(t,e){const n=Ea.prefixForPath(this.userId,e.path),s=IDBKeyRange.lowerBound(n),i=[];return fh(t).us({range:s},(n,s,r)=>{const[o,a,h]=n,u=ma(a);if(o===this.userId&&e.path.isEqual(u))return lh(t).get(h).next(t=>{if(!t)throw Ss();xs(t.userId===this.userId),i.push($a(this.Ut,t))});r.done()}).next(()=>i)}bi(t,e){let n=new no(Gs);const s=[];return e.forEach(e=>{const i=Ea.prefixForPath(this.userId,e.path),r=IDBKeyRange.lowerBound(i),o=fh(t).us({range:r},(t,s,i)=>{const[r,o,a]=t,h=ma(o);r===this.userId&&e.path.isEqual(h)?n=n.add(a):i.done()});s.push(o)}),Zo.Fn(s).next(()=>this.vi(t,n))}Si(t,e){const n=e.path,s=n.length+1,i=Ea.prefixForPath(this.userId,n),r=IDBKeyRange.lowerBound(i);let o=new no(Gs);return fh(t).us({range:r},(t,e,i)=>{const[r,a,h]=t,u=ma(a);r===this.userId&&n.X(u)?u.length===s&&(o=o.add(h)):i.done()}).next(()=>this.vi(t,o))}vi(t,e){const n=[],s=[];return e.forEach(e=>{s.push(lh(t).get(e).next(t=>{if(null===t)throw Ss();xs(t.userId===this.userId),n.push($a(this.Ut,t))}))}),Zo.Fn(s).next(()=>n)}Di(t,e){return ah(t.ys,this.userId,e).next(n=>(t.Vs(()=>{this.Ci(e.batchId)}),Zo.forEach(n,e=>this.Ei.Ni(t,e))))}Ci(t){delete this.Ti[t]}xi(t){return this.mi(t).next(e=>{if(!e)return Zo.resolve();const n=IDBKeyRange.lowerBound(Ea.prefixForUser(this.userId)),s=[];return fh(t).us({range:n},(t,e,n)=>{if(t[0]===this.userId){const e=ma(t[1]);s.push(e)}else n.done()}).next(()=>{xs(0===s.length)})})}Oi(t,e){return ch(t,this.userId,e)}ki(t){return dh(t).get(this.userId).next(t=>t||new va(this.userId,-1,""))}}function ch(t,e,n){const s=Ea.prefixForPath(e,n.path),i=s[1],r=IDBKeyRange.lowerBound(s);let o=!1;return fh(t).us({range:r,cs:!0},(t,n,s)=>{const[r,a,h]=t;r===e&&a===i&&(o=!0),s.done()}).next(()=>o)}function lh(t){return Va(t,ba.store)}function fh(t){return Va(t,Ea.store)}function dh(t){return Va(t,va.store)}class ph{constructor(t){this.Mi=t}next(){return this.Mi+=2,this.Mi}static Fi(){return new ph(0)}static $i(){return new ph(-1)}}class gh{constructor(t,e){this.Ei=t,this.Ut=e}Li(t){return this.Bi(t).next(e=>{const n=new ph(e.highestTargetId);return e.highestTargetId=n.next(),this.qi(t,e).next(()=>e.highestTargetId)})}Ui(t){return this.Bi(t).next(t=>zs.$(new $s(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}Ki(t){return this.Bi(t).next(t=>t.highestListenSequenceNumber)}Qi(t,e,n){return this.Bi(t).next(s=>(s.highestListenSequenceNumber=e,n&&(s.lastRemoteSnapshotVersion=n.q()),e>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=e),this.qi(t,s)))}Wi(t,e){return this.ji(t,e).next(()=>this.Bi(t).next(n=>(n.targetCount+=1,this.Gi(e,n),this.qi(t,n))))}zi(t,e){return this.ji(t,e)}Hi(t,e){return this.Ji(t,e.targetId).next(()=>mh(t).delete(e.targetId)).next(()=>this.Bi(t)).next(e=>(xs(e.targetCount>0),e.targetCount-=1,this.qi(t,e)))}Yi(t,e,n){let s=0;const i=[];return mh(t).us((r,o)=>{const a=za(o);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(s++,i.push(this.Hi(t,a)))}).next(()=>Zo.Fn(i)).next(()=>s)}Tn(t,e){return mh(t).us((t,n)=>{const s=za(n);e(s)})}Bi(t){return yh(t).get(xa.key).next(t=>(xs(null!==t),t))}qi(t,e){return yh(t).put(xa.key,e)}ji(t,e){return mh(t).put(Ha(this.Ut,e))}Gi(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}Xi(t){return this.Bi(t).next(t=>t.targetCount)}Zi(t,e){const n=Oi(e),s=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return mh(t).us({range:s,index:Aa.queryTargetsIndexName},(t,n,s)=>{const r=za(n);Ci(e,r.target)&&(i=r,s.done())}).next(()=>i)}tr(t,e,n){const s=[],i=wh(t);return e.forEach(e=>{const r=da(e.path);s.push(i.put(new Sa(n,r))),s.push(this.Ei.er(t,n,e))}),Zo.Fn(s)}nr(t,e,n){const s=wh(t);return Zo.forEach(e,e=>{const i=da(e.path);return Zo.Fn([s.delete([n,i]),this.Ei.sr(t,n,e)])})}Ji(t,e){const n=wh(t),s=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(s)}ir(t,e){const n=IDBKeyRange.bound([e],[e+1],!1,!0),s=wh(t);let i=lo();return s.us({range:n,cs:!0},(t,e,n)=>{const s=ma(t[1]),r=new Js(s);i=i.add(r)}).next(()=>i)}Oi(t,e){const n=da(e.path),s=IDBKeyRange.bound([n],[Ks(n)],!1,!0);let i=0;return wh(t).us({index:Sa.documentTargetsIndex,cs:!0,range:s},([t,e],n,s)=>{0!==t&&(i++,s.done())}).next(()=>i>0)}vn(t,e){return mh(t).get(e).next(t=>t?za(t):null)}}function mh(t){return Va(t,Aa.store)}function yh(t){return Va(t,xa.store)}function wh(t){return Va(t,Sa.store)}function vh([t,e],[n,s]){const i=Gs(t,n);return 0===i?Gs(e,s):i}class bh{constructor(t){this.rr=t,this.buffer=new no(vh),this.cr=0}ur(){return++this.cr}ar(t){const e=[t,this.ur()];if(this.buffer.size<this.rr)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();vh(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class Eh{constructor(t,e){this.hr=t,this.ls=e,this.lr=!1,this._r=null}start(t){-1!==this.hr.params.Gs&&this.dr(t)}stop(){this._r&&(this._r.cancel(),this._r=null)}get wr(){return null!==this._r}dr(t){const e=this.lr?3e5:6e4;Ts("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this._r=this.ls.Er("lru_garbage_collection",e,async()=>{this._r=null,this.lr=!0;try{await t.Tr(this.hr)}catch(t){ia(t)?Ts("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await ih(t)}await this.dr(t)})}}class Ih{constructor(t,e){this.Ir=t,this.params=e}mr(t,e){return this.Ir.Ar(t).next(t=>Math.floor(e/100*t))}Rr(t,e){if(0===e)return Zo.resolve(qs.k);const n=new bh(e);return this.Ir.Tn(t,t=>n.ar(t.sequenceNumber)).next(()=>this.Ir.Pr(t,t=>n.ar(t))).next(()=>n.maxValue)}Yi(t,e,n){return this.Ir.Yi(t,e,n)}Vr(t,e){return this.Ir.Vr(t,e)}gr(t,e){return-1===this.params.Gs?(Ts("LruGarbageCollector","Garbage collection skipped; disabled"),Zo.resolve(nh)):this.yr(t).next(n=>n<this.params.Gs?(Ts("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold `+this.params.Gs),nh):this.pr(t,e))}yr(t){return this.Ir.yr(t)}pr(t,e){let n,s,i,r,o,a,u;const c=Date.now();return this.mr(t,this.params.zs).next(e=>(e>this.params.Hs?(Ts("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.Hs} from `+e),s=this.params.Hs):s=e,r=Date.now(),this.Rr(t,s))).next(s=>(n=s,o=Date.now(),this.Yi(t,n,e))).next(e=>(i=e,a=Date.now(),this.Vr(t,n))).next(t=>(u=Date.now(),Is()<=h.DEBUG&&Ts("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${r-c}ms\n\tDetermined least recently used ${s} in `+(o-r)+"ms\n"+`\tRemoved ${i} targets in `+(a-o)+"ms\n"+`\tRemoved ${t} documents in `+(u-a)+"ms\n"+`Total Duration: ${u-c}ms`),Zo.resolve({Ks:!0,Qs:s,Ws:i,js:t})))}}class Th{constructor(t,e){this.db=t,this.hr=function(t,e){return new Ih(t,e)}(this,e)}Ar(t){const e=this.br(t);return this.db.vr().Xi(t).next(t=>e.next(e=>t+e))}br(t){let e=0;return this.Pr(t,t=>{e++}).next(()=>e)}Tn(t,e){return this.db.vr().Tn(t,e)}Pr(t,e){return this.Sr(t,(t,n)=>e(n))}er(t,e,n){return _h(t,n)}sr(t,e,n){return _h(t,n)}Yi(t,e,n){return this.db.vr().Yi(t,e,n)}Ni(t,e){return _h(t,e)}Dr(t,e){return function(t,e){let n=!1;return dh(t).hs(s=>ch(t,s,e).next(t=>(t&&(n=!0),Zo.resolve(!t)))).next(()=>n)}(t,e)}Vr(t,e){const n=this.db.Nr().Cr(),s=[];let i=0;return this.Sr(t,(r,o)=>{if(o<=e){const e=this.Dr(t,r).next(e=>{if(!e)return i++,n.li(t,r).next(()=>(n.hi(r),wh(t).delete([0,da(r.path)])))});s.push(e)}}).next(()=>Zo.Fn(s)).next(()=>n.apply(t)).next(()=>i)}removeTarget(t,e){const n=e.Mt(t.ps);return this.db.vr().zi(t,n)}Or(t,e){return _h(t,e)}Sr(t,e){const n=wh(t);let s,i=qs.k;return n.us({index:Sa.documentTargetsIndex},([t,n],{path:r,sequenceNumber:o})=>{0===t?(i!==qs.k&&e(new Js(ma(s)),i),i=o,s=r):i=qs.k}).next(()=>{i!==qs.k&&e(new Js(ma(s)),i)})}yr(t){return this.db.Nr().kr(t)}}function _h(t,e){return wh(t).put(function(t,e){return new Sa(0,da(t.path),e)}(e,t.ps))}class Nh{constructor(t,e){this.Ut=t,this.wi=e}ci(t,e,n){return xh(t).put(Dh(e),n)}hi(t,e){const n=xh(t),s=Dh(e);return n.delete(s)}updateMetadata(t,e){return this.getMetadata(t).next(n=>(n.byteSize+=e,this.Mr(t,n)))}li(t,e){return xh(t).get(Dh(e)).next(t=>this.Fr(t))}$r(t,e){return xh(t).get(Dh(e)).next(t=>{const e=this.Fr(t);return e?{ai:e,size:hh(t)}:null})}getEntries(t,e){let n=oo();return this.Lr(t,e,(t,e)=>{const s=this.Fr(e);n=n.Gt(t,s)}).next(()=>n)}Br(t,e){let n=oo(),s=new Zr(Js.K);return this.Lr(t,e,(t,e)=>{const i=this.Fr(e);i?(n=n.Gt(t,i),s=s.Gt(t,hh(e))):(n=n.Gt(t,null),s=s.Gt(t,0))}).next(()=>({qr:n,Ur:s}))}Lr(t,e,n){if(e.Y())return Zo.resolve();const s=IDBKeyRange.bound(e.first().path.tt(),e.last().path.tt()),i=e.Zt();let r=i.re();return xh(t).us({range:s},(t,e,s)=>{const o=Js._t(t);for(;r&&Js.K(r,o)<0;)n(r,null),r=i.re();r&&r.isEqual(o)&&(n(r,e),r=i.oe()?i.re():null),r?s.ns(r.path.tt()):s.done()}).next(()=>{for(;r;)n(r,null),r=i.oe()?i.re():null})}Kr(t,e,n){let s=ho();const i=e.path.length+1,r={};if(n.isEqual(zs.min())){const t=e.path.tt();r.range=IDBKeyRange.lowerBound(t)}else{const t=e.path.tt(),s=ja(n);r.range=IDBKeyRange.lowerBound([t,s],!0),r.index=_a.collectionReadTimeIndex}return xh(t).us(r,(t,n,r)=>{if(t.length!==i)return;const o=qa(this.Ut,n);e.path.X(o.key.path)?o instanceof xi&&lr(e,o)&&(s=s.Gt(o.key,o)):r.done()}).next(()=>s)}Cr(t){return new Ah(this,!!t&&t.Qr)}kr(t){return this.getMetadata(t).next(t=>t.byteSize)}getMetadata(t){return Sh(t).get(Na.key).next(t=>(xs(!!t),t))}Mr(t,e){return Sh(t).put(Na.key,e)}Fr(t){if(t){const e=qa(this.Ut,t);return e instanceof Di&&e.version.isEqual(zs.min())?null:e}return null}}class Ah extends oh{constructor(t,e){super(),this.Wr=t,this.Qr=e,this.jr=new rh(t=>t.toString(),(t,e)=>t.isEqual(e))}di(t){const e=[];let n=0,s=new no((t,e)=>Gs(t.et(),e.et()));return this.ii.forEach((i,r)=>{const o=this.jr.get(i);if(r.ai){const a=Fa(this.Wr.Ut,r.ai,this.oi(i));s=s.add(i.path.G());const h=hh(a);n+=h-o,e.push(this.Wr.ci(t,i,a))}else if(n-=o,this.Qr){const n=Fa(this.Wr.Ut,new Di(i,zs.min()),this.oi(i));e.push(this.Wr.ci(t,i,n))}else e.push(this.Wr.hi(t,i))}),s.forEach(n=>{e.push(this.Wr.wi.Bs(t,n))}),e.push(this.Wr.updateMetadata(t,n)),Zo.Fn(e)}_i(t,e){return this.Wr.$r(t,e).next(t=>null===t?(this.jr.set(e,0),null):(this.jr.set(e,t.size),t.ai))}fi(t,e){return this.Wr.Br(t,e).next(({qr:t,Ur:e})=>(e.forEach((t,e)=>{this.jr.set(t,e)}),t))}}function Sh(t){return Va(t,Na.store)}function xh(t){return Va(t,_a.store)}function Dh(t){return t.path.tt()}class kh{constructor(t){this.Ut=t}Hn(t,e,n,s){xs(n<s&&n>=0&&s<=11);const i=new ta("createOrUpgrade",e);n<1&&s>=1&&(function(t){t.createObjectStore(wa.store)}(t),function(t){t.createObjectStore(va.store,{keyPath:va.keyPath}),t.createObjectStore(ba.store,{keyPath:ba.keyPath,autoIncrement:!0}).createIndex(ba.userMutationsIndex,ba.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Ea.store)}(t),Rh(t),function(t){t.createObjectStore(_a.store)}(t));let r=Zo.resolve();return n<3&&s>=3&&(0!==n&&(function(t){t.deleteObjectStore(Sa.store),t.deleteObjectStore(Aa.store),t.deleteObjectStore(xa.store)}(t),Rh(t)),r=r.next(()=>(function(t){const e=i.store(xa.store),n=new xa(0,0,zs.min().q(),0);return e.put(xa.key,n)})())),n<4&&s>=4&&(0!==n&&(r=r.next(()=>(function(t,e){return e.store(ba.store).ss().next(n=>{t.deleteObjectStore(ba.store),t.createObjectStore(ba.store,{keyPath:ba.keyPath,autoIncrement:!0}).createIndex(ba.userMutationsIndex,ba.userMutationsKeyPath,{unique:!0});const s=e.store(ba.store),i=n.map(t=>s.put(t));return Zo.Fn(i)})})(t,i))),r=r.next(()=>{!function(t){t.createObjectStore(ka.store,{keyPath:ka.keyPath})}(t)})),n<5&&s>=5&&(r=r.next(()=>this.Gr(i))),n<6&&s>=6&&(r=r.next(()=>((function(t){t.createObjectStore(Na.store)})(t),this.zr(i)))),n<7&&s>=7&&(r=r.next(()=>this.Hr(i))),n<8&&s>=8&&(r=r.next(()=>this.Jr(t,i))),n<9&&s>=9&&(r=r.next(()=>{!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){const e=t.objectStore(_a.store);e.createIndex(_a.readTimeIndex,_a.readTimeIndexPath,{unique:!1}),e.createIndex(_a.collectionReadTimeIndex,_a.collectionReadTimeIndexPath,{unique:!1})}(e)})),n<10&&s>=10&&(r=r.next(()=>this.Yr(i))),n<11&&s>=11&&(r=r.next(()=>{!function(t){t.createObjectStore(Ra.store,{keyPath:Ra.keyPath})}(t),function(t){t.createObjectStore(La.store,{keyPath:La.keyPath})}(t)})),r}zr(t){let e=0;return t.store(_a.store).us((t,n)=>{e+=hh(n)}).next(()=>{const n=new Na(e);return t.store(Na.store).put(Na.key,n)})}Gr(t){const e=t.store(va.store),n=t.store(ba.store);return e.ss().next(e=>Zo.forEach(e,e=>{const s=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return n.ss(ba.userMutationsIndex,s).next(n=>Zo.forEach(n,n=>{xs(n.userId===e.userId);const s=$a(this.Ut,n);return ah(t,e.userId,s).next(()=>{})}))}))}Hr(t){const e=t.store(Sa.store),n=t.store(_a.store);return t.store(xa.store).get(xa.key).next(t=>{const s=[];return n.us((n,i)=>{const r=new Ws(n),o=function(t){return[0,da(r)]}();s.push(e.get(o).next(n=>n?Zo.resolve():(n=>e.put(new Sa(0,da(n),t.highestListenSequenceNumber)))(r)))}).next(()=>Zo.Fn(s))})}Jr(t,e){t.createObjectStore(Da.store,{keyPath:Da.keyPath});const n=e.store(Da.store),s=new Za,i=t=>{if(s.add(t)){const e=t.J(),s=t.G();return n.put({collectionId:e,parent:da(s)})}};return e.store(_a.store).us({cs:!0},(t,e)=>{const n=new Ws(t);return i(n.G())}).next(()=>e.store(Ea.store).us({cs:!0},([t,e,n],s)=>{const r=ma(e);return i(r.G())}))}Yr(t){const e=t.store(Aa.store);return e.us((t,n)=>{const s=za(n),i=Ha(this.Ut,s);return e.put(i)})}}function Rh(t){t.createObjectStore(Sa.store,{keyPath:Sa.keyPath}).createIndex(Sa.documentTargetsIndex,Sa.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Aa.store,{keyPath:Aa.keyPath}).createIndex(Aa.queryTargetsIndexName,Aa.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(xa.store)}const Lh="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Oh{constructor(t,e,n,s,i,r,o,a,h,u){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Xr=i,this.window=r,this.document=o,this.Zr=h,this.eo=u,this.no=null,this.so=!1,this.isPrimary=!1,this.networkEnabled=!0,this.io=null,this.inForeground=!1,this.ro=null,this.oo=null,this.co=Number.NEGATIVE_INFINITY,this.uo=(t=>Promise.resolve()),!Oh.Kn())throw new Rs(ks.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.Ei=new Th(this,s),this.ao=e+"main",this.Ut=new Ma(a),this.ho=new ea(this.ao,11,new kh(this.Ut)),this.lo=new gh(this.Ei,this.Ut),this.wi=new th,this._o=function(t,e){return new Nh(t,e)}(this.Ut,this.wi),this.fo=new Ya,this.window&&this.window.localStorage?this.wo=this.window.localStorage:(this.wo=null,!1===u&&_s("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Eo().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Rs(ks.FAILED_PRECONDITION,Lh);return this.To(),this.Io(),this.mo(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.lo.Ki(t))}).then(t=>{this.no=new qs(t,this.Zr)}).then(()=>{this.so=!0}).catch(t=>(this.ho&&this.ho.close(),Promise.reject(t)))}Ao(t){return this.uo=(async e=>{if(this.wr)return t(e)}),t(this.isPrimary)}Ro(t){this.ho.Yn(async e=>{null===e.newVersion&&await t()})}Po(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Xr.Rs(async()=>{this.wr&&await this.Eo()}))}Eo(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>Vh(t).put(new ka(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next(()=>{if(this.isPrimary)return this.Vo(t).next(t=>{t||(this.isPrimary=!1,this.Xr.yo(()=>this.uo(!1)))})}).next(()=>this.po(t)).next(e=>this.isPrimary&&!e?this.bo(t).next(()=>!1):!!e&&this.vo(t).next(()=>!0))).catch(t=>{if(ia(t))return Ts("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return Ts("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.Xr.yo(()=>this.uo(t)),this.isPrimary=t})}Vo(t){return Ch(t).get(wa.key).next(t=>Zo.resolve(this.So(t)))}Do(t){return Vh(t).delete(this.clientId)}async Co(){if(this.isPrimary&&!this.No(this.co,18e5)){this.co=Date.now();const t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const e=Va(t,ka.store);return e.ss().next(t=>{const n=this.xo(t,18e5),s=t.filter(t=>-1===n.indexOf(t));return Zo.forEach(s,t=>e.delete(t.clientId)).next(()=>s)})}).catch(()=>[]);if(this.wo)for(const e of t)this.wo.removeItem(this.Oo(e.clientId))}}mo(){this.oo=this.Xr.Er("client_metadata_refresh",4e3,()=>this.Eo().then(()=>this.Co()).then(()=>this.mo()))}So(t){return!!t&&t.ownerId===this.clientId}po(t){return this.eo?Zo.resolve(!0):Ch(t).get(wa.key).next(e=>{if(null!==e&&this.No(e.leaseTimestampMs,5e3)&&!this.ko(e.ownerId)){if(this.So(e)&&this.networkEnabled)return!0;if(!this.So(e)){if(!e.allowTabSynchronization)throw new Rs(ks.FAILED_PRECONDITION,Lh);return!1}}return!(!this.networkEnabled||!this.inForeground)||Vh(t).ss().next(t=>void 0===this.xo(t,5e3).find(t=>{if(this.clientId!==t.clientId){const e=!this.networkEnabled&&t.networkEnabled,n=!this.inForeground&&t.inForeground,s=this.networkEnabled===t.networkEnabled;if(e||n&&s)return!0}return!1}))}).next(t=>(this.isPrimary!==t&&Ts("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async Mo(){this.so=!1,this.Fo(),this.oo&&(this.oo.cancel(),this.oo=null),this.$o(),this.Lo(),await this.ho.runTransaction("shutdown","readwrite",[wa.store,ka.store],t=>{const e=new Ca(t,qs.k);return this.bo(e).next(()=>this.Do(e))}),this.ho.close(),this.Bo()}xo(t,e){return t.filter(t=>this.No(t.updateTimeMs,e)&&!this.ko(t.clientId))}qo(){return this.runTransaction("getActiveClients","readonly",t=>Vh(t).ss().next(t=>this.xo(t,18e5).map(t=>t.clientId)))}get wr(){return this.so}Uo(t){return uh.Ii(t,this.Ut,this.wi,this.Ei)}vr(){return this.lo}Nr(){return this._o}Ko(){return this.wi}Qo(){return this.fo}runTransaction(t,e,n){Ts("IndexedDbPersistence","Starting transaction:",t);const s="readonly"===e?"readonly":"readwrite";let i;return this.ho.runTransaction(t,s,Oa,s=>(i=new Ca(s,this.no?this.no.next():qs.k),"readwrite-primary"===e?this.Vo(i).next(t=>!!t||this.po(i)).next(e=>{if(!e)throw _s(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Xr.yo(()=>this.uo(!1)),new Rs(ks.FAILED_PRECONDITION,la);return n(i)}).next(t=>this.vo(i).next(()=>t)):this.Wo(i).next(()=>n(i)))).then(t=>(i.gs(),t))}Wo(t){return Ch(t).get(wa.key).next(t=>{if(null!==t&&this.No(t.leaseTimestampMs,5e3)&&!this.ko(t.ownerId)&&!this.So(t)&&!(this.eo||this.allowTabSynchronization&&t.allowTabSynchronization))throw new Rs(ks.FAILED_PRECONDITION,Lh)})}vo(t){const e=new wa(this.clientId,this.allowTabSynchronization,Date.now());return Ch(t).put(wa.key,e)}static Kn(){return ea.Kn()}bo(t){const e=Ch(t);return e.get(wa.key).next(t=>this.So(t)?(Ts("IndexedDbPersistence","Releasing primary lease."),e.delete(wa.key)):Zo.resolve())}No(t,e){const n=Date.now();return!(t<n-e||t>n&&(_s(`Detected an update time that is in the future: ${t} > ${n}`),1))}To(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ro=(()=>{this.Xr.Rs(()=>(this.inForeground="visible"===this.document.visibilityState,this.Eo()))}),this.document.addEventListener("visibilitychange",this.ro),this.inForeground="visible"===this.document.visibilityState)}$o(){this.ro&&(this.document.removeEventListener("visibilitychange",this.ro),this.ro=null)}Io(){var t;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.io=(()=>{this.Fo(),this.Xr.Rs(()=>this.Mo())}),this.window.addEventListener("unload",this.io))}Lo(){this.io&&(this.window.removeEventListener("unload",this.io),this.io=null)}ko(t){var e;try{const n=null!==(null===(e=this.wo)||void 0===e?void 0:e.getItem(this.Oo(t)));return Ts("IndexedDbPersistence",`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(t){return _s("IndexedDbPersistence","Failed to get zombied client id.",t),!1}}Fo(){if(this.wo)try{this.wo.setItem(this.Oo(this.clientId),String(Date.now()))}catch(t){_s("Failed to set zombie client id.",t)}}Bo(){if(this.wo)try{this.wo.removeItem(this.Oo(this.clientId))}catch(t){}}Oo(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}function Ch(t){return Va(t,wa.store)}function Vh(t){return Va(t,ka.store)}function Uh(t,e){let n=t.projectId;return t.S||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}class Ph{constructor(t,e,n){this._o=t,this.jo=e,this.wi=n}Go(t,e){return this.jo.pi(t,e).next(n=>this.zo(t,e,n))}zo(t,e,n){return this._o.li(t,e).next(t=>{for(const s of n)t=s.Ds(e,t);return t})}Ho(t,e,n){let s=oo();return e.forEach((t,e)=>{for(const s of n)e=s.Ds(t,e);s=s.Gt(t,e)}),s}Jo(t,e){return this._o.getEntries(t,e).next(e=>this.Yo(t,e))}Yo(t,e){return this.jo.bi(t,e).next(n=>{const s=this.Ho(t,e,n);let i=ro();return s.forEach((t,e)=>{e||(e=new Di(t,zs.min())),i=i.Gt(t,e)}),i})}Kr(t,e,n){return function(t){return Js.lt(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Xo(t,e.path):ir(e)?this.Zo(t,e,n):this.tc(t,e,n)}Xo(t,e){return this.Go(t,new Js(e)).next(t=>{let e=ho();return t instanceof xi&&(e=e.Gt(t.key,t)),e})}Zo(t,e,n){const s=e.collectionGroup;let i=ho();return this.wi.qs(t,s).next(r=>Zo.forEach(r,r=>{const o=function(t,e){return new Ji(e,null,t.Ct.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,r.child(s));return this.tc(t,o,n).next(t=>{t.forEach((t,e)=>{i=i.Gt(t,e)})})}).next(()=>i))}tc(t,e,n){let s,i;return this._o.Kr(t,e,n).next(n=>(s=n,this.jo.Si(t,e))).next(e=>(i=e,this.ec(t,i,s).next(t=>{s=t;for(const t of i)for(const e of t.mutations){const n=e.key,i=Ur(e,s.get(n),0,t.bs);s=i instanceof xi?s.Gt(n,i):s.remove(n)}}))).next(()=>(s.forEach((t,n)=>{lr(e,n)||(s=s.remove(t))}),s))}ec(t,e,n){let s=lo();for(const t of e)for(const e of t.mutations)e instanceof jr&&null===n.get(e.key)&&(s=s.add(e.key));let i=n;return this._o.getEntries(t,s).next(t=>(t.forEach((t,e)=>{null!==e&&e instanceof xi&&(i=i.Gt(t,e))}),i))}}class Mh{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.nc=n,this.sc=s}static ic(t,e){let n=lo(),s=lo();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:s=s.add(t.doc.key)}return new Mh(t,e.fromCache,n,s)}}class qh{rc(t){this.oc=t}Kr(t,e,n,s){return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.Ct.length||1===t.Ct.length&&t.Ct[0].field.rt())}(e)||n.isEqual(zs.min())?this.cc(t,e):this.oc.Jo(t,s).next(i=>{const r=this.uc(e,i);return(tr(e)||er(e))&&this.ac(e.limitType,r,s,n)?this.cc(t,e):(Is()<=h.DEBUG&&Ts("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),cr(e)),this.oc.Kr(t,e,n).next(t=>(r.forEach(e=>{t=t.Gt(e.key,e)}),t)))})}uc(t,e){let n=new no(fr(t));return e.forEach((e,s)=>{s instanceof xi&&lr(t,s)&&(n=n.add(s))}),n}ac(t,e,n,s){if(n.size!==e.size)return!0;const i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.L(s)>0)}cc(t,e){return Is()<=h.DEBUG&&Ts("QueryEngine","Using full collection scan to execute query:",cr(e)),this.oc.Kr(t,e,zs.min())}}class Fh{constructor(t,e,n,s){this.persistence=t,this.hc=e,this.Ut=s,this.lc=new Zr(Gs),this._c=new rh(t=>Oi(t),Ci),this.fc=zs.min(),this.jo=t.Uo(n),this.dc=t.Nr(),this.lo=t.vr(),this.wc=new Ph(this.dc,this.jo,this.persistence.Ko()),this.fo=t.Qo(),this.hc.rc(this.wc)}Tr(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.gr(e,this.lc))}}function jh(t,e,n,s){return new Fh(t,e,n,s)}async function Gh(t,e){const n=Ds(t);let s=n.jo,i=n.wc;const r=await n.persistence.runTransaction("Handle user change","readonly",t=>{let r;return n.jo.yi(t).next(o=>(r=o,s=n.persistence.Uo(e),i=new Ph(n.dc,s,n.persistence.Ko()),s.yi(t))).next(e=>{const n=[],s=[];let o=lo();for(const t of r){n.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return i.Jo(t,o).next(t=>({Ec:t,Tc:n,Ic:s}))})});return n.jo=s,n.wc=i,n.hc.rc(n.wc),r}function Bh(t){const e=Ds(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.lo.Ui(t))}function Kh(t,e){const n=Ds(t);return n.persistence.runTransaction("Get next mutation batch","readonly",t=>(void 0===e&&(e=-1),n.jo.Vi(t,e)))}function $h(t,e){const n=Ds(t);return n.persistence.runTransaction("Allocate target","readwrite",t=>{let s;return n.lo.Zi(t,e).next(i=>i?(s=i,Zo.resolve(s)):n.lo.Li(t).next(i=>(s=new pr(e,i,0,t.ps),n.lo.Wi(t,s).next(()=>s))))}).then(t=>{const s=n.lc.get(t.targetId);return(null===s||t.kt.L(s.kt)>0)&&(n.lc=n.lc.Gt(t.targetId,t),n._c.set(e,t.targetId)),t})}async function zh(t,e,n){const s=Ds(t),i=s.lc.get(e),r=n?"readwrite":"readwrite-primary";try{n||await s.persistence.runTransaction("Release target",r,t=>s.persistence.Ei.removeTarget(t,i))}catch(t){if(!ia(t))throw t;Ts("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}s.lc=s.lc.remove(e),s._c.delete(i.target)}function Hh(t,e,n){const s=Ds(t);let i=zs.min(),r=lo();return s.persistence.runTransaction("Execute query","readonly",t=>(function(t,e,n){const s=Ds(t),i=s._c.get(n);return void 0!==i?Zo.resolve(s.lc.get(i)):s.lo.Zi(e,n)})(s,t,or(e)).next(e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,s.lo.ir(t,e.targetId).next(t=>{r=t})}).next(()=>s.hc.Kr(t,e,n?i:zs.min(),n?r:lo())).next(t=>({documents:t,mc:r})))}function Wh(t,e){const n=Ds(t),s=Ds(n.lo),i=n.lc.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",t=>s.vn(t,e).next(t=>t?t.target:null))}function Yh(t){const e=Ds(t);return e.persistence.runTransaction("Get new document changes","readonly",t=>(function(t,e,n){const s=Ds(t);let i=ro(),r=ja(n);const o=xh(e),a=IDBKeyRange.lowerBound(r,!0);return o.us({index:_a.readTimeIndex,range:a},(t,e)=>{const n=qa(s.Ut,e);i=i.Gt(n.key,n),r=e.readTime}).next(()=>({Ac:i,readTime:Ga(r)}))})(e.dc,t,e.fc)).then(({Ac:t,readTime:n})=>(e.fc=n,t))}class Xh{constructor(t){this.Ut=t,this.Rc=new Map,this.Pc=new Map}ks(t,e){return Zo.resolve(this.Rc.get(e))}Ms(t,e){var n;return this.Rc.set(e.id,{id:(n=e).id,version:n.version,createTime:Lo(n.createTime)}),Zo.resolve()}Fs(t,e){return Zo.resolve(this.Pc.get(e))}$s(t,e){var n;return this.Pc.set(e.name,{name:(n=e).name,query:Wa(n.bundledQuery),readTime:Lo(n.readTime)}),Zo.resolve()}}class Jh{constructor(){this.Vc=new no(Qh.gc),this.yc=new no(Qh.bc)}Y(){return this.Vc.Y()}er(t,e){const n=new Qh(t,e);this.Vc=this.Vc.add(n),this.yc=this.yc.add(n)}vc(t,e){t.forEach(t=>this.er(t,e))}sr(t,e){this.Sc(new Qh(t,e))}Dc(t,e){t.forEach(t=>this.sr(t,e))}Cc(t){const e=new Js(new Ws([])),n=new Qh(e,t),s=new Qh(e,t+1),i=[];return this.yc.Ie([n,s],t=>{this.Sc(t),i.push(t.key)}),i}Nc(){this.Vc.forEach(t=>this.Sc(t))}Sc(t){this.Vc=this.Vc.delete(t),this.yc=this.yc.delete(t)}xc(t){const e=new Js(new Ws([])),n=new Qh(e,t),s=new Qh(e,t+1);let i=lo();return this.yc.Ie([n,s],t=>{i=i.add(t.key)}),i}Oi(t){const e=new Qh(t,0),n=this.Vc.Ae(e);return null!==n&&t.isEqual(n.key)}}class Qh{constructor(t,e){this.key=t,this.Oc=e}static gc(t,e){return Js.K(t.key,e.key)||Gs(t.Oc,e.Oc)}static bc(t,e){return Gs(t.Oc,e.Oc)||Js.K(t.key,e.key)}}class Zh{constructor(t,e){this.wi=t,this.Ei=e,this.jo=[],this.kc=1,this.Mc=new no(Qh.gc)}mi(t){return Zo.resolve(0===this.jo.length)}Ai(t,e,n,s){const i=this.kc;this.kc++,this.jo.length>0&&this.jo[this.jo.length-1];const r=new Ua(i,e,n,s);this.jo.push(r);for(const e of s)this.Mc=this.Mc.add(new Qh(e.key,i)),this.wi.Bs(t,e.key.path.G());return Zo.resolve(r)}Ri(t,e){return Zo.resolve(this.Fc(e))}Vi(t,e){const n=e+1,s=this.$c(n),i=s<0?0:s;return Zo.resolve(this.jo.length>i?this.jo[i]:null)}gi(){return Zo.resolve(0===this.jo.length?-1:this.kc-1)}yi(t){return Zo.resolve(this.jo.slice())}pi(t,e){const n=new Qh(e,0),s=new Qh(e,Number.POSITIVE_INFINITY),i=[];return this.Mc.Ie([n,s],t=>{const e=this.Fc(t.Oc);i.push(e)}),Zo.resolve(i)}bi(t,e){let n=new no(Gs);return e.forEach(t=>{const e=new Qh(t,0),s=new Qh(t,Number.POSITIVE_INFINITY);this.Mc.Ie([e,s],t=>{n=n.add(t.Oc)})}),Zo.resolve(this.Lc(n))}Si(t,e){const n=e.path,s=n.length+1;let i=n;Js.lt(i)||(i=i.child(""));const r=new Qh(new Js(i),0);let o=new no(Gs);return this.Mc.me(t=>{const e=t.key.path;return!!n.X(e)&&(e.length===s&&(o=o.add(t.Oc)),!0)},r),Zo.resolve(this.Lc(o))}Lc(t){const e=[];return t.forEach(t=>{const n=this.Fc(t);null!==n&&e.push(n)}),e}Di(t,e){xs(0===this.Bc(e.batchId,"removed")),this.jo.shift();let n=this.Mc;return Zo.forEach(e.mutations,s=>{const i=new Qh(s.key,e.batchId);return n=n.delete(i),this.Ei.Ni(t,s.key)}).next(()=>{this.Mc=n})}Ci(t){}Oi(t,e){const n=new Qh(e,0),s=this.Mc.Ae(n);return Zo.resolve(e.isEqual(s&&s.key))}xi(t){return this.jo.length,Zo.resolve()}Bc(t,e){return this.$c(t)}$c(t){return 0===this.jo.length?0:t-this.jo[0].batchId}Fc(t){const e=this.$c(t);return e<0||e>=this.jo.length?null:this.jo[e]}}class tu{constructor(t,e){this.wi=t,this.qc=e,this.docs=new Zr(Js.K),this.size=0}ci(t,e,n){const s=e.key,i=this.docs.get(s),r=i?i.size:0,o=this.qc(e);return this.docs=this.docs.Gt(s,{ai:e,size:o,readTime:n}),this.size+=o-r,this.wi.Bs(t,s.path.G())}hi(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}li(t,e){const n=this.docs.get(e);return Zo.resolve(n?n.ai:null)}getEntries(t,e){let n=oo();return e.forEach(t=>{const e=this.docs.get(t);n=n.Gt(t,e?e.ai:null)}),Zo.resolve(n)}Kr(t,e,n){let s=ho();const i=new Js(e.path.child("")),r=this.docs.te(i);for(;r.oe();){const{key:t,value:{ai:i,readTime:o}}=r.re();if(!e.path.X(t.path))break;o.L(n)<=0||i instanceof xi&&lr(e,i)&&(s=s.Gt(i.key,i))}return Zo.resolve(s)}Uc(t,e){return Zo.forEach(this.docs,t=>e(t))}Cr(t){return new eu(this)}kr(t){return Zo.resolve(this.size)}}class eu extends oh{constructor(t){super(),this.Wr=t}di(t){const e=[];return this.ii.forEach((n,s)=>{s&&s.ai?e.push(this.Wr.ci(t,s.ai,this.oi(n))):this.Wr.hi(n)}),Zo.Fn(e)}_i(t,e){return this.Wr.li(t,e)}fi(t,e){return this.Wr.getEntries(t,e)}}class nu{constructor(t){this.persistence=t,this.Kc=new rh(t=>Oi(t),Ci),this.lastRemoteSnapshotVersion=zs.min(),this.highestTargetId=0,this.Qc=0,this.Wc=new Jh,this.targetCount=0,this.jc=ph.Fi()}Tn(t,e){return this.Kc.forEach((t,n)=>e(n)),Zo.resolve()}Ui(t){return Zo.resolve(this.lastRemoteSnapshotVersion)}Ki(t){return Zo.resolve(this.Qc)}Li(t){return this.highestTargetId=this.jc.next(),Zo.resolve(this.highestTargetId)}Qi(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Qc&&(this.Qc=e),Zo.resolve()}ji(t){this.Kc.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.jc=new ph(e),this.highestTargetId=e),t.sequenceNumber>this.Qc&&(this.Qc=t.sequenceNumber)}Wi(t,e){return this.ji(e),this.targetCount+=1,Zo.resolve()}zi(t,e){return this.ji(e),Zo.resolve()}Hi(t,e){return this.Kc.delete(e.target),this.Wc.Cc(e.targetId),this.targetCount-=1,Zo.resolve()}Yi(t,e,n){let s=0;const i=[];return this.Kc.forEach((r,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Kc.delete(r),i.push(this.Ji(t,o.targetId)),s++)}),Zo.Fn(i).next(()=>s)}Xi(t){return Zo.resolve(this.targetCount)}Zi(t,e){const n=this.Kc.get(e)||null;return Zo.resolve(n)}tr(t,e,n){return this.Wc.vc(e,n),Zo.resolve()}nr(t,e,n){this.Wc.Dc(e,n);const s=this.persistence.Ei,i=[];return s&&e.forEach(e=>{i.push(s.Ni(t,e))}),Zo.Fn(i)}Ji(t,e){return this.Wc.Cc(e),Zo.resolve()}ir(t,e){const n=this.Wc.xc(e);return Zo.resolve(n)}Oi(t,e){return Zo.resolve(this.Wc.Oi(e))}}class su{constructor(t,e){this.Gc={},this.no=new qs(0),this.so=!1,this.so=!0,this.Ei=t(this),this.lo=new nu(this),this.wi=new Qa,this._o=function(t,e){return new tu(t,e)}(this.wi,t=>this.Ei.zc(t)),this.Ut=new Ma(e),this.fo=new Xh(this.Ut)}start(){return Promise.resolve()}Mo(){return this.so=!1,Promise.resolve()}get wr(){return this.so}Ro(){}Po(){}Ko(){return this.wi}Uo(t){let e=this.Gc[t.i()];return e||(e=new Zh(this.wi,this.Ei),this.Gc[t.i()]=e),e}vr(){return this.lo}Nr(){return this._o}Qo(){return this.fo}runTransaction(t,e,n){Ts("MemoryPersistence","Starting transaction:",t);const s=new iu(this.no.next());return this.Ei.Hc(),n(s).next(t=>this.Ei.Jc(s).next(()=>t)).kn().then(t=>(s.gs(),t))}Yc(t,e){return Zo.$n(Object.values(this.Gc).map(n=>()=>n.Oi(t,e)))}}class iu extends fa{constructor(t){super(),this.ps=t}}class ru{constructor(t){this.persistence=t,this.Xc=new Jh,this.Zc=null}static tu(t){return new ru(t)}get eu(){if(this.Zc)return this.Zc;throw Ss()}er(t,e,n){return this.Xc.er(n,e),this.eu.delete(n.toString()),Zo.resolve()}sr(t,e,n){return this.Xc.sr(n,e),this.eu.add(n.toString()),Zo.resolve()}Ni(t,e){return this.eu.add(e.toString()),Zo.resolve()}removeTarget(t,e){this.Xc.Cc(e.targetId).forEach(t=>this.eu.add(t.toString()));const n=this.persistence.vr();return n.ir(t,e.targetId).next(t=>{t.forEach(t=>this.eu.add(t.toString()))}).next(()=>n.Hi(t,e))}Hc(){this.Zc=new Set}Jc(t){const e=this.persistence.Nr().Cr();return Zo.forEach(this.eu,n=>{const s=Js.ut(n);return this.nu(t,s).next(t=>{t||e.hi(s)})}).next(()=>(this.Zc=null,e.apply(t)))}Or(t,e){return this.nu(t,e).next(t=>{t?this.eu.delete(e.toString()):this.eu.add(e.toString())})}zc(t){return 0}nu(t,e){return Zo.$n([()=>Zo.resolve(this.Xc.Oi(e)),()=>this.persistence.vr().Oi(t,e),()=>this.persistence.Yc(t,e)])}}function ou(t,e){return`firestore_clients_${t}_${e}`}function au(t,e,n){let s=`firestore_mutations_${t}_${n}`;return e.t()&&(s+="_"+e.uid),s}function hu(t,e){return`firestore_targets_${t}_${e}`}class uu{constructor(t,e,n,s){this.user=t,this.batchId=e,this.state=n,this.error=s}static su(t,e,n){const s=JSON.parse(n);let i="object"==typeof s&&-1!==["pending","acknowledged","rejected"].indexOf(s.state)&&(void 0===s.error||"object"==typeof s.error),r=void 0;return i&&s.error&&((i="string"==typeof s.error.message&&"string"==typeof s.error.code)&&(r=new Rs(s.error.code,s.error.message))),i?new uu(t,e,s.state,r):(_s("SharedClientState",`Failed to parse mutation state for ID '${e}': ${n}`),null)}iu(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class cu{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static su(t,e){const n=JSON.parse(e);let s="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return s&&n.error&&((s="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new Rs(n.error.code,n.error.message))),s?new cu(t,n.state,i):(_s("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}iu(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class lu{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static su(t,e){const n=JSON.parse(e);let s="object"==typeof n&&n.activeTargetIds instanceof Array,i=po();for(let t=0;s&&t<n.activeTargetIds.length;++t)s=li(n.activeTargetIds[t]),i=i.add(n.activeTargetIds[t]);return s?new lu(t,i):(_s("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}}class fu{constructor(t,e){this.clientId=t,this.onlineState=e}static su(t){const e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new fu(e.clientId,e.onlineState):(_s("SharedClientState","Failed to parse online state: "+t),null)}}class du{constructor(){this.activeTargetIds=po()}ru(t){this.activeTargetIds=this.activeTargetIds.add(t)}ou(t){this.activeTargetIds=this.activeTargetIds.delete(t)}iu(){const t={activeTargetIds:this.activeTargetIds.tt(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class pu{constructor(t,e,n,s,i){this.window=t,this.Xr=e,this.persistenceKey=n,this.cu=s,this.uu=null,this.au=null,this.D=null,this.hu=this.lu.bind(this),this._u=new Zr(Gs),this.wr=!1,this.fu=[];const r=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.du=ou(this.persistenceKey,this.cu),this.wu=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this._u=this._u.Gt(this.cu,new du),this.Eu=new RegExp(`^firestore_clients_${r}_([^_]*)$`),this.Tu=new RegExp(`^firestore_mutations_${r}_(\\d+)(?:_(.*))?$`),this.Iu=new RegExp(`^firestore_targets_${r}_(\\d+)$`),this.mu=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Au=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.hu)}static Kn(t){return!(!t||!t.localStorage)}async start(){const t=await this.uu.qo();for(const e of t){if(e===this.cu)continue;const t=this.getItem(ou(this.persistenceKey,e));if(t){const n=lu.su(e,t);n&&(this._u=this._u.Gt(n.clientId,n))}}this.Ru();const e=this.storage.getItem(this.mu);if(e){const t=this.Pu(e);t&&this.Vu(t)}for(const t of this.fu)this.lu(t);this.fu=[],this.window.addEventListener("unload",()=>this.Mo()),this.wr=!0}O(t){this.setItem(this.wu,JSON.stringify(t))}gu(){return this.yu(this._u)}pu(t){let e=!1;return this._u.forEach((n,s)=>{s.activeTargetIds.has(t)&&(e=!0)}),e}bu(t){this.vu(t,"pending")}Su(t,e,n){this.vu(t,e,n),this.Du(t)}Cu(t){let e="not-current";if(this.pu(t)){const n=this.storage.getItem(hu(this.persistenceKey,t));if(n){const s=cu.su(t,n);s&&(e=s.state)}}return this.Nu.ru(t),this.Ru(),e}xu(t){this.Nu.ou(t),this.Ru()}Ou(t){return this.Nu.activeTargetIds.has(t)}ku(t){this.removeItem(hu(this.persistenceKey,t))}Mu(t,e,n){this.Fu(t,e,n)}$u(t,e,n){e.forEach(t=>{this.Du(t)}),this.currentUser=t,n.forEach(t=>{this.bu(t)})}Lu(t){this.Bu(t)}qu(){this.Uu()}Mo(){this.wr&&(this.window.removeEventListener("storage",this.hu),this.removeItem(this.du),this.wr=!1)}getItem(t){const e=this.storage.getItem(t);return Ts("SharedClientState","READ",t,e),e}setItem(t,e){Ts("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){Ts("SharedClientState","REMOVE",t),this.storage.removeItem(t)}lu(t){const e=t;if(e.storageArea===this.storage){if(Ts("SharedClientState","EVENT",e.key,e.newValue),e.key===this.du)return void _s("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Xr.yo(async()=>{if(this.wr){if(null!==e.key)if(this.Eu.test(e.key)){if(null==e.newValue){const t=this.Ku(e.key);return this.Qu(t,null)}{const t=this.Wu(e.key,e.newValue);if(t)return this.Qu(t.clientId,t)}}else if(this.Tu.test(e.key)){if(null!==e.newValue){const t=this.ju(e.key,e.newValue);if(t)return this.Gu(t)}}else if(this.Iu.test(e.key)){if(null!==e.newValue){const t=this.zu(e.key,e.newValue);if(t)return this.Hu(t)}}else if(e.key===this.mu){if(null!==e.newValue){const t=this.Pu(e.newValue);if(t)return this.Vu(t)}}else if(e.key===this.wu){const t=function(t){let e=qs.k;if(null!=t)try{const n=JSON.parse(t);xs("number"==typeof n),e=n}catch(t){_s("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(e.newValue);t!==qs.k&&this.D(t)}else if(e.key===this.Au)return this.uu.Ju()}else this.fu.push(e)})}}get Nu(){return this._u.get(this.cu)}Ru(){this.setItem(this.du,this.Nu.iu())}vu(t,e,n){const s=new uu(this.currentUser,t,e,n),i=au(this.persistenceKey,this.currentUser,t);this.setItem(i,s.iu())}Du(t){const e=au(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Bu(t){const e={clientId:this.cu,onlineState:t};this.storage.setItem(this.mu,JSON.stringify(e))}Fu(t,e,n){const s=hu(this.persistenceKey,t),i=new cu(t,e,n);this.setItem(s,i.iu())}Uu(){this.setItem(this.Au,"value-not-used")}Ku(t){const e=this.Eu.exec(t);return e?e[1]:null}Wu(t,e){const n=this.Ku(t);return lu.su(n,e)}ju(t,e){const n=this.Tu.exec(t),s=Number(n[1]),i=void 0!==n[2]?n[2]:null;return uu.su(new bs(i),s,e)}zu(t,e){const n=this.Iu.exec(t),s=Number(n[1]);return cu.su(s,e)}Pu(t){return fu.su(t)}async Gu(t){if(t.user.uid===this.currentUser.uid)return this.uu.Yu(t.batchId,t.state,t.error);Ts("SharedClientState","Ignoring mutation for non-active user "+t.user.uid)}Hu(t){return this.uu.Xu(t.targetId,t.state,t.error)}Qu(t,e){const n=e?this._u.Gt(t,e):this._u.remove(t),s=this.yu(this._u),i=this.yu(n),r=[],o=[];return i.forEach(t=>{s.has(t)||r.push(t)}),s.forEach(t=>{i.has(t)||o.push(t)}),this.uu.Zu(r,o).then(()=>{this._u=n})}Vu(t){this._u.get(t.clientId)&&this.au(t.onlineState)}yu(t){let e=po();return t.forEach((t,n)=>{e=e.Re(n.activeTargetIds)}),e}}class gu{constructor(){this.ta=new du,this.ea={},this.au=null,this.D=null}bu(t){}Su(t,e,n){}Cu(t){return this.ta.ru(t),this.ea[t]||"not-current"}Mu(t,e,n){this.ea[t]=e}xu(t){this.ta.ou(t)}Ou(t){return this.ta.activeTargetIds.has(t)}ku(t){delete this.ea[t]}gu(){return this.ta.activeTargetIds}pu(t){return this.ta.activeTargetIds.has(t)}start(){return this.ta=new du,Promise.resolve()}$u(t,e,n){}Lu(t){}Mo(){}O(t){}qu(){}}class mu{na(t){}Mo(){}}class yu{constructor(){this.sa=(()=>this.ia()),this.ra=(()=>this.oa()),this.ca=[],this.ua()}na(t){this.ca.push(t)}Mo(){window.removeEventListener("online",this.sa),window.removeEventListener("offline",this.ra)}ua(){window.addEventListener("online",this.sa),window.addEventListener("offline",this.ra)}ia(){Ts("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.ca)t(0)}oa(){Ts("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.ca)t(1)}static Kn(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const wu={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class vu{constructor(t){this.aa=t.aa,this.ha=t.ha}la(t){this._a=t}fa(t){this.da=t}onMessage(t){this.wa=t}close(){this.ha()}send(t){this.aa(t)}Ea(){this._a()}Ta(t){this.da(t)}Ia(t){this.wa(t)}}class bu extends class{constructor(t){this.ma=t,this.p=t.p;const e=t.ssl?"https":"http";this.Aa=e+"://"+t.host,this.Ra="projects/"+this.p.projectId+"/databases/"+this.p.database+"/documents"}Pa(t,e,n,s){const i=this.Va(t,e);Ts("RestConnection","Sending: ",i,n);const r={};return this.ga(r,s),this.ya(t,i,r,n).then(t=>(Ts("RestConnection","Received: ",t),t),e=>{throw Ns("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e})}pa(t,e,n,s){return this.Pa(t,e,n,s)}ga(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.2.3",t["Content-Type"]="text/plain",e)for(const n in e.h)e.h.hasOwnProperty(n)&&(t[n]=e.h[n])}Va(t,e){const n=wu[t];return`${this.Aa}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.v=t.v}ya(t,e,n,s){return new Promise((i,r)=>{const o=new vs;o.listenOnce(gs.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case ps.NO_ERROR:const e=o.getResponseJson();Ts("Connection","XHR received:",JSON.stringify(e)),i(e);break;case ps.TIMEOUT:Ts("Connection",'RPC "'+t+'" timed out'),r(new Rs(ks.DEADLINE_EXCEEDED,"Request time out"));break;case ps.HTTP_ERROR:const n=o.getStatus();if(Ts("Connection",'RPC "'+t+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const t=o.getResponseJson().error;if(t&&t.status&&t.message){const e=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(ks).indexOf(e)>=0?e:ks.UNKNOWN}(t.status);r(new Rs(e,t.message))}else r(new Rs(ks.UNKNOWN,"Server responded with status "+o.getStatus()))}else r(new Rs(ks.UNAVAILABLE,"Connection failed."));break;default:Ss()}}finally{Ts("Connection",'RPC "'+t+'" completed.')}});const a=JSON.stringify(s);o.send(e,"POST",a,n,15)})}ba(t,e){const n=[this.Aa,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=fs(),r=ds(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.p.projectId}/databases/${this.p.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.v};var a,h;this.ga(o.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(s())||"object"==typeof navigator&&"ReactNative"===navigator.product||s().indexOf("Electron/")>=0||((h=s()).indexOf("MSIE ")>=0||h.indexOf("Trident/")>=0)||s().indexOf("MSAppHost/")>=0||"object"==typeof(a="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==a.id||(o.httpHeadersOverwriteParam="$httpHeaders");const u=n.join("");Ts("Connection","Creating WebChannel: "+u,o);const c=i.createWebChannel(u,o);let l=!1,f=!1;const d=new vu({aa:t=>{f?Ts("Connection","Not sending because WebChannel is closed:",t):(l||(Ts("Connection","Opening WebChannel transport."),c.open(),l=!0),Ts("Connection","WebChannel sending:",t),c.send(t))},ha:()=>c.close()}),p=(t,e,n)=>{t.listen(e,t=>{try{n(t)}catch(t){setTimeout(()=>{throw t},0)}})};return p(c,ws.EventType.OPEN,()=>{f||Ts("Connection","WebChannel transport opened.")}),p(c,ws.EventType.CLOSE,()=>{f||(f=!0,Ts("Connection","WebChannel transport closed"),d.Ta())}),p(c,ws.EventType.ERROR,t=>{f||(f=!0,Ns("Connection","WebChannel transport errored:",t),d.Ta(new Rs(ks.UNAVAILABLE,"The operation could not be completed")))}),p(c,ws.EventType.MESSAGE,t=>{var e;if(!f){const n=t.data[0];xs(!!n);const s=n,i=s.error||(null===(e=s[0])||void 0===e?void 0:e.error);if(i){Ts("Connection","WebChannel received error:",i);const t=i.status;let e=function(t){const e=Yr[t];if(void 0!==e)return Qr(e)}(t),n=i.message;void 0===e&&(e=ks.INTERNAL,n="Unknown error status: "+t+" with message "+i.message),f=!0,d.Ta(new Rs(e,n)),c.close()}else Ts("Connection","WebChannel received:",n),d.Ia(n)}}),p(r,ms.STAT_EVENT,t=>{t.stat===ys.PROXY?Ts("Connection","Detected buffering proxy"):t.stat===ys.NOPROXY&&Ts("Connection","Detected no buffering proxy")}),setTimeout(()=>{d.Ea()},0),d}}function Eu(){return"undefined"!=typeof window?window:null}function Iu(){return"undefined"!=typeof document?document:null}function Tu(t){return new Do(t,!0)}class _u{constructor(t,e,n=1e3,s=1.5,i=6e4){this.Xr=t,this._s=e,this.va=n,this.Sa=s,this.Da=i,this.Ca=0,this.Na=null,this.xa=Date.now(),this.reset()}reset(){this.Ca=0}Oa(){this.Ca=this.Da}ka(t){this.cancel();const e=Math.floor(this.Ca+this.Ma()),n=Math.max(0,Date.now()-this.xa),s=Math.max(0,e-n);s>0&&Ts("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ca} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Na=this.Xr.Er(this._s,s,()=>(this.xa=Date.now(),t())),this.Ca*=this.Sa,this.Ca<this.va&&(this.Ca=this.va),this.Ca>this.Da&&(this.Ca=this.Da)}Fa(){null!==this.Na&&(this.Na.As(),this.Na=null)}cancel(){null!==this.Na&&(this.Na.cancel(),this.Na=null)}Ma(){return(Math.random()-.5)*this.Ca}}class Nu{constructor(t,e,n,s,i,r){this.Xr=t,this.$a=n,this.La=s,this.Ba=i,this.listener=r,this.state=0,this.qa=0,this.Ua=null,this.stream=null,this.Ka=new _u(t,e)}Qa(){return 1===this.state||2===this.state||4===this.state}Wa(){return 2===this.state}start(){3!==this.state?this.auth():this.ja()}async stop(){this.Qa()&&await this.close(0)}Ga(){this.state=0,this.Ka.reset()}za(){this.Wa()&&null===this.Ua&&(this.Ua=this.Xr.Er(this.$a,6e4,()=>this.Ha()))}Ja(t){this.Ya(),this.stream.send(t)}async Ha(){if(this.Wa())return this.close(0)}Ya(){this.Ua&&(this.Ua.cancel(),this.Ua=null)}async close(t,e){this.Ya(),this.Ka.cancel(),this.qa++,3!==t?this.Ka.reset():e&&e.code===ks.RESOURCE_EXHAUSTED?(_s(e.toString()),_s("Using maximum backoff delay to prevent overloading the backend."),this.Ka.Oa()):e&&e.code===ks.UNAUTHENTICATED&&this.Ba._(),null!==this.stream&&(this.Xa(),this.stream.close(),this.stream=null),this.state=t,await this.listener.fa(e)}Xa(){}auth(){this.state=1;const t=this.Za(this.qa),e=this.qa;this.Ba.getToken().then(t=>{this.qa===e&&this.th(t)},e=>{t(()=>{const t=new Rs(ks.UNKNOWN,"Fetching auth token failed: "+e.message);return this.eh(t)})})}th(t){const e=this.Za(this.qa);this.stream=this.nh(t),this.stream.la(()=>{e(()=>(this.state=2,this.listener.la()))}),this.stream.fa(t=>{e(()=>this.eh(t))}),this.stream.onMessage(t=>{e(()=>this.onMessage(t))})}ja(){this.state=4,this.Ka.ka(async()=>{this.state=0,this.start()})}eh(t){return Ts("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)}Za(t){return e=>{this.Xr.Rs(()=>this.qa===t?e():(Ts("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Au extends Nu{constructor(t,e,n,s,i){super(t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i),this.Ut=s}nh(t){return this.La.ba("Listen",t)}onMessage(t){this.Ka.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const s=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Ss()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],r=function(t,e){return t.Lt?(xs(void 0===e||"string"==typeof e),ni.fromBase64String(e||"")):(xs(void 0===e||e instanceof Uint8Array),ni.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?ks.UNKNOWN:Qr(t.code);return new Rs(e,t.message||"")}(o);n=new Io(s,i,r,a||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const i=Uo(t,s.document.name),r=Lo(s.document.updateTime),o=new _i({mapValue:{fields:s.document.fields}}),a=new xi(i,r,o,{}),h=s.targetIds||[],u=s.removedTargetIds||[];n=new bo(h,u,a.key,a)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const i=Uo(t,s.document),r=s.readTime?Lo(s.readTime):zs.min(),o=new Di(i,r),a=s.removedTargetIds||[];n=new bo([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const i=Uo(t,s.document),r=s.removedTargetIds||[];n=new bo([],r,i,null)}else{if(!("filter"in e))return Ss();{e.filter;const t=e.filter;t.targetId;const s=t.count||0,i=new Wr(s),r=t.targetId;n=new Eo(r,i)}}return n}(this.Ut,t),n=function(t){if(!("targetChange"in t))return zs.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?zs.min():e.readTime?Lo(e.readTime):zs.min()}(t);return this.listener.sh(e,n)}ih(t){const e={};e.database=qo(this.Ut),e.addTarget=function(t,e){let n;const s=e.target;return(n=Vi(s)?{documents:Ko(t,s)}:{query:$o(t,s)}).targetId=e.targetId,e.resumeToken.wt()>0?n.resumeToken=Ro(t,e.resumeToken):e.kt.L(zs.min())>0&&(n.readTime=ko(t,e.kt.q())),n}(this.Ut,t);const n=function(t,e){const n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Ss()}}(0,e.Ot);return null==n?null:{"goog-listen-tags":n}}(this.Ut,t);n&&(e.labels=n),this.Ja(e)}rh(t){const e={};e.database=qo(this.Ut),e.removeTarget=t,this.Ja(e)}}class Su extends Nu{constructor(t,e,n,s,i){super(t,"write_stream_connection_backoff","write_stream_idle",e,n,i),this.Ut=s,this.oh=!1}get uh(){return this.oh}start(){this.oh=!1,this.lastStreamToken=void 0,super.start()}Xa(){this.oh&&this.ah([])}nh(t){return this.La.ba("Write",t)}onMessage(t){if(xs(!!t.streamToken),this.lastStreamToken=t.streamToken,this.oh){this.Ka.reset();const e=function(t,e){return t&&t.length>0?(xs(void 0!==e),t.map(t=>(function(t,e){let n=t.updateTime?Lo(t.updateTime):Lo(e);n.isEqual(zs.min())&&(n=Lo(e));let s=null;return t.transformResults&&t.transformResults.length>0&&(s=t.transformResults),new Rr(n,s)})(t,e))):[]}(t.writeResults,t.commitTime),n=Lo(t.commitTime);return this.listener.hh(n,e)}return xs(!t.writeResults||0===t.writeResults.length),this.oh=!0,this.listener.lh()}_h(){const t={};t.database=qo(this.Ut),this.Ja(t)}ah(t){const e={streamToken:this.lastStreamToken,writes:t.map(t=>Go(this.Ut,t))};this.Ja(e)}}class xu extends class{}{constructor(t,e,n){super(),this.credentials=t,this.La=e,this.Ut=n,this.fh=!1}dh(){if(this.fh)throw new Rs(ks.FAILED_PRECONDITION,"The client has already been terminated.")}Pa(t,e,n){return this.dh(),this.credentials.getToken().then(s=>this.La.Pa(t,e,n,s)).catch(t=>{throw t.code===ks.UNAUTHENTICATED&&this.credentials._(),t})}pa(t,e,n){return this.dh(),this.credentials.getToken().then(s=>this.La.pa(t,e,n,s)).catch(t=>{throw t.code===ks.UNAUTHENTICATED&&this.credentials._(),t})}terminate(){this.fh=!1}}class Du{constructor(t,e){this.ls=t,this.au=e,this.state="Unknown",this.wh=0,this.Eh=null,this.Th=!0}Ih(){0===this.wh&&(this.mh("Unknown"),this.Eh=this.ls.Er("online_state_timeout",1e4,()=>(this.Eh=null,this.Ah("Backend didn't respond within 10 seconds."),this.mh("Offline"),Promise.resolve())))}Rh(t){"Online"===this.state?this.mh("Unknown"):(this.wh++,this.wh>=1&&(this.Ph(),this.Ah("Connection failed 1 times. Most recent error: "+t.toString()),this.mh("Offline")))}set(t){this.Ph(),this.wh=0,"Online"===t&&(this.Th=!1),this.mh(t)}mh(t){t!==this.state&&(this.state=t,this.au(t))}Ah(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Th?(_s(e),this.Th=!1):Ts("OnlineStateTracker",e)}Ph(){null!==this.Eh&&(this.Eh.cancel(),this.Eh=null)}}class ku{constructor(t,e,n,s,i){this.Vh=t,this.gh=e,this.ls=n,this.yh={},this.ph=[],this.bh=new Map,this.Sh=new Set,this.Dh=[],this.Ch=i,this.Ch.na(t=>{n.Rs(async()=>{qu(this)&&(Ts("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=Ds(t);e.Sh.add(4),await Lu(e),e.Nh.set("Unknown"),e.Sh.delete(4),await Ru(e)}(this))})}),this.Nh=new Du(n,s)}}async function Ru(t){if(qu(t))for(const e of t.Dh)await e(!0)}async function Lu(t){for(const e of t.Dh)await e(!1)}function Ou(t,e){const n=Ds(t);n.bh.has(e.targetId)||(n.bh.set(e.targetId,e),Mu(n)?Pu(n):Yu(n).Wa()&&Vu(n,e))}function Cu(t,e){const n=Ds(t),s=Yu(n);n.bh.delete(e),s.Wa()&&Uu(n,e),0===n.bh.size&&(s.Wa()?s.za():qu(n)&&n.Nh.set("Unknown"))}function Vu(t,e){t.xh.rn(e.targetId),Yu(t).ih(e)}function Uu(t,e){t.xh.rn(e),Yu(t).rh(e)}function Pu(t){t.xh=new _o({bn:e=>t.yh.bn(e),vn:e=>t.bh.get(e)||null}),Yu(t).start(),t.Nh.Ih()}function Mu(t){return qu(t)&&!Yu(t).Qa()&&t.bh.size>0}function qu(t){return 0===Ds(t).Sh.size}function Fu(t){t.xh=void 0}async function ju(t,e,n){if(!ia(e))throw e;t.Sh.add(1),await Lu(t),t.Nh.set("Offline"),n||(n=(()=>Bh(t.Vh))),t.ls.yo(async()=>{Ts("RemoteStore","Retrying IndexedDB access"),await n(),t.Sh.delete(1),await Ru(t)})}function Gu(t,e){return e().catch(n=>ju(t,n,e))}async function Bu(t){const e=Ds(t),n=Xu(e);let s=e.ph.length>0?e.ph[e.ph.length-1].batchId:-1;for(;Ku(e);)try{const i=await Kh(e.Vh,s);if(null===i){0===e.ph.length&&n.za();break}s=i.batchId,$u(e,i)}catch(t){await ju(e,t)}zu(e)&&Hu(e)}function Ku(t){return qu(t)&&t.ph.length<10}function $u(t,e){t.ph.push(e);const n=Xu(t);n.Wa()&&n.uh&&n.ah(e.mutations)}function zu(t){return qu(t)&&!Xu(t).Qa()&&t.ph.length>0}function Hu(t){Xu(t).start()}async function Wu(t,e){const n=Ds(t);e?(n.Sh.delete(2),await Ru(n)):e||(n.Sh.add(2),await Lu(n),n.Nh.set("Unknown"))}function Yu(t){return t.$h||(t.$h=function(t,e,n){const s=Ds(t);return s.dh(),new Au(e,s.La,s.credentials,s.Ut,n)}(t.gh,t.ls,{la:async function(t){t.bh.forEach((e,n)=>{Vu(t,e)})}.bind(null,t),fa:async function(t,e){Fu(t),Mu(t)?(t.Nh.Rh(e),Pu(t)):t.Nh.set("Unknown")}.bind(null,t),sh:async function(t,e,n){if(t.Nh.set("Online"),e instanceof Io&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const s of e.targetIds)t.bh.has(s)&&(await t.yh.Oh(s,n),t.bh.delete(s),t.xh.removeTarget(s))}(t,e)}catch(n){Ts("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await ju(t,n)}else if(e instanceof bo?t.xh.fn(e):e instanceof Eo?t.xh.Rn(e):t.xh.En(e),!n.isEqual(zs.min()))try{const s=await Bh(t.Vh);n.L(s)>=0&&await function(t,e){const n=t.xh.gn(e);return n.xe.forEach((n,s)=>{if(n.resumeToken.wt()>0){const i=t.bh.get(s);i&&t.bh.set(s,i.Ft(n.resumeToken,e))}}),n.Oe.forEach(e=>{const n=t.bh.get(e);if(!n)return;t.bh.set(e,n.Ft(ni.Et,n.kt)),Uu(t,e);const s=new pr(n.target,e,1,n.sequenceNumber);Vu(t,s)}),t.yh.kh(n)}(t,n)}catch(e){Ts("RemoteStore","Failed to raise snapshot:",e),await ju(t,e)}}.bind(null,t)}),t.Dh.push(async e=>{e?(t.$h.Ga(),Mu(t)?Pu(t):t.Nh.set("Unknown")):(await t.$h.stop(),Fu(t))})),t.$h}function Xu(t){return t.Lh||(t.Lh=function(t,e,n){const s=Ds(t);return s.dh(),new Su(e,s.La,s.credentials,s.Ut,n)}(t.gh,t.ls,{la:async function(t){Xu(t)._h()}.bind(null,t),fa:async function(t,e){e&&Xu(t).uh&&await async function(t,e){if(Jr(n=e.code)&&n!==ks.ABORTED){const n=t.ph.shift();Xu(t).Ga(),await Gu(t,()=>t.yh.Fh(n.batchId,e)),await Bu(t)}var n}(t,e),zu(t)&&Hu(t)}.bind(null,t),lh:async function(t){const e=Xu(t);for(const n of t.ph)e.ah(n.mutations)}.bind(null,t),hh:async function(t,e,n){const s=t.ph.shift(),i=Pa.from(s,e,n);await Gu(t,()=>t.yh.Mh(i)),await Bu(t)}.bind(null,t)}),t.Dh.push(async e=>{e?(t.Lh.Ga(),await Bu(t)):(await t.Lh.stop(),t.ph.length>0&&(Ts("RemoteStore",`Stopping write stream with ${t.ph.length} pending writes`),t.ph=[]))})),t.Lh}class Ju{constructor(){this.Bh=void 0,this.listeners=[]}}class Qu{constructor(){this.queries=new rh(t=>ur(t),hr),this.onlineState="Unknown",this.qh=new Set}}async function Zu(t,e){const n=Ds(t),s=e.query;let i=!1,r=n.queries.get(s);if(r||(i=!0,r=new Ju),i)try{r.Bh=await n.Uh(s)}catch(t){const n=ca(t,`Initialization of query '${cr(e.query)}' failed`);return void e.onError(n)}n.queries.set(s,r),r.listeners.push(e),e.Kh(n.onlineState),r.Bh&&e.Qh(r.Bh)&&ec(n)}async function tc(t,e){const n=Ds(t),s=e.query;let i=!1;const r=n.queries.get(s);if(r){const t=r.listeners.indexOf(e);t>=0&&(r.listeners.splice(t,1),i=0===r.listeners.length)}if(i)return n.queries.delete(s),n.Wh(s)}function ec(t){t.qh.forEach(t=>{t.next()})}class nc{constructor(t,e,n){this.query=t,this.jh=e,this.Gh=!1,this.zh=null,this.onlineState="Unknown",this.options=n||{}}Qh(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new yo(t.query,t.docs,t.ve,e,t.Se,t.fromCache,t.De,!0)}let e=!1;return this.Gh?this.Hh(t)&&(this.jh.next(t),e=!0):this.Jh(t,this.onlineState)&&(this.Yh(t),e=!0),this.zh=t,e}onError(t){this.jh.error(t)}Kh(t){this.onlineState=t;let e=!1;return this.zh&&!this.Gh&&this.Jh(this.zh,t)&&(this.Yh(this.zh),e=!0),e}Jh(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return!(this.options.Xh&&n||t.docs.Y()&&"Offline"!==e)}Hh(t){if(t.docChanges.length>0)return!0;const e=this.zh&&this.zh.hasPendingWrites!==t.hasPendingWrites;return!(!t.De&&!e)&&!0===this.options.includeMetadataChanges}Yh(t){t=yo.Ne(t.query,t.docs,t.Se,t.fromCache),this.Gh=!0,this.jh.next(t)}}class sc{constructor(t){this.key=t}}class ic{constructor(t){this.key=t}}class rc{constructor(t,e){this.query=t,this.Zh=e,this.tl=null,this.Le=!1,this.el=lo(),this.Se=lo(),this.nl=fr(t),this.sl=new go(this.nl)}get il(){return this.Zh}rl(t,e){const n=e?e.ol:new mo,s=e?e.sl:this.sl;let i=e?e.Se:this.Se,r=s,o=!1;const a=tr(this.query)&&s.size===this.query.limit?s.last():null,h=er(this.query)&&s.size===this.query.limit?s.first():null;if(t.Yt((t,e)=>{const u=s.get(t);let c=e instanceof xi?e:null;c&&(c=lr(this.query,c)?c:null);const l=!!u&&this.Se.has(u.key),f=!!c&&(c.gt||this.Se.has(c.key)&&c.hasCommittedMutations);let d=!1;u&&c?u.data().isEqual(c.data())?l!==f&&(n.track({type:3,doc:c}),d=!0):this.cl(u,c)||(n.track({type:2,doc:c}),d=!0,(a&&this.nl(c,a)>0||h&&this.nl(c,h)<0)&&(o=!0)):!u&&c?(n.track({type:0,doc:c}),d=!0):u&&!c&&(n.track({type:1,doc:u}),d=!0,(a||h)&&(o=!0)),d&&(c?(r=r.add(c),i=f?i.add(t):i.delete(t)):(r=r.delete(t),i=i.delete(t)))}),tr(this.query)||er(this.query))for(;r.size>this.query.limit;){const t=tr(this.query)?r.last():r.first();r=r.delete(t.key),i=i.delete(t.key),n.track({type:1,doc:t})}return{sl:r,ol:n,ac:o,Se:i}}cl(t,e){return t.gt&&e.hasCommittedMutations&&!e.gt}di(t,e,n){const s=this.sl;this.sl=t.sl,this.Se=t.Se;const i=t.ol.be();i.sort((t,e)=>(function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ss()}};return n(t)-n(e)})(t.type,e.type)||this.nl(t.doc,e.doc)),this.ul(n);const r=e?this.al():[],o=0===this.el.size&&this.Le?1:0,a=o!==this.tl;return this.tl=o,0!==i.length||a?{snapshot:new yo(this.query,t.sl,s,i,t.Se,0===o,a,!1),hl:r}:{hl:r}}Kh(t){return this.Le&&"Offline"===t?(this.Le=!1,this.di({sl:this.sl,ol:new mo,Se:this.Se,ac:!1},!1)):{hl:[]}}ll(t){return!this.Zh.has(t)&&!!this.sl.has(t)&&!this.sl.get(t).gt}ul(t){t&&(t.Be.forEach(t=>this.Zh=this.Zh.add(t)),t.qe.forEach(t=>{}),t.Ue.forEach(t=>this.Zh=this.Zh.delete(t)),this.Le=t.Le)}al(){if(!this.Le)return[];const t=this.el;this.el=lo(),this.sl.forEach(t=>{this.ll(t.key)&&(this.el=this.el.add(t.key))});const e=[];return t.forEach(t=>{this.el.has(t)||e.push(new ic(t))}),this.el.forEach(n=>{t.has(n)||e.push(new sc(n))}),e}_l(t){this.Zh=t.mc,this.el=lo();const e=this.rl(t.documents);return this.di(e,!0)}fl(){return yo.Ne(this.query,this.sl,this.Se,0===this.tl)}}class oc{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class ac{constructor(t){this.key=t,this.dl=!1}}class hc{constructor(t,e,n,s,i,r){this.Vh=t,this.wl=e,this.El=n,this.Tl=s,this.currentUser=i,this.Il=r,this.ml={},this.Al=new rh(t=>ur(t),hr),this.Rl=new Map,this.Pl=[],this.Vl=new Zr(Js.K),this.gl=new Map,this.yl=new Jh,this.pl={},this.bl=new Map,this.vl=ph.$i(),this.onlineState="Unknown",this.Sl=void 0}get Dl(){return!0===this.Sl}}async function uc(t,e,n,s){t.Cl=((e,n,s)=>(async function(t,e,n,s){let i=e.view.rl(n);i.ac&&(i=await Hh(t.Vh,e.query,!1).then(({documents:t})=>e.view.rl(t,i)));const r=s&&s.xe.get(e.targetId),o=e.view.di(i,t.Dl,r);return yc(t,e.targetId,o.hl),o.snapshot})(t,e,n,s));const i=await Hh(t.Vh,e,!0),r=new rc(e,i.mc),o=r.rl(i.documents),a=vo.$e(n,s&&"Offline"!==t.onlineState),h=r.di(o,t.Dl,a);yc(t,n,h.hl);const u=new oc(e,n,r);return t.Al.set(e,u),t.Rl.has(n)?t.Rl.get(n).push(e):t.Rl.set(n,[e]),h.snapshot}async function cc(t,e){const n=Ds(t);try{const s=await function(t,e){const n=Ds(t),s=e.kt;let i=n.lc;return n.persistence.runTransaction("Apply remote event","readwrite-primary",t=>{const r=n.dc.Cr({Qr:!0});i=n.lc;const o=[];e.xe.forEach((e,r)=>{const a=i.get(r);if(!a)return;o.push(n.lo.nr(t,e.Ue,r).next(()=>n.lo.tr(t,e.Be,r)));const h=e.resumeToken;if(h.wt()>0){const u=a.Ft(h,s).Mt(t.ps);i=i.Gt(r,u),function(t,e,n){return xs(e.resumeToken.wt()>0),0===t.resumeToken.wt()||e.kt.B()-t.kt.B()>=3e8||n.Be.size+n.qe.size+n.Ue.size>0}(a,u,e)&&o.push(n.lo.zi(t,u))}});let a=ro();if(e.ke.forEach((s,i)=>{e.Me.has(s)&&o.push(n.persistence.Ei.Or(t,s))}),o.push(function(t,e,n,s,i){let r=lo();return n.forEach(t=>r=r.add(t)),e.getEntries(t,r).next(t=>{let i=ro();return n.forEach((n,r)=>{const o=t.get(n),a=s;r instanceof Di&&r.version.isEqual(zs.min())?(e.hi(n,a),i=i.Gt(n,r)):null==o||r.version.L(o.version)>0||0===r.version.L(o.version)&&o.hasPendingWrites?(e.ci(r,a),i=i.Gt(n,r)):Ts("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",r.version)}),i})}(t,r,e.ke,s).next(t=>{a=t})),!s.isEqual(zs.min())){const e=n.lo.Ui(t).next(e=>n.lo.Qi(t,t.ps,s));o.push(e)}return Zo.Fn(o).next(()=>r.apply(t)).next(()=>n.wc.Yo(t,a))}).then(t=>(n.lc=i,t))}(n.Vh,e);e.xe.forEach((t,e)=>{const s=n.gl.get(e);s&&(xs(t.Be.size+t.qe.size+t.Ue.size<=1),t.Be.size>0?s.dl=!0:t.qe.size>0?xs(s.dl):t.Ue.size>0&&(xs(s.dl),s.dl=!1))}),await bc(n,s,e)}catch(t){await ih(t)}}function lc(t,e,n){const s=Ds(t);if(s.Dl&&0===n||!s.Dl&&1===n){const t=[];s.Al.forEach((n,s)=>{const i=s.view.Kh(e);i.snapshot&&t.push(i.snapshot)}),function(t,e){const n=Ds(t);n.onlineState=e;let s=!1;n.queries.forEach((t,n)=>{for(const t of n.listeners)t.Kh(e)&&(s=!0)}),s&&ec(n)}(s.El,e),t.length&&s.ml.sh(t),s.onlineState=e,s.Dl&&s.Tl.Lu(e)}}async function fc(t,e){const n=Ds(t),s=e.batch.batchId;try{const i=await function(t,e){const n=Ds(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",t=>{const s=e.batch.keys(),i=n.dc.Cr({Qr:!0});return function(t,e,n,s){const i=n.batch,r=i.keys();let o=Zo.resolve();return r.forEach(t=>{o=o.next(()=>s.li(e,t)).next(e=>{let r=e;const o=n.xs.get(t);xs(null!==o),(!r||r.version.L(o)<0)&&(r=i.vs(t,r,n))&&s.ci(r,n.Ns)})}),o.next(()=>t.jo.Di(e,i))}(n,t,e,i).next(()=>i.apply(t)).next(()=>n.jo.xi(t)).next(()=>n.wc.Jo(t,s))})}(n.Vh,e);pc(n,s,null),dc(n,s),n.Tl.Su(s,"acknowledged"),await bc(n,i)}catch(t){await ih(t)}}function dc(t,e){(t.bl.get(e)||[]).forEach(t=>{t.resolve()}),t.bl.delete(e)}function pc(t,e,n){const s=Ds(t);let i=s.pl[s.currentUser.i()];if(i){const t=i.get(e);t&&(n?t.reject(n):t.resolve(),i=i.remove(e)),s.pl[s.currentUser.i()]=i}}function gc(t,e,n=null){t.Tl.xu(e);for(const s of t.Rl.get(e))t.Al.delete(s),n&&t.ml.Nl(s,n);t.Rl.delete(e),t.Dl&&t.yl.Cc(e).forEach(e=>{t.yl.Oi(e)||mc(t,e)})}function mc(t,e){const n=t.Vl.get(e);null!==n&&(Cu(t.wl,n),t.Vl=t.Vl.remove(e),t.gl.delete(n),vc(t))}function yc(t,e,n){for(const s of n)s instanceof sc?(t.yl.er(s.key,e),wc(t,s)):s instanceof ic?(Ts("SyncEngine","Document no longer in limbo: "+s.key),t.yl.sr(s.key,e),t.yl.Oi(s.key)||mc(t,s.key)):Ss()}function wc(t,e){const n=e.key;t.Vl.get(n)||(Ts("SyncEngine","New document in limbo: "+n),t.Pl.push(n),vc(t))}function vc(t){for(;t.Pl.length>0&&t.Vl.size<t.Il;){const e=t.Pl.shift(),n=t.vl.next();t.gl.set(n,new ac(e)),t.Vl=t.Vl.Gt(e,n),Ou(t.wl,new pr(or(Zi(e.path)),n,2,qs.k))}}async function bc(t,e,n){const s=Ds(t),i=[],r=[],o=[];s.Al.Y()||(s.Al.forEach((t,a)=>{o.push(s.Cl(a,e,n).then(t=>{if(t){s.Dl&&s.Tl.Mu(a.targetId,t.fromCache?"not-current":"current"),i.push(t);const e=Mh.ic(a.targetId,t);r.push(e)}}))}),await Promise.all(o),s.ml.sh(i),await async function(t,e){const n=Ds(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",t=>Zo.forEach(e,e=>Zo.forEach(e.nc,s=>n.persistence.Ei.er(t,e.targetId,s)).next(()=>Zo.forEach(e.sc,s=>n.persistence.Ei.sr(t,e.targetId,s)))))}catch(t){if(!ia(t))throw t;Ts("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.lc.get(e),s=t.kt,i=t.$t(s);n.lc=n.lc.Gt(e,i)}}}(s.Vh,r))}async function Ec(t,e){const n=Ds(t),s=await Hh(n.Vh,e.query,!0),i=e.view._l(s);return n.Dl&&yc(n,e.targetId,i.hl),i}async function Ic(t,e,n){const s=Ds(t),i=[],r=[];for(const t of e){let e;const n=s.Rl.get(t);if(n&&0!==n.length){e=await $h(s.Vh,or(n[0]));for(const t of n){const e=s.Al.get(t),n=await Ec(s,e);n.snapshot&&r.push(n.snapshot)}}else{const n=await Wh(s.Vh,t);e=await $h(s.Vh,n),await uc(s,Tc(n),t,!1)}i.push(e)}return s.ml.sh(r),i}function Tc(t){return Qi(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function _c(t){const e=Ds(t);return e.wl.yh.kh=cc.bind(null,e),e.wl.yh.bn=function(t,e){const n=Ds(t),s=n.gl.get(e);if(s&&s.dl)return lo().add(s.key);{let t=lo();const s=n.Rl.get(e);if(!s)return t;for(const e of s){const s=n.Al.get(e);t=t.Re(s.view.il)}return t}}.bind(null,e),e.wl.yh.Oh=async function(t,e,n){const s=Ds(t);s.Tl.Mu(e,"rejected",n);const i=s.gl.get(e),r=i&&i.key;if(r){let t=new Zr(Js.K);t=t.Gt(r,new Di(r,zs.min()));const n=lo().add(r),i=new wo(zs.min(),new Map,new no(Gs),t,n);await cc(s,i),s.Vl=s.Vl.remove(r),s.gl.delete(e),vc(s)}else await zh(s.Vh,e,!1).then(()=>gc(s,e,n)).catch(ih)}.bind(null,e),e.ml.sh=function(t,e){const n=Ds(t);let s=!1;for(const t of e){const e=t.query,i=n.queries.get(e);if(i){for(const e of i.listeners)e.Qh(t)&&(s=!0);i.Bh=t}}s&&ec(n)}.bind(null,e.El),e.ml.Nl=function(t,e,n){const s=Ds(t),i=s.queries.get(e);if(i)for(const t of i.listeners)t.onError(n);s.queries.delete(e)}.bind(null,e.El),e}function Nc(t){const e=Ds(t);return e.wl.yh.Mh=fc.bind(null,e),e.wl.yh.Fh=async function(t,e,n){const s=Ds(t);try{const t=await function(t,e){const n=Ds(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let s;return n.jo.Ri(t,e).next(e=>(xs(null!==e),s=e.keys(),n.jo.Di(t,e))).next(()=>n.jo.xi(t)).next(()=>n.wc.Jo(t,s))})}(s.Vh,e);pc(s,e,n),dc(s,e),s.Tl.Su(e,"rejected",n),await bc(s,t)}catch(n){await ih(n)}}.bind(null,e),e}class Ac{constructor(){this.synchronizeTabs=!1}async initialize(t){this.Ut=Tu(t.ma.p),this.Tl=this.xl(t),this.persistence=this.Ol(t),await this.persistence.start(),this.kl=this.Ml(t),this.Vh=this.Fl(t)}Ml(t){return null}Fl(t){return jh(this.persistence,new qh,t.$l,this.Ut)}Ol(t){return new su(ru.tu,this.Ut)}xl(t){return new gu}async terminate(){this.kl&&this.kl.stop(),await this.Tl.Mo(),await this.persistence.Mo()}}class Sc extends Ac{constructor(t,e,n){super(),this.Ll=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(t){await super.initialize(t),await async function(t){const e=Ds(t);return e.persistence.runTransaction("Synchronize last document change read time","readonly",t=>(function(t){const e=xh(t);let n=zs.min();return e.us({index:_a.readTimeIndex,reverse:!0},(t,e,s)=>{e.readTime&&(n=Ga(e.readTime)),s.done()}).next(()=>n)})(t)).then(t=>{e.fc=t})}(this.Vh),await this.Ll.initialize(this,t),await Nc(this.Ll.uu),await Bu(this.Ll.wl)}Fl(t){return jh(this.persistence,new qh,t.$l,this.Ut)}Ml(t){const e=this.persistence.Ei.hr;return new Eh(e,t.ls)}Ol(t){const e=Uh(t.ma.p,t.ma.persistenceKey),n=void 0!==this.cacheSizeBytes?sh.Js(this.cacheSizeBytes):sh.Zs;return new Oh(this.synchronizeTabs,e,t.clientId,n,t.ls,Eu(),Iu(),this.Ut,this.Tl,!!this.forceOwnership)}xl(t){return new gu}}class xc extends Sc{constructor(t,e){super(t,e,!1),this.Ll=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}async initialize(t){await super.initialize(t);const e=this.Ll.uu;this.Tl instanceof pu&&(this.Tl.uu={Yu:async function(t,e,n,s){const i=Ds(t),r=await function(t,e){const n=Ds(t),s=Ds(n.jo);return n.persistence.runTransaction("Lookup mutation documents","readonly",t=>s.Pi(t,e).next(e=>e?n.wc.Jo(t,e):Zo.resolve(null)))}(i.Vh,e);null!==r?("pending"===n?await Bu(i.wl):"acknowledged"===n||"rejected"===n?(pc(i,e,s||null),dc(i,e),function(t,e){Ds(Ds(t).jo).Ci(e)}(i.Vh,e)):Ss(),await bc(i,r)):Ts("SyncEngine","Cannot apply mutation batch with id: "+e)}.bind(null,e),Xu:async function(t,e,n,s){const i=Ds(t);if(i.Sl)Ts("SyncEngine","Ignoring unexpected query state notification.");else if(i.Rl.has(e))switch(n){case"current":case"not-current":{const t=await Yh(i.Vh),s=wo.Fe(e,"current"===n);await bc(i,t,s);break}case"rejected":await zh(i.Vh,e,!0),gc(i,e,s);break;default:Ss()}}.bind(null,e),Zu:async function(t,e,n){const s=_c(t);if(s.Sl){for(const t of e){if(s.Rl.has(t)){Ts("SyncEngine","Adding an already active target "+t);continue}const e=await Wh(s.Vh,t),n=await $h(s.Vh,e);await uc(s,Tc(e),n.targetId,!1),Ou(s.wl,n)}for(const t of n)s.Rl.has(t)&&await zh(s.Vh,t,!1).then(()=>{Cu(s.wl,t),gc(s,t)}).catch(ih)}}.bind(null,e),qo:function(t){return Ds(Ds(Ds(t).Vh).persistence).qo()}.bind(null,e),Ju:async function(t){const e=Ds(t);return Yh(e.Vh).then(t=>bc(e,t))}.bind(null,e)},await this.Tl.start()),await this.persistence.Ao(async t=>{await async function(t,e){const n=Ds(t);if(_c(n),Nc(n),!0===e&&!0!==n.Sl){const t=n.Tl.gu(),e=await Ic(n,t.tt());n.Sl=!0,await Wu(n.wl,!0);for(const t of e)Ou(n.wl,t)}else if(!1===e&&!1!==n.Sl){const t=[];let e=Promise.resolve();n.Rl.forEach((s,i)=>{n.Tl.Ou(i)?t.push(i):e=e.then(()=>(gc(n,i),zh(n.Vh,i,!0))),Cu(n.wl,i)}),await e,await Ic(n,t),function(t){const e=Ds(n);e.gl.forEach((t,n)=>{Cu(e.wl,n)}),e.yl.Nc(),e.gl=new Map,e.Vl=new Zr(Js.K)}(),n.Sl=!1,await Wu(n.wl,!1)}}(this.Ll.uu,t),this.kl&&(t&&!this.kl.wr?this.kl.start(this.Vh):t||this.kl.stop())})}xl(t){const e=Eu();if(!pu.Kn(e))throw new Rs(ks.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Uh(t.ma.p,t.ma.persistenceKey);return new pu(e,t.ls,n,t.clientId,t.$l)}}class Dc{async initialize(t,e){this.Vh||(this.Vh=t.Vh,this.Tl=t.Tl,this.gh=this.Bl(e),this.wl=this.ql(e),this.El=this.Ul(e),this.uu=this.Kl(e,!t.synchronizeTabs),this.Tl.au=(t=>lc(this.uu,t,1)),this.wl.yh.Ql=async function(t,e){const n=Ds(t);if(!n.currentUser.isEqual(e)){Ts("SyncEngine","User change. New user:",e.i());const t=await Gh(n.Vh,e);n.currentUser=e,function(t,e){t.bl.forEach(t=>{t.forEach(t=>{t.reject(new Rs(ks.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.bl.clear()}(n),n.Tl.$u(e,t.Tc,t.Ic),await bc(n,t.Ec)}}.bind(null,this.uu),await Wu(this.wl,this.uu.Dl))}Ul(t){return new Qu}Bl(t){const e=Tu(t.ma.p),n=(s=t.ma,new bu(s));var s;return function(t,e,n){return new xu(t,e,n)}(t.credentials,n,e)}ql(t){return e=this.Vh,n=this.gh,s=t.ls,i=(t=>lc(this.uu,t,0)),r=yu.Kn()?new yu:new mu,new ku(e,n,s,i,r);var e,n,s,i,r}Kl(t,e){return function(t,e,n,s,i,r,o){const a=new hc(t,e,n,s,i,r);return o&&(a.Sl=!0),a}(this.Vh,this.wl,this.El,this.Tl,t.$l,t.Il,e)}terminate(){return async function(t){const e=Ds(t);Ts("RemoteStore","RemoteStore shutting down."),e.Sh.add(5),await Lu(e),e.Ch.Mo(),e.Nh.set("Unknown")}(this.wl)}}class kc{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Wl(this.observer.next,t)}error(t){this.observer.error?this.Wl(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)}jl(){this.muted=!0}Wl(t,e){this.muted||setTimeout(()=>{this.muted||t(e)},0)}}class Rc{constructor(t){this.Gl=t}static fromBase64String(t){try{return new Rc(ni.fromBase64String(t))}catch(t){throw new Rs(ks.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Rc(ni.fromUint8Array(t))}toBase64(){return this.Gl.toBase64()}toUint8Array(){return this.Gl.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this.Gl.isEqual(t.Gl)}}class Lc{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new Rs(ks.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.zl=new Xs(t)}isEqual(t){return this.zl.isEqual(t.zl)}}class Oc{constructor(t){this._methodName=t}}class Cc{constructor(t){this.Hl=t}}function Vc(t,e,n){if(!n)throw new Rs(ks.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function Uc(t){if(!Js.lt(t))throw new Rs(ks.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Pc(t){if(Js.lt(t))throw new Rs(ks.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Mc(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){if(t.constructor){const e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":Ss()}function qc(t,e){if("_delegate"in t&&(t=t.Hl),!(t instanceof e)){if(e.name===t.constructor.name)throw new Rs(ks.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Mc(t);throw new Rs(ks.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function Fc(t,e){if(e<=0)throw new Rs(ks.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}class jc{constructor(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Rs(ks.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Rs(ks.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,function(t,e,n,s){if(!0===e&&!0===s)throw new Rs(ks.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")}(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling)}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties}}const Gc=new Map;class Bc{constructor(t,e){this.Jl="(lite)",this.Yl=new jc({}),this.Xl=!1,t instanceof Ms?(this.Zl=t,this.t_=new Os):(this.e_=t,this.Zl=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Rs(ks.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ms(t.options.projectId)}(t),this.t_=new Cs(e))}get app(){if(!this.e_)throw new Rs(ks.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.e_}get n_(){return this.Xl}get s_(){return void 0!==this.i_}r_(t){if(this.Xl)throw new Rs(ks.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this.Yl=new jc(t),void 0!==t.credentials&&(this.t_=function(t){if(!t)return new Os;switch(t.type){case"gapi":const e=t.client;return xs(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Us(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new Rs(ks.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))}o_(){return this.Yl}c_(){return this.Xl=!0,this.Yl}_delete(){return this.i_||(this.i_=this.u_()),this.i_}u_(){return function(t){const e=Gc.get(t);e&&(Ts("ComponentProvider","Removing Datastore"),Gc.delete(t),e.terminate())}(this),Promise.resolve()}}class Kc{constructor(t,e,n){this.a_=e,this.h_=n,this.type="document",this.firestore=t}get l_(){return this.h_.path}get id(){return this.h_.path.J()}get path(){return this.h_.path.et()}get parent(){return new zc(this.firestore,this.a_,this.h_.path.G())}withConverter(t){return new Kc(this.firestore,t,this.h_)}}class $c{constructor(t,e,n){this.a_=e,this.__=n,this.type="query",this.firestore=t}withConverter(t){return new $c(this.firestore,t,this.__)}}class zc extends $c{constructor(t,e,n){super(t,e,Zi(n)),this.firestore=t,this.l_=n,this.type="collection"}get id(){return this.__.path.J()}get path(){return this.__.path.et()}get parent(){const t=this.l_.G();return t.Y()?null:new Kc(this.firestore,null,new Js(t))}withConverter(t){return new zc(this.firestore,t,this.l_)}}function Hc(t,e,...n){if(t instanceof Cc&&(t=t.Hl),1===arguments.length&&(e=js.M()),Vc("doc","path",e),t instanceof Bc){const s=Ws.nt(e,...n);return Uc(s),new Kc(t,null,new Js(s))}{if(!(t instanceof Kc||t instanceof zc))throw new Rs(ks.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t.l_.child(Ws.nt(e,...n));return Uc(s),new Kc(t.firestore,t instanceof zc?t.a_:null,new Js(s))}}function Wc(t,e){return t instanceof Cc&&(t=t.Hl),e instanceof Cc&&(e=e.Hl),t instanceof $c&&e instanceof $c&&t.firestore===e.firestore&&hr(t.__,e.__)&&t.a_===e.a_}class Yc{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new Rs(ks.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Rs(ks.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.f_=t,this.d_=e}get latitude(){return this.f_}get longitude(){return this.d_}isEqual(t){return this.f_===t.f_&&this.d_===t.d_}toJSON(){return{latitude:this.f_,longitude:this.d_}}F(t){return Gs(this.f_,t.f_)||Gs(this.d_,t.d_)}}const Xc=/^__.*__$/;class Jc{constructor(t,e,n){this.data=t,this.jt=e,this.fieldTransforms=n}w_(t,e){return null!==this.jt?new jr(t,this.data,this.jt,e,this.fieldTransforms):new Fr(t,this.data,e,this.fieldTransforms)}}class Qc{constructor(t,e,n){this.data=t,this.jt=e,this.fieldTransforms=n}w_(t,e){return new jr(t,this.data,this.jt,e,this.fieldTransforms)}}function Zc(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ss()}}class tl{constructor(t,e,n,s,i,r){this.settings=t,this.p=e,this.Ut=n,this.ignoreUndefinedProperties=s,void 0===i&&this.E_(),this.fieldTransforms=i||[],this.jt=r||[]}get path(){return this.settings.path}get T_(){return this.settings.T_}I_(t){return new tl(Object.assign(Object.assign({},this.settings),t),this.p,this.Ut,this.ignoreUndefinedProperties,this.fieldTransforms,this.jt)}m_(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.I_({path:n,A_:!1});return s.R_(t),s}P_(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.I_({path:n,A_:!1});return s.E_(),s}V_(t){return this.I_({path:void 0,A_:!0})}g_(t){return bl(t,this.settings.methodName,this.settings.y_||!1,this.path,this.settings.p_)}contains(t){return void 0!==this.jt.find(e=>t.X(e))||void 0!==this.fieldTransforms.find(e=>t.X(e.field))}E_(){if(this.path)for(let t=0;t<this.path.length;t++)this.R_(this.path.get(t))}R_(t){if(0===t.length)throw this.g_("Document fields must not be empty");if(Zc(this.T_)&&Xc.test(t))throw this.g_('Document fields cannot begin and end with "__"')}}class el{constructor(t,e,n){this.p=t,this.ignoreUndefinedProperties=e,this.Ut=n||Tu(t)}b_(t,e,n,s=!1){return new tl({T_:t,methodName:e,p_:n,path:Xs.st(),A_:!1,y_:s},this.p,this.Ut,this.ignoreUndefinedProperties)}}function nl(t){const e=t.c_(),n=Tu(t.Zl);return new el(t.Zl,!!e.ignoreUndefinedProperties,n)}function sl(t,e,n,s,i,r={}){const o=t.b_(r.merge||r.mergeFields?2:0,e,n,i);ml("Data must be an object, but it was:",o,s);const a=pl(s,o);let h,u;if(r.merge)h=new ei(o.jt),u=o.fieldTransforms;else if(r.mergeFields){const t=[];for(const s of r.mergeFields){const i=yl(e,s,n);if(!o.contains(i))throw new Rs(ks.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);El(t,i)||t.push(i)}h=new ei(t),u=o.fieldTransforms.filter(t=>h.ft(t.field))}else h=null,u=o.fieldTransforms;return new Jc(new _i(a),h,u)}class il extends Oc{v_(t){if(2!==t.T_)throw 1===t.T_?t.g_(this._methodName+"() can only appear at the top level of your update data"):t.g_(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.jt.push(t.path),null}isEqual(t){return t instanceof il}}function rl(t,e,n){return new tl({T_:3,p_:e.settings.p_,methodName:t._methodName,A_:n},e.p,e.Ut,e.ignoreUndefinedProperties)}class ol extends Oc{v_(t){return new kr(t.path,new Ir)}isEqual(t){return t instanceof ol}}class al extends Oc{constructor(t,e){super(t),this.S_=e}v_(t){const e=rl(this,t,!0),n=this.S_.map(t=>dl(t,e)),s=new Tr(n);return new kr(t.path,s)}isEqual(t){return this===t}}class hl extends Oc{constructor(t,e){super(t),this.S_=e}v_(t){const e=rl(this,t,!0),n=this.S_.map(t=>dl(t,e)),s=new Nr(n);return new kr(t.path,s)}isEqual(t){return this===t}}class ul extends Oc{constructor(t,e){super(t),this.D_=e}v_(t){const e=new Sr(t.Ut,yr(t.Ut,this.D_));return new kr(t.path,e)}isEqual(t){return this===t}}function cl(t,e,n,s){const i=t.b_(1,e,n);ml("Data must be an object, but it was:",i,s);const r=[],o=new Ni;Zs(s,(t,s)=>{const a=vl(e,t,n);s instanceof Cc&&(s=s.Hl);const h=i.P_(a);if(s instanceof il)r.push(a);else{const t=dl(s,h);null!=t&&(r.push(a),o.set(a,t))}});const a=new ei(r);return new Qc(o.Rt(),a,i.fieldTransforms)}function ll(t,e,n,s,i,r){const o=t.b_(1,e,n),a=[yl(e,s,n)],h=[i];if(r.length%2!=0)throw new Rs(ks.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<r.length;t+=2)a.push(yl(e,r[t])),h.push(r[t+1]);const u=[],c=new Ni;for(let t=a.length-1;t>=0;--t)if(!El(u,a[t])){const e=a[t];let n=h[t];n instanceof Cc&&(n=n.Hl);const s=o.P_(e);if(n instanceof il)u.push(e);else{const t=dl(n,s);null!=t&&(u.push(e),c.set(e,t))}}const l=new ei(u);return new Qc(c.Rt(),l,o.fieldTransforms)}function fl(t,e,n,s=!1){return dl(n,t.b_(s?4:3,e))}function dl(t,e){if(t instanceof Cc&&(t=t.Hl),gl(t))return ml("Unsupported field value:",e,t),pl(t,e);if(t instanceof Oc)return function(t,e){if(!Zc(e.T_))throw e.g_(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.g_(t._methodName+"() is not currently supported inside arrays");const n=t.v_(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(e.path&&e.jt.push(e.path),t instanceof Array){if(e.settings.A_&&4!==e.T_)throw e.g_("Nested arrays are not supported");return function(t,e){const n=[];let s=0;for(const i of t){let t=dl(i,e.V_(s));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),s++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(t instanceof Cc&&(t=t.Hl),null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return yr(e.Ut,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=$s.fromDate(t);return{timestampValue:ko(e.Ut,n)}}if(t instanceof $s){const n=new $s(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:ko(e.Ut,n)}}if(t instanceof Yc)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Rc)return{bytesValue:Ro(e.Ut,t.Gl)};if(t instanceof Kc){const n=e.p,s=t.firestore.Zl;if(!s.isEqual(n))throw e.g_(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Oo(t.firestore.Zl||e.p,t.h_.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.g_("Unsupported field value: "+Mc(t))}(t,e)}function pl(t,e){const n={};return ti(t)?e.path&&e.path.length>0&&e.jt.push(e.path):Zs(t,(t,s)=>{const i=dl(s,e.m_(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function gl(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof $s||t instanceof Yc||t instanceof Rc||t instanceof Kc||t instanceof Oc)}function ml(t,e,n){if(!gl(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const s=Mc(n);throw"an object"===s?e.g_(t+" a custom object"):e.g_(t+" "+s)}}function yl(t,e,n){if(e instanceof Cc&&(e=e.Hl),e instanceof Lc)return e.zl;if("string"==typeof e)return vl(t,e);throw bl("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}const wl=new RegExp("[~\\*/\\[\\]]");function vl(t,e,n){if(e.search(wl)>=0)throw bl(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Lc(...e.split(".")).zl}catch(s){throw bl(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function bl(t,e,n,s,i){const r=s&&!s.Y(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let h="";return(r||o)&&(h+=" (found",r&&(h+=" in field "+s),o&&(h+=" in document "+i),h+=")"),new Rs(ks.INVALID_ARGUMENT,a+t+h)}function El(t,e){return t.some(t=>t.isEqual(e))}class Il{constructor(t){this.gh=t,this.C_=new Map,this.mutations=[],this.N_=!1,this.x_=null,this.O_=new Set}async k_(t){if(this.M_(),this.mutations.length>0)throw new Rs(ks.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const e=await async function(t,e){const n=Ds(t),s=qo(n.Ut)+"/documents",i={documents:e.map(t=>Vo(n.Ut,t))},r=await n.pa("BatchGetDocuments",s,i),o=new Map;r.forEach(t=>{const e=function(t,e){return"found"in e?function(t,e){xs(!!e.found),e.found.name,e.found.updateTime;const n=Uo(t,e.found.name),s=Lo(e.found.updateTime),i=new _i({mapValue:{fields:e.found.fields}});return new xi(n,s,i,{})}(t,e):"missing"in e?function(t,e){xs(!!e.missing),xs(!!e.readTime);const n=Uo(t,e.missing),s=Lo(e.readTime);return new Di(n,s)}(t,e):Ss()}(n.Ut,t);o.set(e.key.toString(),e)});const a=[];return e.forEach(t=>{const e=o.get(t.toString());xs(!!e),a.push(e)}),a}(this.gh,t);return e.forEach(t=>{t instanceof Di||t instanceof xi?this.F_(t):Ss()}),e}set(t,e){this.write(e.w_(t,this.Wt(t))),this.O_.add(t.toString())}update(t,e){try{this.write(e.w_(t,this.L_(t)))}catch(t){this.x_=t}this.O_.add(t.toString())}delete(t){this.write(new zr(t,this.Wt(t))),this.O_.add(t.toString())}async commit(){if(this.M_(),this.x_)throw this.x_;const t=this.C_;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((t,e)=>{const n=Js.ut(e);this.mutations.push(new Hr(n,this.Wt(n)))}),await async function(t,e){const n=Ds(t),s=qo(n.Ut)+"/documents",i={writes:e.map(t=>Go(n.Ut,t))};await n.Pa("Commit",s,i)}(this.gh,this.mutations),this.N_=!0}F_(t){let e;if(t instanceof xi)e=t.version;else{if(!(t instanceof Di))throw Ss();e=zs.min()}const n=this.C_.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Rs(ks.ABORTED,"Document version changed between two reads.")}else this.C_.set(t.key.toString(),e)}Wt(t){const e=this.C_.get(t.toString());return!this.O_.has(t.toString())&&e?Lr.updateTime(e):Lr.Kt()}L_(t){const e=this.C_.get(t.toString());if(!this.O_.has(t.toString())&&e){if(e.isEqual(zs.min()))throw new Rs(ks.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Lr.updateTime(e)}return Lr.exists(!0)}write(t){this.M_(),this.mutations.push(t)}M_(){}}class Tl{constructor(t,e,n,s){this.ls=t,this.gh=e,this.updateFunction=n,this.ws=s,this.B_=5,this.Ka=new _u(this.ls,"transaction_retry")}run(){this.q_()}q_(){this.Ka.ka(async()=>{const t=new Il(this.gh),e=this.U_(t);e&&e.then(e=>{this.ls.Rs(()=>t.commit().then(()=>{this.ws.resolve(e)}).catch(t=>{this.K_(t)}))}).catch(t=>{this.K_(t)})})}U_(t){try{const e=this.updateFunction(t);return!ui(e)&&e.catch&&e.then?e:(this.ws.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.ws.reject(t),null}}K_(t){this.B_>0&&this.Q_(t)?(this.B_-=1,this.ls.Rs(()=>(this.q_(),Promise.resolve()))):this.ws.reject(t)}Q_(t){if("FirebaseError"===t.name){const e=t.code;return"aborted"===e||"failed-precondition"===e||!Jr(e)}return!1}}class _l{constructor(t,e,n){this.credentials=t,this.ls=e,this.ma=n,this.user=bs.UNAUTHENTICATED,this.clientId=js.M(),this.W_=(()=>{}),this.A=new Qo,this.credentials.T(t=>{Ts("FirestoreClient","Received user=",t.uid),this.user=t,this.W_(t),this.A.resolve()})}async getConfiguration(){return await this.A.promise,{ls:this.ls,ma:this.ma,clientId:this.clientId,credentials:this.credentials,$l:this.user,Il:100}}j_(t){this.W_=t,this.A.promise.then(()=>this.W_(this.user))}G_(){if(this.ls.z_)throw new Rs(ks.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.ls.H_();const t=new Qo;return this.ls.J_(async()=>{try{this.Y_&&await this.Y_.terminate(),this.X_&&await this.X_.terminate(),this.credentials.I(),t.resolve()}catch(e){const n=ca(e,"Failed to shutdown persistence");t.reject(n)}}),t.promise}}async function Nl(t,e){t.ls.Z_(),Ts("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let s=n.$l;t.j_(n=>{s.isEqual(n)||(s=n,t.ls.yo(async()=>{await Gh(e.Vh,n)}))}),e.persistence.Ro(()=>t.terminate()),t.X_=e}async function Al(t,e){t.ls.Z_();const n=await Sl(t);Ts("FirestoreClient","Initializing OnlineComponentProvider");const s=await t.getConfiguration();await e.initialize(n,s),t.j_(n=>t.ls.yo(()=>(async function(t,e){const n=Ds(t);n.ls.Z_(),Ts("RemoteStore","RemoteStore received new credentials");const s=qu(n);n.Sh.add(3),await Lu(n),s&&n.Nh.set("Unknown"),await n.yh.Ql(e),n.Sh.delete(3),await Ru(n)})(e.wl,n))),t.Y_=e}async function Sl(t){return t.X_||(Ts("FirestoreClient","Using default OfflineComponentProvider"),await Nl(t,new Ac)),t.X_}async function xl(t){return t.Y_||(Ts("FirestoreClient","Using default OnlineComponentProvider"),await Al(t,new Dc)),t.Y_}function Dl(t){return Sl(t).then(t=>t.persistence)}function kl(t){return Sl(t).then(t=>t.Vh)}function Rl(t){return xl(t).then(t=>t.wl)}function Ll(t){return xl(t).then(t=>t.uu)}async function Ol(t){const e=await xl(t),n=e.El;return n.Uh=async function(t,e){const n=_c(t);let s,i;const r=n.Al.get(e);if(r)s=r.targetId,n.Tl.Cu(s),i=r.view.fl();else{const t=await $h(n.Vh,or(e)),r=n.Tl.Cu(t.targetId);s=t.targetId,i=await uc(n,e,s,"current"===r),n.Dl&&Ou(n.wl,t)}return i}.bind(null,e.uu),n.Wh=async function(t,e){const n=Ds(t),s=n.Al.get(e),i=n.Rl.get(s.targetId);if(i.length>1)return n.Rl.set(s.targetId,i.filter(t=>!hr(t,e))),void n.Al.delete(e);n.Dl?(n.Tl.xu(s.targetId),n.Tl.pu(s.targetId)||await zh(n.Vh,s.targetId,!1).then(()=>{n.Tl.ku(s.targetId),Cu(n.wl,s.targetId),gc(n,s.targetId)}).catch(ih)):(gc(n,s.targetId),await zh(n.Vh,s.targetId,!0))}.bind(null,e.uu),n}function Cl(t,e,n={}){const s=new Qo;return t.ls.Rs(async()=>(function(t,e,n,s,i){const r=new kc({next:r=>{e.Rs(()=>tc(t,o));const a=r.docs.has(n);!a&&r.fromCache?i.reject(new Rs(ks.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&r.fromCache&&s&&"server"===s.source?i.reject(new Rs(ks.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(r)},error:t=>i.reject(t)}),o=new nc(Zi(n.path),r,{includeMetadataChanges:!0,Xh:!0});return Zu(t,o)})(await Ol(t),t.ls,e,n,s)),s.promise}function Vl(t,e,n={}){const s=new Qo;return t.ls.Rs(async()=>(function(t,e,n,s,i){const r=new kc({next:n=>{e.Rs(()=>tc(t,o)),n.fromCache&&"server"===s.source?i.reject(new Rs(ks.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:t=>i.reject(t)}),o=new nc(n,r,{includeMetadataChanges:!0,Xh:!0});return Zu(t,o)})(await Ol(t),t.ls,e,n,s)),s.promise}class Ul{constructor(){this.tf=Promise.resolve(),this.ef=[],this.nf=!1,this.sf=[],this.rf=null,this.cf=!1,this.uf=[],this.Ka=new _u(this,"async_queue_retry"),this.af=(()=>{const t=Iu();t&&Ts("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Ka.Fa()});const t=Iu();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.af)}get z_(){return this.nf}Rs(t){this.enqueue(t)}J_(t){this.hf(),this.lf(t)}H_(){if(!this.nf){this.nf=!0;const t=Iu();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.af)}}enqueue(t){return this.hf(),this.nf?new Promise(t=>{}):this.lf(t)}yo(t){this.Rs(()=>(this.ef.push(t),this._f()))}async _f(){if(0!==this.ef.length){try{await this.ef[0](),this.ef.shift(),this.Ka.reset()}catch(t){if(!ia(t))throw t;Ts("AsyncQueue","Operation failed with retryable error: "+t)}this.ef.length>0&&this.Ka.ka(()=>this._f())}}lf(t){const e=this.tf.then(()=>(this.cf=!0,t().catch(t=>{throw this.rf=t,this.cf=!1,_s("INTERNAL UNHANDLED ERROR: ",function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(t=>(this.cf=!1,t))));return this.tf=e,e}Er(t,e,n){this.hf(),this.uf.indexOf(t)>-1&&(e=0);const s=ua.Es(this,t,e,n,t=>this.ff(t));return this.sf.push(s),s}hf(){this.rf&&Ss()}Z_(){}async df(){let t;do{t=this.tf,await t}while(t!==this.tf)}wf(t){for(const e of this.sf)if(e._s===t)return!0;return!1}Ef(t){return this.df().then(()=>{this.sf.sort((t,e)=>t.fs-e.fs);for(const e of this.sf)if(e.As(),"all"!==t&&e._s===t)break;return this.df()})}Tf(t){this.uf.push(t)}ff(t){const e=this.sf.indexOf(t);this.sf.splice(e,1)}}class Pl extends Bc{constructor(t,e){super(t,e),this.If=new Ul,this.Jl="name"in t?t.name:"[DEFAULT]"}u_(){return this.mf||ql(this),this.mf.terminate()}}function Ml(t){return t.mf||ql(t),t.mf.G_(),t.mf}function ql(t){const e=t.c_(),n=function(t,e,n){return new Ps(t,e,n.host,n.ssl,n.experimentalForceLongPolling,n.experimentalAutoDetectLongPolling)}(t.Zl,t.Jl,e);t.mf=new _l(t.t_,t.If,n)}function Fl(t,e,n){const s=new Qo;return t.ls.enqueue(async()=>{try{await Nl(t,n),await Al(t,e),s.resolve()}catch(t){if(!function(t){return"FirebaseError"===t.name?t.code===ks.FAILED_PRECONDITION||t.code===ks.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||(22===t.code||20===t.code||11===t.code)}(t))throw t;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),s.reject(t)}}).then(()=>s.promise)}function jl(t){if(t.n_||t.s_)throw new Rs(ks.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Gl{Af(t,e="none"){switch(fi(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ri(t.integerValue||t.doubleValue);case 3:return this.Rf(t.timestampValue);case 4:return this.Pf(t,e);case 5:return t.stringValue;case 6:return this.Vf(oi(t.bytesValue));case 7:return this.gf(t.referenceValue);case 8:return this.yf(t.geoPointValue);case 9:return this.pf(t.arrayValue,e);case 10:return this.bf(t.mapValue,e);default:throw Ss()}}bf(t,e){const n={};return Zs(t.fields||{},(t,s)=>{n[t]=this.Af(s,e)}),n}yf(t){return new Yc(ri(t.latitude),ri(t.longitude))}pf(t,e){return(t.values||[]).map(t=>this.Af(t,e))}Pf(t,e){switch(e){case"previous":const n=function t(e){const n=e.mapValue.fields.__previous_value__;return ai(n)?t(n):n}(t);return null==n?null:this.Af(n,e);case"estimate":return this.Rf(hi(t));default:return null}}Rf(t){const e=ii(t);return new $s(e.seconds,e.nanos)}vf(t,e){const n=Ws.nt(t);xs(Jo(n));const s=new Ms(n.get(1),n.get(3)),i=new Js(n.j(5));return s.isEqual(e)||_s(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}class Bl{constructor(t,e,n,s,i){this.Sf=t,this.Df=e,this.h_=n,this.Cf=s,this.a_=i}get id(){return this.h_.path.J()}get ref(){return new Kc(this.Sf,this.a_,this.h_)}exists(){return null!==this.Cf}data(){if(this.Cf){if(this.a_){const t=new Kl(this.Sf,this.Df,this.h_,this.Cf,null);return this.a_.fromFirestore(t)}return this.Df.Af(this.Cf.yt())}}get(t){if(this.Cf){const e=this.Cf.data().field($l("DocumentSnapshot.get",t));if(null!==e)return this.Df.Af(e)}}}class Kl extends Bl{data(){return super.data()}}function $l(t,e){return"string"==typeof e?vl(t,e):e instanceof Cc?e.Hl.zl:e.zl}class zl{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Hl extends Bl{constructor(t,e,n,s,i,r){super(t,e,n,s,r),this.Sf=t,this.Nf=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this.Cf){if(this.a_){const e=new Wl(this.Sf,this.Df,this.h_,this.Cf,this.metadata,null);return this.a_.fromFirestore(e,t)}return this.Df.Af(this.Cf.yt(),t.serverTimestamps)}}get(t,e={}){if(this.Cf){const n=this.Cf.data().field($l("DocumentSnapshot.get",t));if(null!==n)return this.Df.Af(n,e.serverTimestamps)}}}class Wl extends Hl{data(t={}){return super.data(t)}}class Yl{constructor(t,e,n,s){this.Sf=t,this.Df=e,this.xf=s,this.metadata=new zl(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this.xf.docs.size}get empty(){return 0===this.size}forEach(t,e){this.xf.docs.forEach(n=>{t.call(e,new Wl(this.Sf,this.Df,n.key,n,new zl(this.xf.Se.has(n.key),this.xf.fromCache),this.query.a_))})}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this.xf.Ce)throw new Rs(ks.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.Of&&this.kf===e||(this.Of=function(t,e){if(t.xf.ve.Y()){let e,n=0;return t.xf.docChanges.map(s=>{const i=new Wl(t.Sf,t.Df,s.doc.key,s.doc,new zl(t.xf.Se.has(s.doc.key),t.xf.fromCache),t.query.a_);return e=s.doc,{type:"added",doc:i,oldIndex:-1,newIndex:n++}})}{let n=t.xf.ve;return t.xf.docChanges.filter(t=>e||3!==t.type).map(e=>{const s=new Wl(t.Sf,t.Df,e.doc.key,e.doc,new zl(t.xf.Se.has(e.doc.key),t.xf.fromCache),t.query.a_);let i=-1,r=-1;return 0!==e.type&&(i=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(r=(n=n.add(e.doc)).indexOf(e.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ss()}}(e.type),doc:s,oldIndex:i,newIndex:r}})}}(this,e),this.kf=e),this.Of}}function Xl(t){if(er(t)&&0===t.Ct.length)throw new Rs(ks.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Jl{}class Ql extends Jl{constructor(t,e,n){super(),this.Ff=t,this.$f=e,this.Lf=n,this.type="where"}Mf(t){const e=nl(t.firestore),n=function(t,e,n,s,i,r,o){let a;if(i.rt()){if("array-contains"===r||"array-contains-any"===r)throw new Rs(ks.INVALID_ARGUMENT,`Invalid Query. You can't perform '${r}' queries on FieldPath.documentId().`);if("in"===r||"not-in"===r){of(o,r);const e=[];for(const n of o)e.push(rf(s,t,n));a={arrayValue:{values:e}}}else a=rf(s,t,o)}else"in"!==r&&"not-in"!==r&&"array-contains-any"!==r||of(o,r),a=fl(n,"where",o,"in"===r||"not-in"===r);const h=Ui.create(i,r,a);return function(t,e){if(e.Dt()){const n=sr(t);if(null!==n&&!n.isEqual(e.field))throw new Rs(ks.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${e.field.toString()}'`);const s=nr(t);null!==s&&af(t,e.field,s)}const n=function(t,e){for(const n of t.filters)if(e.indexOf(n.op)>=0)return n.op;return null}(t,function(t){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==n)throw n===e.op?new Rs(ks.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Rs(ks.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}(t,h),h}(t.__,0,e,t.firestore.Zl,this.Ff,this.$f,this.Lf);return new $c(t.firestore,t.a_,function(t,e){const n=t.filters.concat([e]);return new Ji(t.path,t.collectionGroup,t.Ct.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t.__,n))}}class Zl extends Jl{constructor(t,e){super(),this.Ff=t,this.Bf=e,this.type="orderBy"}Mf(t){const e=function(t,e,n){if(null!==t.startAt)throw new Rs(ks.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Rs(ks.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const s=new Hi(e,n);return function(t,e){if(null===nr(t)){const n=sr(t);null!==n&&af(t,n,e.field)}}(t,s),s}(t.__,this.Ff,this.Bf);return new $c(t.firestore,t.a_,function(t,e){const n=t.Ct.concat([e]);return new Ji(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t.__,e))}}class tf extends Jl{constructor(t,e,n){super(),this.type=t,this.qf=e,this.Uf=n}Mf(t){return new $c(t.firestore,t.a_,ar(t.__,this.qf,this.Uf))}}class ef extends Jl{constructor(t,e,n){super(),this.type=t,this.Kf=e,this.Qf=n}Mf(t){const e=sf(t,this.type,this.Kf,this.Qf);return new $c(t.firestore,t.a_,function(t,e){return new Ji(t.path,t.collectionGroup,t.Ct.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t.__,e))}}class nf extends Jl{constructor(t,e,n){super(),this.type=t,this.Kf=e,this.Qf=n}Mf(t){const e=sf(t,this.type,this.Kf,this.Qf);return new $c(t.firestore,t.a_,function(t,e){return new Ji(t.path,t.collectionGroup,t.Ct.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t.__,e))}}function sf(t,e,n,s){if(n[0]instanceof Cc&&(n[0]=n[0].Hl),n[0]instanceof Bl)return function(t,e,n,s,i){if(!s)throw new Rs(ks.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");const r=[];for(const n of rr(t))if(n.field.rt())r.push(wi(e,s.key));else{const t=s.field(n.field);if(ai(t))throw new Rs(ks.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t){const t=n.field.et();throw new Rs(ks.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${t}' (used as the orderBy) does not exist.`)}r.push(t)}return new $i(r,i)}(t.__,t.firestore.Zl,e,n[0].Cf,s);{const i=nl(t.firestore);return function(t,e,n,s,i,r){const o=t.Ct;if(i.length>o.length)throw new Rs(ks.INVALID_ARGUMENT,`Too many arguments provided to ${s}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let r=0;r<i.length;r++){const h=i[r];if(o[r].field.rt()){if("string"!=typeof h)throw new Rs(ks.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${s}(), but got a ${typeof h}`);if(!ir(t)&&-1!==h.indexOf("/"))throw new Rs(ks.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ${s}() must be a plain document ID, but '${h}' contains a slash.`);const n=t.path.child(Ws.nt(h));if(!Js.lt(n))throw new Rs(ks.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ${s}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new Js(n);a.push(wi(e,i))}else{const t=fl(n,s,h);a.push(t)}}return new $i(a,r)}(t.__,t.firestore.Zl,i,e,n,s)}}function rf(t,e,n){if(n instanceof Cc&&(n=n.Hl),"string"==typeof n){if(""===n)throw new Rs(ks.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!ir(e)&&-1!==n.indexOf("/"))throw new Rs(ks.INVALID_ARGUMENT,`Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const s=e.path.child(Ws.nt(n));if(!Js.lt(s))throw new Rs(ks.INVALID_ARGUMENT,`Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return wi(t,new Js(s))}if(n instanceof Kc)return wi(t,n.h_);throw new Rs(ks.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Mc(n)+".")}function of(t,e){if(!Array.isArray(t)||0===t.length)throw new Rs(ks.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(t.length>10)throw new Rs(ks.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function af(t,e,n){if(!n.isEqual(e))throw new Rs(ks.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}function hf(t,e,n){let s;return s=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}class uf extends Gl{constructor(t){super(),this.firestore=t}Vf(t){return new Rc(t)}gf(t){const e=this.vf(t,this.firestore.Zl);return new Kc(this.firestore,null,e)}}class cf{constructor(t,e){this.Sf=t,this.Wf=e,this.jf=[],this.Gf=!1,this.zf=nl(t)}set(t,e,n){this.Hf();const s=lf(t,this.Sf),i=hf(s.a_,e,n),r=sl(this.zf,"WriteBatch.set",s.h_,i,null!==s.a_,n);return this.jf.push(r.w_(s.h_,Lr.Kt())),this}update(t,e,n,...s){this.Hf();const i=lf(t,this.Sf);let r;return e instanceof Cc&&(e=e.Hl),r="string"==typeof e||e instanceof Lc?ll(this.zf,"WriteBatch.update",i.h_,e,n,s):cl(this.zf,"WriteBatch.update",i.h_,e),this.jf.push(r.w_(i.h_,Lr.exists(!0))),this}delete(t){this.Hf();const e=lf(t,this.Sf);return this.jf=this.jf.concat(new zr(e.h_,Lr.Kt())),this}commit(){return this.Hf(),this.Gf=!0,this.jf.length>0?this.Wf(this.jf):Promise.resolve()}Hf(){if(this.Gf)throw new Rs(ks.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function lf(t,e){if(t instanceof Cc&&(t=t.Hl),t.firestore!==e)throw new Rs(ks.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}function ff(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const t of["next","error","complete"])if(t in n&&"function"==typeof n[t])return!0;return!1}(t)}class df extends Gl{constructor(t){super(),this.firestore=t}Vf(t){return new Rc(t)}gf(t){const e=this.vf(t,this.firestore.Zl);return new Kc(this.firestore,null,e)}}function pf(t,e){return function(t,e){const n=new Qo;return t.ls.Rs(async()=>(async function(t,e,n){const s=Nc(t);try{const i=await function(t,e){const n=Ds(t),s=$s.now(),i=e.reduce((t,e)=>t.add(e.key),lo());let r;return n.persistence.runTransaction("Locally write mutations","readwrite",t=>n.wc.Jo(t,i).next(i=>{r=i;const o=[];for(const t of e){const e=Pr(t,r.get(t.key));null!=e&&o.push(new jr(t.key,e,Ai(e.proto.mapValue),Lr.exists(!0)))}return n.jo.Ai(t,s,o,e)})).then(t=>{const e=t.Cs(r);return{batchId:t.batchId,ii:e}})}(s.Vh,e);s.Tl.bu(i.batchId),function(t,e,n){let s=t.pl[t.currentUser.i()];s||(s=new Zr(Gs)),s=s.Gt(e,n),t.pl[t.currentUser.i()]=s}(s,i.batchId,n),await bc(s,i.ii),await Bu(s.wl)}catch(t){const e=ca(t,"Failed to persist write");n.reject(e)}})(await Ll(t),e,n)),n.promise}(Ml(t),e)}function gf(t,e,n){const s=n.docs.get(e.h_),i=new df(t);return new Hl(t,i,e.h_,s,new zl(n.hasPendingWrites,n.fromCache),e.a_)}class mf extends class{constructor(t,e){this.Sf=t,this.Jf=e,this.zf=nl(t)}get(t){const e=lf(t,this.Sf),n=new uf(this.Sf);return this.Jf.k_([e.h_]).then(t=>{if(!t||1!==t.length)return Ss();const s=t[0];if(s instanceof Di)return new Bl(this.Sf,n,e.h_,null,e.a_);if(s instanceof xi)return new Bl(this.Sf,n,s.key,s,e.a_);throw Ss()})}set(t,e,n){const s=lf(t,this.Sf),i=hf(s.a_,e,n),r=sl(this.zf,"Transaction.set",s.h_,i,null!==s.a_,n);return this.Jf.set(s.h_,r),this}update(t,e,n,...s){const i=lf(t,this.Sf);let r;return e instanceof Cc&&(e=e.Hl),r="string"==typeof e||e instanceof Lc?ll(this.zf,"Transaction.update",i.h_,e,n,s):cl(this.zf,"Transaction.update",i.h_,e),this.Jf.update(i.h_,r),this}delete(t){const e=lf(t,this.Sf);return this.Jf.delete(e.h_),this}}{constructor(t,e){super(t,e),this.Sf=t}get(t){const e=lf(t,this.Sf),n=new df(this.Sf);return super.get(t).then(t=>new Hl(this.Sf,n,e.h_,t.Cf,new zl(!1,!1),e.a_))}}e._registerComponent(new c("firestore-exp",t=>((t,e)=>new Pl(t,e))(t.getProvider("app-exp").getImmediate(),t.getProvider("auth-internal")),"PUBLIC")),e.registerVersion("firestore-exp","0.0.900","node"),t.Bytes=Rc,t.CACHE_SIZE_UNLIMITED=-1,t.CollectionReference=zc,t.DocumentReference=Kc,t.DocumentSnapshot=Hl,t.FieldPath=Lc,t.FieldValue=Oc,t.FirebaseFirestore=Pl,t.FirestoreError=Rs,t.GeoPoint=Yc,t.Query=$c,t.QueryConstraint=Jl,t.QueryDocumentSnapshot=Wl,t.QuerySnapshot=Yl,t.SnapshotMetadata=zl,t.Timestamp=$s,t.Transaction=mf,t.WriteBatch=cf,t.addDoc=function(t,e){const n=qc(t.firestore,Pl),s=Hc(t),i=hf(t.a_,e);return pf(n,[sl(nl(t.firestore),"addDoc",s.h_,i,null!==t.a_,{}).w_(s.h_,Lr.exists(!1))]).then(()=>s)},t.arrayRemove=function(...t){return new hl("arrayRemove",t)},t.arrayUnion=function(...t){return new al("arrayUnion",t)},t.clearIndexedDbPersistence=function(t){if(t.n_&&!t.s_)throw new Rs(ks.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Qo;return t.If.J_(async()=>{try{await async function(t){if(!ea.Kn())return Promise.resolve();const e=t+"main";await ea.delete(e)}(Uh(t.Zl,t.Jl)),e.resolve()}catch(t){e.reject(t)}}),e.promise},t.collection=function(t,e,...n){if(t instanceof Cc&&(t=t.Hl),Vc("collection","path",e),t instanceof Bc){const s=Ws.nt(e,...n);return Pc(s),new zc(t,null,s)}{if(!(t instanceof Kc||t instanceof zc))throw new Rs(ks.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=Ws.nt(t.path,...n).child(Ws.nt(e));return Pc(s),new zc(t.firestore,null,s)}},t.collectionGroup=function(t,e){if(t=qc(t,Bc),Vc("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Rs(ks.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new $c(t,null,function(t){return new Ji(Ws.st(),t)}(e))},t.deleteDoc=function(t){return pf(qc(t.firestore,Pl),[new zr(t.h_,Lr.Kt())])},t.deleteField=function(){return new il("deleteField")},t.disableNetwork=function(t){return function(t){return t.ls.enqueue(async()=>{const e=await Dl(t),n=await Rl(t);return e.Po(!1),async function(t){const e=Ds(n);e.Sh.add(0),await Lu(e),e.Nh.set("Offline")}()})}(Ml(t=qc(t,Pl)))},t.doc=Hc,t.documentId=function(){return new Lc("__name__")},t.enableIndexedDbPersistence=function(t,e){jl(t=qc(t,Pl));const n=Ml(t),s=t.c_(),i=new Dc;return Fl(n,i,new Sc(i,s.cacheSizeBytes,null==e?void 0:e.forceOwnership))},t.enableMultiTabIndexedDbPersistence=function(t){jl(t=qc(t,Pl));const e=Ml(t),n=t.c_(),s=new Dc;return Fl(e,s,new xc(s,n.cacheSizeBytes))},t.enableNetwork=function(t){return function(t){return t.ls.enqueue(async()=>{const e=await Dl(t),n=await Rl(t);return e.Po(!0),function(t){const e=Ds(n);return e.Sh.delete(0),Ru(e)}()})}(Ml(t=qc(t,Pl)))},t.endAt=function(...t){return new nf("endAt",t,!1)},t.endBefore=function(...t){return new nf("endBefore",t,!0)},t.getDoc=function(t){const e=qc((t=qc(t,Kc)).firestore,Pl);return Cl(Ml(e),t.h_).then(n=>gf(e,t,n))},t.getDocFromCache=function(t){const e=qc((t=qc(t,Kc)).firestore,Pl),n=Ml(e),s=new df(e);return function(t,e){const n=new Qo;return t.ls.Rs(async()=>(async function(t,e,n){try{const s=await function(t,e){const n=Ds(t);return n.persistence.runTransaction("read document","readonly",t=>n.wc.Go(t,e))}(t,e);s instanceof xi?n.resolve(s):s instanceof Di?n.resolve(null):n.reject(new Rs(ks.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(t){const s=ca(t,`Failed to get document '${e} from cache`);n.reject(s)}})(await kl(t),e,n)),n.promise}(n,t.h_).then(n=>new Hl(e,s,t.h_,n,new zl(n instanceof xi&&n.gt,!0),t.a_))},t.getDocFromServer=function(t){const e=qc((t=qc(t,Kc)).firestore,Pl);return Cl(Ml(e),t.h_,{source:"server"}).then(n=>gf(e,t,n))},t.getDocs=function(t){const e=qc((t=qc(t,$c)).firestore,Pl),n=Ml(e),s=new df(e);return Xl(t.__),Vl(n,t.__).then(n=>new Yl(e,s,t,n))},t.getDocsFromCache=function(t){const e=qc((t=qc(t,$c)).firestore,Pl),n=Ml(e),s=new df(e);return function(t,e){const n=new Qo;return t.ls.Rs(async()=>(async function(t,e,n){try{const s=await Hh(t,e,!0),i=new rc(e,s.mc),r=i.rl(s.documents),o=i.di(r,!1);n.resolve(o.snapshot)}catch(t){const s=ca(t,`Failed to execute query '${e} against cache`);n.reject(s)}})(await kl(t),e,n)),n.promise}(n,t.__).then(n=>new Yl(e,s,t,n))},t.getDocsFromServer=function(t){const e=qc((t=qc(t,$c)).firestore,Pl),n=Ml(e),s=new df(e);return Vl(n,t.__,{source:"server"}).then(n=>new Yl(e,s,t,n))},t.getFirestore=function(t){return e._getProvider(t,"firestore-exp").getImmediate()},t.increment=function(t){return new ul("increment",t)},t.initializeFirestore=function(t,n){const s=e._getProvider(t,"firestore-exp").getImmediate();if(void 0!==n.cacheSizeBytes&&-1!==n.cacheSizeBytes&&n.cacheSizeBytes<1048576)throw new Rs(ks.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return s.r_(n),s},t.limit=function(t){return Fc("limit",t),new tf("limit",t,"F")},t.limitToLast=function(t){return Fc("limitToLast",t),new tf("limitToLast",t,"L")},t.onSnapshot=function(t,...e){var n,s,i;t instanceof Cc&&(t=t.Hl);let r={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||ff(e[o])||(r=e[o],o++);const a={includeMetadataChanges:r.includeMetadataChanges};if(ff(e[o])){const t=e[o];e[o]=null===(n=t.next)||void 0===n?void 0:n.bind(t),e[o+1]=null===(s=t.error)||void 0===s?void 0:s.bind(t),e[o+2]=null===(i=t.complete)||void 0===i?void 0:i.bind(t)}let h,u,c;if(t instanceof Kc)u=qc(t.firestore,Pl),c=Zi(t.h_.path),h={next:n=>{e[o]&&e[o](gf(u,t,n))},error:e[o+1],complete:e[o+2]};else{const n=qc(t,$c);u=qc(n.firestore,Pl),c=n.__;const s=new df(u);h={next:t=>{e[o]&&e[o](new Yl(u,s,n,t))},error:e[o+1],complete:e[o+2]},Xl(t.__)}return function(t,e,n,s){const i=new kc(h),r=new nc(e,i,n);return t.ls.Rs(async()=>Zu(await Ol(t),r)),()=>{i.jl(),t.ls.Rs(async()=>tc(await Ol(t),r))}}(Ml(u),c,a)},t.onSnapshotsInSync=function(t,e){return function(t,e){const n=new kc(e);return t.ls.Rs(async()=>(function(t,e){Ds(t).qh.add(e),e.next()})(await Ol(t),n)),()=>{n.jl(),t.ls.Rs(async()=>(function(t,e){Ds(t).qh.delete(e)})(await Ol(t),n))}}(Ml(t=qc(t,Pl)),ff(e)?e:{next:e})},t.orderBy=function(t,e="asc"){const n=e,s=$l("orderBy",t);return new Zl(s,n)},t.query=function(t,...e){for(const n of e)t=n.Mf(t);return t},t.queryEqual=Wc,t.refEqual=function(t,e){return t instanceof Cc&&(t=t.Hl),e instanceof Cc&&(e=e.Hl),(t instanceof Kc||t instanceof zc)&&(e instanceof Kc||e instanceof zc)&&t.firestore===e.firestore&&t.path===e.path&&t.a_===e.a_},t.runTransaction=function(t,e){return function(t,e){const n=new Qo;return t.ls.Rs(async()=>{const s=await function(t){return xl(t).then(t=>t.gh)}(t);new Tl(t.ls,s,e,n).run()}),n.promise}(Ml(t),n=>e(new mf(t,n)))},t.serverTimestamp=function(){return new ol("serverTimestamp")},t.setDoc=function(t,e,n){const s=qc((t=qc(t,Kc)).firestore,Pl),i=hf(t.a_,e,n);return pf(s,[sl(nl(s),"setDoc",t.h_,i,null!==t.a_,n).w_(t.h_,Lr.Kt())])},t.setLogLevel=function(t){Es.setLogLevel(t)},t.snapshotEqual=function(t,e){return t instanceof Hl&&e instanceof Hl?t.Sf===e.Sf&&t.h_.isEqual(e.h_)&&(null===t.Cf?null===e.Cf:t.Cf.isEqual(e.Cf))&&t.a_===e.a_:t instanceof Yl&&e instanceof Yl&&t.Sf===e.Sf&&Wc(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t.xf.isEqual(e.xf)},t.startAfter=function(...t){return new ef("startAfter",t,!1)},t.startAt=function(...t){return new ef("startAt",t,!0)},t.terminate=function(t){return e._removeServiceInstance(t.app,"firestore-exp"),t._delete()},t.updateDoc=function(t,e,n,...s){const i=qc((t=qc(t,Kc)).firestore,Pl),r=nl(i);let o;return e instanceof Cc&&(e=e.Hl),pf(i,[(o="string"==typeof e||e instanceof Lc?ll(r,"updateDoc",t.h_,e,n,s):cl(r,"updateDoc",t.h_,e)).w_(t.h_,Lr.exists(!0))])},t.useFirestoreEmulator=function(t,e,n){const s=(t=qc(t,Bc)).o_();"firestore.googleapis.com"!==s.host&&s.host!==e&&Ns("Host has been set in both settings() and useEmulator(), emulator host will be used"),t.r_(Object.assign(Object.assign({},s),{host:`${e}:${n}`,ssl:!1}))},t.waitForPendingWrites=function(t){return function(t){const e=new Qo;return t.ls.Rs(async()=>(async function(t,e){const n=Ds(t);qu(n.wl)||Ts("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const s=await function(t){const e=Ds(n.Vh);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",t=>e.jo.gi(t))}();if(-1===s)return void e.resolve();const i=n.bl.get(s)||[];i.push(e),n.bl.set(s,i)}catch(t){const n=ca(t,"Initialization of waitForPendingWrites() operation failed");e.reject(n)}})(await Ll(t),e)),e.promise}(Ml(t=qc(t,Pl)))},t.where=function(t,e,n){const s=e,i=$l("where",t);return new Ql(i,s,n)},t.writeBatch=function(t){return Ml(t=qc(t,Pl)),new cf(t,e=>pf(t,e))},Object.defineProperty(t,"__esModule",{value:!0})}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});