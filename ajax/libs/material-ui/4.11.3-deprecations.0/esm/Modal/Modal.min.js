import _objectWithoutProperties from"@babel/runtime/helpers/esm/objectWithoutProperties";import _extends from"@babel/runtime/helpers/esm/extends";import*as React from"react";import*as ReactDOM from"react-dom";import PropTypes from"prop-types";import{getThemeProps,useTheme}from"@material-ui/styles";import{elementAcceptingRef,HTMLElementType}from"@material-ui/utils";import deprecatedPropType from"../utils/deprecatedPropType";import ownerDocument from"../utils/ownerDocument";import Portal from"../Portal";import createChainedFunction from"../utils/createChainedFunction";import useForkRef from"../utils/useForkRef";import useEventCallback from"../utils/useEventCallback";import zIndex from"../styles/zIndex";import ModalManager,{ariaHidden}from"./ModalManager";import TrapFocus from"../Unstable_TrapFocus";import SimpleBackdrop from"./SimpleBackdrop";function getContainer(e){return e="function"==typeof e?e():e,ReactDOM.findDOMNode(e)}function getHasTransition(e){return!!e.children&&e.children.props.hasOwnProperty("in")}var defaultManager=new ModalManager;export var styles=function(e){return{root:{position:"fixed",zIndex:e.zIndex.modal,right:0,bottom:0,top:0,left:0},hidden:{visibility:"hidden"}}};var Modal=React.forwardRef(function(e,o){var r=useTheme(),t=getThemeProps({name:"MuiModal",props:_extends({},e),theme:r}),n=t.BackdropComponent,a=void 0===n?SimpleBackdrop:n,p=t.BackdropProps,c=t.children,s=t.closeAfterTransition,i=void 0!==s&&s,l=t.container,d=t.disableAutoFocus,u=void 0!==d&&d,m=t.disableBackdropClick,f=void 0!==m&&m,b=t.disableEnforceFocus,y=void 0!==b&&b,T=t.disableEscapeKeyDown,k=void 0!==T&&T,P=t.disablePortal,h=void 0!==P&&P,R=t.disableRestoreFocus,C=void 0!==R&&R,E=t.disableScrollLock,v=void 0!==E&&E,g=t.hideBackdrop,F=void 0!==g&&g,M=t.keepMounted,x=void 0!==M&&M,w=t.manager,B=void 0===w?defaultManager:w,D=t.onBackdropClick,A=t.onClose,I=t.onEscapeKeyDown,K=t.onRendered,_=t.open,S=_objectWithoutProperties(t,["BackdropComponent","BackdropProps","children","closeAfterTransition","container","disableAutoFocus","disableBackdropClick","disableEnforceFocus","disableEscapeKeyDown","disablePortal","disableRestoreFocus","disableScrollLock","hideBackdrop","keepMounted","manager","onBackdropClick","onClose","onEscapeKeyDown","onRendered","open"]),O=React.useState(!0),z=O[0],H=O[1],L=React.useRef({}),j=React.useRef(null),U=React.useRef(null),N=useForkRef(U,o),W=getHasTransition(t),q=function(){return ownerDocument(j.current)},V=function(){return L.current.modalRef=U.current,L.current.mountNode=j.current,L.current},G=function(){B.mount(V(),{disableScrollLock:v}),U.current.scrollTop=0},J=useEventCallback(function(){var e=getContainer(l)||q().body;B.add(V(),e),U.current&&G()}),Q=React.useCallback(function(){return B.isTopModal(V())},[B]),X=useEventCallback(function(e){j.current=e,e&&(K&&K(),_&&Q()?G():ariaHidden(U.current,!0))}),Y=React.useCallback(function(){B.remove(V())},[B]);if(React.useEffect(function(){return function(){Y()}},[Y]),React.useEffect(function(){_?J():W&&i||Y()},[_,Y,W,i,J]),!x&&!_&&(!W||z))return null;var Z=styles(r||{zIndex:zIndex}),$={};return void 0===c.props.tabIndex&&($.tabIndex=c.props.tabIndex||"-1"),W&&($.onEnter=createChainedFunction(function(){H(!1)},c.props.onEnter),$.onExited=createChainedFunction(function(){H(!0),i&&Y()},c.props.onExited)),React.createElement(Portal,{ref:X,container:l,disablePortal:h},React.createElement("div",_extends({ref:N,onKeyDown:function(e){"Escape"===e.key&&Q()&&(I&&I(e),k||(e.stopPropagation(),A&&A(e,"escapeKeyDown")))},role:"presentation"},S,{style:_extends({},Z.root,!_&&z?Z.hidden:{},S.style)}),F?null:React.createElement(a,_extends({open:_,onClick:function(e){e.target===e.currentTarget&&(D&&D(e),!f&&A&&A(e,"backdropClick"))}},p)),React.createElement(TrapFocus,{disableEnforceFocus:y,disableAutoFocus:u,disableRestoreFocus:C,getDoc:q,isEnabled:Q,open:_},React.cloneElement(c,$))))});"production"!==process.env.NODE_ENV&&(Modal.propTypes={BackdropComponent:PropTypes.elementType,BackdropProps:PropTypes.object,children:elementAcceptingRef.isRequired,closeAfterTransition:PropTypes.bool,container:PropTypes.oneOfType([HTMLElementType,PropTypes.instanceOf(React.Component),PropTypes.func]),disableAutoFocus:PropTypes.bool,disableBackdropClick:deprecatedPropType(PropTypes.bool,"Use the onClose prop with the `reason` argument to filter the `backdropClick` events."),disableEnforceFocus:PropTypes.bool,disableEscapeKeyDown:PropTypes.bool,disablePortal:PropTypes.bool,disableRestoreFocus:PropTypes.bool,disableScrollLock:PropTypes.bool,hideBackdrop:PropTypes.bool,keepMounted:PropTypes.bool,manager:PropTypes.object,onBackdropClick:deprecatedPropType(PropTypes.func,"Use the onClose prop with the `reason` argument to handle the `backdropClick` events."),onClose:PropTypes.func,onEscapeKeyDown:deprecatedPropType(PropTypes.func,"Use the onClose prop with the `reason` argument to handle the `escapeKeyDown` events."),onRendered:deprecatedPropType(PropTypes.func,"Use the ref instead."),open:PropTypes.bool.isRequired});export default Modal;