import _objectWithoutPropertiesLoose from"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose";import _extends from"@babel/runtime/helpers/esm/extends";import*as React from"react";import PropTypes from"prop-types";import clsx from"clsx";import{deepmerge}from"@material-ui/utils";import{unstable_composeClasses as composeClasses}from"@material-ui/unstyled";import experimentalStyled from"../styles/experimentalStyled";import useThemeProps from"../styles/useThemeProps";import Person from"../internal/svg-icons/Person";import avatarClasses,{getAvatarUtilityClass}from"./avatarClasses";const overridesResolver=(e,t)=>{const{styleProps:r}=e;return deepmerge(t.root||{},_extends({},t[r.variant],r.colorDefault&&t.colorDefault,{[`& .${avatarClasses.img}`]:t.img,[`& .${avatarClasses.fallback}`]:t.fallback}))},useUtilityClasses=e=>{const{classes:t,variant:r,colorDefault:s}=e;return composeClasses({root:["root",r,s&&"colorDefault"],img:["img"],fallback:["fallback"]},getAvatarUtilityClass,t)},AvatarRoot=experimentalStyled("div",{},{name:"MuiAvatar",slot:"Root",overridesResolver:overridesResolver})(({theme:e,styleProps:t})=>_extends({position:"relative",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:40,height:40,fontFamily:e.typography.fontFamily,fontSize:e.typography.pxToRem(20),lineHeight:1,borderRadius:"50%",overflow:"hidden",userSelect:"none"},"rounded"===t.variant&&{borderRadius:e.shape.borderRadius},"square"===t.variant&&{borderRadius:0},t.colorDefault&&{color:e.palette.background.default,backgroundColor:"light"===e.palette.mode?e.palette.grey[400]:e.palette.grey[600]})),AvatarImg=experimentalStyled("img",{},{name:"MuiAvatar",slot:"Img"})({width:"100%",height:"100%",textAlign:"center",objectFit:"cover",color:"transparent",textIndent:1e4}),AvatarFallback=experimentalStyled(Person,{},{name:"MuiAvatar",slot:"Fallback"})({width:"75%",height:"75%"});function useLoaded({src:e,srcSet:t}){const[r,s]=React.useState(!1);return React.useEffect(()=>{if(!e&&!t)return;s(!1);let r=!0;const o=new Image;return o.src=e,t&&(o.srcset=t),o.onload=(()=>{r&&s("loaded")}),o.onerror=(()=>{r&&s("error")}),()=>{r=!1}},[e,t]),r}const Avatar=React.forwardRef(function(e,t){const r=useThemeProps({props:e,name:"MuiAvatar"}),{alt:s,children:o,className:a,component:l="div",imgProps:i,sizes:n,src:c,srcSet:p,variant:m="circular"}=r,d=_objectWithoutPropertiesLoose(r,["alt","children","className","component","imgProps","sizes","src","srcSet","variant"]);let u=null;const y=useLoaded({src:c,srcSet:p}),f=c||p,v=f&&"error"!==y,g=_extends({},r,{colorDefault:!v,component:l,variant:m}),P=useUtilityClasses(g);return u=v?React.createElement(AvatarImg,_extends({alt:s,src:c,srcSet:p,sizes:n,styleProps:g,className:P.img},i)):null!=o?o:f&&s?s[0]:React.createElement(AvatarFallback,{className:P.fallback}),React.createElement(AvatarRoot,_extends({as:l,styleProps:g,className:clsx(P.root,a),ref:t},d),u)});"production"!==process.env.NODE_ENV&&(Avatar.propTypes={alt:PropTypes.string,children:PropTypes.node,classes:PropTypes.object,className:PropTypes.string,component:PropTypes.elementType,imgProps:PropTypes.object,sizes:PropTypes.string,src:PropTypes.string,srcSet:PropTypes.string,sx:PropTypes.object,variant:PropTypes.oneOfType([PropTypes.oneOf(["circular","rounded","square"]),PropTypes.string])});export default Avatar;