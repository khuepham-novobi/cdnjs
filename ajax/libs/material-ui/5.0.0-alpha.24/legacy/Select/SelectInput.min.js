import _extends from"@babel/runtime/helpers/esm/extends";import _slicedToArray from"@babel/runtime/helpers/esm/slicedToArray";import _objectWithoutProperties from"@babel/runtime/helpers/esm/objectWithoutProperties";import _typeof from"@babel/runtime/helpers/esm/typeof";import{formatMuiErrorMessage as _formatMuiErrorMessage}from"@material-ui/utils";import*as React from"react";import{isFragment}from"react-is";import PropTypes from"prop-types";import clsx from"clsx";import{refType}from"@material-ui/utils";import ownerDocument from"../utils/ownerDocument";import capitalize from"../utils/capitalize";import Menu from"../Menu/Menu";import{isFilled}from"../InputBase/utils";import useForkRef from"../utils/useForkRef";import useControlled from"../utils/useControlled";function areEqualValues(e,r){return"object"===_typeof(r)&&null!==r?e===r:String(e)===String(r)}function isEmpty(e){return null==e||"string"==typeof e&&!e.trim()}var SelectInput=React.forwardRef(function(e,r){var o=e["aria-describedby"],t=e["aria-label"],n=e.autoFocus,a=e.autoWidth,l=e.children,s=e.classes,i=e.className,p=e.defaultValue,u=e.disabled,c=e.displayEmpty,d=e.IconComponent,f=e.inputRef,m=e.labelId,y=e.MenuProps,v=void 0===y?{}:y,b=e.multiple,P=e.name,T=e.onBlur,h=e.onChange,E=e.onClose,R=e.onFocus,g=e.onOpen,x=e.open,C=e.readOnly,I=e.renderValue,M=e.SelectDisplayProps,_=void 0===M?{}:M,O=e.tabIndex,F=(e.type,e.value),w=e.variant,D=void 0===w?"standard":w,N=_objectWithoutProperties(e,["aria-describedby","aria-label","autoFocus","autoWidth","children","classes","className","defaultValue","disabled","displayEmpty","IconComponent","inputRef","labelId","MenuProps","multiple","name","onBlur","onChange","onClose","onFocus","onOpen","open","readOnly","renderValue","SelectDisplayProps","tabIndex","type","value","variant"]),S=useControlled({controlled:F,default:p,name:"Select"}),j=_slicedToArray(S,2),V=j[0],A=j[1],k=React.useRef(null),W=React.useRef(null),B=React.useState(null),U=B[0],L=B[1],q=React.useRef(null!=x).current,K=React.useState(),z=K[0],H=K[1],Y=React.useState(!1),G=Y[0],J=Y[1],Q=useForkRef(r,f),X=React.useCallback(function(e){W.current=e,e&&L(e)},[]);React.useImperativeHandle(Q,function(){return{focus:function(){W.current.focus()},node:k.current,value:V}},[V]),React.useEffect(function(){n&&W.current.focus()},[n]),React.useEffect(function(){var e=ownerDocument(W.current).getElementById(m);if(e){var r=function(){getSelection().isCollapsed&&W.current.focus()};return e.addEventListener("click",r),function(){e.removeEventListener("click",r)}}},[m]);var Z,$,ee=function(e,r){e?g&&g(r):E&&E(r),q||(H(a?null:U.clientWidth),J(e))},re=React.Children.toArray(l),oe=null!==U&&(q?x:G);delete N["aria-invalid"];var te=[],ne=!1,ae=!1;(isFilled({value:V})||c)&&(I?Z=I(V):ne=!0);var le=re.map(function(e){if(!React.isValidElement(e))return null;var r;if("production"!==process.env.NODE_ENV&&isFragment(e)&&console.error(["Material-UI: The Select component doesn't accept a Fragment as a child.","Consider providing an array instead."].join("\n")),b){if(!Array.isArray(V))throw new Error("production"!==process.env.NODE_ENV?"Material-UI: The `value` prop must be an array when using the `Select` component with `multiple`.":_formatMuiErrorMessage(2));(r=V.some(function(r){return areEqualValues(r,e.props.value)}))&&ne&&te.push(e.props.children)}else(r=areEqualValues(V,e.props.value))&&ne&&($=e.props.children);return r&&(ae=!0),React.cloneElement(e,{"aria-selected":r?"true":void 0,onClick:function(e){return function(r){var o;if(b){o=Array.isArray(V)?V.slice():[];var t=V.indexOf(e.props.value);-1===t?o.push(e.props.value):o.splice(t,1)}else o=e.props.value;e.props.onClick&&e.props.onClick(r),V!==o&&(A(o),h&&(r.persist(),Object.defineProperty(r,"target",{writable:!0,value:{value:o,name:P}}),h(r,e))),b||ee(!1,r)}}(e),onKeyUp:function(r){" "===r.key&&r.preventDefault(),e.props.onKeyUp&&e.props.onKeyUp(r)},role:"option",selected:r,value:void 0,"data-value":e.props.value})});"production"!==process.env.NODE_ENV&&React.useEffect(function(){if(!ae&&!b&&""!==V){var e=re.map(function(e){return e.props.value});console.warn(["Material-UI: You have provided an out-of-range value `".concat(V,"` for the select ").concat(P?'(name="'.concat(P,'") '):"","component."),"Consider providing a value that matches one of the available options or ''.","The available values are ".concat(e.filter(function(e){return null!=e}).map(function(e){return"`".concat(e,"`")}).join(", ")||'""',".")].join("\n"))}},[ae,re,b,P,V]),ne&&(Z=b?te.join(", "):$);var se,ie=z;!a&&q&&U&&(ie=U.clientWidth),se=void 0!==O?O:u?null:0;var pe=_.id||(P?"mui-component-select-".concat(P):void 0);return React.createElement(React.Fragment,null,React.createElement("div",_extends({ref:X,tabIndex:se,role:"button","aria-disabled":u?"true":void 0,"aria-expanded":oe?"true":void 0,"aria-haspopup":"listbox","aria-label":t,"aria-labelledby":[m,pe].filter(Boolean).join(" ")||void 0,"aria-describedby":o,onKeyDown:function(e){C||-1!==[" ","ArrowUp","ArrowDown","Enter"].indexOf(e.key)&&(e.preventDefault(),ee(!0,e))},onMouseDown:u||C?null:function(e){0===e.button&&(e.preventDefault(),W.current.focus(),ee(!0,e))},onBlur:function(e){!oe&&T&&(e.persist(),Object.defineProperty(e,"target",{writable:!0,value:{value:V,name:P}}),T(e))},onFocus:R},_,{className:clsx(s.root,s.select,s.selectMenu,s[D],i,_.className,u&&s.disabled),id:pe}),isEmpty(Z)?React.createElement("span",{className:"notranslate",dangerouslySetInnerHTML:{__html:"&#8203;"}}):Z),React.createElement("input",_extends({value:Array.isArray(V)?V.join(","):V,name:P,ref:k,"aria-hidden":!0,onChange:function(e){var r=re.map(function(e){return e.props.value}).indexOf(e.target.value);if(-1!==r){var o=re[r];A(o.props.value),h&&h(e,o)}},tabIndex:-1,disabled:u,className:s.nativeInput,autoFocus:n},N)),React.createElement(d,{className:clsx(s.icon,s["icon".concat(capitalize(D))],oe&&s.iconOpen,u&&s.disabled)}),React.createElement(Menu,_extends({id:"menu-".concat(P||""),anchorEl:U,open:oe,onClose:function(e){ee(!1,e)}},v,{MenuListProps:_extends({"aria-labelledby":m,role:"listbox",disableListWrap:!0},v.MenuListProps),PaperProps:_extends({},v.PaperProps,{style:_extends({minWidth:ie},null!=v.PaperProps?v.PaperProps.style:null)})}),le))});"production"!==process.env.NODE_ENV&&(SelectInput.propTypes={"aria-describedby":PropTypes.string,"aria-label":PropTypes.string,autoFocus:PropTypes.bool,autoWidth:PropTypes.bool,children:PropTypes.node,classes:PropTypes.object.isRequired,className:PropTypes.string,defaultValue:PropTypes.any,disabled:PropTypes.bool,displayEmpty:PropTypes.bool,IconComponent:PropTypes.elementType.isRequired,inputRef:refType,labelId:PropTypes.string,MenuProps:PropTypes.object,multiple:PropTypes.bool,name:PropTypes.string,onBlur:PropTypes.func,onChange:PropTypes.func,onClose:PropTypes.func,onFocus:PropTypes.func,onOpen:PropTypes.func,open:PropTypes.bool,readOnly:PropTypes.bool,renderValue:PropTypes.func,SelectDisplayProps:PropTypes.object,tabIndex:PropTypes.oneOfType([PropTypes.number,PropTypes.string]),type:PropTypes.any,value:PropTypes.any,variant:PropTypes.oneOf(["standard","outlined","filled"])});export default SelectInput;