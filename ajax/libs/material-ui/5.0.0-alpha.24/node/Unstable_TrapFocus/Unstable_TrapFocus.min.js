"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:!0}),exports.defaultGetTabbable=defaultGetTabbable,exports.default=void 0;var React=_interopRequireWildcard(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),_utils=require("@material-ui/utils"),_ownerDocument=_interopRequireDefault(require("../utils/ownerDocument")),_useForkRef=_interopRequireDefault(require("../utils/useForkRef"));const candidatesSelector=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'].join(",");function getTabIndex(e){const t=parseInt(e.getAttribute("tabindex"),10);return Number.isNaN(t)?"true"===e.contentEditable||("AUDIO"===e.nodeName||"VIDEO"===e.nodeName||"DETAILS"===e.nodeName)&&null===e.getAttribute("tabindex")?0:e.tabIndex:t}function isNonTabbableRadio(e){if("INPUT"!==e.tagName||"radio"!==e.type)return!1;if(!e.name)return!1;const t=t=>e.ownerDocument.querySelector(`input[type="radio"]${t}`);let r=t(`[name="${e.name}"]:checked`);return r||(r=t(`[name="${e.name}"]`)),r!==e}function isNodeMatchingSelectorFocusable(e){return!(e.disabled||"INPUT"===e.tagName&&"hidden"===e.type||isNonTabbableRadio(e))}function defaultGetTabbable(e){const t=[],r=[];return Array.from(e.querySelectorAll(candidatesSelector)).forEach((e,n)=>{const u=getTabIndex(e);-1!==u&&isNodeMatchingSelectorFocusable(e)&&(0===u?t.push(e):r.push({documentOrder:n,tabIndex:u,node:e}))}),r.sort((e,t)=>e.tabIndex===t.tabIndex?e.documentOrder-t.documentOrder:e.tabIndex-t.tabIndex).map(e=>e.node).concat(t)}function Unstable_TrapFocus(e){const{children:t,disableAutoFocus:r=!1,disableEnforceFocus:n=!1,disableRestoreFocus:u=!1,getDoc:o,getTabbable:a=defaultGetTabbable,isEnabled:c,open:s}=e,l=React.useRef(),i=React.useRef(null),d=React.useRef(null),f=React.useRef(),p=React.useRef(null),b=React.useRef(!1),R=React.useRef(null),m=(0,_useForkRef.default)(t.ref,R),E=React.useRef(null),T=React.useRef();React.useEffect(()=>{T.current=s},[s]),T.current||!s||"undefined"==typeof window||r||(f.current=o().activeElement),React.useEffect(()=>{s&&R.current&&(b.current=!r)},[r,s]),React.useEffect(()=>{if(!s||!R.current)return;const e=(0,_ownerDocument.default)(R.current);return R.current.contains(e.activeElement)||(R.current.hasAttribute("tabIndex")||("production"!==process.env.NODE_ENV&&console.error(["Material-UI: The modal content node does not accept focus.",'For the benefit of assistive technologies, the tabIndex of the node is being set to "-1".'].join("\n")),R.current.setAttribute("tabIndex",-1)),b.current&&R.current.focus()),()=>{u||(f.current&&f.current.focus&&(l.current=!0,f.current.focus()),f.current=null)}},[s]),React.useEffect(()=>{if(!s||!R.current)return;const e=(0,_ownerDocument.default)(R.current),t=t=>{const{current:r}=R;if(null!==r)if(e.hasFocus()&&!n&&c()&&!l.current){if(!r.contains(e.activeElement)){if(t&&p.current!==t.target||e.activeElement!==p.current)p.current=null;else if(null!==p.current)return;if(!b.current)return;let n=[];if(e.activeElement!==i.current&&e.activeElement!==d.current||(n=a(R.current)),n.length>0){var u,o;const e=Boolean((null===(u=E.current)||void 0===u?void 0:u.shiftKey)&&"Tab"===(null===(o=E.current)||void 0===o?void 0:o.key)),t=n[0],r=n[n.length-1];e?r.focus():t.focus()}else r.focus()}}else l.current=!1},r=t=>{E.current=t,!n&&c()&&"Tab"===t.key&&e.activeElement===R.current&&t.shiftKey&&(l.current=!0,d.current.focus())};e.addEventListener("focusin",t),e.addEventListener("keydown",r,!0);const u=setInterval(()=>{"BODY"===e.activeElement.tagName&&t()},50);return()=>{clearInterval(u),e.removeEventListener("focusin",t),e.removeEventListener("keydown",r,!0)}},[r,n,u,c,s,a]);const _=e=>{b.current||(f.current=e.relatedTarget),b.current=!0};return React.createElement(React.Fragment,null,React.createElement("div",{tabIndex:0,onFocus:_,ref:i,"data-test":"sentinelStart"}),React.cloneElement(t,{ref:m,onFocus:e=>{b.current||(f.current=e.relatedTarget),b.current=!0,p.current=e.target;const r=t.props.onFocus;r&&r(e)}}),React.createElement("div",{tabIndex:0,onFocus:_,ref:d,"data-test":"sentinelEnd"}))}"production"!==process.env.NODE_ENV&&(Unstable_TrapFocus.propTypes={children:_utils.elementAcceptingRef,disableAutoFocus:_propTypes.default.bool,disableEnforceFocus:_propTypes.default.bool,disableRestoreFocus:_propTypes.default.bool,getDoc:_propTypes.default.func.isRequired,getTabbable:_propTypes.default.func,isEnabled:_propTypes.default.func.isRequired,open:_propTypes.default.bool.isRequired}),"production"!==process.env.NODE_ENV&&(Unstable_TrapFocus.propTypes=(0,_utils.exactProp)(Unstable_TrapFocus.propTypes));var _default=Unstable_TrapFocus;exports.default=_default;