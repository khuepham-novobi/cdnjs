"use strict";var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard"),_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_objectWithoutPropertiesLoose2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutPropertiesLoose")),React=_interopRequireWildcard(require("react")),_reactIs=require("react-is"),_propTypes=_interopRequireDefault(require("prop-types")),_ownerDocument=_interopRequireDefault(require("../utils/ownerDocument")),_List=_interopRequireDefault(require("../List")),_getScrollbarSize=_interopRequireDefault(require("../utils/getScrollbarSize")),_useForkRef=_interopRequireDefault(require("../utils/useForkRef")),_useEnhancedEffect=_interopRequireDefault(require("../utils/useEnhancedEffect"));function nextItem(e,t,r){return e===t?e.firstChild:t&&t.nextElementSibling?t.nextElementSibling:r?null:e.firstChild}function previousItem(e,t,r){return e===t?r?e.firstChild:e.lastChild:t&&t.previousElementSibling?t.previousElementSibling:r?null:e.lastChild}function textCriteriaMatches(e,t){if(void 0===t)return!0;let r=e.innerText;return void 0===r&&(r=e.textContent),0!==(r=r.trim().toLowerCase()).length&&(t.repeating?r[0]===t.keys[0]:0===r.indexOf(t.keys.join("")))}function moveFocus(e,t,r,i,n,o){let u=!1,s=n(e,t,!!t&&r);for(;s;){if(s===e.firstChild){if(u)return;u=!0}const t=!i&&(s.disabled||"true"===s.getAttribute("aria-disabled"));if(s.hasAttribute("tabindex")&&textCriteriaMatches(s,o)&&!t)return void s.focus();s=n(e,s,r)}}const MenuList=React.forwardRef(function(e,t){const{actions:r,autoFocus:i=!1,autoFocusItem:n=!1,children:o,className:u,disabledItemsFocusable:s=!1,disableListWrap:a=!1,onKeyDown:l,variant:c="selectedMenu"}=e,p=(0,_objectWithoutPropertiesLoose2.default)(e,["actions","autoFocus","autoFocusItem","children","className","disabledItemsFocusable","disableListWrap","onKeyDown","variant"]),d=React.useRef(null),f=React.useRef({keys:[],repeating:!0,previousKeyMatched:!0,lastTime:null});(0,_useEnhancedEffect.default)(()=>{i&&d.current.focus()},[i]),React.useImperativeHandle(r,()=>({adjustStyleForScrollbar:(e,t)=>{const r=!d.current.style.width;if(e.clientHeight<d.current.clientHeight&&r){const r=`${(0,_getScrollbarSize.default)((0,_ownerDocument.default)(e))}px`;d.current.style["rtl"===t.direction?"paddingLeft":"paddingRight"]=r,d.current.style.width=`calc(100% + ${r})`}return d.current}}),[]);const m=(0,_useForkRef.default)(d,t);let _=-1;React.Children.forEach(o,(e,t)=>{React.isValidElement(e)&&("production"!==process.env.NODE_ENV&&(0,_reactIs.isFragment)(e)&&console.error(["Material-UI: The Menu component doesn't accept a Fragment as a child.","Consider providing an array instead."].join("\n")),e.props.disabled||("selectedMenu"===c&&e.props.selected?_=t:-1===_&&(_=t)))});const b=React.Children.map(o,(e,t)=>{if(t===_){const t={};return n&&(t.autoFocus=!0),void 0===e.props.tabIndex&&"selectedMenu"===c&&(t.tabIndex=0),React.cloneElement(e,t)}return e});return React.createElement(_List.default,(0,_extends2.default)({role:"menu",ref:m,className:u,onKeyDown:e=>{const t=d.current,r=e.key,i=(0,_ownerDocument.default)(t).activeElement;if("ArrowDown"===r)e.preventDefault(),moveFocus(t,i,a,s,nextItem);else if("ArrowUp"===r)e.preventDefault(),moveFocus(t,i,a,s,previousItem);else if("Home"===r)e.preventDefault(),moveFocus(t,null,a,s,nextItem);else if("End"===r)e.preventDefault(),moveFocus(t,null,a,s,previousItem);else if(1===r.length){const n=f.current,o=r.toLowerCase(),u=performance.now();n.keys.length>0&&(u-n.lastTime>500?(n.keys=[],n.repeating=!0,n.previousKeyMatched=!0):n.repeating&&o!==n.keys[0]&&(n.repeating=!1)),n.lastTime=u,n.keys.push(o);const a=i&&!n.repeating&&textCriteriaMatches(i,n);n.previousKeyMatched&&(a||moveFocus(t,i,!1,s,nextItem,n))?e.preventDefault():n.previousKeyMatched=!1}l&&l(e)},tabIndex:i?0:-1},p),b)});"production"!==process.env.NODE_ENV&&(MenuList.propTypes={autoFocus:_propTypes.default.bool,autoFocusItem:_propTypes.default.bool,children:_propTypes.default.node,className:_propTypes.default.string,disabledItemsFocusable:_propTypes.default.bool,disableListWrap:_propTypes.default.bool,onKeyDown:_propTypes.default.func,variant:_propTypes.default.oneOf(["menu","selectedMenu"])});var _default=MenuList;exports.default=_default;