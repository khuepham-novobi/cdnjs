import _extends from"@babel/runtime/helpers/esm/extends";import _slicedToArray from"@babel/runtime/helpers/esm/slicedToArray";import _typeof from"@babel/runtime/helpers/esm/typeof";import*as React from"react";import{setRef,useEventCallback,useControlled,unstable_useId as useId}from"../utils";function stripDiacritics(e){return void 0!==e.normalize?e.normalize("NFD").replace(/[\u0300-\u036f]/g,""):e}export function createFilterOptions(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.ignoreAccents,n=void 0===t||t,r=e.ignoreCase,o=void 0===r||r,i=e.limit,a=e.matchFrom,u=void 0===a?"any":a,c=e.stringify,l=e.trim,s=void 0!==l&&l;return function(e,t){var r=t.inputValue,a=t.getOptionLabel,l=s?r.trim():r;o&&(l=l.toLowerCase()),n&&(l=stripDiacritics(l));var f=e.filter(function(e){var t=(c||a)(e);return o&&(t=t.toLowerCase()),n&&(t=stripDiacritics(t)),"start"===u?0===t.indexOf(l):t.indexOf(l)>-1});return"number"==typeof i?f.slice(0,i):f}};function findIndex(e,t){for(var n=0;n<e.length;n+=1)if(t(e[n]))return n;return-1}var defaultFilterOptions=createFilterOptions(),pageSize=5;export default function useAutocomplete(e){var t=e.autoComplete,n=void 0!==t&&t,r=e.autoHighlight,o=void 0!==r&&r,i=e.autoSelect,a=void 0!==i&&i,u=e.blurOnSelect,c=void 0!==u&&u,l=e.clearOnBlur,s=void 0===l?!e.freeSolo:l,f=e.clearOnEscape,d=void 0!==f&&f,p=e.componentName,v=void 0===p?"useAutocomplete":p,g=e.debug,h=void 0!==g&&g,b=e.defaultValue,m=void 0===b?e.multiple?[]:null:b,x=e.disableClearable,y=void 0!==x&&x,O=e.disableCloseOnSelect,k=void 0!==O&&O,S=e.disabledItemsFocusable,C=void 0!==S&&S,D=e.disableListWrap,A=void 0!==D&&D,E=e.filterOptions,R=void 0===E?defaultFilterOptions:E,w=e.filterSelectedOptions,I=void 0!==w&&w,T=e.freeSolo,N=void 0!==T&&T,L=e.getOptionDisabled,P=e.getOptionLabel,_=void 0===P?function(e){var t;return null!==(t=e.label)&&void 0!==t?t:e}:P,F=e.getOptionSelected,H=void 0===F?function(e,t){return e===t}:F,M=e.groupBy,V=e.handleHomeEndKeys,q=void 0===V?!e.freeSolo:V,z=e.id,B=e.includeInputInList,K=void 0!==B&&B,U=e.inputValue,J=e.multiple,j=void 0!==J&&J,Y=e.onChange,W=e.onClose,G=e.onHighlightChange,Q=e.onInputChange,X=e.onOpen,Z=e.open,$=e.openOnFocus,ee=void 0!==$&&$,te=e.options,ne=e.selectOnFocus,re=void 0===ne?!e.freeSolo:ne,oe=e.value,ie=useId(z),ae=_;"production"!==process.env.NODE_ENV&&(ae=function(e){var t=_(e);if("string"!=typeof t){var n=void 0===t?"undefined":"".concat(_typeof(t)," (").concat(t,")");console.error("Material-UI: The `getOptionLabel` method of ".concat(v," returned ").concat(n," instead of a string for ").concat(JSON.stringify(e),"."))}return t});var ue=React.useRef(!1),ce=React.useRef(!0),le=React.useRef(null),se=React.useRef(null),fe=React.useState(null),de=fe[0],pe=fe[1],ve=React.useState(-1),ge=ve[0],he=ve[1],be=o?0:-1,me=React.useRef(be),xe=useControlled({controlled:oe,default:m,name:v}),ye=_slicedToArray(xe,2),Oe=ye[0],ke=ye[1],Se=useControlled({controlled:U,default:"",name:v,state:"inputValue"}),Ce=_slicedToArray(Se,2),De=Ce[0],Ae=Ce[1],Ee=React.useState(!1),Re=Ee[0],we=Ee[1],Ie=useEventCallback(function(e,t){var n;if(j)n="";else if(null==t)n="";else{var r=ae(t);n="string"==typeof r?r:""}De!==n&&(Ae(n),Q&&Q(e,n,"reset"))});React.useEffect(function(){Ie(null,Oe)},[Oe,Ie]);var Te=useControlled({controlled:Z,default:!1,name:v,state:"open"}),Ne=_slicedToArray(Te,2),Le=Ne[0],Pe=Ne[1],_e=React.useState(!0),Fe=_e[0],He=_e[1],Me=!j&&null!=Oe&&De===ae(Oe),Ve=Le,qe=Ve?R(te.filter(function(e){return!I||!(j?Oe:[Oe]).some(function(t){return null!==t&&H(e,t)})}),{inputValue:Me&&Fe?"":De,getOptionLabel:ae}):[],ze=Le&&qe.length>0;if("production"!==process.env.NODE_ENV&&null!==Oe&&!N&&te.length>0){var Be=(j?Oe:[Oe]).filter(function(e){return!te.some(function(t){return H(t,e)})});Be.length>0&&console.warn(["Material-UI: The value provided to ".concat(v," is invalid."),"None of the options match with `".concat(Be.length>1?JSON.stringify(Be):JSON.stringify(Be[0]),"`."),"You can use the `getOptionSelected` prop to customize the equality test."].join("\n"))}var Ke=useEventCallback(function(e){-1===e?le.current.focus():de.querySelector('[data-tag-index="'.concat(e,'"]')).focus()});React.useEffect(function(){j&&ge>Oe.length-1&&(he(-1),Ke(-1))},[Oe,j,ge,Ke]);var Ue=useEventCallback(function(e){var t=e.event,n=e.index,r=e.reason,o=void 0===r?"auto":r;if(me.current=n,-1===n?le.current.removeAttribute("aria-activedescendant"):le.current.setAttribute("aria-activedescendant","".concat(ie,"-option-").concat(n)),G&&G(t,-1===n?null:qe[n],o),se.current){var i=se.current.querySelector("[data-focus]");i&&i.removeAttribute("data-focus");var a=se.current.parentElement.querySelector('[role="listbox"]');if(a)if(-1!==n){var u=se.current.querySelector('[data-option-index="'.concat(n,'"]'));if(u&&(u.setAttribute("data-focus","true"),a.scrollHeight>a.clientHeight&&"mouse"!==o)){var c=u,l=a.clientHeight+a.scrollTop,s=c.offsetTop+c.offsetHeight;s>l?a.scrollTop=s-a.clientHeight:c.offsetTop-c.offsetHeight*(M?1.3:0)<a.scrollTop&&(a.scrollTop=c.offsetTop-c.offsetHeight*(M?1.3:0))}}else a.scrollTop=0}}),Je=useEventCallback(function(e){var t=e.event,r=e.diff,o=e.direction,i=void 0===o?"next":o,a=e.reason,u=void 0===a?"auto":a;if(Ve){var c=function(e,t){if(!se.current||-1===e)return-1;for(var n=e;;){if("next"===t&&n===qe.length||"previous"===t&&-1===n)return-1;var r=se.current.querySelector('[data-option-index="'.concat(n,'"]')),o=!C&&(!r||r.disabled||"true"===r.getAttribute("aria-disabled"));if(!(r&&!r.hasAttribute("tabindex")||o))return n;n+="next"===t?1:-1}}(function(){var e=qe.length-1;if("reset"===r)return be;if("start"===r)return 0;if("end"===r)return e;var t=me.current+r;return t<0?-1===t&&K?-1:A&&-1!==me.current||Math.abs(r)>1?0:e:t>e?t===e+1&&K?-1:A||Math.abs(r)>1?e:0:t}(),i);if(Ue({index:c,reason:u,event:t}),n&&"reset"!==r)if(-1===c)le.current.value=De;else{var l=ae(qe[c]);le.current.value=l,0===l.toLowerCase().indexOf(De.toLowerCase())&&De.length>0&&le.current.setSelectionRange(De.length,l.length)}}}),je=React.useCallback(function(){if(Ve){var e=j?Oe[0]:Oe;if(0!==qe.length&&null!=e){if(se.current)if(I||null==e)me.current>=qe.length-1?Ue({index:qe.length-1}):Ue({index:me.current});else{var t=qe[me.current];if(j&&t&&-1!==findIndex(Oe,function(e){return H(t,e)}))return;var n=findIndex(qe,function(t){return H(t,e)});-1===n?Je({diff:"reset"}):Ue({index:n})}}else Je({diff:"reset"})}},[0===qe.length,!j&&Oe,I,Je,Ue,Ve,De,j]),Ye=useEventCallback(function(e){setRef(se,e),e&&je()});React.useEffect(function(){je()},[je]);var We=function(e){Le||(Pe(!0),He(!0),X&&X(e))},Ge=function(e,t){Le&&(Pe(!1),W&&W(e,t))},Qe=function(e,t,n,r){Oe!==t&&(Y&&Y(e,t,n,r),ke(t))},Xe=React.useRef(!1),Ze=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"select-option",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"options",o=n,i=t;if(j){if(i=Array.isArray(Oe)?Oe.slice():[],"production"!==process.env.NODE_ENV){var a=i.filter(function(e){return H(t,e)});a.length>1&&console.error(["Material-UI: The `getOptionSelected` method of ".concat(v," do not handle the arguments correctly."),"The component expects a single value to match a given option but found ".concat(a.length," matches.")].join("\n"))}var u=findIndex(i,function(e){return H(t,e)});-1===u?i.push(t):"freeSolo"!==r&&(i.splice(u,1),o="remove-option")}Ie(e,i),Qe(e,i,o,{option:t}),k||e.ctrlKey||e.metaKey||Ge(e,o),(!0===c||"touch"===c&&Xe.current||"mouse"===c&&!Xe.current)&&le.current.blur()};var $e=function(e,t){if(j){Ge(e,"toggleInput");var n=ge;-1===ge?""===De&&"previous"===t&&(n=Oe.length-1):((n+="next"===t?1:-1)<0&&(n=0),n===Oe.length&&(n=-1)),n=function(e,t){if(-1===e)return-1;for(var n=e;;){if("next"===t&&n===Oe.length||"previous"===t&&-1===n)return-1;var r=de.querySelector('[data-tag-index="'.concat(n,'"]'));if(r&&r.hasAttribute("tabindex")&&!r.disabled&&"true"!==r.getAttribute("aria-disabled"))return n;n+="next"===t?1:-1}}(n,t),he(n),Ke(n)}},et=function(e){ue.current=!0,Ae(""),Q&&Q(e,"","clear"),Qe(e,j?[]:null,"clear")},tt=function(e){we(!0),ee&&!ue.current&&We(e)},nt=function(e){null!==se.current&&se.current.parentElement.contains(document.activeElement)?le.current.focus():(we(!1),ce.current=!0,ue.current=!1,h&&""!==De||(a&&-1!==me.current&&Ve?Ze(e,qe[me.current],"blur"):a&&N&&""!==De?Ze(e,De,"blur","freeSolo"):s&&Ie(e,Oe),Ge(e,"blur")))},rt=function(e){var t=e.target.value;De!==t&&(Ae(t),He(!1),Q&&Q(e,t,"input")),""===t?y||j||Qe(e,null,"clear"):We(e)},ot=function(e){Ue({event:e,index:Number(e.currentTarget.getAttribute("data-option-index")),reason:"mouse"})},it=function(){Xe.current=!0},at=function(e){var t=Number(e.currentTarget.getAttribute("data-option-index"));Ze(e,qe[t],"select-option"),Xe.current=!1},ut=function(e){Le?Ge(e,"toggleInput"):We(e)},ct=function(e){e.target.getAttribute("id")!==ie&&e.preventDefault()},lt=function(){le.current.focus(),re&&ce.current&&le.current.selectionEnd-le.current.selectionStart==0&&le.current.select(),ce.current=!1},st=function(e){""!==De&&Le||ut(e)},ft=N&&De.length>0;ft=ft||(j?Oe.length>0:null!==Oe);var dt=qe;if(M){var pt=new Map,vt=!1;dt=qe.reduce(function(e,t,n){var r=M(t);return e.length>0&&e[e.length-1].group===r?e[e.length-1].options.push(t):("production"!==process.env.NODE_ENV&&(pt.get(r)&&!vt&&(console.warn("Material-UI: The options provided combined with the `groupBy` method of ".concat(v," returns duplicated headers."),"You can solve the issue by sorting the options with the output of `groupBy`."),vt=!0),pt.set(r,!0)),e.push({key:n,index:n,group:r,options:[t]})),e},[])}return{getRootProps:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _extends({"aria-owns":ze?"".concat(ie,"-listbox"):null,role:"combobox","aria-expanded":ze},e,{onKeyDown:function(e){return function(t){switch(-1!==ge&&-1===["ArrowLeft","ArrowRight"].indexOf(t.key)&&(he(-1),Ke(-1)),t.key){case"Home":Ve&&q&&(t.preventDefault(),Je({diff:"start",direction:"next",reason:"keyboard",event:t}));break;case"End":Ve&&q&&(t.preventDefault(),Je({diff:"end",direction:"previous",reason:"keyboard",event:t}));break;case"PageUp":t.preventDefault(),Je({diff:-pageSize,direction:"previous",reason:"keyboard",event:t}),We(t);break;case"PageDown":t.preventDefault(),Je({diff:pageSize,direction:"next",reason:"keyboard",event:t}),We(t);break;case"ArrowDown":t.preventDefault(),Je({diff:1,direction:"next",reason:"keyboard",event:t}),We(t);break;case"ArrowUp":t.preventDefault(),Je({diff:-1,direction:"previous",reason:"keyboard",event:t}),We(t);break;case"ArrowLeft":$e(t,"previous");break;case"ArrowRight":$e(t,"next");break;case"Enter":if(229===t.which)break;if(-1!==me.current&&Ve){var r=qe[me.current],o=!!L&&L(r);if(t.preventDefault(),o)return;Ze(t,r,"select-option"),n&&le.current.setSelectionRange(le.current.value.length,le.current.value.length)}else N&&""!==De&&!1===Me&&(j&&t.preventDefault(),Ze(t,De,"create-option","freeSolo"));break;case"Escape":Ve?(t.preventDefault(),t.stopPropagation(),Ge(t,"escape")):d&&(""!==De||j&&Oe.length>0)&&(t.preventDefault(),t.stopPropagation(),et(t));break;case"Backspace":if(j&&""===De&&Oe.length>0){var i=-1===ge?Oe.length-1:ge,a=Oe.slice();a.splice(i,1),Qe(t,a,"remove-option",{option:Oe[i]})}}e.onKeyDown&&e.onKeyDown(t)}}(e),onMouseDown:ct,onClick:lt})},getInputLabelProps:function(){return{id:"".concat(ie,"-label"),htmlFor:ie}},getInputProps:function(){return{id:ie,value:De,onBlur:nt,onFocus:tt,onChange:rt,onMouseDown:st,"aria-activedescendant":Ve?"":null,"aria-autocomplete":n?"both":"list","aria-controls":ze?"".concat(ie,"-listbox"):null,autoComplete:"off",ref:le,autoCapitalize:"none",spellCheck:"false"}},getClearProps:function(){return{tabIndex:-1,onClick:et}},getPopupIndicatorProps:function(){return{tabIndex:-1,onClick:ut}},getTagProps:function(e){var t=e.index;return{key:t,"data-tag-index":t,tabIndex:-1,onDelete:function(e){return function(t){var n=Oe.slice();n.splice(e,1),Qe(t,n,"remove-option",{option:Oe[e]})}}(t)}},getListboxProps:function(){return{role:"listbox",id:"".concat(ie,"-listbox"),"aria-labelledby":"".concat(ie,"-label"),ref:Ye,onMouseDown:function(e){e.preventDefault()}}},getOptionProps:function(e){var t=e.index,n=e.option,r=(j?Oe:[Oe]).some(function(e){return null!=e&&H(n,e)}),o=!!L&&L(n);return{key:t,tabIndex:-1,role:"option",id:"".concat(ie,"-option-").concat(t),onMouseOver:ot,onClick:at,onTouchStart:it,"data-option-index":t,"aria-disabled":o,"aria-selected":r}},id:ie,inputValue:De,value:Oe,dirty:ft,popupOpen:Ve,focused:Re||-1!==ge,anchorEl:de,setAnchorEl:pe,focusedTag:ge,groupedOptions:dt}};