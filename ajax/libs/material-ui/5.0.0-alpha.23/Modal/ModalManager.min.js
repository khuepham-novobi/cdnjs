import getScrollbarSize from"../utils/getScrollbarSize";import ownerDocument from"../utils/ownerDocument";import ownerWindow from"../utils/ownerWindow";function isOverflowing(e){const n=ownerDocument(e);return n.body===e?ownerWindow(e).innerWidth>n.documentElement.clientWidth:e.scrollHeight>e.clientHeight}export function ariaHidden(e,n){n?e.setAttribute("aria-hidden","true"):e.removeAttribute("aria-hidden")};function getPaddingRight(e){return parseInt(ownerWindow(e).getComputedStyle(e).paddingRight,10)||0}function ariaHiddenSiblings(e,n,t,i=[],o){const r=[n,t,...i],d=["TEMPLATE","SCRIPT","STYLE"];[].forEach.call(e.children,e=>{-1===r.indexOf(e)&&-1===d.indexOf(e.tagName)&&ariaHidden(e,o)})}function findIndexOf(e,n){let t=-1;return e.some((e,i)=>!!n(e)&&(t=i,!0)),t}function handleContainer(e,n){const t=[],i=e.container;if(!n.disableScrollLock){if(isOverflowing(i)){const e=getScrollbarSize(ownerDocument(i));t.push({value:i.style.paddingRight,property:"padding-right",el:i}),i.style.paddingRight=`${getPaddingRight(i)+e}px`;const n=ownerDocument(i).querySelectorAll(".mui-fixed");[].forEach.call(n,n=>{t.push({value:n.style.paddingRight,property:"padding-right",el:n}),n.style.paddingRight=`${getPaddingRight(n)+e}px`})}const e=i.parentElement,n=ownerWindow(i),o="HTML"===(null==e?void 0:e.nodeName)&&"scroll"===n.getComputedStyle(e).overflowY?e:i;t.push({value:o.style.overflow,property:"overflow",el:o}),o.style.overflow="hidden"}return()=>{t.forEach(({value:e,el:n,property:t})=>{e?n.style.setProperty(t,e):n.style.removeProperty(t)})}}function getHiddenSiblings(e){const n=[];return[].forEach.call(e.children,e=>{"true"===e.getAttribute("aria-hidden")&&n.push(e)}),n}export default class ModalManager{constructor(){this.containers=void 0,this.modals=void 0,this.modals=[],this.containers=[]}add(e,n){let t=this.modals.indexOf(e);if(-1!==t)return t;t=this.modals.length,this.modals.push(e),e.modalRef&&ariaHidden(e.modalRef,!1);const i=getHiddenSiblings(n);ariaHiddenSiblings(n,e.mount,e.modalRef,i,!0);const o=findIndexOf(this.containers,e=>e.container===n);return-1!==o?(this.containers[o].modals.push(e),t):(this.containers.push({modals:[e],container:n,restore:null,hiddenSiblings:i}),t)}mount(e,n){const t=findIndexOf(this.containers,n=>-1!==n.modals.indexOf(e)),i=this.containers[t];i.restore||(i.restore=handleContainer(i,n))}remove(e){const n=this.modals.indexOf(e);if(-1===n)return n;const t=findIndexOf(this.containers,n=>-1!==n.modals.indexOf(e)),i=this.containers[t];if(i.modals.splice(i.modals.indexOf(e),1),this.modals.splice(n,1),0===i.modals.length)i.restore&&i.restore(),e.modalRef&&ariaHidden(e.modalRef,!0),ariaHiddenSiblings(i.container,e.mount,e.modalRef,i.hiddenSiblings,!1),this.containers.splice(t,1);else{const e=i.modals[i.modals.length-1];e.modalRef&&ariaHidden(e.modalRef,!1)}return n}isTopModal(e){return this.modals.length>0&&this.modals[this.modals.length-1]===e}};