import _extends from"@babel/runtime/helpers/esm/extends";import _objectWithoutProperties from"@babel/runtime/helpers/esm/objectWithoutProperties";import*as React from"react";import PropTypes from"prop-types";import{createPopper}from"@popperjs/core";import{chainPropTypes,refType,HTMLElementType}from"@material-ui/utils";import{useTheme}from"@material-ui/styles";import Portal from"../Portal";import setRef from"../utils/setRef";import useForkRef from"../utils/useForkRef";import useEnhancedEffect from"../utils/useEnhancedEffect";function flipPlacement(e,t){if("ltr"===(t&&t.direction||"ltr"))return e;switch(e){case"bottom-end":return"bottom-start";case"bottom-start":return"bottom-end";case"top-end":return"top-start";case"top-start":return"top-end";default:return e}}function getAnchorEl(e){return"function"==typeof e?e():e}var defaultPopperOptions={},Popper=React.forwardRef(function(e,t){var o=e.anchorEl,r=e.children,n=e.container,p=e.disablePortal,a=void 0!==p&&p,i=e.keepMounted,s=void 0!==i&&i,c=e.modifiers,l=e.open,u=e.placement,f=void 0===u?"bottom":u,d=e.popperOptions,m=void 0===d?defaultPopperOptions:d,y=e.popperRef,h=e.style,T=e.transition,P=void 0!==T&&T,b=_objectWithoutProperties(e,["anchorEl","children","container","disablePortal","keepMounted","modifiers","open","placement","popperOptions","popperRef","style","transition"]),E=React.useRef(null),R=useForkRef(E,t),v=React.useRef(null),g=useForkRef(v,y),O=React.useRef(g);useEnhancedEffect(function(){O.current=g},[g]),React.useImperativeHandle(y,function(){return v.current},[]);var M=React.useState(!0),j=M[0],x=M[1],k=flipPlacement(f,useTheme()),_=React.useState(k),N=_[0],w=_[1];React.useEffect(function(){v.current&&v.current.forceUpdate()});var I=React.useCallback(function(){if(E.current&&o&&l){v.current&&(v.current.destroy(),O.current(null));var e=getAnchorEl(o);if("production"!==process.env.NODE_ENV&&e&&1===e.nodeType){var t=e.getBoundingClientRect();"test"!==process.env.NODE_ENV&&0===t.top&&0===t.left&&0===t.right&&0===t.bottom&&console.warn(["Material-UI: The `anchorEl` prop provided to the component is invalid.","The anchor element should be part of the document layout.","Make sure the element is present in the document or that it's not display none."].join("\n"))}var r=[{name:"preventOverflow",options:{altBoundary:a}},{name:"flip",options:{altBoundary:a}},{name:"onUpdate",enabled:!0,phase:"afterWrite",fn:function(e){var t=e.state;w(t.placement)}}];null!=c&&(r=r.concat(c)),m&&null!=m.modifiers&&(r=r.concat(m.modifiers));var n=createPopper(getAnchorEl(o),E.current,_extends({placement:k},m,{modifiers:r}));O.current(n)}},[o,a,c,l,k,m]),U=React.useCallback(function(e){setRef(R,e),I()},[R,I]),W=function(){v.current&&(v.current.destroy(),O.current(null))};if(React.useEffect(function(){return function(){W()}},[]),React.useEffect(function(){l||P||W()},[l,P]),!s&&!l&&(!P||j))return null;var B={placement:N};return P&&(B.TransitionProps={in:l,onEnter:function(){x(!1)},onExited:function(){x(!0),W()}}),React.createElement(Portal,{disablePortal:a,container:n},React.createElement("div",_extends({ref:U,role:"tooltip"},b,{style:_extends({position:"fixed",top:0,left:0,display:l||!s||P?null:"none"},h)}),"function"==typeof r?r(B):r))});"production"!==process.env.NODE_ENV&&(Popper.propTypes={anchorEl:chainPropTypes(PropTypes.oneOfType([HTMLElementType,PropTypes.object,PropTypes.func]),function(e){if(e.open){var t=getAnchorEl(e.anchorEl);if(t&&1===t.nodeType){var o=t.getBoundingClientRect();if("test"!==process.env.NODE_ENV&&0===o.top&&0===o.left&&0===o.right&&0===o.bottom)return new Error(["Material-UI: The `anchorEl` prop provided to the component is invalid.","The anchor element should be part of the document layout.","Make sure the element is present in the document or that it's not display none."].join("\n"))}else if(!t||"function"!=typeof t.getBoundingClientRect||null!=t.contextElement&&1!==t.contextElement.nodeType)return new Error(["Material-UI: The `anchorEl` prop provided to the component is invalid.","It should be an HTML element instance or a virtualElement ","(https://popper.js.org/docs/v2/virtual-elements/)."].join("\n"))}return null}),children:PropTypes.oneOfType([PropTypes.node,PropTypes.func]),container:PropTypes.oneOfType([HTMLElementType,PropTypes.func]),disablePortal:PropTypes.bool,keepMounted:PropTypes.bool,modifiers:PropTypes.arrayOf(PropTypes.shape({data:PropTypes.object,effect:PropTypes.func,enabled:PropTypes.bool,fn:PropTypes.func,name:PropTypes.any.isRequired,options:PropTypes.object,phase:PropTypes.oneOf(["afterMain","afterRead","afterWrite","beforeMain","beforeRead","beforeWrite","main","read","write"]),requires:PropTypes.arrayOf(PropTypes.string),requiresIfExists:PropTypes.arrayOf(PropTypes.string)})),open:PropTypes.bool.isRequired,placement:PropTypes.oneOf(["auto-end","auto-start","auto","bottom-end","bottom-start","bottom","left-end","left-start","left","right-end","right-start","right","top-end","top-start","top"]),popperOptions:PropTypes.shape({modifiers:PropTypes.array,onFirstUpdate:PropTypes.func,placement:PropTypes.oneOf(["auto-end","auto-start","auto","bottom-end","bottom-start","bottom","left-end","left-start","left","right-end","right-start","right","top-end","top-start","top"]),strategy:PropTypes.oneOf(["absolute","fixed"])}),popperRef:refType,style:PropTypes.object,transition:PropTypes.bool});export default Popper;