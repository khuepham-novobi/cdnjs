import _extends from"@babel/runtime/helpers/esm/extends";import _slicedToArray from"@babel/runtime/helpers/esm/slicedToArray";import _typeof from"@babel/runtime/helpers/esm/typeof";import*as React from"react";import{setRef,useEventCallback,useControlled,unstable_useId as useId}from"../utils";function stripDiacritics(e){return void 0!==e.normalize?e.normalize("NFD").replace(/[\u0300-\u036f]/g,""):e}export function createFilterOptions(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.ignoreAccents,n=void 0===t||t,r=e.ignoreCase,o=void 0===r||r,i=e.limit,a=e.matchFrom,u=void 0===a?"any":a,c=e.stringify,l=e.trim,s=void 0!==l&&l;return function(e,t){var r=t.inputValue,a=t.getOptionLabel,l=s?r.trim():r;o&&(l=l.toLowerCase()),n&&(l=stripDiacritics(l));var f=e.filter(function(e){var t=(c||a)(e);return o&&(t=t.toLowerCase()),n&&(t=stripDiacritics(t)),"start"===u?0===t.indexOf(l):t.indexOf(l)>-1});return"number"==typeof i?f.slice(0,i):f}};function findIndex(e,t){for(var n=0;n<e.length;n+=1)if(t(e[n]))return n;return-1}var defaultFilterOptions=createFilterOptions(),pageSize=5;export default function useAutocomplete(e){var t,n=e.autoComplete,r=void 0!==n&&n,o=e.autoHighlight,i=void 0!==o&&o,a=e.autoSelect,u=void 0!==a&&a,c=e.blurOnSelect,l=void 0!==c&&c,s=e.clearOnBlur,f=void 0===s?!e.freeSolo:s,d=e.clearOnEscape,p=void 0!==d&&d,v=e.componentName,g=void 0===v?"useAutocomplete":v,h=e.defaultValue,b=void 0===h?e.multiple?[]:null:h,m=e.disableClearable,x=void 0!==m&&m,y=e.disableCloseOnSelect,O=void 0!==y&&y,k=e.disabledItemsFocusable,S=void 0!==k&&k,C=e.disableListWrap,D=void 0!==C&&C,A=e.filterOptions,E=void 0===A?defaultFilterOptions:A,R=e.filterSelectedOptions,w=void 0!==R&&R,I=e.freeSolo,T=void 0!==I&&I,L=e.getOptionDisabled,N=e.getOptionLabel,M=void 0===N?function(e){var t;return null!==(t=e.label)&&void 0!==t?t:e}:N,P=e.getOptionSelected,_=void 0===P?function(e,t){return e===t}:P,V=e.groupBy,F=e.handleHomeEndKeys,H=void 0===F?!e.freeSolo:F,q=e.id,z=e.includeInputInList,B=void 0!==z&&z,K=e.inputValue,U=e.multiple,J=void 0!==U&&U,j=e.onChange,Y=e.onClose,W=e.onHighlightChange,G=e.onInputChange,Q=e.onOpen,X=e.open,Z=e.openOnFocus,$=void 0!==Z&&Z,ee=e.options,te=e.selectOnFocus,ne=void 0===te?!e.freeSolo:te,re=e.value,oe=useId(q);t=function(e){var t=M(e);if("string"!=typeof t){if("production"!==process.env.NODE_ENV){var n=void 0===t?"undefined":"".concat(_typeof(t)," (").concat(t,")");console.error("Material-UI: The `getOptionLabel` method of ".concat(g," returned ").concat(n," instead of a string for ").concat(JSON.stringify(e),"."))}return String(t)}return t};var ie=React.useRef(!1),ae=React.useRef(!0),ue=React.useRef(null),ce=React.useRef(null),le=React.useState(null),se=le[0],fe=le[1],de=React.useState(-1),pe=de[0],ve=de[1],ge=i?0:-1,he=React.useRef(ge),be=useControlled({controlled:re,default:b,name:g}),me=_slicedToArray(be,2),xe=me[0],ye=me[1],Oe=useControlled({controlled:K,default:"",name:g,state:"inputValue"}),ke=_slicedToArray(Oe,2),Se=ke[0],Ce=ke[1],De=React.useState(!1),Ae=De[0],Ee=De[1],Re=useEventCallback(function(e,n){var r;if(J)r="";else if(null==n)r="";else{var o=t(n);r="string"==typeof o?o:""}Se!==r&&(Ce(r),G&&G(e,r,"reset"))});React.useEffect(function(){Re(null,xe)},[xe,Re]);var we=useControlled({controlled:X,default:!1,name:g,state:"open"}),Ie=_slicedToArray(we,2),Te=Ie[0],Le=Ie[1],Ne=React.useState(!0),Me=Ne[0],Pe=Ne[1],_e=!J&&null!=xe&&Se===t(xe),Ve=Te,Fe=Ve?E(ee.filter(function(e){return!w||!(J?xe:[xe]).some(function(t){return null!==t&&_(e,t)})}),{inputValue:_e&&Me?"":Se,getOptionLabel:t}):[],He=Te&&Fe.length>0;if("production"!==process.env.NODE_ENV&&null!==xe&&!T&&ee.length>0){var qe=(J?xe:[xe]).filter(function(e){return!ee.some(function(t){return _(t,e)})});qe.length>0&&console.warn(["Material-UI: The value provided to ".concat(g," is invalid."),"None of the options match with `".concat(qe.length>1?JSON.stringify(qe):JSON.stringify(qe[0]),"`."),"You can use the `getOptionSelected` prop to customize the equality test."].join("\n"))}var ze=useEventCallback(function(e){-1===e?ue.current.focus():se.querySelector('[data-tag-index="'.concat(e,'"]')).focus()});React.useEffect(function(){J&&pe>xe.length-1&&(ve(-1),ze(-1))},[xe,J,pe,ze]);var Be=useEventCallback(function(e){var t=e.event,n=e.index,r=e.reason,o=void 0===r?"auto":r;if(he.current=n,-1===n?ue.current.removeAttribute("aria-activedescendant"):ue.current.setAttribute("aria-activedescendant","".concat(oe,"-option-").concat(n)),W&&W(t,-1===n?null:Fe[n],o),ce.current){var i=ce.current.querySelector("[data-focus]");i&&(i.removeAttribute("data-focus"),i.classList.remove("Mui-focusVisible"));var a=ce.current.parentElement.querySelector('[role="listbox"]');if(a)if(-1!==n){var u=ce.current.querySelector('[data-option-index="'.concat(n,'"]'));if(u&&(u.setAttribute("data-focus","true"),"keyboard"===o&&u.classList.add("Mui-focusVisible"),a.scrollHeight>a.clientHeight&&"mouse"!==o)){var c=u,l=a.clientHeight+a.scrollTop,s=c.offsetTop+c.offsetHeight;s>l?a.scrollTop=s-a.clientHeight:c.offsetTop-c.offsetHeight*(V?1.3:0)<a.scrollTop&&(a.scrollTop=c.offsetTop-c.offsetHeight*(V?1.3:0))}}else a.scrollTop=0}}),Ke=useEventCallback(function(e){var n=e.event,o=e.diff,i=e.direction,a=void 0===i?"next":i,u=e.reason,c=void 0===u?"auto":u;if(Ve){var l=function(e,t){if(!ce.current||-1===e)return-1;for(var n=e;;){if("next"===t&&n===Fe.length||"previous"===t&&-1===n)return-1;var r=ce.current.querySelector('[data-option-index="'.concat(n,'"]')),o=!S&&(!r||r.disabled||"true"===r.getAttribute("aria-disabled"));if(!(r&&!r.hasAttribute("tabindex")||o))return n;n+="next"===t?1:-1}}(function(){var e=Fe.length-1;if("reset"===o)return ge;if("start"===o)return 0;if("end"===o)return e;var t=he.current+o;return t<0?-1===t&&B?-1:D&&-1!==he.current||Math.abs(o)>1?0:e:t>e?t===e+1&&B?-1:D||Math.abs(o)>1?e:0:t}(),a);if(Be({index:l,reason:c,event:n}),r&&"reset"!==o)if(-1===l)ue.current.value=Se;else{var s=t(Fe[l]);ue.current.value=s,0===s.toLowerCase().indexOf(Se.toLowerCase())&&Se.length>0&&ue.current.setSelectionRange(Se.length,s.length)}}}),Ue=React.useCallback(function(){if(Ve){var e=J?xe[0]:xe;if(0!==Fe.length&&null!=e){if(ce.current)if(null==e)he.current>=Fe.length-1?Be({index:Fe.length-1}):Be({index:he.current});else{var t=Fe[he.current];if(J&&t&&-1!==findIndex(xe,function(e){return _(t,e)}))return;var n=findIndex(Fe,function(t){return _(t,e)});-1===n?Ke({diff:"reset"}):Be({index:n})}}else Ke({diff:"reset"})}},[Fe.length,!J&&xe,w,Ke,Be,Ve,Se,J]),Je=useEventCallback(function(e){setRef(ce,e),e&&Ue()});React.useEffect(function(){Ue()},[Ue]);var je=function(e){Te||(Le(!0),Pe(!0),Q&&Q(e))},Ye=function(e,t){Te&&(Le(!1),Y&&Y(e,t))},We=function(e,t,n,r){xe!==t&&(j&&j(e,t,n,r),ye(t))},Ge=React.useRef(!1),Qe=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"select-option",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"options",o=n,i=t;if(J){if(i=Array.isArray(xe)?xe.slice():[],"production"!==process.env.NODE_ENV){var a=i.filter(function(e){return _(t,e)});a.length>1&&console.error(["Material-UI: The `getOptionSelected` method of ".concat(g," do not handle the arguments correctly."),"The component expects a single value to match a given option but found ".concat(a.length," matches.")].join("\n"))}var u=findIndex(i,function(e){return _(t,e)});-1===u?i.push(t):"freeSolo"!==r&&(i.splice(u,1),o="remove-option")}Re(e,i),We(e,i,o,{option:t}),O||e.ctrlKey||e.metaKey||Ye(e,o),(!0===l||"touch"===l&&Ge.current||"mouse"===l&&!Ge.current)&&ue.current.blur()};var Xe=function(e,t){if(J){Ye(e,"toggleInput");var n=pe;-1===pe?""===Se&&"previous"===t&&(n=xe.length-1):((n+="next"===t?1:-1)<0&&(n=0),n===xe.length&&(n=-1)),n=function(e,t){if(-1===e)return-1;for(var n=e;;){if("next"===t&&n===xe.length||"previous"===t&&-1===n)return-1;var r=se.querySelector('[data-tag-index="'.concat(n,'"]'));if(r&&r.hasAttribute("tabindex")&&!r.disabled&&"true"!==r.getAttribute("aria-disabled"))return n;n+="next"===t?1:-1}}(n,t),ve(n),ze(n)}},Ze=function(e){ie.current=!0,Ce(""),G&&G(e,"","clear"),We(e,J?[]:null,"clear")},$e=function(e){Ee(!0),$&&!ie.current&&je(e)},et=function(e){null!==ce.current&&ce.current.parentElement.contains(document.activeElement)?ue.current.focus():(Ee(!1),ae.current=!0,ie.current=!1,u&&-1!==he.current&&Ve?Qe(e,Fe[he.current],"blur"):u&&T&&""!==Se?Qe(e,Se,"blur","freeSolo"):f&&Re(e,xe),Ye(e,"blur"))},tt=function(e){var t=e.target.value;Se!==t&&(Ce(t),Pe(!1),G&&G(e,t,"input")),""===t?x||J||We(e,null,"clear"):je(e)},nt=function(e){Be({event:e,index:Number(e.currentTarget.getAttribute("data-option-index")),reason:"mouse"})},rt=function(){Ge.current=!0},ot=function(e){var t=Number(e.currentTarget.getAttribute("data-option-index"));Qe(e,Fe[t],"select-option"),Ge.current=!1},it=function(e){Te?Ye(e,"toggleInput"):je(e)},at=function(e){e.target.getAttribute("id")!==oe&&e.preventDefault()},ut=function(){ue.current.focus(),ne&&ae.current&&ue.current.selectionEnd-ue.current.selectionStart==0&&ue.current.select(),ae.current=!1},ct=function(e){""!==Se&&Te||it(e)},lt=T&&Se.length>0;lt=lt||(J?xe.length>0:null!==xe);var st=Fe;if(V){var ft=new Map,dt=!1;st=Fe.reduce(function(e,t,n){var r=V(t);return e.length>0&&e[e.length-1].group===r?e[e.length-1].options.push(t):("production"!==process.env.NODE_ENV&&(ft.get(r)&&!dt&&(console.warn("Material-UI: The options provided combined with the `groupBy` method of ".concat(g," returns duplicated headers."),"You can solve the issue by sorting the options with the output of `groupBy`."),dt=!0),ft.set(r,!0)),e.push({key:n,index:n,group:r,options:[t]})),e},[])}return{getRootProps:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _extends({"aria-owns":He?"".concat(oe,"-listbox"):null,role:"combobox","aria-expanded":He},e,{onKeyDown:function(e){return function(t){if(e.onKeyDown&&e.onKeyDown(t),!t.defaultMuiPrevented&&(-1!==pe&&-1===["ArrowLeft","ArrowRight"].indexOf(t.key)&&(ve(-1),ze(-1)),229!==t.which))switch(t.key){case"Home":Ve&&H&&(t.preventDefault(),Ke({diff:"start",direction:"next",reason:"keyboard",event:t}));break;case"End":Ve&&H&&(t.preventDefault(),Ke({diff:"end",direction:"previous",reason:"keyboard",event:t}));break;case"PageUp":t.preventDefault(),Ke({diff:-pageSize,direction:"previous",reason:"keyboard",event:t}),je(t);break;case"PageDown":t.preventDefault(),Ke({diff:pageSize,direction:"next",reason:"keyboard",event:t}),je(t);break;case"ArrowDown":t.preventDefault(),Ke({diff:1,direction:"next",reason:"keyboard",event:t}),je(t);break;case"ArrowUp":t.preventDefault(),Ke({diff:-1,direction:"previous",reason:"keyboard",event:t}),je(t);break;case"ArrowLeft":Xe(t,"previous");break;case"ArrowRight":Xe(t,"next");break;case"Enter":if(-1!==he.current&&Ve){var n=Fe[he.current],o=!!L&&L(n);if(t.preventDefault(),o)return;Qe(t,n,"select-option"),r&&ue.current.setSelectionRange(ue.current.value.length,ue.current.value.length)}else T&&""!==Se&&!1===_e&&(J&&t.preventDefault(),Qe(t,Se,"create-option","freeSolo"));break;case"Escape":Ve?(t.preventDefault(),t.stopPropagation(),Ye(t,"escape")):p&&(""!==Se||J&&xe.length>0)&&(t.preventDefault(),t.stopPropagation(),Ze(t));break;case"Backspace":if(J&&""===Se&&xe.length>0){var i=-1===pe?xe.length-1:pe,a=xe.slice();a.splice(i,1),We(t,a,"remove-option",{option:xe[i]})}}}}(e),onMouseDown:at,onClick:ut})},getInputLabelProps:function(){return{id:"".concat(oe,"-label"),htmlFor:oe}},getInputProps:function(){return{id:oe,value:Se,onBlur:et,onFocus:$e,onChange:tt,onMouseDown:ct,"aria-activedescendant":Ve?"":null,"aria-autocomplete":r?"both":"list","aria-controls":He?"".concat(oe,"-listbox"):null,autoComplete:"off",ref:ue,autoCapitalize:"none",spellCheck:"false"}},getClearProps:function(){return{tabIndex:-1,onClick:Ze}},getPopupIndicatorProps:function(){return{tabIndex:-1,onClick:it}},getTagProps:function(e){var t=e.index;return{key:t,"data-tag-index":t,tabIndex:-1,onDelete:function(e){return function(t){var n=xe.slice();n.splice(e,1),We(t,n,"remove-option",{option:xe[e]})}}(t)}},getListboxProps:function(){return{role:"listbox",id:"".concat(oe,"-listbox"),"aria-labelledby":"".concat(oe,"-label"),ref:Je,onMouseDown:function(e){e.preventDefault()}}},getOptionProps:function(e){var n=e.index,r=e.option,o=(J?xe:[xe]).some(function(e){return null!=e&&_(r,e)}),i=!!L&&L(r);return{key:t(r),tabIndex:-1,role:"option",id:"".concat(oe,"-option-").concat(n),onMouseOver:nt,onClick:ot,onTouchStart:rt,"data-option-index":n,"aria-disabled":i,"aria-selected":o}},id:oe,inputValue:Se,value:xe,dirty:lt,popupOpen:Ve,focused:Ae||-1!==pe,anchorEl:se,setAnchorEl:fe,focusedTag:pe,groupedOptions:st}};