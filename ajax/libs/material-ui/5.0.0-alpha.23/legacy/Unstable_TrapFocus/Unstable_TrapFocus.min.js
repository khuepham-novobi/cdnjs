import*as React from"react";import PropTypes from"prop-types";import{exactProp,elementAcceptingRef}from"@material-ui/utils";import ownerDocument from"../utils/ownerDocument";import useForkRef from"../utils/useForkRef";var candidatesSelector=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'].join(",");function getTabIndex(e){var t=parseInt(e.getAttribute("tabindex"),10);return Number.isNaN(t)?"true"===e.contentEditable||("AUDIO"===e.nodeName||"VIDEO"===e.nodeName||"DETAILS"===e.nodeName)&&null===e.getAttribute("tabindex")?0:e.tabIndex:t}function isNonTabbableRadio(e){if("INPUT"!==e.tagName||"radio"!==e.type)return!1;if(!e.name)return!1;var t=function(t){return e.ownerDocument.querySelector('input[type="radio"]'.concat(t))},n=t('[name="'.concat(e.name,'"]:checked'));return n||(n=t('[name="'.concat(e.name,'"]'))),n!==e}function isNodeMatchingSelectorFocusable(e){return!(e.disabled||"INPUT"===e.tagName&&"hidden"===e.type||isNonTabbableRadio(e))}export function defaultGetTabbable(e){var t=[],n=[];return Array.from(e.querySelectorAll(candidatesSelector)).forEach(function(e,r){var o=getTabIndex(e);-1!==o&&isNodeMatchingSelectorFocusable(e)&&(0===o?t.push(e):n.push({documentOrder:r,tabIndex:o,node:e}))}),n.sort(function(e,t){return e.tabIndex===t.tabIndex?e.documentOrder-t.documentOrder:e.tabIndex-t.tabIndex}).map(function(e){return e.node}).concat(t)};function Unstable_TrapFocus(e){var t=e.children,n=e.disableAutoFocus,r=void 0!==n&&n,o=e.disableEnforceFocus,c=void 0!==o&&o,u=e.disableRestoreFocus,a=void 0!==u&&u,i=e.getDoc,s=e.getTabbable,l=void 0===s?defaultGetTabbable:s,d=e.isEnabled,f=e.open,b=React.useRef(),p=React.useRef(null),m=React.useRef(null),v=React.useRef(),R=React.useRef(null),E=React.useRef(!1),T=React.useRef(null),y=useForkRef(t.ref,T),g=React.useRef(null),F=React.useRef();React.useEffect(function(){F.current=f},[f]),F.current||!f||"undefined"==typeof window||r||(v.current=i().activeElement),React.useEffect(function(){f&&T.current&&(E.current=!r)},[r,f]),React.useEffect(function(){if(f&&T.current){var e=ownerDocument(T.current);return T.current.contains(e.activeElement)||(T.current.hasAttribute("tabIndex")||("production"!==process.env.NODE_ENV&&console.error(["Material-UI: The modal content node does not accept focus.",'For the benefit of assistive technologies, the tabIndex of the node is being set to "-1".'].join("\n")),T.current.setAttribute("tabIndex",-1)),E.current&&T.current.focus()),function(){a||(v.current&&v.current.focus&&(b.current=!0,v.current.focus()),v.current=null)}}},[f]),React.useEffect(function(){if(f&&T.current){var e=ownerDocument(T.current),t=function(t){var n=T.current;if(null!==n)if(e.hasFocus()&&!c&&d()&&!b.current){if(!n.contains(e.activeElement)){if(t&&R.current!==t.target||e.activeElement!==R.current)R.current=null;else if(null!==R.current)return;if(!E.current)return;var r=[];if(e.activeElement!==p.current&&e.activeElement!==m.current||(r=l(T.current)),r.length>0){var o,u,a=Boolean((null===(o=g.current)||void 0===o?void 0:o.shiftKey)&&"Tab"===(null===(u=g.current)||void 0===u?void 0:u.key)),i=r[0],s=r[r.length-1];a?s.focus():i.focus()}else n.focus()}}else b.current=!1},n=function(t){g.current=t,!c&&d()&&"Tab"===t.key&&e.activeElement===T.current&&t.shiftKey&&(b.current=!0,m.current.focus())};e.addEventListener("focusin",t),e.addEventListener("keydown",n,!0);var r=setInterval(function(){"BODY"===e.activeElement.tagName&&t()},50);return function(){clearInterval(r),e.removeEventListener("focusin",t),e.removeEventListener("keydown",n,!0)}}},[r,c,a,d,f,l]);var I=function(e){E.current||(v.current=e.relatedTarget),E.current=!0};return React.createElement(React.Fragment,null,React.createElement("div",{tabIndex:0,onFocus:I,ref:p,"data-test":"sentinelStart"}),React.cloneElement(t,{ref:y,onFocus:function(e){E.current||(v.current=e.relatedTarget),E.current=!0,R.current=e.target;var n=t.props.onFocus;n&&n(e)}}),React.createElement("div",{tabIndex:0,onFocus:I,ref:m,"data-test":"sentinelEnd"}))}"production"!==process.env.NODE_ENV&&(Unstable_TrapFocus.propTypes={children:elementAcceptingRef,disableAutoFocus:PropTypes.bool,disableEnforceFocus:PropTypes.bool,disableRestoreFocus:PropTypes.bool,getDoc:PropTypes.func.isRequired,getTabbable:PropTypes.func,isEnabled:PropTypes.func.isRequired,open:PropTypes.bool.isRequired}),"production"!==process.env.NODE_ENV&&(Unstable_TrapFocus.propTypes=exactProp(Unstable_TrapFocus.propTypes));export default Unstable_TrapFocus;