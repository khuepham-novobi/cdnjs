import _classCallCheck from"@babel/runtime/helpers/esm/classCallCheck";import _createClass from"@babel/runtime/helpers/esm/createClass";import _toConsumableArray from"@babel/runtime/helpers/esm/toConsumableArray";import getScrollbarSize from"../utils/getScrollbarSize";import ownerDocument from"../utils/ownerDocument";import ownerWindow from"../utils/ownerWindow";function isOverflowing(e){var n=ownerDocument(e);return n.body===e?ownerWindow(e).innerWidth>n.documentElement.clientWidth:e.scrollHeight>e.clientHeight}export function ariaHidden(e,n){n?e.setAttribute("aria-hidden","true"):e.removeAttribute("aria-hidden")};function getPaddingRight(e){return parseInt(ownerWindow(e).getComputedStyle(e).paddingRight,10)||0}function ariaHiddenSiblings(e,n,i){var t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4?arguments[4]:void 0,o=[n,i].concat(_toConsumableArray(t)),a=["TEMPLATE","SCRIPT","STYLE"];[].forEach.call(e.children,function(e){-1===o.indexOf(e)&&-1===a.indexOf(e.tagName)&&ariaHidden(e,r)})}function findIndexOf(e,n){var i=-1;return e.some(function(e,t){return!!n(e)&&(i=t,!0)}),i}function handleContainer(e,n){var i=[],t=e.container;if(!n.disableScrollLock){if(isOverflowing(t)){var r=getScrollbarSize(ownerDocument(t));i.push({value:t.style.paddingRight,property:"padding-right",el:t}),t.style.paddingRight="".concat(getPaddingRight(t)+r,"px");var o=ownerDocument(t).querySelectorAll(".mui-fixed");[].forEach.call(o,function(e){i.push({value:e.style.paddingRight,property:"padding-right",el:e}),e.style.paddingRight="".concat(getPaddingRight(e)+r,"px")})}var a=t.parentElement,l=ownerWindow(t),d="HTML"===(null==a?void 0:a.nodeName)&&"scroll"===l.getComputedStyle(a).overflowY?a:t;i.push({value:d.style.overflow,property:"overflow",el:d}),d.style.overflow="hidden"}return function(){i.forEach(function(e){var n=e.value,i=e.el,t=e.property;n?i.style.setProperty(t,n):i.style.removeProperty(t)})}}function getHiddenSiblings(e){var n=[];return[].forEach.call(e.children,function(e){"true"===e.getAttribute("aria-hidden")&&n.push(e)}),n}var ModalManager=function(){function e(){_classCallCheck(this,e),this.containers=void 0,this.modals=void 0,this.modals=[],this.containers=[]}return _createClass(e,[{key:"add",value:function(e,n){var i=this.modals.indexOf(e);if(-1!==i)return i;i=this.modals.length,this.modals.push(e),e.modalRef&&ariaHidden(e.modalRef,!1);var t=getHiddenSiblings(n);ariaHiddenSiblings(n,e.mount,e.modalRef,t,!0);var r=findIndexOf(this.containers,function(e){return e.container===n});return-1!==r?(this.containers[r].modals.push(e),i):(this.containers.push({modals:[e],container:n,restore:null,hiddenSiblings:t}),i)}},{key:"mount",value:function(e,n){var i=findIndexOf(this.containers,function(n){return-1!==n.modals.indexOf(e)}),t=this.containers[i];t.restore||(t.restore=handleContainer(t,n))}},{key:"remove",value:function(e){var n=this.modals.indexOf(e);if(-1===n)return n;var i=findIndexOf(this.containers,function(n){return-1!==n.modals.indexOf(e)}),t=this.containers[i];if(t.modals.splice(t.modals.indexOf(e),1),this.modals.splice(n,1),0===t.modals.length)t.restore&&t.restore(),e.modalRef&&ariaHidden(e.modalRef,!0),ariaHiddenSiblings(t.container,e.mount,e.modalRef,t.hiddenSiblings,!1),this.containers.splice(i,1);else{var r=t.modals[t.modals.length-1];r.modalRef&&ariaHidden(r.modalRef,!1)}return n}},{key:"isTopModal",value:function(e){return this.modals.length>0&&this.modals[this.modals.length-1]===e}}]),e}();export{ModalManager as default};