import _objectWithoutProperties from"@babel/runtime/helpers/esm/objectWithoutProperties";import _extends from"@babel/runtime/helpers/esm/extends";import*as React from"react";import PropTypes from"prop-types";import{getThemeProps,useTheme}from"@material-ui/styles";import{elementAcceptingRef,HTMLElementType}from"@material-ui/utils";import ownerDocument from"../utils/ownerDocument";import Portal from"../Portal";import createChainedFunction from"../utils/createChainedFunction";import useForkRef from"../utils/useForkRef";import useEventCallback from"../utils/useEventCallback";import zIndex from"../styles/zIndex";import ModalManager,{ariaHidden}from"./ModalManager";import TrapFocus from"../Unstable_TrapFocus";import SimpleBackdrop from"./SimpleBackdrop";function getContainer(e){return"function"==typeof e?e():e}function getHasTransition(e){return!!e.children&&e.children.props.hasOwnProperty("in")}var defaultManager=new ModalManager;export var styles=function(e){return{root:{position:"fixed",zIndex:e.zIndex.modal,right:0,bottom:0,top:0,left:0},hidden:{visibility:"hidden"}}};var Modal=React.forwardRef(function(e,o){var r=useTheme(),t=getThemeProps({name:"MuiModal",props:_extends({},e),theme:r}),n=t.BackdropComponent,a=void 0===n?SimpleBackdrop:n,i=t.BackdropProps,c=t.children,s=t.closeAfterTransition,p=void 0!==s&&s,l=t.container,d=t.disableAutoFocus,u=void 0!==d&&d,f=t.disableEnforceFocus,m=void 0!==f&&f,b=t.disableEscapeKeyDown,y=void 0!==b&&b,T=t.disablePortal,k=void 0!==T&&T,P=t.disableRestoreFocus,R=void 0!==P&&P,E=t.disableScrollLock,h=void 0!==E&&E,v=t.hideBackdrop,C=void 0!==v&&v,F=t.keepMounted,g=void 0!==F&&F,x=t.manager,M=void 0===x?defaultManager:x,B=t.onBackdropClick,w=t.onClose,D=t.onKeyDown,A=t.open,I=_objectWithoutProperties(t,["BackdropComponent","BackdropProps","children","closeAfterTransition","container","disableAutoFocus","disableEnforceFocus","disableEscapeKeyDown","disablePortal","disableRestoreFocus","disableScrollLock","hideBackdrop","keepMounted","manager","onBackdropClick","onClose","onKeyDown","open"]),_=React.useState(!0),K=_[0],S=_[1],z=React.useRef({}),H=React.useRef(null),L=React.useRef(null),j=useForkRef(L,o),N=getHasTransition(t),O=function(){return ownerDocument(H.current)},W=function(){return z.current.modalRef=L.current,z.current.mountNode=H.current,z.current},q=function(){M.mount(W(),{disableScrollLock:h}),L.current.scrollTop=0},U=useEventCallback(function(){var e=getContainer(l)||O().body;M.add(W(),e),L.current&&q()}),V=React.useCallback(function(){return M.isTopModal(W())},[M]),G=useEventCallback(function(e){H.current=e,e&&(A&&V()?q():ariaHidden(L.current,!0))}),J=React.useCallback(function(){M.remove(W())},[M]);if(React.useEffect(function(){return function(){J()}},[J]),React.useEffect(function(){A?U():N&&p||J()},[A,J,N,p,U]),!g&&!A&&(!N||K))return null;var Q=styles(r||{zIndex:zIndex}),X={};return void 0===c.props.tabIndex&&(X.tabIndex=c.props.tabIndex||"-1"),N&&(X.onEnter=createChainedFunction(function(){S(!1)},c.props.onEnter),X.onExited=createChainedFunction(function(){S(!0),p&&J()},c.props.onExited)),React.createElement(Portal,{ref:G,container:l,disablePortal:k},React.createElement("div",_extends({ref:j,onKeyDown:function(e){D&&D(e),"Escape"===e.key&&V()&&(y||(e.stopPropagation(),w&&w(e,"escapeKeyDown")))},role:"presentation"},I,{style:_extends({},Q.root,!A&&K?Q.hidden:{},I.style)}),C?null:React.createElement(a,_extends({open:A,onClick:function(e){e.target===e.currentTarget&&(B&&B(e),w&&w(e,"backdropClick"))}},i)),React.createElement(TrapFocus,{disableEnforceFocus:m,disableAutoFocus:u,disableRestoreFocus:R,getDoc:O,isEnabled:V,open:A},React.cloneElement(c,X))))});"production"!==process.env.NODE_ENV&&(Modal.propTypes={BackdropComponent:PropTypes.elementType,BackdropProps:PropTypes.object,children:elementAcceptingRef.isRequired,closeAfterTransition:PropTypes.bool,container:PropTypes.oneOfType([HTMLElementType,PropTypes.func]),disableAutoFocus:PropTypes.bool,disableEnforceFocus:PropTypes.bool,disableEscapeKeyDown:PropTypes.bool,disablePortal:PropTypes.bool,disableRestoreFocus:PropTypes.bool,disableScrollLock:PropTypes.bool,hideBackdrop:PropTypes.bool,keepMounted:PropTypes.bool,onBackdropClick:PropTypes.func,onClose:PropTypes.func,onKeyDown:PropTypes.func,open:PropTypes.bool.isRequired,style:PropTypes.object});export default Modal;