import _extends from"@babel/runtime/helpers/esm/extends";import _objectWithoutProperties from"@babel/runtime/helpers/esm/objectWithoutProperties";import*as React from"react";import PropTypes from"prop-types";import{chainPropTypes,elementTypeAcceptingRef,refType,HTMLElementType}from"@material-ui/utils";import clsx from"clsx";import debounce from"../utils/debounce";import ownerDocument from"../utils/ownerDocument";import ownerWindow from"../utils/ownerWindow";import withStyles from"../styles/withStyles";import Modal from"../Modal";import Grow from"../Grow";import Paper from"../Paper";export function getOffsetTop(e,o){var t=0;return"number"==typeof o?t=o:"center"===o?t=e.height/2:"bottom"===o&&(t=e.height),t};export function getOffsetLeft(e,o){var t=0;return"number"==typeof o?t=o:"center"===o?t=e.width/2:"right"===o&&(t=e.width),t};function getTransformOriginValue(e){return[e.horizontal,e.vertical].map(function(e){return"number"==typeof e?"".concat(e,"px"):e}).join(" ")}function getScrollParent(e,o){for(var t=o,r=0;t&&t!==e;)r+=(t=t.parentElement).scrollTop;return r}function getAnchorEl(e){return"function"==typeof e?e():e}export var styles={root:{},paper:{position:"absolute",overflowY:"auto",overflowX:"hidden",minWidth:16,minHeight:16,maxWidth:"calc(100% - 32px)",maxHeight:"calc(100% - 32px)",outline:0}};var Popover=React.forwardRef(function(e,o){var t=e.action,r=e.anchorEl,n=e.anchorOrigin,i=void 0===n?{vertical:"top",horizontal:"left"}:n,a=e.anchorPosition,p=e.anchorReference,s=void 0===p?"anchorEl":p,c=e.children,l=e.classes,u=e.className,h=e.container,f=e.elevation,m=void 0===f?8:f,d=e.getContentAnchorEl,v=e.marginThreshold,T=void 0===v?16:v,y=e.open,P=e.PaperProps,g=void 0===P?{}:P,E=e.transformOrigin,b=void 0===E?{vertical:"top",horizontal:"left"}:E,O=e.TransitionComponent,R=void 0===O?Grow:O,w=e.transitionDuration,x=void 0===w?"auto":w,N=e.TransitionProps,C=(N=void 0===N?{}:N).onEntering,M=_objectWithoutProperties(N,["onEntering"]),z=_objectWithoutProperties(e,["action","anchorEl","anchorOrigin","anchorPosition","anchorReference","children","classes","className","container","elevation","getContentAnchorEl","marginThreshold","open","PaperProps","transformOrigin","TransitionComponent","transitionDuration","TransitionProps"]),D=React.useRef(),_=React.useCallback(function(e){if("anchorPosition"===s)return"production"!==process.env.NODE_ENV&&(a||console.error('Material-UI: You need to provide a `anchorPosition` prop when using <Popover anchorReference="anchorPosition" />.')),a;var o=getAnchorEl(r),t=o&&1===o.nodeType?o:ownerDocument(D.current).body,n=t.getBoundingClientRect();if("production"!==process.env.NODE_ENV){var p=t.getBoundingClientRect();"test"!==process.env.NODE_ENV&&0===p.top&&0===p.left&&0===p.right&&0===p.bottom&&console.warn(["Material-UI: The `anchorEl` prop provided to the component is invalid.","The anchor element should be part of the document layout.","Make sure the element is present in the document or that it's not display none."].join("\n"))}var c=0===e?i.vertical:"center";return{top:n.top+getOffsetTop(n,c),left:n.left+getOffsetLeft(n,i.horizontal)}},[r,i.horizontal,i.vertical,a,s]),A=React.useCallback(function(e){var o=0;if(d&&"anchorEl"===s){var t=d(e);if(t&&e.contains(t)){var r=getScrollParent(e,t);o=t.offsetTop+t.clientHeight/2-r||0}"production"!==process.env.NODE_ENV&&"top"!==i.vertical&&console.error(["Material-UI: You can not change the default `anchorOrigin.vertical` value ","when also providing the `getContentAnchorEl` prop to the popover component.","Only use one of the two props.","Set `getContentAnchorEl` to `null | undefined` or leave `anchorOrigin.vertical` unchanged."].join("\n"))}return o},[i.vertical,s,d]),j=React.useCallback(function(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return{vertical:getOffsetTop(e,b.vertical)+o,horizontal:getOffsetLeft(e,b.horizontal)}},[b.horizontal,b.vertical]),W=React.useCallback(function(e){var o=A(e),t={width:e.offsetWidth,height:e.offsetHeight},n=j(t,o);if("none"===s)return{top:null,left:null,transformOrigin:getTransformOriginValue(n)};var i=_(o),a=i.top-n.vertical,p=i.left-n.horizontal,c=a+t.height,l=p+t.width,u=ownerWindow(getAnchorEl(r)),h=u.innerHeight-T,f=u.innerWidth-T;if(a<T){var m=a-T;a-=m,n.vertical+=m}else if(c>h){var d=c-h;a-=d,n.vertical+=d}if("production"!==process.env.NODE_ENV&&t.height>h&&t.height&&h&&console.error(["Material-UI: The popover component is too tall.","Some part of it can not be seen on the screen (".concat(t.height-h,"px)."),"Please consider adding a `max-height` to improve the user-experience."].join("\n")),p<T){var v=p-T;p-=v,n.horizontal+=v}else if(l>f){var y=l-f;p-=y,n.horizontal+=y}return{top:"".concat(Math.round(a),"px"),left:"".concat(Math.round(p),"px"),transformOrigin:getTransformOriginValue(n)}},[r,s,_,A,j,T]),V=React.useCallback(function(){var e=D.current;if(e){var o=W(e);null!==o.top&&(e.style.top=o.top),null!==o.left&&(e.style.left=o.left),e.style.transformOrigin=o.transformOrigin}},[W]);React.useEffect(function(){y&&V()}),React.useImperativeHandle(t,function(){return y?{updatePosition:function(){V()}}:null},[y,V]),React.useEffect(function(){if(y){var e=debounce(function(){V()}),o=ownerWindow(r);return o.addEventListener("resize",e),function(){e.clear(),o.removeEventListener("resize",e)}}},[r,y,V]);var H=x;"auto"!==x||R.muiSupportAuto||(H=void 0);var k=h||(r?ownerDocument(getAnchorEl(r)).body:void 0);return React.createElement(Modal,_extends({container:k,open:y,ref:o,BackdropProps:{invisible:!0},className:clsx(l.root,u)},z),React.createElement(R,_extends({appear:!0,in:y,timeout:H,onEntering:function(e,o){C&&C(e,o),V()}},M),React.createElement(Paper,_extends({elevation:m,ref:D},g,{className:clsx(l.paper,g.className)}),c)))});"production"!==process.env.NODE_ENV&&(Popover.propTypes={action:refType,anchorEl:chainPropTypes(PropTypes.oneOfType([HTMLElementType,PropTypes.func]),function(e){if(e.open&&(!e.anchorReference||"anchorEl"===e.anchorReference)){var o=getAnchorEl(e.anchorEl);if(!o||1!==o.nodeType)return new Error(["Material-UI: The `anchorEl` prop provided to the component is invalid.","It should be an Element instance but it's `".concat(o,"` instead.")].join("\n"));var t=o.getBoundingClientRect();if("test"!==process.env.NODE_ENV&&0===t.top&&0===t.left&&0===t.right&&0===t.bottom)return new Error(["Material-UI: The `anchorEl` prop provided to the component is invalid.","The anchor element should be part of the document layout.","Make sure the element is present in the document or that it's not display none."].join("\n"))}return null}),anchorOrigin:PropTypes.shape({horizontal:PropTypes.oneOfType([PropTypes.oneOf(["center","left","right"]),PropTypes.number]).isRequired,vertical:PropTypes.oneOfType([PropTypes.oneOf(["bottom","center","top"]),PropTypes.number]).isRequired}),anchorPosition:PropTypes.shape({left:PropTypes.number.isRequired,top:PropTypes.number.isRequired}),anchorReference:PropTypes.oneOf(["anchorEl","anchorPosition","none"]),children:PropTypes.node,classes:PropTypes.object,className:PropTypes.string,container:PropTypes.oneOfType([HTMLElementType,PropTypes.func]),elevation:PropTypes.number,getContentAnchorEl:PropTypes.func,marginThreshold:PropTypes.number,onClose:PropTypes.func,open:PropTypes.bool.isRequired,PaperProps:PropTypes.shape({component:elementTypeAcceptingRef}),transformOrigin:PropTypes.shape({horizontal:PropTypes.oneOfType([PropTypes.oneOf(["center","left","right"]),PropTypes.number]).isRequired,vertical:PropTypes.oneOfType([PropTypes.oneOf(["bottom","center","top"]),PropTypes.number]).isRequired}),TransitionComponent:PropTypes.elementType,transitionDuration:PropTypes.oneOfType([PropTypes.oneOf(["auto"]),PropTypes.number,PropTypes.shape({appear:PropTypes.number,enter:PropTypes.number,exit:PropTypes.number})]),TransitionProps:PropTypes.object});export default withStyles(styles,{name:"MuiPopover"})(Popover);