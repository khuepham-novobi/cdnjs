import _extends from"@babel/runtime/helpers/esm/extends";import _objectWithoutPropertiesLoose from"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose";import{formatMuiErrorMessage as _formatMuiErrorMessage}from"@material-ui/utils";import*as React from"react";import{isFragment}from"react-is";import PropTypes from"prop-types";import clsx from"clsx";import{refType}from"@material-ui/utils";import ownerDocument from"../utils/ownerDocument";import capitalize from"../utils/capitalize";import Menu from"../Menu/Menu";import{isFilled}from"../InputBase/utils";import useForkRef from"../utils/useForkRef";import useControlled from"../utils/useControlled";function areEqualValues(e,o){return"object"==typeof o&&null!==o?e===o:String(e)===String(o)}function isEmpty(e){return null==e||"string"==typeof e&&!e.trim()}const SelectInput=React.forwardRef(function(e,o){const{"aria-describedby":r,"aria-label":t,autoFocus:a,autoWidth:n,children:l,classes:s,className:p,defaultValue:i,disabled:u,displayEmpty:c,IconComponent:d,inputRef:m,labelId:y,MenuProps:f={},multiple:b,name:v,onBlur:P,onChange:h,onClose:T,onFocus:E,onOpen:R,open:g,readOnly:x,renderValue:C,SelectDisplayProps:I={},tabIndex:M,value:O,variant:F="standard"}=e,_=_objectWithoutPropertiesLoose(e,["aria-describedby","aria-label","autoFocus","autoWidth","children","classes","className","defaultValue","disabled","displayEmpty","IconComponent","inputRef","labelId","MenuProps","multiple","name","onBlur","onChange","onClose","onFocus","onOpen","open","readOnly","renderValue","SelectDisplayProps","tabIndex","type","value","variant"]),[w,D]=useControlled({controlled:O,default:i,name:"Select"}),S=React.useRef(null),j=React.useRef(null),[N,V]=React.useState(null),{current:k}=React.useRef(null!=g),[W,A]=React.useState(),[L,$]=React.useState(!1),B=useForkRef(o,m),U=React.useCallback(e=>{j.current=e,e&&V(e)},[]);React.useImperativeHandle(B,()=>({focus:()=>{j.current.focus()},node:S.current,value:w}),[w]),React.useEffect(()=>{a&&j.current.focus()},[a]),React.useEffect(()=>{const e=ownerDocument(j.current).getElementById(y);if(e){const o=()=>{getSelection().isCollapsed&&j.current.focus()};return e.addEventListener("click",o),()=>{e.removeEventListener("click",o)}}},[y]);const q=(e,o)=>{e?R&&R(o):T&&T(o),k||(A(n?null:N.clientWidth),$(e))},K=React.Children.toArray(l),z=null!==N&&(k?g:L);let H,Y;delete _["aria-invalid"];const G=[];let J=!1,Q=!1;(isFilled({value:w})||c)&&(C?H=C(w):J=!0);const X=K.map(e=>{if(!React.isValidElement(e))return null;let o;if("production"!==process.env.NODE_ENV&&isFragment(e)&&console.error(["Material-UI: The Select component doesn't accept a Fragment as a child.","Consider providing an array instead."].join("\n")),b){if(!Array.isArray(w))throw new Error("production"!==process.env.NODE_ENV?"Material-UI: The `value` prop must be an array when using the `Select` component with `multiple`.":_formatMuiErrorMessage(2));(o=w.some(o=>areEqualValues(o,e.props.value)))&&J&&G.push(e.props.children)}else(o=areEqualValues(w,e.props.value))&&J&&(Y=e.props.children);return o&&(Q=!0),React.cloneElement(e,{"aria-selected":o?"true":void 0,onClick:(e=>o=>{let r;if(b){r=Array.isArray(w)?w.slice():[];const o=w.indexOf(e.props.value);-1===o?r.push(e.props.value):r.splice(o,1)}else r=e.props.value;e.props.onClick&&e.props.onClick(o),w!==r&&(D(r),h&&(o.persist(),Object.defineProperty(o,"target",{writable:!0,value:{value:r,name:v}}),h(o,e))),b||q(!1,o)})(e),onKeyUp:o=>{" "===o.key&&o.preventDefault(),e.props.onKeyUp&&e.props.onKeyUp(o)},role:"option",selected:o,value:void 0,"data-value":e.props.value})});"production"!==process.env.NODE_ENV&&React.useEffect(()=>{if(!Q&&!b&&""!==w){const e=K.map(e=>e.props.value);console.warn([`Material-UI: You have provided an out-of-range value \`${w}\` for the select ${v?`(name="${v}") `:""}component.`,"Consider providing a value that matches one of the available options or ''.",`The available values are ${e.filter(e=>null!=e).map(e=>`\`${e}\``).join(", ")||'""'}.`].join("\n"))}},[Q,K,b,v,w]),J&&(H=b?G.join(", "):Y);let Z,ee=W;!n&&k&&N&&(ee=N.clientWidth),Z=void 0!==M?M:u?null:0;const oe=I.id||(v?`mui-component-select-${v}`:void 0);return React.createElement(React.Fragment,null,React.createElement("div",_extends({ref:U,tabIndex:Z,role:"button","aria-disabled":u?"true":void 0,"aria-expanded":z?"true":void 0,"aria-haspopup":"listbox","aria-label":t,"aria-labelledby":[y,oe].filter(Boolean).join(" ")||void 0,"aria-describedby":r,onKeyDown:e=>{x||-1!==[" ","ArrowUp","ArrowDown","Enter"].indexOf(e.key)&&(e.preventDefault(),q(!0,e))},onMouseDown:u||x?null:e=>{0===e.button&&(e.preventDefault(),j.current.focus(),q(!0,e))},onBlur:e=>{!z&&P&&(e.persist(),Object.defineProperty(e,"target",{writable:!0,value:{value:w,name:v}}),P(e))},onFocus:E},I,{className:clsx(s.root,s.select,s.selectMenu,s[F],p,I.className,u&&s.disabled),id:oe}),isEmpty(H)?React.createElement("span",{dangerouslySetInnerHTML:{__html:"&#8203;"}}):H),React.createElement("input",_extends({value:Array.isArray(w)?w.join(","):w,name:v,ref:S,"aria-hidden":!0,onChange:e=>{const o=K.map(e=>e.props.value).indexOf(e.target.value);if(-1===o)return;const r=K[o];D(r.props.value),h&&h(e,r)},tabIndex:-1,disabled:u,className:s.nativeInput,autoFocus:a},_)),React.createElement(d,{className:clsx(s.icon,s[`icon${capitalize(F)}`],z&&s.iconOpen,u&&s.disabled)}),React.createElement(Menu,_extends({id:`menu-${v||""}`,anchorEl:N,open:z,onClose:e=>{q(!1,e)}},f,{MenuListProps:_extends({"aria-labelledby":y,role:"listbox",disableListWrap:!0},f.MenuListProps),PaperProps:_extends({},f.PaperProps,{style:_extends({minWidth:ee},null!=f.PaperProps?f.PaperProps.style:null)})}),X))});"production"!==process.env.NODE_ENV&&(SelectInput.propTypes={"aria-describedby":PropTypes.string,"aria-label":PropTypes.string,autoFocus:PropTypes.bool,autoWidth:PropTypes.bool,children:PropTypes.node,classes:PropTypes.object.isRequired,className:PropTypes.string,defaultValue:PropTypes.any,disabled:PropTypes.bool,displayEmpty:PropTypes.bool,IconComponent:PropTypes.elementType.isRequired,inputRef:refType,labelId:PropTypes.string,MenuProps:PropTypes.object,multiple:PropTypes.bool,name:PropTypes.string,onBlur:PropTypes.func,onChange:PropTypes.func,onClose:PropTypes.func,onFocus:PropTypes.func,onOpen:PropTypes.func,open:PropTypes.bool,readOnly:PropTypes.bool,renderValue:PropTypes.func,SelectDisplayProps:PropTypes.object,tabIndex:PropTypes.oneOfType([PropTypes.number,PropTypes.string]),type:PropTypes.any,value:PropTypes.any,variant:PropTypes.oneOf(["standard","outlined","filled"])});export default SelectInput;