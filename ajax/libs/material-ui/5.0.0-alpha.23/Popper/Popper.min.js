import _extends from"@babel/runtime/helpers/esm/extends";import _objectWithoutPropertiesLoose from"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose";import*as React from"react";import PropTypes from"prop-types";import{createPopper}from"@popperjs/core";import{chainPropTypes,refType,HTMLElementType}from"@material-ui/utils";import{useTheme}from"@material-ui/styles";import Portal from"../Portal";import setRef from"../utils/setRef";import useForkRef from"../utils/useForkRef";import useEnhancedEffect from"../utils/useEnhancedEffect";function flipPlacement(e,t){if("ltr"===(t&&t.direction||"ltr"))return e;switch(e){case"bottom-end":return"bottom-start";case"bottom-start":return"bottom-end";case"top-end":return"top-start";case"top-start":return"top-end";default:return e}}function getAnchorEl(e){return"function"==typeof e?e():e}const defaultPopperOptions={},Popper=React.forwardRef(function(e,t){const{anchorEl:o,children:r,container:n,disablePortal:p=!1,keepMounted:s=!1,modifiers:a,open:i,placement:l="bottom",popperOptions:c=defaultPopperOptions,popperRef:u,style:f,transition:d=!1}=e,m=_objectWithoutPropertiesLoose(e,["anchorEl","children","container","disablePortal","keepMounted","modifiers","open","placement","popperOptions","popperRef","style","transition"]),y=React.useRef(null),h=useForkRef(y,t),T=React.useRef(null),P=useForkRef(T,u),b=React.useRef(P);useEnhancedEffect(()=>{b.current=P},[P]),React.useImperativeHandle(u,()=>T.current,[]);const[E,R]=React.useState(!0),g=flipPlacement(l,useTheme()),[O,v]=React.useState(g);React.useEffect(()=>{T.current&&T.current.forceUpdate()});const M=React.useCallback(()=>{if(!y.current||!o||!i)return;T.current&&(T.current.destroy(),b.current(null));const e=getAnchorEl(o);if("production"!==process.env.NODE_ENV&&e&&1===e.nodeType){const t=e.getBoundingClientRect();"test"!==process.env.NODE_ENV&&0===t.top&&0===t.left&&0===t.right&&0===t.bottom&&console.warn(["Material-UI: The `anchorEl` prop provided to the component is invalid.","The anchor element should be part of the document layout.","Make sure the element is present in the document or that it's not display none."].join("\n"))}let t=[{name:"preventOverflow",options:{altBoundary:p}},{name:"flip",options:{altBoundary:p}},{name:"onUpdate",enabled:!0,phase:"afterWrite",fn:({state:e})=>{(e=>{v(e.placement)})(e)}}];null!=a&&(t=t.concat(a)),c&&null!=c.modifiers&&(t=t.concat(c.modifiers));const r=createPopper(getAnchorEl(o),y.current,_extends({placement:g},c,{modifiers:t}));b.current(r)},[o,p,a,i,g,c]),j=React.useCallback(e=>{setRef(h,e),M()},[h,M]),x=()=>{R(!1)},k=()=>{T.current&&(T.current.destroy(),b.current(null))},_=()=>{R(!0),k()};if(React.useEffect(()=>()=>{k()},[]),React.useEffect(()=>{i||d||k()},[i,d]),!s&&!i&&(!d||E))return null;const N={placement:O};return d&&(N.TransitionProps={in:i,onEnter:x,onExited:_}),React.createElement(Portal,{disablePortal:p,container:n},React.createElement("div",_extends({ref:j,role:"tooltip"},m,{style:_extends({position:"fixed",top:0,left:0,display:i||!s||d?null:"none"},f)}),"function"==typeof r?r(N):r))});"production"!==process.env.NODE_ENV&&(Popper.propTypes={anchorEl:chainPropTypes(PropTypes.oneOfType([HTMLElementType,PropTypes.object,PropTypes.func]),e=>{if(e.open){const t=getAnchorEl(e.anchorEl);if(t&&1===t.nodeType){const e=t.getBoundingClientRect();if("test"!==process.env.NODE_ENV&&0===e.top&&0===e.left&&0===e.right&&0===e.bottom)return new Error(["Material-UI: The `anchorEl` prop provided to the component is invalid.","The anchor element should be part of the document layout.","Make sure the element is present in the document or that it's not display none."].join("\n"))}else if(!t||"function"!=typeof t.getBoundingClientRect||null!=t.contextElement&&1!==t.contextElement.nodeType)return new Error(["Material-UI: The `anchorEl` prop provided to the component is invalid.","It should be an HTML element instance or a virtualElement ","(https://popper.js.org/docs/v2/virtual-elements/)."].join("\n"))}return null}),children:PropTypes.oneOfType([PropTypes.node,PropTypes.func]),container:PropTypes.oneOfType([HTMLElementType,PropTypes.func]),disablePortal:PropTypes.bool,keepMounted:PropTypes.bool,modifiers:PropTypes.arrayOf(PropTypes.shape({data:PropTypes.object,effect:PropTypes.func,enabled:PropTypes.bool,fn:PropTypes.func,name:PropTypes.any.isRequired,options:PropTypes.object,phase:PropTypes.oneOf(["afterMain","afterRead","afterWrite","beforeMain","beforeRead","beforeWrite","main","read","write"]),requires:PropTypes.arrayOf(PropTypes.string),requiresIfExists:PropTypes.arrayOf(PropTypes.string)})),open:PropTypes.bool.isRequired,placement:PropTypes.oneOf(["auto-end","auto-start","auto","bottom-end","bottom-start","bottom","left-end","left-start","left","right-end","right-start","right","top-end","top-start","top"]),popperOptions:PropTypes.shape({modifiers:PropTypes.array,onFirstUpdate:PropTypes.func,placement:PropTypes.oneOf(["auto-end","auto-start","auto","bottom-end","bottom-start","bottom","left-end","left-start","left","right-end","right-start","right","top-end","top-start","top"]),strategy:PropTypes.oneOf(["absolute","fixed"])}),popperRef:refType,style:PropTypes.object,transition:PropTypes.bool});export default Popper;