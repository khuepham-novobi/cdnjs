"use strict";var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard"),_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.createFilterOptions=createFilterOptions,exports.default=useAutocomplete;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),React=_interopRequireWildcard(require("react")),_utils=require("../utils");function stripDiacritics(e){return void 0!==e.normalize?e.normalize("NFD").replace(/[\u0300-\u036f]/g,""):e}function createFilterOptions(e={}){const{ignoreAccents:t=!0,ignoreCase:n=!0,limit:r,matchFrom:o="any",stringify:i,trim:l=!1}=e;return(e,{inputValue:a,getOptionLabel:u})=>{let s=l?a.trim():a;n&&(s=s.toLowerCase()),t&&(s=stripDiacritics(s));const c=e.filter(e=>{let r=(i||u)(e);return n&&(r=r.toLowerCase()),t&&(r=stripDiacritics(r)),"start"===o?0===r.indexOf(s):r.indexOf(s)>-1});return"number"==typeof r?c.slice(0,r):c}}function findIndex(e,t){for(let n=0;n<e.length;n+=1)if(t(e[n]))return n;return-1}const defaultFilterOptions=createFilterOptions(),pageSize=5;function useAutocomplete(e){const{autoComplete:t=!1,autoHighlight:n=!1,autoSelect:r=!1,blurOnSelect:o=!1,clearOnBlur:i=!e.freeSolo,clearOnEscape:l=!1,componentName:a="useAutocomplete",defaultValue:u=(e.multiple?[]:null),disableClearable:s=!1,disableCloseOnSelect:c=!1,disabledItemsFocusable:p=!1,disableListWrap:d=!1,filterOptions:f=defaultFilterOptions,filterSelectedOptions:g=!1,freeSolo:b=!1,getOptionDisabled:h,getOptionLabel:v=(e=>{var t;return null!==(t=e.label)&&void 0!==t?t:e}),getOptionSelected:m=((e,t)=>e===t),groupBy:x,handleHomeEndKeys:y=!e.freeSolo,id:O,includeInputInList:S=!1,inputValue:k,multiple:D=!1,onChange:R,onClose:C,onHighlightChange:w,onInputChange:E,onOpen:A,open:_,openOnFocus:$=!1,options:I,selectOnFocus:q=!e.freeSolo,value:T}=e,L=(0,_utils.unstable_useId)(O);let N=v;N=(e=>{const t=v(e);if("string"!=typeof t){if("production"!==process.env.NODE_ENV){const n=void 0===t?"undefined":`${typeof t} (${t})`;console.error(`Material-UI: The \`getOptionLabel\` method of ${a} returned ${n} instead of a string for ${JSON.stringify(e)}.`)}return String(t)}return t});const M=React.useRef(!1),P=React.useRef(!0),F=React.useRef(null),V=React.useRef(null),[H,z]=React.useState(null),[B,K]=React.useState(-1),U=n?0:-1,W=React.useRef(U),[j,J]=(0,_utils.useControlled)({controlled:T,default:u,name:a}),[Y,G]=(0,_utils.useControlled)({controlled:k,default:"",name:a,state:"inputValue"}),[Q,X]=React.useState(!1),Z=(0,_utils.useEventCallback)((e,t)=>{let n;if(D)n="";else if(null==t)n="";else{const e=N(t);n="string"==typeof e?e:""}Y!==n&&(G(n),E&&E(e,n,"reset"))});React.useEffect(()=>{Z(null,j)},[j,Z]);const[ee,te]=(0,_utils.useControlled)({controlled:_,default:!1,name:a,state:"open"}),[ne,re]=React.useState(!0),oe=!D&&null!=j&&Y===N(j),ie=ee,le=ie?f(I.filter(e=>!g||!(D?j:[j]).some(t=>null!==t&&m(e,t))),{inputValue:oe&&ne?"":Y,getOptionLabel:N}):[],ae=ee&&le.length>0;if("production"!==process.env.NODE_ENV&&null!==j&&!b&&I.length>0){const e=(D?j:[j]).filter(e=>!I.some(t=>m(t,e)));e.length>0&&console.warn([`Material-UI: The value provided to ${a} is invalid.`,`None of the options match with \`${e.length>1?JSON.stringify(e):JSON.stringify(e[0])}\`.`,"You can use the `getOptionSelected` prop to customize the equality test."].join("\n"))}const ue=(0,_utils.useEventCallback)(e=>{-1===e?F.current.focus():H.querySelector(`[data-tag-index="${e}"]`).focus()});React.useEffect(()=>{D&&B>j.length-1&&(K(-1),ue(-1))},[j,D,B,ue]);const se=(0,_utils.useEventCallback)(({event:e,index:t,reason:n="auto"})=>{if(W.current=t,-1===t?F.current.removeAttribute("aria-activedescendant"):F.current.setAttribute("aria-activedescendant",`${L}-option-${t}`),w&&w(e,-1===t?null:le[t],n),!V.current)return;const r=V.current.querySelector("[data-focus]");r&&(r.removeAttribute("data-focus"),r.classList.remove("Mui-focusVisible"));const o=V.current.parentElement.querySelector('[role="listbox"]');if(!o)return;if(-1===t)return void(o.scrollTop=0);const i=V.current.querySelector(`[data-option-index="${t}"]`);if(i&&(i.setAttribute("data-focus","true"),"keyboard"===n&&i.classList.add("Mui-focusVisible"),o.scrollHeight>o.clientHeight&&"mouse"!==n)){const e=i,t=o.clientHeight+o.scrollTop,n=e.offsetTop+e.offsetHeight;n>t?o.scrollTop=n-o.clientHeight:e.offsetTop-e.offsetHeight*(x?1.3:0)<o.scrollTop&&(o.scrollTop=e.offsetTop-e.offsetHeight*(x?1.3:0))}}),ce=(0,_utils.useEventCallback)(({event:e,diff:n,direction:r="next",reason:o="auto"})=>{if(!ie)return;const i=function(e,t){if(!V.current||-1===e)return-1;let n=e;for(;;){if("next"===t&&n===le.length||"previous"===t&&-1===n)return-1;const e=V.current.querySelector(`[data-option-index="${n}"]`),r=!p&&(!e||e.disabled||"true"===e.getAttribute("aria-disabled"));if(!(e&&!e.hasAttribute("tabindex")||r))return n;n+="next"===t?1:-1}}((()=>{const e=le.length-1;if("reset"===n)return U;if("start"===n)return 0;if("end"===n)return e;const t=W.current+n;return t<0?-1===t&&S?-1:d&&-1!==W.current||Math.abs(n)>1?0:e:t>e?t===e+1&&S?-1:d||Math.abs(n)>1?e:0:t})(),r);if(se({index:i,reason:o,event:e}),t&&"reset"!==n)if(-1===i)F.current.value=Y;else{const e=N(le[i]);F.current.value=e,0===e.toLowerCase().indexOf(Y.toLowerCase())&&Y.length>0&&F.current.setSelectionRange(Y.length,e.length)}}),pe=React.useCallback(()=>{if(!ie)return;const e=D?j[0]:j;if(0!==le.length&&null!=e){if(V.current)if(null==e)W.current>=le.length-1?se({index:le.length-1}):se({index:W.current});else{const t=le[W.current];if(D&&t&&-1!==findIndex(j,e=>m(t,e)))return;const n=findIndex(le,t=>m(t,e));-1===n?ce({diff:"reset"}):se({index:n})}}else ce({diff:"reset"})},[le.length,!D&&j,g,ce,se,ie,Y,D]),de=(0,_utils.useEventCallback)(e=>{(0,_utils.setRef)(V,e),e&&pe()});React.useEffect(()=>{pe()},[pe]);const fe=e=>{ee||(te(!0),re(!0),A&&A(e))},ge=(e,t)=>{ee&&(te(!1),C&&C(e,t))},be=(e,t,n,r)=>{j!==t&&(R&&R(e,t,n,r),J(t))},he=React.useRef(!1),ve=(e,t,n="select-option",r="options")=>{let i=n,l=t;if(D){if(l=Array.isArray(j)?j.slice():[],"production"!==process.env.NODE_ENV){const e=l.filter(e=>m(t,e));e.length>1&&console.error([`Material-UI: The \`getOptionSelected\` method of ${a} do not handle the arguments correctly.`,`The component expects a single value to match a given option but found ${e.length} matches.`].join("\n"))}const e=findIndex(l,e=>m(t,e));-1===e?l.push(t):"freeSolo"!==r&&(l.splice(e,1),i="remove-option")}Z(e,l),be(e,l,i,{option:t}),c||e.ctrlKey||e.metaKey||ge(e,i),(!0===o||"touch"===o&&he.current||"mouse"===o&&!he.current)&&F.current.blur()};const me=(e,t)=>{if(!D)return;ge(e,"toggleInput");let n=B;-1===B?""===Y&&"previous"===t&&(n=j.length-1):((n+="next"===t?1:-1)<0&&(n=0),n===j.length&&(n=-1)),n=function(e,t){if(-1===e)return-1;let n=e;for(;;){if("next"===t&&n===j.length||"previous"===t&&-1===n)return-1;const e=H.querySelector(`[data-tag-index="${n}"]`);if(e&&e.hasAttribute("tabindex")&&!e.disabled&&"true"!==e.getAttribute("aria-disabled"))return n;n+="next"===t?1:-1}}(n,t),K(n),ue(n)},xe=e=>{M.current=!0,G(""),E&&E(e,"","clear"),be(e,D?[]:null,"clear")},ye=e=>{se({event:e,index:Number(e.currentTarget.getAttribute("data-option-index")),reason:"mouse"})},Oe=()=>{he.current=!0},Se=e=>{const t=Number(e.currentTarget.getAttribute("data-option-index"));ve(e,le[t],"select-option"),he.current=!1},ke=e=>{ee?ge(e,"toggleInput"):fe(e)},De=e=>{e.target.getAttribute("id")!==L&&e.preventDefault()},Re=()=>{F.current.focus(),q&&P.current&&F.current.selectionEnd-F.current.selectionStart==0&&F.current.select(),P.current=!1};let Ce=b&&Y.length>0;Ce=Ce||(D?j.length>0:null!==j);let we=le;if(x){const e=new Map;let t=!1;we=le.reduce((n,r,o)=>{const i=x(r);return n.length>0&&n[n.length-1].group===i?n[n.length-1].options.push(r):("production"!==process.env.NODE_ENV&&(e.get(i)&&!t&&(console.warn(`Material-UI: The options provided combined with the \`groupBy\` method of ${a} returns duplicated headers.`,"You can solve the issue by sorting the options with the output of `groupBy`."),t=!0),e.set(i,!0)),n.push({key:o,index:o,group:i,options:[r]})),n},[])}return{getRootProps:(e={})=>(0,_extends2.default)({"aria-owns":ae?`${L}-listbox`:null,role:"combobox","aria-expanded":ae},e,{onKeyDown:(e=>n=>{if(e.onKeyDown&&e.onKeyDown(n),!n.defaultMuiPrevented&&(-1!==B&&-1===["ArrowLeft","ArrowRight"].indexOf(n.key)&&(K(-1),ue(-1)),229!==n.which))switch(n.key){case"Home":ie&&y&&(n.preventDefault(),ce({diff:"start",direction:"next",reason:"keyboard",event:n}));break;case"End":ie&&y&&(n.preventDefault(),ce({diff:"end",direction:"previous",reason:"keyboard",event:n}));break;case"PageUp":n.preventDefault(),ce({diff:-pageSize,direction:"previous",reason:"keyboard",event:n}),fe(n);break;case"PageDown":n.preventDefault(),ce({diff:pageSize,direction:"next",reason:"keyboard",event:n}),fe(n);break;case"ArrowDown":n.preventDefault(),ce({diff:1,direction:"next",reason:"keyboard",event:n}),fe(n);break;case"ArrowUp":n.preventDefault(),ce({diff:-1,direction:"previous",reason:"keyboard",event:n}),fe(n);break;case"ArrowLeft":me(n,"previous");break;case"ArrowRight":me(n,"next");break;case"Enter":if(-1!==W.current&&ie){const e=le[W.current],r=!!h&&h(e);if(n.preventDefault(),r)return;ve(n,e,"select-option"),t&&F.current.setSelectionRange(F.current.value.length,F.current.value.length)}else b&&""!==Y&&!1===oe&&(D&&n.preventDefault(),ve(n,Y,"create-option","freeSolo"));break;case"Escape":ie?(n.preventDefault(),n.stopPropagation(),ge(n,"escape")):l&&(""!==Y||D&&j.length>0)&&(n.preventDefault(),n.stopPropagation(),xe(n));break;case"Backspace":if(D&&""===Y&&j.length>0){const e=-1===B?j.length-1:B,t=j.slice();t.splice(e,1),be(n,t,"remove-option",{option:j[e]})}}})(e),onMouseDown:De,onClick:Re}),getInputLabelProps:()=>({id:`${L}-label`,htmlFor:L}),getInputProps:()=>({id:L,value:Y,onBlur:e=>{null!==V.current&&V.current.parentElement.contains(document.activeElement)?F.current.focus():(X(!1),P.current=!0,M.current=!1,r&&-1!==W.current&&ie?ve(e,le[W.current],"blur"):r&&b&&""!==Y?ve(e,Y,"blur","freeSolo"):i&&Z(e,j),ge(e,"blur"))},onFocus:e=>{X(!0),$&&!M.current&&fe(e)},onChange:e=>{const t=e.target.value;Y!==t&&(G(t),re(!1),E&&E(e,t,"input")),""===t?s||D||be(e,null,"clear"):fe(e)},onMouseDown:e=>{""!==Y&&ee||ke(e)},"aria-activedescendant":ie?"":null,"aria-autocomplete":t?"both":"list","aria-controls":ae?`${L}-listbox`:null,autoComplete:"off",ref:F,autoCapitalize:"none",spellCheck:"false"}),getClearProps:()=>({tabIndex:-1,onClick:xe}),getPopupIndicatorProps:()=>({tabIndex:-1,onClick:ke}),getTagProps:({index:e})=>({key:e,"data-tag-index":e,tabIndex:-1,onDelete:(e=>t=>{const n=j.slice();n.splice(e,1),be(t,n,"remove-option",{option:j[e]})})(e)}),getListboxProps:()=>({role:"listbox",id:`${L}-listbox`,"aria-labelledby":`${L}-label`,ref:de,onMouseDown:e=>{e.preventDefault()}}),getOptionProps:({index:e,option:t})=>{const n=(D?j:[j]).some(e=>null!=e&&m(t,e)),r=!!h&&h(t);return{key:N(t),tabIndex:-1,role:"option",id:`${L}-option-${e}`,onMouseOver:ye,onClick:Se,onTouchStart:Oe,"data-option-index":e,"aria-disabled":r,"aria-selected":n}},id:L,inputValue:Y,value:j,dirty:Ce,popupOpen:ie,focused:Q||-1!==B,anchorEl:H,setAnchorEl:z,focusedTag:B,groupedOptions:we}}