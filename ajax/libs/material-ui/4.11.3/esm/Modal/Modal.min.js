import _objectWithoutProperties from"@babel/runtime/helpers/esm/objectWithoutProperties";import _extends from"@babel/runtime/helpers/esm/extends";import*as React from"react";import*as ReactDOM from"react-dom";import PropTypes from"prop-types";import{getThemeProps,useTheme}from"@material-ui/styles";import{elementAcceptingRef,HTMLElementType}from"@material-ui/utils";import ownerDocument from"../utils/ownerDocument";import Portal from"../Portal";import createChainedFunction from"../utils/createChainedFunction";import useForkRef from"../utils/useForkRef";import useEventCallback from"../utils/useEventCallback";import zIndex from"../styles/zIndex";import ModalManager,{ariaHidden}from"./ModalManager";import TrapFocus from"../Unstable_TrapFocus";import SimpleBackdrop from"./SimpleBackdrop";function getContainer(e){return e="function"==typeof e?e():e,ReactDOM.findDOMNode(e)}function getHasTransition(e){return!!e.children&&e.children.props.hasOwnProperty("in")}var defaultManager=new ModalManager;export var styles=function(e){return{root:{position:"fixed",zIndex:e.zIndex.modal,right:0,bottom:0,top:0,left:0},hidden:{visibility:"hidden"}}};var Modal=React.forwardRef(function(e,o){var r=useTheme(),n=getThemeProps({name:"MuiModal",props:_extends({},e),theme:r}),t=n.BackdropComponent,a=void 0===t?SimpleBackdrop:t,i=n.BackdropProps,c=n.children,s=n.closeAfterTransition,p=void 0!==s&&s,l=n.container,d=n.disableAutoFocus,u=void 0!==d&&d,f=n.disableBackdropClick,m=void 0!==f&&f,b=n.disableEnforceFocus,y=void 0!==b&&b,k=n.disableEscapeKeyDown,T=void 0!==k&&k,P=n.disablePortal,R=void 0!==P&&P,E=n.disableRestoreFocus,h=void 0!==E&&E,v=n.disableScrollLock,C=void 0!==v&&v,F=n.hideBackdrop,M=void 0!==F&&F,g=n.keepMounted,x=void 0!==g&&g,B=n.manager,D=void 0===B?defaultManager:B,w=n.onBackdropClick,A=n.onClose,I=n.onEscapeKeyDown,_=n.onRendered,K=n.open,S=_objectWithoutProperties(n,["BackdropComponent","BackdropProps","children","closeAfterTransition","container","disableAutoFocus","disableBackdropClick","disableEnforceFocus","disableEscapeKeyDown","disablePortal","disableRestoreFocus","disableScrollLock","hideBackdrop","keepMounted","manager","onBackdropClick","onClose","onEscapeKeyDown","onRendered","open"]),O=React.useState(!0),z=O[0],H=O[1],L=React.useRef({}),j=React.useRef(null),N=React.useRef(null),W=useForkRef(N,o),q=getHasTransition(n),U=function(){return ownerDocument(j.current)},V=function(){return L.current.modalRef=N.current,L.current.mountNode=j.current,L.current},G=function(){D.mount(V(),{disableScrollLock:C}),N.current.scrollTop=0},J=useEventCallback(function(){var e=getContainer(l)||U().body;D.add(V(),e),N.current&&G()}),Q=React.useCallback(function(){return D.isTopModal(V())},[D]),X=useEventCallback(function(e){j.current=e,e&&(_&&_(),K&&Q()?G():ariaHidden(N.current,!0))}),Y=React.useCallback(function(){D.remove(V())},[D]);if(React.useEffect(function(){return function(){Y()}},[Y]),React.useEffect(function(){K?J():q&&p||Y()},[K,Y,q,p,J]),!x&&!K&&(!q||z))return null;var Z=styles(r||{zIndex:zIndex}),$={};return void 0===c.props.tabIndex&&($.tabIndex=c.props.tabIndex||"-1"),q&&($.onEnter=createChainedFunction(function(){H(!1)},c.props.onEnter),$.onExited=createChainedFunction(function(){H(!0),p&&Y()},c.props.onExited)),React.createElement(Portal,{ref:X,container:l,disablePortal:R},React.createElement("div",_extends({ref:W,onKeyDown:function(e){"Escape"===e.key&&Q()&&(I&&I(e),T||(e.stopPropagation(),A&&A(e,"escapeKeyDown")))},role:"presentation"},S,{style:_extends({},Z.root,!K&&z?Z.hidden:{},S.style)}),M?null:React.createElement(a,_extends({open:K,onClick:function(e){e.target===e.currentTarget&&(w&&w(e),!m&&A&&A(e,"backdropClick"))}},i)),React.createElement(TrapFocus,{disableEnforceFocus:y,disableAutoFocus:u,disableRestoreFocus:h,getDoc:U,isEnabled:Q,open:K},React.cloneElement(c,$))))});"production"!==process.env.NODE_ENV&&(Modal.propTypes={BackdropComponent:PropTypes.elementType,BackdropProps:PropTypes.object,children:elementAcceptingRef.isRequired,closeAfterTransition:PropTypes.bool,container:PropTypes.oneOfType([HTMLElementType,PropTypes.instanceOf(React.Component),PropTypes.func]),disableAutoFocus:PropTypes.bool,disableBackdropClick:PropTypes.bool,disableEnforceFocus:PropTypes.bool,disableEscapeKeyDown:PropTypes.bool,disablePortal:PropTypes.bool,disableRestoreFocus:PropTypes.bool,disableScrollLock:PropTypes.bool,hideBackdrop:PropTypes.bool,keepMounted:PropTypes.bool,manager:PropTypes.object,onBackdropClick:PropTypes.func,onClose:PropTypes.func,onEscapeKeyDown:PropTypes.func,onRendered:PropTypes.func,open:PropTypes.bool.isRequired});export default Modal;