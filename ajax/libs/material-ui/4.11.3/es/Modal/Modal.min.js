import _objectWithoutPropertiesLoose from"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose";import _extends from"@babel/runtime/helpers/esm/extends";import*as React from"react";import*as ReactDOM from"react-dom";import PropTypes from"prop-types";import{getThemeProps,useTheme}from"@material-ui/styles";import{elementAcceptingRef,HTMLElementType}from"@material-ui/utils";import ownerDocument from"../utils/ownerDocument";import Portal from"../Portal";import createChainedFunction from"../utils/createChainedFunction";import useForkRef from"../utils/useForkRef";import useEventCallback from"../utils/useEventCallback";import zIndex from"../styles/zIndex";import ModalManager,{ariaHidden}from"./ModalManager";import TrapFocus from"../Unstable_TrapFocus";import SimpleBackdrop from"./SimpleBackdrop";function getContainer(e){return e="function"==typeof e?e():e,ReactDOM.findDOMNode(e)}function getHasTransition(e){return!!e.children&&e.children.props.hasOwnProperty("in")}const defaultManager=new ModalManager;export const styles=e=>({root:{position:"fixed",zIndex:e.zIndex.modal,right:0,bottom:0,top:0,left:0},hidden:{visibility:"hidden"}});const Modal=React.forwardRef(function(e,o){const r=useTheme(),t=getThemeProps({name:"MuiModal",props:_extends({},e),theme:r}),{BackdropComponent:n=SimpleBackdrop,BackdropProps:a,children:s,closeAfterTransition:c=!1,container:p,disableAutoFocus:l=!1,disableBackdropClick:i=!1,disableEnforceFocus:d=!1,disableEscapeKeyDown:u=!1,disablePortal:m=!1,disableRestoreFocus:b=!1,disableScrollLock:f=!1,hideBackdrop:y=!1,keepMounted:k=!1,manager:T=defaultManager,onBackdropClick:P,onClose:R,onEscapeKeyDown:E,onRendered:h,open:C}=t,F=_objectWithoutPropertiesLoose(t,["BackdropComponent","BackdropProps","children","closeAfterTransition","container","disableAutoFocus","disableBackdropClick","disableEnforceFocus","disableEscapeKeyDown","disablePortal","disableRestoreFocus","disableScrollLock","hideBackdrop","keepMounted","manager","onBackdropClick","onClose","onEscapeKeyDown","onRendered","open"]),[M,g]=React.useState(!0),x=React.useRef({}),B=React.useRef(null),D=React.useRef(null),w=useForkRef(D,o),v=getHasTransition(t),A=()=>ownerDocument(B.current),I=()=>(x.current.modalRef=D.current,x.current.mountNode=B.current,x.current),L=()=>{T.mount(I(),{disableScrollLock:f}),D.current.scrollTop=0},_=useEventCallback(()=>{const e=getContainer(p)||A().body;T.add(I(),e),D.current&&L()}),K=React.useCallback(()=>T.isTopModal(I()),[T]),S=useEventCallback(e=>{B.current=e,e&&(h&&h(),C&&K()?L():ariaHidden(D.current,!0))}),O=React.useCallback(()=>{T.remove(I())},[T]);if(React.useEffect(()=>()=>{O()},[O]),React.useEffect(()=>{C?_():v&&c||O()},[C,O,v,c,_]),!k&&!C&&(!v||M))return null;const z=()=>{g(!1)},H=()=>{g(!0),c&&O()},j=styles(r||{zIndex:zIndex}),N={};return void 0===s.props.tabIndex&&(N.tabIndex=s.props.tabIndex||"-1"),v&&(N.onEnter=createChainedFunction(z,s.props.onEnter),N.onExited=createChainedFunction(H,s.props.onExited)),React.createElement(Portal,{ref:S,container:p,disablePortal:m},React.createElement("div",_extends({ref:w,onKeyDown:e=>{"Escape"===e.key&&K()&&(E&&E(e),u||(e.stopPropagation(),R&&R(e,"escapeKeyDown")))},role:"presentation"},F,{style:_extends({},j.root,!C&&M?j.hidden:{},F.style)}),y?null:React.createElement(n,_extends({open:C,onClick:e=>{e.target===e.currentTarget&&(P&&P(e),!i&&R&&R(e,"backdropClick"))}},a)),React.createElement(TrapFocus,{disableEnforceFocus:d,disableAutoFocus:l,disableRestoreFocus:b,getDoc:A,isEnabled:K,open:C},React.cloneElement(s,N))))});"production"!==process.env.NODE_ENV&&(Modal.propTypes={BackdropComponent:PropTypes.elementType,BackdropProps:PropTypes.object,children:elementAcceptingRef.isRequired,closeAfterTransition:PropTypes.bool,container:PropTypes.oneOfType([HTMLElementType,PropTypes.instanceOf(React.Component),PropTypes.func]),disableAutoFocus:PropTypes.bool,disableBackdropClick:PropTypes.bool,disableEnforceFocus:PropTypes.bool,disableEscapeKeyDown:PropTypes.bool,disablePortal:PropTypes.bool,disableRestoreFocus:PropTypes.bool,disableScrollLock:PropTypes.bool,hideBackdrop:PropTypes.bool,keepMounted:PropTypes.bool,manager:PropTypes.object,onBackdropClick:PropTypes.func,onClose:PropTypes.func,onEscapeKeyDown:PropTypes.func,onRendered:PropTypes.func,open:PropTypes.bool.isRequired});export default Modal;