import getScrollbarSize from"../utils/getScrollbarSize";import ownerDocument from"../utils/ownerDocument";import ownerWindow from"../utils/ownerWindow";function isOverflowing(e){const t=ownerDocument(e);return t.body===e?ownerWindow(t).innerWidth>t.documentElement.clientWidth:e.scrollHeight>e.clientHeight}export function ariaHidden(e,t){t?e.setAttribute("aria-hidden","true"):e.removeAttribute("aria-hidden")};function getPaddingRight(e){return parseInt(window.getComputedStyle(e)["padding-right"],10)||0}function ariaHiddenSiblings(e,t,n,i=[],o){const d=[t,n,...i],r=["TEMPLATE","SCRIPT","STYLE"];[].forEach.call(e.children,e=>{1===e.nodeType&&-1===d.indexOf(e)&&-1===r.indexOf(e.tagName)&&ariaHidden(e,o)})}function findIndexOf(e,t){let n=-1;return e.some((e,i)=>!!t(e)&&(n=i,!0)),n}function handleContainer(e,t){const n=[],i=[],o=e.container;let d;if(!t.disableScrollLock){if(isOverflowing(o)){const e=getScrollbarSize();n.push({value:o.style.paddingRight,key:"padding-right",el:o}),o.style["padding-right"]=`${getPaddingRight(o)+e}px`,d=ownerDocument(o).querySelectorAll(".mui-fixed"),[].forEach.call(d,t=>{i.push(t.style.paddingRight),t.style.paddingRight=`${getPaddingRight(t)+e}px`})}const e=o.parentElement,t="HTML"===e.nodeName&&"scroll"===window.getComputedStyle(e)["overflow-y"]?e:o;n.push({value:t.style.overflow,key:"overflow",el:t}),t.style.overflow="hidden"}return()=>{d&&[].forEach.call(d,(e,t)=>{i[t]?e.style.paddingRight=i[t]:e.style.removeProperty("padding-right")}),n.forEach(({value:e,el:t,key:n})=>{e?t.style.setProperty(n,e):t.style.removeProperty(n)})}}function getHiddenSiblings(e){const t=[];return[].forEach.call(e.children,e=>{e.getAttribute&&"true"===e.getAttribute("aria-hidden")&&t.push(e)}),t}export default class ModalManager{constructor(){this.modals=[],this.containers=[]}add(e,t){let n=this.modals.indexOf(e);if(-1!==n)return n;n=this.modals.length,this.modals.push(e),e.modalRef&&ariaHidden(e.modalRef,!1);const i=getHiddenSiblings(t);ariaHiddenSiblings(t,e.mountNode,e.modalRef,i,!0);const o=findIndexOf(this.containers,e=>e.container===t);return-1!==o?(this.containers[o].modals.push(e),n):(this.containers.push({modals:[e],container:t,restore:null,hiddenSiblingNodes:i}),n)}mount(e,t){const n=findIndexOf(this.containers,t=>-1!==t.modals.indexOf(e)),i=this.containers[n];i.restore||(i.restore=handleContainer(i,t))}remove(e){const t=this.modals.indexOf(e);if(-1===t)return t;const n=findIndexOf(this.containers,t=>-1!==t.modals.indexOf(e)),i=this.containers[n];if(i.modals.splice(i.modals.indexOf(e),1),this.modals.splice(t,1),0===i.modals.length)i.restore&&i.restore(),e.modalRef&&ariaHidden(e.modalRef,!0),ariaHiddenSiblings(i.container,e.mountNode,e.modalRef,i.hiddenSiblingNodes,!1),this.containers.splice(n,1);else{const e=i.modals[i.modals.length-1];e.modalRef&&ariaHidden(e.modalRef,!1)}return t}isTopModal(e){return this.modals.length>0&&this.modals[this.modals.length-1]===e}};