import{EventEmitter,ElementRef,NgZone,ChangeDetectorRef,Component,ChangeDetectionStrategy,ViewEncapsulation,Input,Output,ViewChild,ContentChild,ContentChildren,NgModule}from"@angular/core";import{Header,Footer,PrimeTemplate,SharedModule}from"primeng/api";import{RippleModule}from"primeng/ripple";import{CommonModule}from"@angular/common";import{UniqueComponentId}from"primeng/utils";class Carousel{constructor(t,e,i){this.el=t,this.zone=e,this.cd=i,this.orientation="horizontal",this.verticalViewPortHeight="300px",this.contentClass="",this.indicatorsContentClass="",this.circular=!1,this.autoplayInterval=0,this.onPage=new EventEmitter,this._numVisible=1,this._numScroll=1,this._oldNumScroll=0,this.prevState={numScroll:0,numVisible:0,value:[]},this.defaultNumScroll=1,this.defaultNumVisible=1,this._page=0,this.isRemainingItemsAdded=!1,this.remainingItems=0,this.swipeThreshold=20,this.totalShiftedItems=this.page*this.numScroll*-1}get page(){return this._page}set page(t){this.isCreated&&t!==this._page&&(this.autoplayInterval&&(this.stopAutoplay(),this.allowAutoplay=!1),t>this._page&&t<this.totalDots()-1?this.step(-1,t):t<this._page&&0!==t&&this.step(1,t)),this._page=t}get numVisible(){return this._numVisible}set numVisible(t){this._numVisible=t}get numScroll(){return this._numVisible}set numScroll(t){this._numScroll=t}get value(){return this._value}set value(t){this._value=t,this.circular&&this._value&&this.setCloneItems()}ngAfterContentInit(){this.id=UniqueComponentId(),this.allowAutoplay=!!this.autoplayInterval,this.circular&&this.setCloneItems(),this.responsiveOptions&&(this.defaultNumScroll=this._numScroll,this.defaultNumVisible=this._numVisible),this.createStyle(),this.calculatePosition(),this.responsiveOptions&&this.bindDocumentListeners(),this.templates.forEach(t=>{switch(t.getType()){case"item":this.itemTemplate=t.template;break;case"header":this.headerTemplate=t.template;break;case"footer":this.footerTemplate=t.template;break;default:this.itemTemplate=t.template}})}ngAfterContentChecked(){const t=this.isCircular();let e=this.totalShiftedItems;if(this.value&&(this.prevState.numScroll!==this._numScroll||this.prevState.numVisible!==this._numVisible||this.prevState.value.length!==this.value.length)){this.autoplayInterval&&this.stopAutoplay(),this.remainingItems=(this.value.length-this._numVisible)%this._numScroll;let i=this._page;0!==this.totalDots()&&i>=this.totalDots()&&(i=this.totalDots()-1,this._page=i,this.onPage.emit({page:this.page})),e=i*this._numScroll*-1,t&&(e-=this._numVisible),i===this.totalDots()-1&&this.remainingItems>0?(e+=-1*this.remainingItems+this._numScroll,this.isRemainingItemsAdded=!0):this.isRemainingItemsAdded=!1,e!==this.totalShiftedItems&&(this.totalShiftedItems=e),this._oldNumScroll=this._numScroll,this.prevState.numScroll=this._numScroll,this.prevState.numVisible=this._numVisible,this.prevState.value=this._value,this.totalDots()>0&&this.itemsContainer&&this.itemsContainer.nativeElement&&(this.itemsContainer.nativeElement.style.transform=this.isVertical()?`translate3d(0, ${e*(100/this._numVisible)}%, 0)`:`translate3d(${e*(100/this._numVisible)}%, 0, 0)`),this.isCreated=!0,this.autoplayInterval&&this.isAutoplay()&&this.startAutoplay()}t&&(0===this.page?e=-1*this._numVisible:0===e&&(e=-1*this.value.length,this.remainingItems>0&&(this.isRemainingItemsAdded=!0)),e!==this.totalShiftedItems&&(this.totalShiftedItems=e))}createStyle(){this.carouselStyle||(this.carouselStyle=document.createElement("style"),this.carouselStyle.type="text/css",document.body.appendChild(this.carouselStyle));let t=`\n            #${this.id} .p-carousel-item {\n\t\t\t\tflex: 1 0 ${100/this.numVisible}%\n\t\t\t}\n        `;if(this.responsiveOptions){this.responsiveOptions.sort((t,e)=>{const i=t.breakpoint,s=e.breakpoint;let n=null;return-1*(n=null==i&&null!=s?-1:null!=i&&null==s?1:null==i&&null==s?0:"string"==typeof i&&"string"==typeof s?i.localeCompare(s,void 0,{numeric:!0}):i<s?-1:i>s?1:0)});for(let e=0;e<this.responsiveOptions.length;e++){let i=this.responsiveOptions[e];t+=`\n                    @media screen and (max-width: ${i.breakpoint}) {\n                        #${this.id} .p-carousel-item {\n                            flex: 1 0 ${100/i.numVisible}%\n                        }\n                    }\n                `}}this.carouselStyle.innerHTML=t}calculatePosition(){if(this.itemsContainer&&this.responsiveOptions){let t=window.innerWidth,e={numVisible:this.defaultNumVisible,numScroll:this.defaultNumScroll};for(let i=0;i<this.responsiveOptions.length;i++){let s=this.responsiveOptions[i];parseInt(s.breakpoint,10)>=t&&(e=s)}if(this._numScroll!==e.numScroll){let t=this._page;t=Math.floor(t*this._numScroll/e.numScroll);let i=e.numScroll*this.page*-1;this.isCircular()&&(i-=e.numVisible),this.totalShiftedItems=i,this._numScroll=e.numScroll,this._page=t,this.onPage.emit({page:this.page})}this._numVisible!==e.numVisible&&(this._numVisible=e.numVisible,this.setCloneItems()),this.cd.markForCheck()}}setCloneItems(){this.clonedItemsForStarting=[],this.clonedItemsForFinishing=[],this.isCircular()&&(this.clonedItemsForStarting.push(...this.value.slice(-1*this._numVisible)),this.clonedItemsForFinishing.push(...this.value.slice(0,this._numVisible)))}firstIndex(){return this.isCircular()?-1*(this.totalShiftedItems+this.numVisible):-1*this.totalShiftedItems}lastIndex(){return this.firstIndex()+this.numVisible-1}totalDots(){return this.value?Math.ceil((this.value.length-this._numVisible)/this._numScroll)+1:0}totalDotsArray(){const t=this.totalDots();return t<=0?[]:Array(t).fill(0)}isVertical(){return"vertical"===this.orientation}isCircular(){return this.circular&&this.value&&this.value.length>=this.numVisible}isAutoplay(){return this.autoplayInterval&&this.allowAutoplay}isForwardNavDisabled(){return this.isEmpty()||this._page>=this.totalDots()-1&&!this.isCircular()}isBackwardNavDisabled(){return this.isEmpty()||this._page<=0&&!this.isCircular()}isEmpty(){return!this.value||0===this.value.length}navForward(t,e){(this.isCircular()||this._page<this.totalDots()-1)&&this.step(-1,e),this.autoplayInterval&&(this.stopAutoplay(),this.allowAutoplay=!1),t&&t.cancelable&&t.preventDefault()}navBackward(t,e){(this.isCircular()||0!==this._page)&&this.step(1,e),this.autoplayInterval&&(this.stopAutoplay(),this.allowAutoplay=!1),t&&t.cancelable&&t.preventDefault()}onDotClick(t,e){let i=this._page;this.autoplayInterval&&(this.stopAutoplay(),this.allowAutoplay=!1),e>i?this.navForward(t,e):e<i&&this.navBackward(t,e)}step(t,e){let i=this.totalShiftedItems;const s=this.isCircular();if(null!=e)i=this._numScroll*e*-1,s&&(i-=this._numVisible),this.isRemainingItemsAdded=!1;else{i+=this._numScroll*t,this.isRemainingItemsAdded&&(i+=this.remainingItems-this._numScroll*t,this.isRemainingItemsAdded=!1);let n=s?i+this._numVisible:i;e=Math.abs(Math.floor(n/this._numScroll))}s&&this.page===this.totalDots()-1&&-1===t?(i=-1*(this.value.length+this._numVisible),e=0):s&&0===this.page&&1===t?(i=0,e=this.totalDots()-1):e===this.totalDots()-1&&this.remainingItems>0&&(i+=-1*this.remainingItems-this._numScroll*t,this.isRemainingItemsAdded=!0),this.itemsContainer&&(this.itemsContainer.nativeElement.style.transform=this.isVertical()?`translate3d(0, ${i*(100/this._numVisible)}%, 0)`:`translate3d(${i*(100/this._numVisible)}%, 0, 0)`,this.itemsContainer.nativeElement.style.transition="transform 500ms ease 0s"),this.totalShiftedItems=i,this._page=e,this.onPage.emit({page:this.page})}startAutoplay(){this.interval=setInterval(()=>{this.totalDots()>0&&(this.page===this.totalDots()-1?this.step(-1,0):this.step(-1,this.page+1))},this.autoplayInterval)}stopAutoplay(){this.interval&&clearInterval(this.interval)}onTransitionEnd(){this.itemsContainer&&(this.itemsContainer.nativeElement.style.transition="",0!==this.page&&this.page!==this.totalDots()-1||!this.isCircular()||(this.itemsContainer.nativeElement.style.transform=this.isVertical()?`translate3d(0, ${this.totalShiftedItems*(100/this._numVisible)}%, 0)`:`translate3d(${this.totalShiftedItems*(100/this._numVisible)}%, 0, 0)`))}onTouchStart(t){let e=t.changedTouches[0];this.startPos={x:e.pageX,y:e.pageY}}onTouchMove(t){t.cancelable&&t.preventDefault()}onTouchEnd(t){let e=t.changedTouches[0];this.isVertical()?this.changePageOnTouch(t,e.pageY-this.startPos.y):this.changePageOnTouch(t,e.pageX-this.startPos.x)}changePageOnTouch(t,e){Math.abs(e)>this.swipeThreshold&&(e<0?this.navForward(t):this.navBackward(t))}bindDocumentListeners(){this.documentResizeListener||(this.documentResizeListener=(t=>{this.calculatePosition()}),window.addEventListener("resize",this.documentResizeListener))}unbindDocumentListeners(){this.documentResizeListener&&(window.removeEventListener("resize",this.documentResizeListener),this.documentResizeListener=null)}ngOnDestroy(){this.responsiveOptions&&this.unbindDocumentListeners(),this.autoplayInterval&&this.stopAutoplay()}}Carousel.ctorParameters=(()=>[{type:ElementRef},{type:NgZone},{type:ChangeDetectorRef}]),Carousel.decorators=[{type:Component,args:[{selector:"p-carousel",template:'\n\t\t<div [attr.id]="id" [ngClass]="{\'p-carousel p-component\':true, \'p-carousel-vertical\': isVertical(), \'p-carousel-horizontal\': !isVertical()}" [ngStyle]="style" [class]="styleClass">\n\t\t\t<div class="p-carousel-header" *ngIf="headerFacet || headerTemplate">\n                <ng-content select="p-header"></ng-content>\n                <ng-container *ngTemplateOutlet="headerTemplate"></ng-container>\n\t\t\t</div>\n\t\t\t<div [class]="contentClass" [ngClass]="\'p-carousel-content\'">\n\t\t\t\t<div class="p-carousel-container">\n\t\t\t\t\t<button type="button" [ngClass]="{\'p-carousel-prev p-link\':true, \'p-disabled\': isBackwardNavDisabled()}" [disabled]="isBackwardNavDisabled()" (click)="navBackward($event)" pRipple>\n\t\t\t\t\t\t<span [ngClass]="{\'p-carousel-prev-icon pi\': true, \'pi-chevron-left\': !isVertical(), \'pi-chevron-up\': isVertical()}"></span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<div class="p-carousel-items-content" [ngStyle]="{\'height\': isVertical() ? verticalViewPortHeight : \'auto\'}">\n\t\t\t\t\t\t<div #itemsContainer class="p-carousel-items-container" (transitionend)="onTransitionEnd()" (touchend)="onTouchEnd($event)" (touchstart)="onTouchStart($event)" (touchmove)="onTouchMove($event)">\n                            <div *ngFor="let item of clonedItemsForStarting; let index = index" [ngClass]= "{\'p-carousel-item p-carousel-item-cloned\': true,\n                                \'p-carousel-item-active\': (totalShiftedItems * -1) === (value.length),\n\t\t\t\t\t\t\t    \'p-carousel-item-start\': 0 === index,\n\t\t\t\t\t\t\t    \'p-carousel-item-end\': (clonedItemsForStarting.length - 1) === index}">\n\t\t\t\t\t\t\t\t<ng-container *ngTemplateOutlet="itemTemplate; context: {$implicit: item}"></ng-container>\n\t\t\t\t\t\t\t</div>\n                            <div *ngFor="let item of value; let index = index" [ngClass]= "{\'p-carousel-item\': true,\n                                \'p-carousel-item-active\': (firstIndex() <= index && lastIndex() >= index),\n\t\t\t\t\t\t\t    \'p-carousel-item-start\': firstIndex() === index,\n\t\t\t\t\t\t\t    \'p-carousel-item-end\': lastIndex() === index}">\n\t\t\t\t\t\t\t\t<ng-container *ngTemplateOutlet="itemTemplate; context: {$implicit: item}"></ng-container>\n\t\t\t\t\t\t\t</div>\n                            <div *ngFor="let item of clonedItemsForFinishing; let index = index" [ngClass]= "{\'p-carousel-item p-carousel-item-cloned\': true,\n                                \'p-carousel-item-active\': ((totalShiftedItems *-1) === numVisible),\n\t\t\t\t\t\t\t    \'p-carousel-item-start\': 0 === index,\n\t\t\t\t\t\t\t    \'p-carousel-item-end\': (clonedItemsForFinishing.length - 1) === index}">\n\t\t\t\t\t\t\t\t<ng-container *ngTemplateOutlet="itemTemplate; context: {$implicit: item}"></ng-container>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<button type="button" [ngClass]="{\'p-carousel-next p-link\': true, \'p-disabled\': isForwardNavDisabled()}" [disabled]="isForwardNavDisabled()" (click)="navForward($event)" pRipple>\n\t\t\t\t\t\t<span [ngClass]="{\'p-carousel-prev-icon pi\': true, \'pi-chevron-right\': !isVertical(), \'pi-chevron-down\': isVertical()}"></span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t\t<ul [ngClass]="\'p-carousel-indicators p-reset\'" [class]="indicatorsContentClass">\n\t\t\t\t\t<li *ngFor="let totalDot of totalDotsArray(); let i = index" [ngClass]="{\'p-carousel-indicator\':true,\'p-highlight\': _page === i}">\n\t\t\t\t\t\t<button type="button" class="p-link" (click)="onDotClick($event, i)"></button>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t</div>\n\t\t\t<div class="p-carousel-footer" *ngIf="footerFacet || footerTemplate">\n                <ng-content select="p-footer"></ng-content>\n                <ng-container *ngTemplateOutlet="footerTemplate"></ng-container>\n\t\t\t</div>\n\t\t</div>\n    ',changeDetection:ChangeDetectionStrategy.OnPush,encapsulation:ViewEncapsulation.None,styles:[".p-carousel{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column}.p-carousel-content{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;overflow:auto}.p-carousel-next,.p-carousel-prev{-ms-flex-item-align:center;align-self:center;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center;overflow:hidden;position:relative}.p-carousel-container{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row}.p-carousel-items-content{overflow:hidden;width:100%}.p-carousel-items-container{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row}.p-carousel-indicators{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-pack:center;justify-content:center;-ms-flex-wrap:wrap;flex-wrap:wrap}.p-carousel-indicator>button{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center}.p-carousel-vertical .p-carousel-container{-ms-flex-direction:column;flex-direction:column}.p-carousel-vertical .p-carousel-items-container{-ms-flex-direction:column;flex-direction:column;height:100%}.p-items-hidden .p-carousel-item{visibility:hidden}.p-items-hidden .p-carousel-item.p-carousel-item-active{visibility:visible}"]}]}],Carousel.ctorParameters=(()=>[{type:ElementRef},{type:NgZone},{type:ChangeDetectorRef}]),Carousel.propDecorators={page:[{type:Input}],numVisible:[{type:Input}],numScroll:[{type:Input}],responsiveOptions:[{type:Input}],orientation:[{type:Input}],verticalViewPortHeight:[{type:Input}],contentClass:[{type:Input}],indicatorsContentClass:[{type:Input}],value:[{type:Input}],circular:[{type:Input}],autoplayInterval:[{type:Input}],style:[{type:Input}],styleClass:[{type:Input}],onPage:[{type:Output}],itemsContainer:[{type:ViewChild,args:["itemsContainer"]}],headerFacet:[{type:ContentChild,args:[Header]}],footerFacet:[{type:ContentChild,args:[Footer]}],templates:[{type:ContentChildren,args:[PrimeTemplate]}]};class CarouselModule{}CarouselModule.decorators=[{type:NgModule,args:[{imports:[CommonModule,SharedModule,RippleModule],exports:[CommonModule,Carousel,SharedModule],declarations:[Carousel]}]}];export{Carousel,CarouselModule};