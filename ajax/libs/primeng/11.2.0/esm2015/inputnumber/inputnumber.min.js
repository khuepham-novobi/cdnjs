import{NgModule,Component,ChangeDetectionStrategy,Input,ElementRef,ViewChild,EventEmitter,Output,forwardRef,ViewEncapsulation,ChangeDetectorRef}from"@angular/core";import{CommonModule}from"@angular/common";import{InputTextModule}from"primeng/inputtext";import{ButtonModule}from"primeng/button";import{NG_VALUE_ACCESSOR}from"@angular/forms";export const INPUTNUMBER_VALUE_ACCESSOR={provide:NG_VALUE_ACCESSOR,useExisting:forwardRef(()=>InputNumber),multi:!0};export class InputNumber{constructor(t,e){this.el=t,this.cd=e,this.showButtons=!1,this.format=!0,this.buttonLayout="stacked",this.incrementButtonIcon="pi pi-angle-up",this.decrementButtonIcon="pi pi-angle-down",this.step=1,this.onInput=new EventEmitter,this.onFocus=new EventEmitter,this.onBlur=new EventEmitter,this.onKeyDown=new EventEmitter,this.onModelChange=(()=>{}),this.onModelTouched=(()=>{}),this.groupChar="",this.prefixChar="",this.suffixChar="",this._modeOption="decimal",this._useGroupingOption=!0}get locale(){return this._localeOption}set locale(t){this._localeOption=t,this.updateConstructParser()}get localeMatcher(){return this._localeMatcherOption}set localeMatcher(t){this._localeMatcherOption=t,this.updateConstructParser()}get mode(){return this._modeOption}set mode(t){this._modeOption=t,this.updateConstructParser()}get currency(){return this._currencyOption}set currency(t){this._currencyOption=t,this.updateConstructParser()}get currencyDisplay(){return this._currencyDisplayOption}set currencyDisplay(t){this._currencyDisplayOption=t,this.updateConstructParser()}get useGrouping(){return this._useGroupingOption}set useGrouping(t){this._useGroupingOption=t,this.updateConstructParser()}get minFractionDigits(){return this._minFractionDigitsOption}set minFractionDigits(t){this._minFractionDigitsOption=t,this.updateConstructParser()}get maxFractionDigits(){return this._maxFractionDigitsOption}set maxFractionDigits(t){this._maxFractionDigitsOption=t,this.updateConstructParser()}get prefix(){return this._prefixOption}set prefix(t){this._prefixOption=t,this.updateConstructParser()}get suffix(){return this._suffixOption}set suffix(t){this._suffixOption=t,this.updateConstructParser()}ngOnInit(){this.constructParser(),this.initialized=!0}getOptions(){return{localeMatcher:this.localeMatcher,style:this.mode,currency:this.currency,currencyDisplay:this.currencyDisplay,useGrouping:this.useGrouping,minimumFractionDigits:this.minFractionDigits,maximumFractionDigits:this.maxFractionDigits}}constructParser(){this.numberFormat=new Intl.NumberFormat(this.locale,this.getOptions());const t=[...new Intl.NumberFormat(this.locale,{useGrouping:!1}).format(9876543210)].reverse(),e=new Map(t.map((t,e)=>[t,e]));this._numeral=new RegExp(`[${t.join("")}]`,"g"),this._decimal=this.getDecimalExpression(),this._group=this.getGroupingExpression(),this._minusSign=this.getMinusSignExpression(),this._currency=this.getCurrencyExpression(),this._suffix=this.getSuffixExpression(),this._prefix=this.getPrefixExpression(),this._index=(t=>e.get(t))}updateConstructParser(){this.initialized&&this.constructParser()}escapeRegExp(t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}getDecimalExpression(){const t=new Intl.NumberFormat(this.locale,{useGrouping:!1});return new RegExp(`[${t.format(1.1).trim().replace(this._numeral,"")}]`,"g")}getGroupingExpression(){const t=new Intl.NumberFormat(this.locale,{useGrouping:!0});return this.groupChar=t.format(1e6).trim().replace(this._numeral,"").charAt(0),new RegExp(`[${this.groupChar}]`,"g")}getMinusSignExpression(){const t=new Intl.NumberFormat(this.locale,{useGrouping:!1});return new RegExp(`[${t.format(-1).trim().replace(this._numeral,"")}]`,"g")}getCurrencyExpression(){if(this.currency){const t=new Intl.NumberFormat(this.locale,{style:"currency",currency:this.currency,currencyDisplay:this.currencyDisplay});return new RegExp(`[${t.format(1).replace(/\s/g,"").replace(this._numeral,"").replace(this._decimal,"").replace(this._group,"")}]`,"g")}return new RegExp("[]","g")}getPrefixExpression(){if(this.prefix)this.prefixChar=this.prefix;else{const t=new Intl.NumberFormat(this.locale,{style:this.mode,currency:this.currency,currencyDisplay:this.currencyDisplay});this.prefixChar=t.format(1).split("1")[0]}return new RegExp(`${this.escapeRegExp(this.prefixChar||"")}`,"g")}getSuffixExpression(){if(this.suffix)this.suffixChar=this.suffix;else{const t=new Intl.NumberFormat(this.locale,{style:this.mode,currency:this.currency,currencyDisplay:this.currencyDisplay,minimumFractionDigits:0,maximumFractionDigits:0});this.suffixChar=t.format(1).split("1")[1]}return new RegExp(`${this.escapeRegExp(this.suffixChar||"")}`,"g")}formatValue(t){if(null!=t){if("-"===t)return t;if(this.format){let e=new Intl.NumberFormat(this.locale,this.getOptions()).format(t);return this.prefix&&(e=this.prefix+e),this.suffix&&(e+=this.suffix),e}return t.toString()}return""}parseValue(t){let e=t.replace(this._suffix,"").replace(this._prefix,"").trim().replace(/\s/g,"").replace(this._currency,"").replace(this._group,"").replace(this._minusSign,"-").replace(this._decimal,".").replace(this._numeral,this._index);if(e){if("-"===e)return e;let t=+e;return isNaN(t)?null:t}return null}repeat(t,e,n){let i=e||500;this.clearTimer(),this.timer=setTimeout(()=>{this.repeat(t,40,n)},i),this.spin(t,n)}spin(t,e){let n=this.step*e,i=this.parseValue(this.input.nativeElement.value)||0,s=this.validateValue(i+n);this.maxlength&&this.maxlength<this.formatValue(s).length||(this.updateInput(s,null,"spin"),this.updateModel(t,s),this.handleOnInput(t,i,s))}onUpButtonMouseDown(t){this.input.nativeElement.focus(),this.repeat(t,null,1),t.preventDefault()}onUpButtonMouseUp(){this.clearTimer()}onUpButtonMouseLeave(){this.clearTimer()}onUpButtonKeyDown(t){32!==t.keyCode&&13!==t.keyCode||this.repeat(t,null,1)}onUpButtonKeyUp(){this.clearTimer()}onDownButtonMouseDown(t){this.input.nativeElement.focus(),this.repeat(t,null,-1),t.preventDefault()}onDownButtonMouseUp(){this.clearTimer()}onDownButtonMouseLeave(){this.clearTimer()}onDownButtonKeyUp(){this.clearTimer()}onDownButtonKeyDown(t){32!==t.keyCode&&13!==t.keyCode||this.repeat(t,null,-1)}onUserInput(t){this.isSpecialChar&&(t.target.value=this.lastValue),this.isSpecialChar=!1}onInputKeyDown(t){if(this.lastValue=t.target.value,t.shiftKey||t.altKey)return void(this.isSpecialChar=!0);let e=t.target.selectionStart,n=t.target.selectionEnd,i=t.target.value,s=null;switch(t.altKey&&t.preventDefault(),t.which){case 38:this.spin(t,1),t.preventDefault();break;case 40:this.spin(t,-1),t.preventDefault();break;case 37:this.isNumeralChar(i.charAt(e-1))||t.preventDefault();break;case 39:this.isNumeralChar(i.charAt(e))||t.preventDefault();break;case 13:let u=this.validateValue(this.parseValue(this.input.nativeElement.value));this.input.nativeElement.value=this.formatValue(u),this.input.nativeElement.setAttribute("aria-valuenow",u),this.updateModel(t,u);break;case 8:if(t.preventDefault(),e===n){let n=i.charAt(e-1),u=i.search(this._decimal);this._decimal.lastIndex=0,this.isNumeralChar(n)&&(this._group.test(n)?(this._group.lastIndex=0,s=i.slice(0,e-2)+i.slice(e-1)):this._decimal.test(n)?(this._decimal.lastIndex=0,this.input.nativeElement.setSelectionRange(e-1,e-1)):u>0&&e>u?s=i.slice(0,e-1)+"0"+i.slice(e):u>0&&1===u?(s=i.slice(0,e-1)+"0"+i.slice(e),s=this.parseValue(s)>0?s:""):s=i.slice(0,e-1)+i.slice(e)),this.updateValue(t,s,null,"delete-single")}else s=this.deleteRange(i,e,n),this.updateValue(t,s,null,"delete-range");break;case 46:if(t.preventDefault(),e===n){let n=i.charAt(e),u=i.search(this._decimal);this._decimal.lastIndex=0,this.isNumeralChar(n)&&(this._group.test(n)?(this._group.lastIndex=0,s=i.slice(0,e)+i.slice(e+2)):this._decimal.test(n)?(this._decimal.lastIndex=0,this.input.nativeElement.setSelectionRange(e+1,e+1)):u>0&&e>u?s=i.slice(0,e)+"0"+i.slice(e+1):u>0&&1===u?(s=i.slice(0,e)+"0"+i.slice(e+1),s=this.parseValue(s)>0?s:""):s=i.slice(0,e)+i.slice(e+1)),this.updateValue(t,s,null,"delete-back-single")}else s=this.deleteRange(i,e,n),this.updateValue(t,s,null,"delete-range")}this.onKeyDown.emit(t)}onInputKeyPress(t){t.preventDefault();let e=t.which||t.keyCode,n=String.fromCharCode(e);const i=this.isDecimalSign(n),s=this.isMinusSign(n);(48<=e&&e<=57||s||i)&&this.insert(t,n,{isDecimalSign:i,isMinusSign:s})}onPaste(t){t.preventDefault();let e=(t.clipboardData||window.clipboardData).getData("Text");if(e){let n=this.parseValue(e);null!=n&&this.insert(t,n.toString())}}isMinusSign(t){return!!this._minusSign.test(t)&&(this._minusSign.lastIndex=0,!0)}isDecimalSign(t){return!!this._decimal.test(t)&&(this._decimal.lastIndex=0,!0)}insert(t,e,n={isDecimalSign:!1,isMinusSign:!1}){let i=this.input.nativeElement.selectionStart,s=this.input.nativeElement.selectionEnd,u=this.input.nativeElement.value.trim();const r=u.search(this._decimal);this._decimal.lastIndex=0;const a=u.search(this._minusSign);let o;if(this._minusSign.lastIndex=0,n.isMinusSign)0===i&&(o=u,-1!==a&&0===s||(o=this.insertText(u,e,0,s)),this.updateValue(t,o,e,"insert"));else if(n.isDecimalSign)r>0&&i===r?this.updateValue(t,u,e,"insert"):r>i&&r<s&&(o=this.insertText(u,e,i,s),this.updateValue(t,o,e,"insert"));else{const n=this.numberFormat.resolvedOptions().maximumFractionDigits,a=i!==s?"range-insert":"insert";r>0&&i>r?i+e.length-(r+1)<=n&&(o=u.slice(0,i)+e+u.slice(i+e.length),this.updateValue(t,o,e,a)):(o=this.insertText(u,e,i,s),this.updateValue(t,o,e,a))}}insertText(t,e,n,i){if(2==e.split(".").length){const s=t.slice(n,i).search(this._decimal);return this._decimal.lastIndex=0,s>0?t.slice(0,n)+this.formatValue(e)+t.slice(i):t||this.formatValue(e)}return i-n===t.length?this.formatValue(e):0===n?e+t.slice(i):i===t.length?t.slice(0,n)+e:t.slice(0,n)+e+t.slice(i)}deleteRange(t,e,n){let i;return i=n-e===t.length?"":0===e?t.slice(n):n===t.length?t.slice(0,e):t.slice(0,e)+t.slice(n)}initCursor(){let t=this.input.nativeElement.selectionStart,e=this.input.nativeElement.value,n=e.length,i=null,s=e.charAt(t);if(this.isNumeralChar(s))return;let u=t-1;for(;u>=0;){if(s=e.charAt(u),this.isNumeralChar(s)){i=u;break}u--}if(null!==i)this.input.nativeElement.setSelectionRange(i+1,i+1);else{for(u=t+1;u<n;){if(s=e.charAt(u),this.isNumeralChar(s)){i=u;break}u++}null!==i&&this.input.nativeElement.setSelectionRange(i,i)}}onInputClick(){this.initCursor()}isNumeralChar(t){return!(1!==t.length||!(this._numeral.test(t)||this._decimal.test(t)||this._group.test(t)||this._minusSign.test(t)))&&(this.resetRegex(),!0)}resetRegex(){this._numeral.lastIndex=0,this._decimal.lastIndex=0,this._group.lastIndex=0,this._minusSign.lastIndex=0}updateValue(t,e,n,i){let s=this.input.nativeElement.value,u=null;null!=e&&(u=this.parseValue(e),this.updateInput(u,n,i)),this.handleOnInput(t,s,u)}handleOnInput(t,e,n){this.isValueChanged(e,n)&&this.onInput.emit({originalEvent:t,value:n})}isValueChanged(t,e){if(null===e&&null!==t)return!0;if(null!=e){return e!==("string"==typeof t?this.parseValue(t):t)}return!1}validateValue(t){return null!==this.min&&t<this.min?this.min:null!==this.max&&t>this.max?this.max:"-"===t?null:t}updateInput(t,e,n){e=e||"";let i=this.input.nativeElement.value,s=this.formatValue(t),u=i.length;if(0===u){this.input.nativeElement.value=s,this.input.nativeElement.setSelectionRange(0,0),this.initCursor();const t=(this.prefixChar||"").length+e.length;this.input.nativeElement.setSelectionRange(t,t)}else{let t=this.input.nativeElement.selectionStart,r=this.input.nativeElement.selectionEnd;if(this.maxlength&&this.maxlength<s.length)return;this.input.nativeElement.value=s;let a=s.length;if("range-insert"===n){const n=this.parseValue((i||"").slice(0,t)),u=(null!==n?n.toString():"").split("").join(`(${this.groupChar})?`),a=new RegExp(u,"g");a.test(s);const o=e.split("").join(`(${this.groupChar})?`),l=new RegExp(o,"g");l.test(s.slice(a.lastIndex)),r=a.lastIndex+l.lastIndex,this.input.nativeElement.setSelectionRange(r,r)}else if(a===u)"insert"===n||"delete-back-single"===n?this.input.nativeElement.setSelectionRange(r+1,r+1):"delete-single"===n?this.input.nativeElement.setSelectionRange(r-1,r-1):"delete-range"!==n&&"spin"!==n||this.input.nativeElement.setSelectionRange(r,r);else if("delete-back-single"===n){let t=i.charAt(r-1),e=i.charAt(r),n=u-a,s=this._group.test(e);s&&1===n?r+=1:!s&&this.isNumeralChar(t)&&(r+=-1*n+1),this._group.lastIndex=0,this.input.nativeElement.setSelectionRange(r,r)}else r+=a-u,this.input.nativeElement.setSelectionRange(r,r)}this.input.nativeElement.setAttribute("aria-valuenow",t)}onInputFocus(t){this.focused=!0,this.onFocus.emit(t)}onInputBlur(t){this.focused=!1;let e=this.validateValue(this.parseValue(this.input.nativeElement.value));this.input.nativeElement.value=this.formatValue(e),this.input.nativeElement.setAttribute("aria-valuenow",e),this.updateModel(t,e),this.onBlur.emit(t)}formattedValue(){return this.formatValue(this.value)}updateModel(t,e){this.value!==e&&(this.value=e,this.onModelChange(e)),this.onModelTouched()}writeValue(t){this.value=t,this.cd.markForCheck()}registerOnChange(t){this.onModelChange=t}registerOnTouched(t){this.onModelTouched=t}setDisabledState(t){this.disabled=t,this.cd.markForCheck()}get filled(){return null!=this.value&&this.value.toString().length>0}clearTimer(){this.timer&&clearInterval(this.timer)}};InputNumber.decorators=[{type:Component,args:[{selector:"p-inputNumber",template:'\n        <span [ngClass]="{\'p-inputnumber p-component\': true,\'p-inputnumber-buttons-stacked\': this.showButtons && this.buttonLayout === \'stacked\',\n                \'p-inputnumber-buttons-horizontal\': this.showButtons && this.buttonLayout === \'horizontal\', \'p-inputnumber-buttons-vertical\': this.showButtons && this.buttonLayout === \'vertical\'}"\n                [ngStyle]="style" [class]="styleClass">\n            <input #input [ngClass]="\'p-inputnumber-input\'" [ngStyle]="inputStyle" [class]="inputStyleClass" pInputText [value]="formattedValue()" [attr.placeholder]="placeholder" [attr.title]="title" [attr.id]="inputId"\n                [attr.size]="size" [attr.name]="name" [attr.autocomplete]="autocomplete" [attr.maxlength]="maxlength" [attr.tabindex]="tabindex" [attr.aria-label]="ariaLabel"\n                [attr.aria-required]="ariaRequired" [disabled]="disabled" [attr.required]="required" [attr.aria-valumin]="min" [attr.aria-valuemax]="max"\n                (input)="onUserInput($event)" (keydown)="onInputKeyDown($event)" (keypress)="onInputKeyPress($event)" (paste)="onPaste($event)" (click)="onInputClick()"\n                (focus)="onInputFocus($event)" (blur)="onInputBlur($event)">\n            <span class="p-inputnumber-button-group" *ngIf="showButtons && buttonLayout === \'stacked\'">\n                <button type="button" pButton [ngClass]="{\'p-inputnumber-button p-inputnumber-button-up\': true}" [class]="incrementButtonClass" [icon]="incrementButtonIcon" [disabled]="disabled"\n                    (mousedown)="this.onUpButtonMouseDown($event)" (mouseup)="onUpButtonMouseUp()" (mouseleave)="onUpButtonMouseLeave()" (keydown)="onUpButtonKeyDown($event)" (keyup)="onUpButtonKeyUp()"></button>\n                <button type="button" pButton [ngClass]="{\'p-inputnumber-button p-inputnumber-button-down\': true}" [class]="decrementButtonClass" [icon]="decrementButtonIcon" [disabled]="disabled"\n                    (mousedown)="this.onDownButtonMouseDown($event)" (mouseup)="onDownButtonMouseUp()" (mouseleave)="onDownButtonMouseLeave()" (keydown)="onDownButtonKeyDown($event)" (keyup)="onDownButtonKeyUp()"></button>\n            </span>\n            <button type="button" pButton [ngClass]="{\'p-inputnumber-button p-inputnumber-button-up\': true}" [class]="incrementButtonClass" [icon]="incrementButtonIcon" *ngIf="showButtons && buttonLayout !== \'stacked\'" [disabled]="disabled"\n                (mousedown)="this.onUpButtonMouseDown($event)" (mouseup)="onUpButtonMouseUp()" (mouseleave)="onUpButtonMouseLeave()" (keydown)="onUpButtonKeyDown($event)" (keyup)="onUpButtonKeyUp()"></button>\n            <button type="button" pButton [ngClass]="{\'p-inputnumber-button p-inputnumber-button-down\': true}" [class]="decrementButtonClass" [icon]="decrementButtonIcon" *ngIf="showButtons && buttonLayout !== \'stacked\'" [disabled]="disabled"\n                (mousedown)="this.onDownButtonMouseDown($event)" (mouseup)="onDownButtonMouseUp()" (mouseleave)="onDownButtonMouseLeave()" (keydown)="onDownButtonKeyDown($event)" (keyup)="onDownButtonKeyUp()"></button>\n        </span>\n    ',changeDetection:ChangeDetectionStrategy.OnPush,providers:[INPUTNUMBER_VALUE_ACCESSOR],encapsulation:ViewEncapsulation.None,host:{"[class.p-inputwrapper-filled]":"filled","[class.p-inputwrapper-focus]":"focused"},styles:[".p-inputnumber{display:inline-flex}.p-inputnumber-button{align-items:center;display:flex;flex:0 0 auto;justify-content:center}.p-inputnumber-buttons-horizontal .p-button.p-inputnumber-button .p-button-label,.p-inputnumber-buttons-stacked .p-button.p-inputnumber-button .p-button-label{display:none}.p-inputnumber-buttons-stacked .p-button.p-inputnumber-button-up{border-bottom-left-radius:0;border-bottom-right-radius:0;border-top-left-radius:0;padding:0}.p-inputnumber-buttons-stacked .p-inputnumber-input{border-bottom-right-radius:0;border-top-right-radius:0}.p-inputnumber-buttons-stacked .p-button.p-inputnumber-button-down{border-bottom-left-radius:0;border-top-left-radius:0;border-top-right-radius:0;padding:0}.p-inputnumber-buttons-stacked .p-inputnumber-button-group{display:flex;flex-direction:column}.p-inputnumber-buttons-stacked .p-inputnumber-button-group .p-button.p-inputnumber-button{flex:1 1 auto}.p-inputnumber-buttons-horizontal .p-button.p-inputnumber-button-up{border-bottom-left-radius:0;border-top-left-radius:0;order:3}.p-inputnumber-buttons-horizontal .p-inputnumber-input{border-radius:0;order:2}.p-inputnumber-buttons-horizontal .p-button.p-inputnumber-button-down{border-bottom-right-radius:0;border-top-right-radius:0;order:1}.p-inputnumber-buttons-vertical{flex-direction:column}.p-inputnumber-buttons-vertical .p-button.p-inputnumber-button-up{border-bottom-left-radius:0;border-bottom-right-radius:0;order:1;width:100%}.p-inputnumber-buttons-vertical .p-inputnumber-input{border-radius:0;order:2;text-align:center}.p-inputnumber-buttons-vertical .p-button.p-inputnumber-button-down{border-top-left-radius:0;border-top-right-radius:0;order:3;width:100%}.p-inputnumber-input{flex:1 1 auto}.p-fluid .p-inputnumber{width:100%}.p-fluid .p-inputnumber .p-inputnumber-input{width:1%}.p-fluid .p-inputnumber-buttons-vertical .p-inputnumber-input{width:100%}"]}]}],InputNumber.ctorParameters=(()=>[{type:ElementRef},{type:ChangeDetectorRef}]),InputNumber.propDecorators={showButtons:[{type:Input}],format:[{type:Input}],buttonLayout:[{type:Input}],disabled:[{type:Input}],inputId:[{type:Input}],styleClass:[{type:Input}],style:[{type:Input}],placeholder:[{type:Input}],size:[{type:Input}],maxlength:[{type:Input}],tabindex:[{type:Input}],title:[{type:Input}],ariaLabel:[{type:Input}],ariaRequired:[{type:Input}],name:[{type:Input}],required:[{type:Input}],autocomplete:[{type:Input}],min:[{type:Input}],max:[{type:Input}],incrementButtonClass:[{type:Input}],decrementButtonClass:[{type:Input}],incrementButtonIcon:[{type:Input}],decrementButtonIcon:[{type:Input}],step:[{type:Input}],inputStyle:[{type:Input}],inputStyleClass:[{type:Input}],input:[{type:ViewChild,args:["input"]}],onInput:[{type:Output}],onFocus:[{type:Output}],onBlur:[{type:Output}],onKeyDown:[{type:Output}],locale:[{type:Input}],localeMatcher:[{type:Input}],mode:[{type:Input}],currency:[{type:Input}],currencyDisplay:[{type:Input}],useGrouping:[{type:Input}],minFractionDigits:[{type:Input}],maxFractionDigits:[{type:Input}],prefix:[{type:Input}],suffix:[{type:Input}]};export class InputNumberModule{};InputNumberModule.decorators=[{type:NgModule,args:[{imports:[CommonModule,InputTextModule,ButtonModule],exports:[InputNumber],declarations:[InputNumber]}]}];