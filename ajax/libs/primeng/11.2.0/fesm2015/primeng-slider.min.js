import{forwardRef,EventEmitter,Component,ChangeDetectionStrategy,ViewEncapsulation,ElementRef,Renderer2,NgZone,ChangeDetectorRef,Input,Output,ViewChild,NgModule}from"@angular/core";import{CommonModule}from"@angular/common";import{DomHandler}from"primeng/dom";import{NG_VALUE_ACCESSOR}from"@angular/forms";const SLIDER_VALUE_ACCESSOR={provide:NG_VALUE_ACCESSOR,useExisting:forwardRef(()=>Slider),multi:!0};class Slider{constructor(e,t,a,i){this.el=e,this.renderer=t,this.ngZone=a,this.cd=i,this.min=0,this.max=100,this.orientation="horizontal",this.tabindex=0,this.onChange=new EventEmitter,this.onSlideEnd=new EventEmitter,this.handleValues=[],this.onModelChange=(()=>{}),this.onModelTouched=(()=>{}),this.handleIndex=0}onMouseDown(e,t){this.disabled||(this.dragging=!0,this.updateDomData(),this.sliderHandleClick=!0,this.range&&this.handleValues&&this.handleValues[0]===this.max?this.handleIndex=0:this.handleIndex=t,this.bindDragListeners(),e.target.focus(),e.preventDefault(),this.animate&&DomHandler.removeClass(this.el.nativeElement.children[0],"p-slider-animate"))}onTouchStart(e,t){if(!this.disabled){var a=e.changedTouches[0];this.startHandleValue=this.range?this.handleValues[t]:this.handleValue,this.dragging=!0,this.range&&this.handleValues&&this.handleValues[0]===this.max?this.handleIndex=0:this.handleIndex=t,"horizontal"===this.orientation?(this.startx=parseInt(a.clientX,10),this.barWidth=this.el.nativeElement.children[0].offsetWidth):(this.starty=parseInt(a.clientY,10),this.barHeight=this.el.nativeElement.children[0].offsetHeight),this.animate&&DomHandler.removeClass(this.el.nativeElement.children[0],"p-slider-animate"),e.preventDefault()}}onTouchMove(e,t){if(!this.disabled){var a=e.changedTouches[0],i=0;i="horizontal"===this.orientation?Math.floor(100*(parseInt(a.clientX,10)-this.startx)/this.barWidth)+this.startHandleValue:Math.floor(100*(this.starty-parseInt(a.clientY,10))/this.barHeight)+this.startHandleValue,this.setValueFromHandle(e,i),e.preventDefault()}}onTouchEnd(e,t){this.disabled||(this.dragging=!1,this.range?this.onSlideEnd.emit({originalEvent:e,values:this.values}):this.onSlideEnd.emit({originalEvent:e,value:this.value}),this.animate&&DomHandler.addClass(this.el.nativeElement.children[0],"p-slider-animate"),e.preventDefault())}onBarClick(e){this.disabled||(this.sliderHandleClick||(this.updateDomData(),this.handleChange(e)),this.sliderHandleClick=!1)}onHandleKeydown(e,t){this.disabled||(38==e.which||39==e.which?this.spin(e,1,t):37!=e.which&&40!=e.which||this.spin(e,-1,t))}spin(e,t,a){let i=(this.step||1)*t;this.range?(this.handleIndex=a,this.updateValue(this.values[this.handleIndex]+i),this.updateHandleValue()):(this.updateValue(this.value+i),this.updateHandleValue()),e.preventDefault()}handleChange(e){let t=this.calculateHandleValue(e);this.setValueFromHandle(e,t)}bindDragListeners(){this.ngZone.runOutsideAngular(()=>{const e=this.el?this.el.nativeElement.ownerDocument:"document";this.dragListener||(this.dragListener=this.renderer.listen(e,"mousemove",e=>{this.dragging&&this.ngZone.run(()=>{this.handleChange(e)})})),this.mouseupListener||(this.mouseupListener=this.renderer.listen(e,"mouseup",e=>{this.dragging&&(this.dragging=!1,this.ngZone.run(()=>{this.range?this.onSlideEnd.emit({originalEvent:e,values:this.values}):this.onSlideEnd.emit({originalEvent:e,value:this.value}),this.animate&&DomHandler.addClass(this.el.nativeElement.children[0],"p-slider-animate")}))}))})}unbindDragListeners(){this.dragListener&&this.dragListener(),this.mouseupListener&&this.mouseupListener()}setValueFromHandle(e,t){let a=this.getValueFromHandle(t);this.range?this.step?this.handleStepChange(a,this.values[this.handleIndex]):(this.handleValues[this.handleIndex]=t,this.updateValue(a,e)):this.step?this.handleStepChange(a,this.value):(this.handleValue=t,this.updateValue(a,e)),this.cd.markForCheck()}handleStepChange(e,t){let a=e-t,i=t;a<0?i=t+Math.ceil(e/this.step-t/this.step)*this.step:a>0&&(i=t+Math.floor(e/this.step-t/this.step)*this.step),this.updateValue(i),this.updateHandleValue()}writeValue(e){this.range?this.values=e||[0,0]:this.value=e||0,this.updateHandleValue(),this.cd.markForCheck()}registerOnChange(e){this.onModelChange=e}registerOnTouched(e){this.onModelTouched=e}setDisabledState(e){this.disabled=e,this.cd.markForCheck()}get rangeStartLeft(){return this.isVertical()?"auto":this.handleValues[0]+"%"}get rangeStartBottom(){return this.isVertical()?this.handleValues[0]+"%":"auto"}get rangeEndLeft(){return this.isVertical()?"auto":this.handleValues[1]+"%"}get rangeEndBottom(){return this.isVertical()?this.handleValues[1]+"%":"auto"}isVertical(){return"vertical"===this.orientation}updateDomData(){let e=this.el.nativeElement.children[0].getBoundingClientRect();this.initX=e.left+DomHandler.getWindowScrollLeft(),this.initY=e.top+DomHandler.getWindowScrollTop(),this.barWidth=this.el.nativeElement.children[0].offsetWidth,this.barHeight=this.el.nativeElement.children[0].offsetHeight}calculateHandleValue(e){return"horizontal"===this.orientation?100*(e.pageX-this.initX)/this.barWidth:100*(this.initY+this.barHeight-e.pageY)/this.barHeight}updateHandleValue(){this.range?(this.handleValues[0]=100*(this.values[0]<this.min?0:this.values[0]-this.min)/(this.max-this.min),this.handleValues[1]=100*(this.values[1]>this.max?100:this.values[1]-this.min)/(this.max-this.min)):this.value<this.min?this.handleValue=0:this.value>this.max?this.handleValue=100:this.handleValue=100*(this.value-this.min)/(this.max-this.min)}updateValue(e,t){if(this.range){let a=e;0==this.handleIndex?(a<this.min?(a=this.min,this.handleValues[0]=0):a>this.values[1]&&(a=this.values[1],this.handleValues[0]=this.handleValues[1]),this.sliderHandleStart.nativeElement.focus()):(a>this.max?(a=this.max,this.handleValues[1]=100):a<this.values[0]&&(a=this.values[0],this.handleValues[1]=this.handleValues[0]),this.sliderHandleEnd.nativeElement.focus()),this.values[this.handleIndex]=this.getNormalizedValue(a),this.values=this.values.slice(),this.onModelChange(this.values),this.onChange.emit({event:t,values:this.values})}else e<this.min?(e=this.min,this.handleValue=0):e>this.max&&(e=this.max,this.handleValue=100),this.value=this.getNormalizedValue(e),this.onModelChange(this.value),this.onChange.emit({event:t,value:this.value}),this.sliderHandle.nativeElement.focus()}getValueFromHandle(e){return(this.max-this.min)*(e/100)+this.min}getDecimalsCount(e){return e&&Math.floor(e)!==e&&e.toString().split(".")[1].length||0}getNormalizedValue(e){let t=this.getDecimalsCount(this.step);return t>0?+e.toFixed(t):Math.floor(e)}ngOnDestroy(){this.unbindDragListeners()}}Slider.decorators=[{type:Component,args:[{selector:"p-slider",template:'\n        <div [ngStyle]="style" [class]="styleClass" [ngClass]="{\'p-slider p-component\':true,\'p-disabled\':disabled,\n            \'p-slider-horizontal\':orientation == \'horizontal\',\'p-slider-vertical\':orientation == \'vertical\',\'p-slider-animate\':animate}"\n            (click)="onBarClick($event)">\n            <span *ngIf="range && orientation == \'horizontal\'" class="p-slider-range" [ngStyle]="{\'left\':handleValues[0] + \'%\',width: (handleValues[1] - handleValues[0] + \'%\')}"></span>\n            <span *ngIf="range && orientation == \'vertical\'" class="p-slider-range" [ngStyle]="{\'bottom\':handleValues[0] + \'%\',height: (handleValues[1] - handleValues[0] + \'%\')}"></span>\n            <span *ngIf="!range && orientation==\'vertical\'" class="p-slider-range" [ngStyle]="{\'height\': handleValue + \'%\'}"></span>\n            <span *ngIf="!range && orientation==\'horizontal\'" class="p-slider-range" [ngStyle]="{\'width\': handleValue + \'%\'}"></span>\n            <span #sliderHandle *ngIf="!range" [attr.tabindex]="disabled ? null : tabindex" (keydown)="onHandleKeydown($event)" class="p-slider-handle" (mousedown)="onMouseDown($event)" (touchstart)="onTouchStart($event)" (touchmove)="onTouchMove($event)" (touchend)="onTouchEnd($event)"\n                [style.transition]="dragging ? \'none\': null" [ngStyle]="{\'left\': orientation == \'horizontal\' ? handleValue + \'%\' : null,\'bottom\': orientation == \'vertical\' ? handleValue + \'%\' : null}"\n                [attr.aria-valuemin]="min" [attr.aria-valuenow]="value" [attr.aria-valuemax]="max" [attr.aria-labelledby]="ariaLabelledBy"></span>\n            <span #sliderHandleStart *ngIf="range" [attr.tabindex]="disabled ? null : tabindex" (keydown)="onHandleKeydown($event,0)" (mousedown)="onMouseDown($event,0)" (touchstart)="onTouchStart($event,0)" (touchmove)="onTouchMove($event,0)" (touchend)="onTouchEnd($event)" [style.transition]="dragging ? \'none\': null" class="p-slider-handle" \n                [ngStyle]="{\'left\': rangeStartLeft, \'bottom\': rangeStartBottom}" [ngClass]="{\'p-slider-handle-active\':handleIndex==0}"\n                [attr.aria-valuemin]="min" [attr.aria-valuenow]="value ? value[0] : null" [attr.aria-valuemax]="max" [attr.aria-labelledby]="ariaLabelledBy"></span>\n            <span #sliderHandleEnd *ngIf="range" [attr.tabindex]="disabled ? null : tabindex" (keydown)="onHandleKeydown($event,1)" (mousedown)="onMouseDown($event,1)" (touchstart)="onTouchStart($event,1)" (touchmove)="onTouchMove($event,1)" (touchend)="onTouchEnd($event)" [style.transition]="dragging ? \'none\': null" class="p-slider-handle" \n                [ngStyle]="{\'left\': rangeEndLeft, \'bottom\': rangeEndBottom}" [ngClass]="{\'p-slider-handle-active\':handleIndex==1}"\n                [attr.aria-valuemin]="min" [attr.aria-valuenow]="value ? value[1] : null" [attr.aria-valuemax]="max" [attr.aria-labelledby]="ariaLabelledBy"></span>\n        </div>\n    ',providers:[SLIDER_VALUE_ACCESSOR],changeDetection:ChangeDetectionStrategy.OnPush,encapsulation:ViewEncapsulation.None,styles:[".p-slider{position:relative}.p-slider .p-slider-handle{cursor:grab;touch-action:none}.p-slider-range,.p-slider .p-slider-handle{display:block;position:absolute}.p-slider-horizontal .p-slider-range{height:100%;left:0;top:0}.p-slider-horizontal .p-slider-handle{top:50%}.p-slider-vertical{height:100px}.p-slider-vertical .p-slider-handle{left:50%}.p-slider-vertical .p-slider-range{bottom:0;left:0;width:100%}"]}]}],Slider.ctorParameters=(()=>[{type:ElementRef},{type:Renderer2},{type:NgZone},{type:ChangeDetectorRef}]),Slider.propDecorators={animate:[{type:Input}],disabled:[{type:Input}],min:[{type:Input}],max:[{type:Input}],orientation:[{type:Input}],step:[{type:Input}],range:[{type:Input}],style:[{type:Input}],styleClass:[{type:Input}],ariaLabelledBy:[{type:Input}],tabindex:[{type:Input}],onChange:[{type:Output}],onSlideEnd:[{type:Output}],sliderHandle:[{type:ViewChild,args:["sliderHandle"]}],sliderHandleStart:[{type:ViewChild,args:["sliderHandleStart"]}],sliderHandleEnd:[{type:ViewChild,args:["sliderHandleEnd"]}]};class SliderModule{}SliderModule.decorators=[{type:NgModule,args:[{imports:[CommonModule],exports:[Slider],declarations:[Slider]}]}];export{SLIDER_VALUE_ACCESSOR,Slider,SliderModule};