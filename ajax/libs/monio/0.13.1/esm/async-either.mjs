/*! Monio: async-either.mjs
    v0.13.1 (c) 2021 Kyle Simpson
    MIT License: http://getify.mit-license.org
*/
import{isPromise}from"./lib/util.mjs";import Either from"./either.mjs";var brand={};export default Object.assign(AsyncEither,{Left:AsyncLeft,Right:AsyncRight,of:AsyncRight,pure:AsyncRight,unit:AsyncRight,is:is,fromFoldable:fromFoldable,fromPromise:fromPromise});function AsyncLeft(r){return AsyncEither(Either.Left(r))}function AsyncRight(r){return AsyncEither(Either.Right(r))}function AsyncEither(r){return fromPromise(isPromise(r)?r:Either.Left.is(r)?Promise.reject(r):Promise.resolve(r))}function fromPromise(r){r=splitPromise(r);var t={map:function map(t){var handle=r=>{var _doMap=t=>{var i=r.chain(t);return isPromise(i)?splitPromise(i):r._is_right()?i:Promise.reject(i)};return isPromise(t)?t.then(_doMap):_doMap(t)};return AsyncEither(r.then(handle,handle))},chain:chain,flatMap:chain,bind:chain,ap:function ap(t){return t.map(r)},concat:function concat(t){return t.map((t=>r.then((r=>r.concat(t)))))},fold:function fold(t,i){var handle=r=>t=>t.fold((t=>Promise.reject(r(t))),r);return r.then(handle(i),handle(t))},_inspect:function _inspect(){return`${t[Symbol.toStringTag]}(Promise)`},_is:function _is(r){return r===brand},[Symbol.toStringTag]:"AsyncEither"};return t;function chain(t){var handle=r=>{var _doChain=t=>{var i=r.chain(t);return is(i)?i.fold((r=>r),(r=>r)):Either.is(i)?i.fold((r=>Promise.reject(r)),(r=>r)):i};return isPromise(t)?t.then(_doChain):_doChain(t)};return AsyncEither(r.then(handle,handle))}}function is(r){return r&&"function"==typeof r._is&&r._is(brand)}function fromFoldable(r){return r.fold(AsyncEither.Left,AsyncEither.Right)}function splitPromise(r){return r.then((r=>Either.is(r)?r:Either.Right(r)),(r=>Promise.reject(Either.is(r)?r:Either.Left(r))))}function toPromise(r){return new Promise(((t,i)=>r.fold((r=>i(Either.Left(r))),(r=>t(Either.Right(r))))))}