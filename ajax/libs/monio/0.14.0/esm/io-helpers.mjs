/*! Monio: io-helpers.mjs
    v0.14.0 (c) 2021 Kyle Simpson
    MIT License: http://getify.mit-license.org
*/
import{isFunction,isPromise,isMonad}from"./lib/util.mjs";import IO from"./io.mjs";import Maybe from"./maybe.mjs";import Either from"./either.mjs";var returnedValues=new WeakSet;export{applyIO};export{doIO};export{doIOBind};export{filterIOList};export{concatIOList};export{iif};export{elif};export{els};export{iNot};export{iReturn};export{wasReturned};function applyIO(t,r){return IO((()=>t.run(r)))}function doIO(t,...r){return r.length>0?IO((e=>IO.do(t(e,...r)).run(e))):IO.do(t)}function doIOBind(t,r){var e=IO((()=>IO.do(t).run(r)));return(...n)=>n.length>0?IO((()=>IO.do(t(r,...n)).run(r))):e}function filterIOList(t,r){return r.reduce(((r,e)=>r.chain((r=>t(e).map((t=>t?[...r,e]:r))))),IO.of([]))}function concatIOList(t){return t.reduce(((t,r)=>t.map((t=>[...t,r]))),IO.of([]))}function iif(t,r,...e){return IO((n=>liftIO(n,t).chain((function doThens(t){return t?(Array.isArray(r)?r:[r]).reduce(((t,r)=>t.chain((t=>liftIO(n,t).chain((t=>returnedValues.has(t)?IO.of(t):liftIO(n,r)))))),IO.of()).chain((r=>liftIO(n,r).chain((r=>IO.of(returnedValues.has(r)?r:t))))):IO.of(t)})).chain(function doNextElse(t){return r=>!r&&t.length>0?liftIO(n,t[0]).chain(doNextElse(t.slice(1))):IO.of(r)}(e)).run(n)))}function elif(t,r){return iif(t,r)}function els(t){return iif(!0,t)}function iReturn(t){return IO((r=>liftIO(r,t).map((t=>{var r={returned:t};return returnedValues.add(r),r})).run(r)))}function iNot(t){return IO((r=>liftIO(r,t).map(not).run(r)))}function wasReturned(t){return returnedValues.has(t)}function liftIO(t,r){if(isMonad(r)){if(IO.is(r))return r;if(Either.Left.is(r)||Maybe.Nothing.is(r)){let t={returned:r};return returnedValues.add(t),IO.of(t)}{let t=r.chain(IO.of);return IO.is(t)?t:IO.of(r)}}return isFunction(r)?liftIO(t,r(t)):r&&"object"==typeof r&&isFunction(r.next)?IO.do(r):IO.of(r)}