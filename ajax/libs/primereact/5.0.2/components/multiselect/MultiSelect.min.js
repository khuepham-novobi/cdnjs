"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MultiSelect=void 0;var _ClassNames=require("../utils/ClassNames"),_propTypes=_interopRequireDefault(require("prop-types")),_react=_interopRequireWildcard(require("react")),_reactTransitionGroup=require("react-transition-group"),_Tooltip=require("../tooltip/Tooltip"),_DomHandler=_interopRequireDefault(require("../utils/DomHandler")),_FilterUtils=_interopRequireDefault(require("../utils/FilterUtils")),_ObjectUtils=_interopRequireDefault(require("../utils/ObjectUtils")),_MultiSelectHeader=require("./MultiSelectHeader"),_MultiSelectItem=require("./MultiSelectItem"),_MultiSelectPanel=require("./MultiSelectPanel"),_UniqueComponentId=_interopRequireDefault(require("../utils/UniqueComponentId")),_ConnectedOverlayScrollHandler=_interopRequireDefault(require("../utils/ConnectedOverlayScrollHandler"));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var i,l,r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&((l=n?Object.getOwnPropertyDescriptor(e,i):null)&&(l.get||l.set)?Object.defineProperty(r,i,l):r[i]=e[i]);return r.default=e,t&&t.set(e,r),r}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _createForOfIteratorHelper(e,t){var i;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(i=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var l=0,t=function(){};return{s:t,n:function(){return l>=e.length?{done:!0}:{done:!1,value:e[l++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,n=!0,s=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return n=e.done,e},e:function(e){s=!0,r=e},f:function(){try{n||null==i.return||i.return()}finally{if(s)throw r}}}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,l=new Array(t);i<t;i++)l[i]=e[i];return l}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var l=t[i];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(i){var l=_isNativeReflectConstruct();return function(){var e,t=_getPrototypeOf(i);return _possibleConstructorReturn(this,l?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var MultiSelect=function(){_inherits(i,_react.Component);var t=_createSuper(i);function i(e){return _classCallCheck(this,i),(e=t.call(this,e)).state={filter:"",focused:!1,overlayVisible:!1},e.onClick=e.onClick.bind(_assertThisInitialized(e)),e.onKeyDown=e.onKeyDown.bind(_assertThisInitialized(e)),e.onOptionClick=e.onOptionClick.bind(_assertThisInitialized(e)),e.onOptionKeyDown=e.onOptionKeyDown.bind(_assertThisInitialized(e)),e.onFocus=e.onFocus.bind(_assertThisInitialized(e)),e.onBlur=e.onBlur.bind(_assertThisInitialized(e)),e.onFilter=e.onFilter.bind(_assertThisInitialized(e)),e.onCloseClick=e.onCloseClick.bind(_assertThisInitialized(e)),e.onToggleAll=e.onToggleAll.bind(_assertThisInitialized(e)),e.onOverlayEnter=e.onOverlayEnter.bind(_assertThisInitialized(e)),e.onOverlayEntered=e.onOverlayEntered.bind(_assertThisInitialized(e)),e.onOverlayExit=e.onOverlayExit.bind(_assertThisInitialized(e)),e.onOverlayExited=e.onOverlayExited.bind(_assertThisInitialized(e)),e.id=e.props.id||(0,_UniqueComponentId.default)(),e}return _createClass(i,[{key:"onOptionClick",value:function(e){var t=this.getOptionValue(e.option),i=this.findSelectionIndex(t),t=-1!==i?this.props.value.filter(function(e,t){return t!==i}):[].concat(_toConsumableArray(this.props.value||[]),[t]);this.updateModel(e.originalEvent,t)}},{key:"onOptionKeyDown",value:function(e){var t=e.originalEvent,i=t.currentTarget;switch(t.which){case 40:var l=this.findNextItem(i);l&&l.focus(),t.preventDefault();break;case 38:i=this.findPrevItem(i);i&&i.focus(),t.preventDefault();break;case 13:case 32:this.onOptionClick(e),t.preventDefault();break;case 27:this.hide(),this.focusInput.focus()}}},{key:"findNextItem",value:function(e){e=e.nextElementSibling;return e?_DomHandler.default.hasClass(e,"p-multiselect-item")?e:this.findNextItem(e):null}},{key:"findPrevItem",value:function(e){e=e.previousElementSibling;return e?_DomHandler.default.hasClass(e,"p-multiselect-item")?e:this.findPrevItem(e):null}},{key:"onClick",value:function(e){this.props.disabled||this.isPanelClicked(e)||_DomHandler.default.hasClass(e.target,"p-multiselect-token-icon")||this.isClearClicked(e)||(this.state.overlayVisible?this.hide():this.show(),this.focusInput.focus())}},{key:"onKeyDown",value:function(e){switch(e.which){case 40:!this.state.overlayVisible&&e.altKey&&(this.show(),e.preventDefault());break;case 32:this.state.overlayVisible||(this.show(),e.preventDefault());break;case 27:this.hide()}}},{key:"onToggleAll",value:function(e){var t;if(e.checked)t=[];else{var i=this.hasFilter()?this.filterOptions(this.props.options):this.props.options;if(i){t=[];var l=_createForOfIteratorHelper(i);try{for(l.s();!(r=l.n()).done;){var r=r.value;t.push(this.getOptionValue(r))}}catch(e){l.e(e)}finally{l.f()}}}this.updateModel(e.originalEvent,t)}},{key:"updateModel",value:function(e,t){this.props.onChange&&this.props.onChange({originalEvent:e,value:t,stopPropagation:function(){},preventDefault:function(){},target:{name:this.props.name,id:this.id,value:t}})}},{key:"onFilter",value:function(e){this.setState({filter:e.query})}},{key:"resetFilter",value:function(){this.setState({filter:""})}},{key:"show",value:function(){this.setState({overlayVisible:!0})}},{key:"hide",value:function(){this.setState({overlayVisible:!1})}},{key:"onOverlayEnter",value:function(){this.panel.element.style.zIndex=String(_DomHandler.default.generateZIndex()),this.alignPanel()}},{key:"onOverlayEntered",value:function(){this.bindDocumentClickListener(),this.bindScrollListener(),this.bindResizeListener()}},{key:"onOverlayExit",value:function(){this.unbindDocumentClickListener(),this.unbindScrollListener(),this.unbindResizeListener()}},{key:"onOverlayExited",value:function(){this.props.filter&&this.props.resetFilterOnHide&&this.resetFilter()}},{key:"alignPanel",value:function(){var e=this.label.parentElement;this.props.appendTo?(this.panel.element.style.minWidth=_DomHandler.default.getWidth(e)+"px",_DomHandler.default.absolutePosition(this.panel.element,e)):_DomHandler.default.relativePosition(this.panel.element,e)}},{key:"onCloseClick",value:function(e){this.hide(),this.focusInput.focus(),e.preventDefault(),e.stopPropagation()}},{key:"findSelectionIndex",value:function(e){var t=-1;if(this.props.value)for(var i=this.equalityKey(),l=0;l<this.props.value.length;l++)if(_ObjectUtils.default.equals(this.props.value[l],e,i)){t=l;break}return t}},{key:"isSelected",value:function(e){return-1!==this.findSelectionIndex(this.getOptionValue(e))}},{key:"getLabelByValue",value:function(e){for(var t=null,i=0;i<this.props.options.length;i++){var l=this.props.options[i],r=this.getOptionValue(l),n=this.equalityKey();if(_ObjectUtils.default.equals(r,e,n)){t=this.getOptionLabel(l);break}}return t}},{key:"onFocus",value:function(e){var t=this;e.persist(),this.setState({focused:!0},function(){t.props.onFocus&&t.props.onFocus(e)})}},{key:"onBlur",value:function(e){var t=this;e.persist(),this.setState({focused:!1},function(){t.props.onBlur&&t.props.onBlur(e)})}},{key:"bindDocumentClickListener",value:function(){var t=this;this.documentClickListener||(this.documentClickListener=function(e){t.state.overlayVisible&&t.isOutsideClicked(e)&&t.hide()},document.addEventListener("click",this.documentClickListener))}},{key:"bindScrollListener",value:function(){var e=this;this.scrollHandler||(this.scrollHandler=new _ConnectedOverlayScrollHandler.default(this.container,function(){e.state.overlayVisible&&e.hide()})),this.scrollHandler.bindScrollListener()}},{key:"unbindScrollListener",value:function(){this.scrollHandler&&this.scrollHandler.unbindScrollListener()}},{key:"bindResizeListener",value:function(){var e=this;this.resizeListener||(this.resizeListener=function(){e.state.overlayVisible&&e.hide()},window.addEventListener("resize",this.resizeListener))}},{key:"unbindResizeListener",value:function(){this.resizeListener&&(window.removeEventListener("resize",this.resizeListener),this.resizeListener=null)}},{key:"isOutsideClicked",value:function(e){return this.container&&!(this.container.isSameNode(e.target)||this.isClearClicked(e)||this.container.contains(e.target)||this.panel&&this.panel.element&&this.panel.element.contains(e.target))}},{key:"isClearClicked",value:function(e){return _DomHandler.default.hasClass(e.target,"p-multiselect-clear-icon")}},{key:"isPanelClicked",value:function(e){return this.panel&&this.panel.element&&this.panel.element.contains(e.target)}},{key:"unbindDocumentClickListener",value:function(){this.documentClickListener&&(document.removeEventListener("click",this.documentClickListener),this.documentClickListener=null)}},{key:"componentDidMount",value:function(){this.props.tooltip&&this.renderTooltip()}},{key:"componentDidUpdate",value:function(e){e.tooltip!==this.props.tooltip&&(this.tooltip?this.tooltip.updateContent(this.props.tooltip):this.renderTooltip())}},{key:"componentWillUnmount",value:function(){this.unbindDocumentClickListener(),this.unbindResizeListener(),this.scrollHandler&&(this.scrollHandler.destroy(),this.scrollHandler=null),this.tooltip&&(this.tooltip.destroy(),this.tooltip=null)}},{key:"hasFilter",value:function(){return this.state.filter&&0<this.state.filter.trim().length}},{key:"isAllChecked",value:function(e){return this.hasFilter()?this.props.value&&e&&e.length&&this.props.value.length===e.length:this.props.value&&this.props.options&&this.props.value.length===this.props.options.length}},{key:"filterOptions",value:function(e){if(e){var t=this.state.filter.trim().toLocaleLowerCase(this.props.filterLocale),i=this.props.filterBy?this.props.filterBy.split(","):[this.props.optionLabel||"label"];return _FilterUtils.default.filter(e,i,t,this.props.filterMatchMode,this.props.filterLocale)}}},{key:"getOptionLabel",value:function(e){return this.props.optionLabel?_ObjectUtils.default.resolveFieldData(e,this.props.optionLabel):e&&void 0!==e.label?e.label:e}},{key:"getOptionValue",value:function(e){return this.props.optionValue?_ObjectUtils.default.resolveFieldData(e,this.props.optionValue):e&&void 0!==e.value?e.value:e}},{key:"isEmpty",value:function(){return!this.props.value||0===this.props.value.length}},{key:"equalityKey",value:function(){return this.props.optionValue?null:this.props.dataKey}},{key:"checkValidity",value:function(){return this.nativeSelect.checkValidity()}},{key:"removeChip",value:function(e,t){var i=this.equalityKey(),l=this.props.value.filter(function(e){return!_ObjectUtils.default.equals(e,t,i)});this.updateModel(e,l)}},{key:"getSelectedItemsLabel",value:function(){var e=/{(.*?)}/;return e.test(this.props.selectedItemsLabel)?this.props.selectedItemsLabel.replace(this.props.selectedItemsLabel.match(e)[0],this.props.value.length+""):this.props.selectedItemsLabel}},{key:"getLabel",value:function(){var e;if(this.isEmpty()||this.props.fixedPlaceholder)return e;e="";for(var t=0;t<this.props.value.length;t++)0!==t&&(e+=","),e+=this.getLabelByValue(this.props.value[t]);return this.props.value.length<=this.props.maxSelectedLabels?e:this.getSelectedItemsLabel()}},{key:"getLabelContent",value:function(){var i=this;return this.props.selectedItemTemplate?this.isEmpty()?_ObjectUtils.default.getJSXElement(this.props.selectedItemTemplate):this.props.value.length<=this.props.maxSelectedLabels?this.props.value.map(function(e,t){e=_ObjectUtils.default.getJSXElement(i.props.selectedItemTemplate,e);return _react.default.createElement(_react.default.Fragment,{key:t},e)}):this.getSelectedItemsLabel():"chip"!==this.props.display||this.isEmpty()?this.getLabel():this.props.value.map(function(t){var e=i.getLabelByValue(t);return _react.default.createElement("div",{className:"p-multiselect-token",key:e},_react.default.createElement("span",{className:"p-multiselect-token-label"},e),!i.props.disabled&&_react.default.createElement("span",{className:"p-multiselect-token-icon pi pi-times-circle",onClick:function(e){return i.removeChip(e,t)}}))})}},{key:"renderTooltip",value:function(){this.tooltip=(0,_Tooltip.tip)({target:this.container,content:this.props.tooltip,options:this.props.tooltipOptions})}},{key:"renderHeader",value:function(e){return _react.default.createElement(_MultiSelectHeader.MultiSelectHeader,{filter:this.props.filter,filterValue:this.state.filter,onFilter:this.onFilter,filterPlaceholder:this.props.filterPlaceholder,onClose:this.onCloseClick,onToggleAll:this.onToggleAll,allChecked:this.isAllChecked(e)})}},{key:"renderClearIcon",value:function(){var t=this;return this.isEmpty()||!this.props.showClear||this.props.disabled?null:_react.default.createElement("i",{className:"p-multiselect-clear-icon pi pi-times",onClick:function(e){return t.updateModel(e,null)}})}},{key:"renderLabel",value:function(){var t=this,e=this.isEmpty(),i=this.getLabelContent(),e=(0,_ClassNames.classNames)("p-multiselect-label",{"p-placeholder":e&&this.props.placeholder,"p-multiselect-label-empty":e&&!this.props.placeholder&&!this.props.selectedItemTemplate,"p-multiselect-items-label":!e&&this.props.value.length>this.props.maxSelectedLabels});return _react.default.createElement("div",{ref:function(e){return t.label=e},className:"p-multiselect-label-container"},_react.default.createElement("div",{className:e},i||this.props.placeholder||"empty"))}},{key:"renderHiddenSelect",value:function(){var i=this,e=this.props.value?this.props.value.map(function(e,t){return _react.default.createElement("option",{key:i.getOptionLabel(e)+"_"+t,value:i.getOptionValue(e)})}):null;return _react.default.createElement("div",{className:"p-hidden-accessible p-multiselect-hidden-select"},_react.default.createElement("select",{ref:function(e){return i.nativeSelect=e},required:this.props.required,name:this.props.name,tabIndex:"-1","aria-hidden":"true",multiple:!0},e))}},{key:"render",value:function(){var l=this,e=(0,_ClassNames.classNames)("p-multiselect p-component p-inputwrapper",{"p-multiselect-chip":"chip"===this.props.display,"p-disabled":this.props.disabled,"p-multiselect-clearable":this.props.showClear&&!this.props.disabled,"p-focus":this.state.focused,"p-inputwrapper-filled":this.props.value&&0<this.props.value.length,"p-inputwrapper-focus":this.state.focused},this.props.className),t=this.renderLabel(),i=this.renderClearIcon(),r=this.renderHiddenSelect(),n=this.props.options,s=this.hasFilter();s&&(n=this.filterOptions(n)),n&&n.length?n=n.map(function(e,t){var i=l.getOptionLabel(e);return _react.default.createElement(_MultiSelectItem.MultiSelectItem,{key:i+"_"+t,label:i,option:e,template:l.props.itemTemplate,selected:l.isSelected(e),onClick:l.onOptionClick,onKeyDown:l.onOptionKeyDown,tabIndex:l.props.tabIndex})}):s&&(o=_ObjectUtils.default.getJSXElement(this.props.emptyFilterMessage,this.props),n=_react.default.createElement("li",{className:"p-multiselect-empty-message"},o));var o=this.renderHeader(n);return _react.default.createElement("div",{id:this.id,className:e,onClick:this.onClick,ref:function(e){return l.container=e},style:this.props.style},r,_react.default.createElement("div",{className:"p-hidden-accessible"},_react.default.createElement("input",{ref:function(e){return l.focusInput=e},id:this.props.inputId,readOnly:!0,type:"text",onFocus:this.onFocus,onBlur:this.onBlur,onKeyDown:this.onKeyDown,role:"listbox","aria-haspopup":"listbox","aria-labelledby":this.props.ariaLabelledBy,"aria-expanded":this.state.overlayVisible,disabled:this.props.disabled,tabIndex:this.props.tabIndex})),t,i,_react.default.createElement("div",{className:"p-multiselect-trigger"},_react.default.createElement("span",{className:"p-multiselect-trigger-icon pi pi-chevron-down p-c"})),_react.default.createElement(_reactTransitionGroup.CSSTransition,{classNames:"p-connected-overlay",in:this.state.overlayVisible,timeout:{enter:120,exit:100},unmountOnExit:!0,onEnter:this.onOverlayEnter,onEntered:this.onOverlayEntered,onExit:this.onOverlayExit,onExited:this.onOverlayExited},_react.default.createElement(_MultiSelectPanel.MultiSelectPanel,{ref:function(e){return l.panel=e},header:o,appendTo:this.props.appendTo,scrollHeight:this.props.scrollHeight,panelClassName:this.props.panelClassName,panelStyle:this.props.panelStyle},n)))}}]),i}();_defineProperty(exports.MultiSelect=MultiSelect,"defaultProps",{id:null,name:null,value:null,options:null,optionLabel:null,optionValue:null,display:"comma",style:null,className:null,panelClassName:null,panelStyle:null,scrollHeight:"200px",placeholder:null,fixedPlaceholder:!1,disabled:!1,showClear:!1,filter:!1,filterBy:null,filterMatchMode:"contains",filterPlaceholder:null,filterLocale:void 0,emptyFilterMessage:"No results found",resetFilterOnHide:!1,tabIndex:"0",dataKey:null,inputId:null,required:!1,appendTo:null,tooltip:null,tooltipOptions:null,maxSelectedLabels:3,selectedItemsLabel:"{0} items selected",ariaLabelledBy:null,itemTemplate:null,selectedItemTemplate:null,onChange:null,onFocus:null,onBlur:null}),_defineProperty(MultiSelect,"propTypes",{id:_propTypes.default.string,name:_propTypes.default.string,value:_propTypes.default.any,options:_propTypes.default.array,optionLabel:_propTypes.default.string,optionValue:_propTypes.default.string,display:_propTypes.default.string,style:_propTypes.default.object,className:_propTypes.default.string,panelClassName:_propTypes.default.string,panelStyle:_propTypes.default.object,scrollHeight:_propTypes.default.string,placeholder:_propTypes.default.string,fixedPlaceholder:_propTypes.default.bool,disabled:_propTypes.default.bool,showClear:_propTypes.default.bool,filter:_propTypes.default.bool,filterBy:_propTypes.default.string,filterMatchMode:_propTypes.default.string,filterPlaceholder:_propTypes.default.string,filterLocale:_propTypes.default.string,emptyFilterMessage:_propTypes.default.any,resetFilterOnHide:_propTypes.default.bool,tabIndex:_propTypes.default.string,dataKey:_propTypes.default.string,inputId:_propTypes.default.string,required:_propTypes.default.bool,appendTo:_propTypes.default.object,tooltip:_propTypes.default.string,tooltipOptions:_propTypes.default.object,maxSelectedLabels:_propTypes.default.number,selectedItemsLabel:_propTypes.default.string,ariaLabelledBy:_propTypes.default.string,itemTemplate:_propTypes.default.any,selectedItemTemplate:_propTypes.default.any,onChange:_propTypes.default.func,onFocus:_propTypes.default.func,onBlur:_propTypes.default.func});