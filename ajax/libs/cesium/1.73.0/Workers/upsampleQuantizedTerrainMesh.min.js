define(["./when-54c2dc71","./Check-6c0211bc","./Math-fc8cecf5","./Cartesian2-bddc1162","./Transforms-43808565","./RuntimeError-2109023a","./WebGLConstants-76bb35d1","./ComponentDatatype-6d99a1ee","./AttributeCompression-9fc99391","./IndexDatatype-53503fee","./IntersectionTests-60a97ecf","./Plane-c946480f","./createTaskProcessorWorker","./EllipsoidTangentPlane-9a2d3381","./OrientedBoundingBox-9c6c4bfe","./TerrainEncoding-a1538d1e"],function(g,e,ae,pe,de,t,i,n,s,fe,r,h,u,o,le,ce){"use strict";var ge=function(e,t,i,n,s,r){var h,u,o;g.defined(r)?r.length=0:r=[],o=t?(h=i<e,u=n<e,s<e):(h=e<i,u=e<n,e<s);var a,p,d,f,l,c,t=h+u+o;return 1===t?h?(a=(e-i)/(n-i),p=(e-i)/(s-i),r.push(1),r.push(2),1!==p&&(r.push(-1),r.push(0),r.push(2),r.push(p)),1!==a&&(r.push(-1),r.push(0),r.push(1),r.push(a))):u?(d=(e-n)/(s-n),f=(e-n)/(i-n),r.push(2),r.push(0),1!==f&&(r.push(-1),r.push(1),r.push(0),r.push(f)),1!==d&&(r.push(-1),r.push(1),r.push(2),r.push(d))):o&&(l=(e-s)/(i-s),c=(e-s)/(n-s),r.push(0),r.push(1),1!==c&&(r.push(-1),r.push(2),r.push(1),r.push(c)),1!==l&&(r.push(-1),r.push(2),r.push(0),r.push(l))):2===t?h||i===e?u||n===e?o||s===e||(p=(e-i)/(s-i),d=(e-n)/(s-n),r.push(2),r.push(-1),r.push(0),r.push(2),r.push(p),r.push(-1),r.push(1),r.push(2),r.push(d)):(c=(e-s)/(n-s),a=(e-i)/(n-i),r.push(1),r.push(-1),r.push(2),r.push(1),r.push(c),r.push(-1),r.push(0),r.push(1),r.push(a)):(f=(e-n)/(i-n),l=(e-s)/(i-s),r.push(0),r.push(-1),r.push(1),r.push(0),r.push(f),r.push(-1),r.push(2),r.push(0),r.push(l)):3!==t&&(r.push(0),r.push(1),r.push(2)),r},me=32767,xe=16383,we=[],ve=[],Ce=[],Be=new pe.Cartographic,ye=new pe.Cartesian3,Ie=[],be=[],ze=[],Me=[],Ne=[],Ve=new pe.Cartesian3,Ae=new de.BoundingSphere,Ee=new le.OrientedBoundingBox,Re=new pe.Cartesian2,He=new pe.Cartesian3;function Te(){this.vertexBuffer=void 0,this.index=void 0,this.first=void 0,this.second=void 0,this.ratio=void 0}Te.prototype.clone=function(e){return g.defined(e)||(e=new Te),e.uBuffer=this.uBuffer,e.vBuffer=this.vBuffer,e.heightBuffer=this.heightBuffer,e.normalBuffer=this.normalBuffer,e.index=this.index,e.first=this.first,e.second=this.second,e.ratio=this.ratio,e},Te.prototype.initializeIndexed=function(e,t,i,n,s){this.uBuffer=e,this.vBuffer=t,this.heightBuffer=i,this.normalBuffer=n,this.index=s,this.first=void 0,this.second=void 0,this.ratio=void 0},Te.prototype.initializeFromClipResult=function(e,t,i){var n=t+1;return-1!==e[t]?i[e[t]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=i[e[n]],++n,this.second=i[e[n]],++n,this.ratio=e[n],++n),n},Te.prototype.getKey=function(){return this.isIndexed()?this.index:JSON.stringify({first:this.first.getKey(),second:this.second.getKey(),ratio:this.ratio})},Te.prototype.isIndexed=function(){return g.defined(this.index)},Te.prototype.getH=function(){return g.defined(this.index)?this.heightBuffer[this.index]:ae.CesiumMath.lerp(this.first.getH(),this.second.getH(),this.ratio)},Te.prototype.getU=function(){return g.defined(this.index)?this.uBuffer[this.index]:ae.CesiumMath.lerp(this.first.getU(),this.second.getU(),this.ratio)},Te.prototype.getV=function(){return g.defined(this.index)?this.vBuffer[this.index]:ae.CesiumMath.lerp(this.first.getV(),this.second.getV(),this.ratio)};var a=new pe.Cartesian2,p=-1,d=[new pe.Cartesian3,new pe.Cartesian3],f=[new pe.Cartesian3,new pe.Cartesian3];function l(e,t){var i=d[++p],n=f[p],i=s.AttributeCompression.octDecode(e.first.getNormalX(),e.first.getNormalY(),i),n=s.AttributeCompression.octDecode(e.second.getNormalX(),e.second.getNormalY(),n);return ye=pe.Cartesian3.lerp(i,n,e.ratio,ye),pe.Cartesian3.normalize(ye,ye),s.AttributeCompression.octEncode(ye,t),--p,t}Te.prototype.getNormalX=function(){return g.defined(this.index)?this.normalBuffer[2*this.index]:(a=l(this,a)).x},Te.prototype.getNormalY=function(){return g.defined(this.index)?this.normalBuffer[2*this.index+1]:(a=l(this,a)).y};var m=[];function Oe(e,t,i,n,s,r,h,u,o){if(0!==h.length){for(var a=0,p=0;p<h.length;)p=m[a++].initializeFromClipResult(h,p,u);for(var d=0;d<a;++d){var f,l,c=m[d];c.isIndexed()?(c.newIndex=r[c.index],c.uBuffer=e,c.vBuffer=t,c.heightBuffer=i,o&&(c.normalBuffer=n)):(f=c.getKey(),g.defined(r[f])?c.newIndex=r[f]:(l=e.length,e.push(c.getU()),t.push(c.getV()),i.push(c.getH()),o&&(n.push(c.getNormalX()),n.push(c.getNormalY())),c.newIndex=l,r[f]=l))}3===a?(s.push(m[0].newIndex),s.push(m[1].newIndex),s.push(m[2].newIndex)):4===a&&(s.push(m[0].newIndex),s.push(m[1].newIndex),s.push(m[2].newIndex),s.push(m[0].newIndex),s.push(m[2].newIndex),s.push(m[3].newIndex))}}return m.push(new Te),m.push(new Te),m.push(new Te),m.push(new Te),u(function(e,t){var i=e.isEastChild,n=e.isNorthChild,s=i?xe:0,r=i?me:xe,h=n?xe:0,u=n?me:xe,o=Ie,a=be,p=ze,d=Ne;o.length=0,a.length=0,p.length=0,d.length=0;var f=Me;f.length=0;for(var l={},c=e.vertices,g=(g=e.indices).subarray(0,e.indexCountWithoutSkirts),m=ce.TerrainEncoding.clone(e.encoding),x=m.hasVertexNormals,w=e.exaggeration,v=0,C=e.vertexCountWithoutSkirts,B=e.minimumHeight,y=e.maximumHeight,I=new Array(C),b=new Array(C),z=new Array(C),M=x?new Array(2*C):void 0,N=0,V=0;N<C;++N,V+=2){var A=m.decodeTextureCoordinates(c,N,Re),E=m.decodeHeight(c,N)/w,R=ae.CesiumMath.clamp(A.x*me|0,0,me),H=ae.CesiumMath.clamp(A.y*me|0,0,me);z[N]=ae.CesiumMath.clamp((E-B)/(y-B)*me|0,0,me),R<20&&(R=0),H<20&&(H=0),me-R<20&&(R=me),me-H<20&&(H=me),I[N]=R,b[N]=H,x&&(A=m.getOctEncodedNormal(c,N,He),M[V]=A.x,M[V+1]=A.y),(i&&xe<=R||!i&&R<=xe)&&(n&&xe<=H||!n&&H<=xe)&&(l[N]=v,o.push(R),a.push(H),p.push(z[N]),x&&(d.push(M[V]),d.push(M[V+1])),++v)}var T=[];T.push(new Te),T.push(new Te),T.push(new Te);var O=[];for(O.push(new Te),O.push(new Te),O.push(new Te),N=0;N<g.length;N+=3){var U=g[N],F=g[N+1],P=g[N+2],S=I[U],k=I[F],D=I[P];T[0].initializeIndexed(I,b,z,M,U),T[1].initializeIndexed(I,b,z,M,F),T[2].initializeIndexed(I,b,z,M,P);var W,D=ge(xe,i,S,k,D,we);D.length<=0||(W=O[0].initializeFromClipResult(D,0,T))>=D.length||(W=O[1].initializeFromClipResult(D,W,T))>=D.length||(W=O[2].initializeFromClipResult(D,W,T),Oe(o,a,p,d,f,l,ge(xe,n,O[0].getV(),O[1].getV(),O[2].getV(),ve),O,x),W<D.length&&(O[2].clone(O[1]),O[2].initializeFromClipResult(D,W,T),Oe(o,a,p,d,f,l,ge(xe,n,O[0].getV(),O[1].getV(),O[2].getV(),ve),O,x)))}var X=i?-me:0,K=n?-me:0,Y=[],L=[],_=[],G=[],J=Number.MAX_VALUE,Z=-J,j=Ce;j.length=0;var q=pe.Ellipsoid.clone(e.ellipsoid),Q=pe.Rectangle.clone(e.childRectangle),$=Q.north,ee=Q.south,te=Q.east,ie=Q.west;for(te<ie&&(te+=ae.CesiumMath.TWO_PI),N=0;N<o.length;++N)R=(R=Math.round(o[N]))<=s?(Y.push(N),0):r<=R?(_.push(N),me):2*R+X,o[N]=R,H=(H=Math.round(a[N]))<=h?(L.push(N),0):u<=H?(G.push(N),me):2*H+K,a[N]=H,(E=ae.CesiumMath.lerp(B,y,p[N]/me))<J&&(J=E),Z<E&&(Z=E),p[N]=E,Be.longitude=ae.CesiumMath.lerp(ie,te,R/me),Be.latitude=ae.CesiumMath.lerp(ee,$,H/me),Be.height=E,q.cartographicToCartesian(Be,ye),j.push(ye.x),j.push(ye.y),j.push(ye.z);for(var ne=de.BoundingSphere.fromVertices(j,pe.Cartesian3.ZERO,3,Ae),se=le.OrientedBoundingBox.fromRectangle(Q,J,Z,q,Ee),e=new ce.EllipsoidalOccluder(q).computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(ne.center,j,3,ne.center,J,Ve),re=Z-J,he=new Uint16Array(o.length+a.length+p.length),N=0;N<o.length;++N)he[N]=o[N];var ue=o.length;for(N=0;N<a.length;++N)he[ue+N]=a[N];for(ue+=a.length,N=0;N<p.length;++N)he[ue+N]=me*(p[N]-J)/re;var oe,Q=fe.IndexDatatype.createTypedArray(o.length,f);return x?(oe=new Uint8Array(d),t.push(he.buffer,Q.buffer,oe.buffer),oe=oe.buffer):t.push(he.buffer,Q.buffer),{vertices:he.buffer,encodedNormals:oe,indices:Q.buffer,minimumHeight:J,maximumHeight:Z,westIndices:Y,southIndices:L,eastIndices:_,northIndices:G,boundingSphere:ne,orientedBoundingBox:se,horizonOcclusionPoint:e}})});