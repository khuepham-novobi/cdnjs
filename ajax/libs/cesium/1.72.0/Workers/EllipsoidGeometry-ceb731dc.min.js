define(["exports","./when-54c2dc71","./Check-6c0211bc","./Math-fc8cecf5","./Cartesian2-bddc1162","./Transforms-ec27f304","./ComponentDatatype-6d99a1ee","./GeometryAttribute-44fb48f1","./GeometryAttributes-4fcfcf40","./IndexDatatype-53503fee","./GeometryOffsetAttribute-7350d9af","./VertexFormat-7572c785"],function(t,$,e,tt,et,at,it,rt,nt,ot,mt,f){"use strict";var st=new et.Cartesian3,ut=new et.Cartesian3,lt=new et.Cartesian3,ct=new et.Cartesian3,ft=new et.Cartesian3,l=new et.Cartesian3(1,1,1),dt=Math.cos,Ct=Math.sin;function d(t){t=$.defaultValue(t,$.defaultValue.EMPTY_OBJECT);var e=$.defaultValue(t.radii,l),a=$.defaultValue(t.innerRadii,e),i=$.defaultValue(t.minimumClock,0),r=$.defaultValue(t.maximumClock,tt.CesiumMath.TWO_PI),n=$.defaultValue(t.minimumCone,0),o=$.defaultValue(t.maximumCone,tt.CesiumMath.PI),m=Math.round($.defaultValue(t.stackPartitions,64)),s=Math.round($.defaultValue(t.slicePartitions,64)),u=$.defaultValue(t.vertexFormat,f.VertexFormat.DEFAULT);this._radii=et.Cartesian3.clone(e),this._innerRadii=et.Cartesian3.clone(a),this._minimumClock=i,this._maximumClock=r,this._minimumCone=n,this._maximumCone=o,this._stackPartitions=m,this._slicePartitions=s,this._vertexFormat=f.VertexFormat.clone(u),this._offsetAttribute=t.offsetAttribute,this._workerName="createEllipsoidGeometry"}d.packedLength=2*et.Cartesian3.packedLength+f.VertexFormat.packedLength+7,d.pack=function(t,e,a){return a=$.defaultValue(a,0),et.Cartesian3.pack(t._radii,e,a),a+=et.Cartesian3.packedLength,et.Cartesian3.pack(t._innerRadii,e,a),a+=et.Cartesian3.packedLength,f.VertexFormat.pack(t._vertexFormat,e,a),a+=f.VertexFormat.packedLength,e[a++]=t._minimumClock,e[a++]=t._maximumClock,e[a++]=t._minimumCone,e[a++]=t._maximumCone,e[a++]=t._stackPartitions,e[a++]=t._slicePartitions,e[a]=$.defaultValue(t._offsetAttribute,-1),e};var a,C=new et.Cartesian3,p=new et.Cartesian3,y=new f.VertexFormat,_={radii:C,innerRadii:p,vertexFormat:y,minimumClock:void 0,maximumClock:void 0,minimumCone:void 0,maximumCone:void 0,stackPartitions:void 0,slicePartitions:void 0,offsetAttribute:void 0};d.unpack=function(t,e,a){e=$.defaultValue(e,0);var i=et.Cartesian3.unpack(t,e,C);e+=et.Cartesian3.packedLength;var r=et.Cartesian3.unpack(t,e,p);e+=et.Cartesian3.packedLength;var n=f.VertexFormat.unpack(t,e,y);e+=f.VertexFormat.packedLength;var o=t[e++],m=t[e++],s=t[e++],u=t[e++],l=t[e++],c=t[e++],e=t[e];return $.defined(a)?(a._radii=et.Cartesian3.clone(i,a._radii),a._innerRadii=et.Cartesian3.clone(r,a._innerRadii),a._vertexFormat=f.VertexFormat.clone(n,a._vertexFormat),a._minimumClock=o,a._maximumClock=m,a._minimumCone=s,a._maximumCone=u,a._stackPartitions=l,a._slicePartitions=c,a._offsetAttribute=-1===e?void 0:e,a):(_.minimumClock=o,_.maximumClock=m,_.minimumCone=s,_.maximumCone=u,_.stackPartitions=l,_.slicePartitions=c,_.offsetAttribute=-1===e?void 0:e,new d(_))},d.createGeometry=function(t){var e=t._radii;if(!(e.x<=0||e.y<=0||e.z<=0)){var a=t._innerRadii;if(!(a.x<=0||a.y<=0||a.z<=0)){var i=t._minimumClock,r=t._maximumClock,n=t._minimumCone,o=t._maximumCone,m=t._vertexFormat,s=t._slicePartitions+1,u=t._stackPartitions+1;(s=Math.round(s*Math.abs(r-i)/tt.CesiumMath.TWO_PI))<2&&(s=2),(u=Math.round(u*Math.abs(o-n)/tt.CesiumMath.PI))<2&&(u=2);for(var l=0,c=[n],f=[i],d=0;d<u;d++)c.push(n+d*(o-n)/(u-1));for(c.push(o),E=0;E<s;E++)f.push(i+E*(r-i)/(s-1));f.push(r);var C=c.length,p=f.length,y=0,_=1,h=a.x!==e.x||a.y!==e.y||a.z!==e.z,v=!1,A=!1,x=!1;h&&(_=2,0<n&&(v=!0,y+=s-1),o<Math.PI&&(A=!0,y+=s-1),(r-i)%tt.CesiumMath.TWO_PI?(x=!0,y+=2*(u-1)+1):y+=1);var b=p*C*_,k=new Float64Array(3*b),w=mt.arrayFill(new Array(b),!1),F=mt.arrayFill(new Array(b),!1),P=s*u*_,y=6*(P+y+1-(s+u)*_),g=ot.IndexDatatype.createTypedArray(P,y),V=m.normal?new Float32Array(3*b):void 0,M=m.tangent?new Float32Array(3*b):void 0,T=m.bitangent?new Float32Array(3*b):void 0,D=m.st?new Float32Array(2*b):void 0,G=new Array(C),L=new Array(C);for(d=0;d<C;d++)G[d]=Ct(c[d]),L[d]=dt(c[d]);for(var O=new Array(p),I=new Array(p),E=0;E<p;E++)I[E]=dt(f[E]),O[E]=Ct(f[E]);for(d=0;d<C;d++)for(E=0;E<p;E++)k[l++]=e.x*G[d]*I[E],k[l++]=e.y*G[d]*O[E],k[l++]=e.z*L[d];var z,N,R,U,S=b/2;if(h)for(d=0;d<C;d++)for(E=0;E<p;E++)k[l++]=a.x*G[d]*I[E],k[l++]=a.y*G[d]*O[E],k[l++]=a.z*L[d],w[S]=!0,0<d&&d!==C-1&&0!==E&&E!==p-1&&(F[S]=!0),S++;for(l=0,d=1;d<C-2;d++)for(z=d*p,N=(d+1)*p,E=1;E<p-2;E++)g[l++]=N+E,g[l++]=N+E+1,g[l++]=z+E+1,g[l++]=N+E,g[l++]=z+E+1,g[l++]=z+E;if(h)for(var B=C*p,d=1;d<C-2;d++)for(z=B+d*p,N=B+(d+1)*p,E=1;E<p-2;E++)g[l++]=N+E,g[l++]=z+E,g[l++]=z+E+1,g[l++]=N+E,g[l++]=z+E+1,g[l++]=N+E+1;if(h){if(v)for(U=C*p,d=1;d<p-2;d++)g[l++]=d,g[l++]=d+1,g[l++]=U+d+1,g[l++]=d,g[l++]=U+d+1,g[l++]=U+d;if(A)for(R=C*p-p,U=C*p*_-p,d=1;d<p-2;d++)g[l++]=R+d+1,g[l++]=R+d,g[l++]=U+d,g[l++]=R+d+1,g[l++]=U+d,g[l++]=U+d+1}if(x){for(d=1;d<C-2;d++)U=p*C+p*d,R=p*d,g[l++]=U,g[l++]=R+p,g[l++]=R,g[l++]=U,g[l++]=U+p,g[l++]=R+p;for(d=1;d<C-2;d++)U=p*C+p*(d+1)-1,R=p*(d+1)-1,g[l++]=R+p,g[l++]=U,g[l++]=R,g[l++]=R+p,g[l++]=U+p,g[l++]=U}A=new nt.GeometryAttributes;m.position&&(A.position=new rt.GeometryAttribute({componentDatatype:it.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:k}));var W=0,Y=0,J=0,X=0,Z=b/2,j=et.Ellipsoid.fromCartesian3(e),q=et.Ellipsoid.fromCartesian3(a);if(m.st||m.normal||m.tangent||m.bitangent){for(d=0;d<b;d++){Q=w[d]?q:j;var H,K=et.Cartesian3.fromArray(k,3*d,st),Q=Q.geodeticSurfaceNormal(K,ut);F[d]&&et.Cartesian3.negate(Q,Q),m.st&&(H=et.Cartesian2.negate(Q,ft),D[W++]=Math.atan2(H.y,H.x)/tt.CesiumMath.TWO_PI+.5,D[W++]=Math.asin(Q.z)/Math.PI+.5),m.normal&&(V[Y++]=Q.x,V[Y++]=Q.y,V[Y++]=Q.z),(m.tangent||m.bitangent)&&(K=lt,H=0,w[d]&&(H=Z),H=!v&&H<=d&&d<H+2*p?et.Cartesian3.UNIT_X:et.Cartesian3.UNIT_Z,et.Cartesian3.cross(H,Q,K),et.Cartesian3.normalize(K,K),m.tangent&&(M[J++]=K.x,M[J++]=K.y,M[J++]=K.z),m.bitangent&&(K=et.Cartesian3.cross(Q,K,ct),et.Cartesian3.normalize(K,K),T[X++]=K.x,T[X++]=K.y,T[X++]=K.z))}m.st&&(A.st=new rt.GeometryAttribute({componentDatatype:it.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:D})),m.normal&&(A.normal=new rt.GeometryAttribute({componentDatatype:it.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:V})),m.tangent&&(A.tangent=new rt.GeometryAttribute({componentDatatype:it.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:M})),m.bitangent&&(A.bitangent=new rt.GeometryAttribute({componentDatatype:it.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:T}))}return $.defined(t._offsetAttribute)&&(_=k.length,x=new Uint8Array(_/3),_=t._offsetAttribute===mt.GeometryOffsetAttribute.NONE?0:1,mt.arrayFill(x,_),A.applyOffset=new rt.GeometryAttribute({componentDatatype:it.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:x})),new rt.Geometry({attributes:A,indices:g,primitiveType:rt.PrimitiveType.TRIANGLES,boundingSphere:at.BoundingSphere.fromEllipsoid(j),offsetAttribute:t._offsetAttribute})}}},d.getUnitEllipsoid=function(){return $.defined(a)||(a=d.createGeometry(new d({radii:new et.Cartesian3(1,1,1),vertexFormat:f.VertexFormat.POSITION_ONLY}))),a},t.EllipsoidGeometry=d});