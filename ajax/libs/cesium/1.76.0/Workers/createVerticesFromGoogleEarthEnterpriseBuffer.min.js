define(["./when-54c2dc71","./Check-6c0211bc","./Math-fc8cecf5","./Cartesian2-bddc1162","./Transforms-d07bb42c","./RuntimeError-2109023a","./WebGLConstants-76bb35d1","./ComponentDatatype-6d99a1ee","./AttributeCompression-9fc99391","./IntersectionTests-8abf6dba","./Plane-c8971487","./WebMercatorProjection-df58d479","./createTaskProcessorWorker","./EllipsoidTangentPlane-0a0e472c","./OrientedBoundingBox-2c275398","./TerrainEncoding-d6aef4ae"],function(Tt,t,Ct,ft,Mt,vt,e,i,n,a,r,Nt,o,xt,bt,St){"use strict";var wt=Uint16Array.BYTES_PER_ELEMENT,Pt=Int32Array.BYTES_PER_ELEMENT,Bt=Uint32Array.BYTES_PER_ELEMENT,yt=Float32Array.BYTES_PER_ELEMENT,At=Float64Array.BYTES_PER_ELEMENT;function Rt(t,e,i){i=Tt.defaultValue(i,Ct.CesiumMath);for(var n=t.length,a=0;a<n;++a)if(i.equalsEpsilon(t[a],e,Ct.CesiumMath.EPSILON12))return a;return-1}var _t=new ft.Cartographic,Wt=new ft.Cartesian3,Ft=new ft.Cartesian3,Ot=new ft.Cartesian3,Yt=new Mt.Matrix4;function kt(t,e,i,n,a,r,o,s,u,h){for(var c=o.length,d=0;d<c;++d){var g=o[d],l=g.cartographic,m=g.index,p=t.length,I=l.longitude,E=l.latitude,E=Ct.CesiumMath.clamp(E,-Ct.CesiumMath.PI_OVER_TWO,Ct.CesiumMath.PI_OVER_TWO),l=l.height-r.skirtHeight;r.hMin=Math.min(r.hMin,l),ft.Cartographic.fromRadians(I,E,l,_t),u&&(_t.longitude+=s),u?d===c-1?_t.latitude+=h:0===d&&(_t.latitude-=h):_t.latitude+=s,E=r.ellipsoid.cartographicToCartesian(_t),t.push(E),e.push(l),i.push(ft.Cartesian2.clone(i[m])),0<n.length&&n.push(n[m]),Mt.Matrix4.multiplyByPoint(r.toENU,E,Wt),l=r.minimum,E=r.maximum,ft.Cartesian3.minimumByComponent(Wt,l,l),ft.Cartesian3.maximumByComponent(Wt,E,E),E=r.lastBorderPoint,Tt.defined(E)&&(E=E.index,a.push(E,p-1,p,p,m,E)),r.lastBorderPoint=g}}return o(function(t,e){t.ellipsoid=ft.Ellipsoid.clone(t.ellipsoid),t.rectangle=ft.Rectangle.clone(t.rectangle);var i=function(t,e,i,n,a,r,o,s,u,h){var c,d,g,l,m,p,I,E=Tt.defined(n)?(c=n.west,d=n.south,g=n.east,l=n.north,m=n.width,n.height):(c=Ct.CesiumMath.toRadians(a.west),d=Ct.CesiumMath.toRadians(a.south),g=Ct.CesiumMath.toRadians(a.east),l=Ct.CesiumMath.toRadians(a.north),m=Ct.CesiumMath.toRadians(n.width),Ct.CesiumMath.toRadians(n.height)),T=[d,l],C=[c,g],f=Mt.Transforms.eastNorthUpToFixedFrame(e,i),M=Mt.Matrix4.inverseTransformation(f,Yt);s&&(p=Nt.WebMercatorProjection.geodeticLatitudeToMercatorAngle(d),I=1/(Nt.WebMercatorProjection.geodeticLatitudeToMercatorAngle(l)-p));var v=new DataView(t),N=Number.POSITIVE_INFINITY,x=Number.NEGATIVE_INFINITY,b=Ft;b.x=Number.POSITIVE_INFINITY,b.y=Number.POSITIVE_INFINITY,b.z=Number.POSITIVE_INFINITY;var S=Ot;S.x=Number.NEGATIVE_INFINITY,S.y=Number.NEGATIVE_INFINITY,S.z=Number.NEGATIVE_INFINITY;for(var w=0,P=0,B=0,y=0;y<4;++y){var A=w,R=v.getUint32(A,!0);A+=Bt;var _=Ct.CesiumMath.toRadians(180*v.getFloat64(A,!0));A+=At,-1===Rt(C,_)&&C.push(_),_=Ct.CesiumMath.toRadians(180*v.getFloat64(A,!0)),A+=At,-1===Rt(T,_)&&T.push(_),A+=2*At,_=v.getInt32(A,!0),A+=Pt,P+=_,B+=3*(_=v.getInt32(A,!0)),w+=R+Bt}var W=[],F=[],O=new Array(P),Y=new Array(P),k=new Array(P),U=s?new Array(P):[],V=new Array(B),H=[],L=[],D=[],G=[],j=0,z=0;for(y=w=0;y<4;++y){R=v.getUint32(w,!0);var q=w+=Bt,J=Ct.CesiumMath.toRadians(180*v.getFloat64(w,!0));w+=At;var K=Ct.CesiumMath.toRadians(180*v.getFloat64(w,!0));w+=At;var Q=Ct.CesiumMath.toRadians(180*v.getFloat64(w,!0)),X=.5*Q;w+=At;var Z=Ct.CesiumMath.toRadians(180*v.getFloat64(w,!0)),$=.5*Z;w+=At;var tt=v.getInt32(w,!0);w+=Pt;var et=v.getInt32(w,!0);w+=Pt,w+=Pt;for(var it=new Array(tt),nt=0;nt<tt;++nt){var at=J+v.getUint8(w++)*Q;_t.longitude=at;var rt=K+v.getUint8(w++)*Z;_t.latitude=rt;var ot=v.getFloat32(w,!0);if(w+=yt,0!==ot&&ot<h&&(ot*=-Math.pow(2,u)),ot*=6371010*r,_t.height=ot,-1!==Rt(C,at)||-1!==Rt(T,rt)){var st=Rt(W,_t,ft.Cartographic);if(-1!==st){it[nt]=F[st];continue}W.push(ft.Cartographic.clone(_t)),F.push(j)}it[nt]=j,Math.abs(at-c)<X?H.push({index:j,cartographic:ft.Cartographic.clone(_t)}):Math.abs(at-g)<X?D.push({index:j,cartographic:ft.Cartographic.clone(_t)}):Math.abs(rt-d)<$?L.push({index:j,cartographic:ft.Cartographic.clone(_t)}):Math.abs(rt-l)<$&&G.push({index:j,cartographic:ft.Cartographic.clone(_t)}),N=Math.min(ot,N),x=Math.max(ot,x),k[j]=ot,ot=i.cartographicToCartesian(_t),O[j]=ot,s&&(U[j]=(Nt.WebMercatorProjection.geodeticLatitudeToMercatorAngle(rt)-p)*I),Mt.Matrix4.multiplyByPoint(M,ot,Wt),ft.Cartesian3.minimumByComponent(Wt,b,b),ft.Cartesian3.maximumByComponent(Wt,S,S),at=(at-c)/(g-c),at=Ct.CesiumMath.clamp(at,0,1),rt=(rt-d)/(l-d),rt=Ct.CesiumMath.clamp(rt,0,1),Y[j]=new ft.Cartesian2(at,rt),++j}for(var ut=3*et,ht=0;ht<ut;++ht,++z)V[z]=it[v.getUint16(w,!0)],w+=wt;if(R!==w-q)throw new vt.RuntimeError("Invalid terrain tile.")}O.length=j,Y.length=j,k.length=j,s&&(U.length=j);var E,ct=j,a=z,t={hMin:N,lastBorderPoint:void 0,skirtHeight:o,toENU:M,ellipsoid:i,minimum:b,maximum:S};H.sort(function(t,e){return e.cartographic.latitude-t.cartographic.latitude}),L.sort(function(t,e){return t.cartographic.longitude-e.cartographic.longitude}),D.sort(function(t,e){return t.cartographic.latitude-e.cartographic.latitude}),G.sort(function(t,e){return e.cartographic.longitude-t.cartographic.longitude}),kt(O,k,Y,U,V,t,H,-(o=1e-5)*m,!0,-o*E),kt(O,k,Y,U,V,t,L,-o*E,!1),kt(O,k,Y,U,V,t,D,o*m,!0,o*E),kt(O,k,Y,U,V,t,G,o*E,!1),0<H.length&&0<G.length&&(gt=H[0].index,lt=G[G.length-1].index,E=O.length-1,V.push(lt,E,ct,ct,gt,lt)),P=O.length;var dt,gt=Mt.BoundingSphere.fromPoints(O);Tt.defined(n)&&(dt=bt.OrientedBoundingBox.fromRectangle(n,N,x,i));for(var lt=new St.EllipsoidalOccluder(i).computeHorizonCullingPointPossiblyUnderEllipsoid(e,O,N),n=new xt.AxisAlignedBoundingBox(b,S,e),mt=new St.TerrainEncoding(n,t.hMin,x,f,!1,s),pt=new Float32Array(P*mt.getStride()),It=0,Et=0;Et<P;++Et)It=mt.encode(pt,It,O[Et],Y[Et],k[Et],void 0,U[Et]);return e=H.map(function(t){return t.index}).reverse(),n=L.map(function(t){return t.index}).reverse(),t=D.map(function(t){return t.index}).reverse(),f=G.map(function(t){return t.index}).reverse(),n.unshift(t[t.length-1]),n.push(e[0]),f.unshift(e[e.length-1]),f.push(t[0]),{vertices:pt,indices:new Uint16Array(V),maximumHeight:x,minimumHeight:N,encoding:mt,boundingSphere3D:gt,orientedBoundingBox:dt,occludeePointInScaledSpace:lt,vertexCountWithoutSkirts:ct,indexCountWithoutSkirts:a,westIndicesSouthToNorth:e,southIndicesEastToWest:n,eastIndicesNorthToSouth:t,northIndicesWestToEast:f}}(t.buffer,t.relativeToCenter,t.ellipsoid,t.rectangle,t.nativeRectangle,t.exaggeration,t.skirtHeight,t.includeWebMercatorT,t.negativeAltitudeExponentBias,t.negativeElevationThreshold),n=i.vertices;return e.push(n.buffer),t=i.indices,e.push(t.buffer),{vertices:n.buffer,indices:t.buffer,numberOfAttributes:i.encoding.getStride(),minimumHeight:i.minimumHeight,maximumHeight:i.maximumHeight,boundingSphere3D:i.boundingSphere3D,orientedBoundingBox:i.orientedBoundingBox,occludeePointInScaledSpace:i.occludeePointInScaledSpace,encoding:i.encoding,vertexCountWithoutSkirts:i.vertexCountWithoutSkirts,indexCountWithoutSkirts:i.indexCountWithoutSkirts,westIndicesSouthToNorth:i.westIndicesSouthToNorth,southIndicesEastToWest:i.southIndicesEastToWest,eastIndicesNorthToSouth:i.eastIndicesNorthToSouth,northIndicesWestToEast:i.northIndicesWestToEast}})});