define(["exports","./when-54c2dc71","./Check-6c0211bc","./Math-fc8cecf5","./Cartesian2-bddc1162","./Transforms-6f81ad4c"],function(a,f,t,p,v,w){"use strict";var R={};function n(a,t,e){var r=a+t;return p.CesiumMath.sign(a)!==p.CesiumMath.sign(t)&&Math.abs(r/Math.max(Math.abs(a),Math.abs(t)))<e?0:r}R.computeDiscriminant=function(a,t,e){return t*t-4*a*e},R.computeRealRoots=function(a,t,e){if(0===a)return 0===t?[]:[-e/t];if(0!==t)return 0===e?(r=-t/a)<0?[r,0]:[0,r]:(r=n(t*t,-4*a*e,p.CesiumMath.EPSILON14))<0?[]:(r=-.5*n(t,p.CesiumMath.sign(t)*Math.sqrt(r),p.CesiumMath.EPSILON14),0<t?[r/a,e/r]:[e/r,r/a]);if(0===e)return[0,0];var t=Math.abs(e),r=Math.abs(a);return t<r&&t/r<p.CesiumMath.EPSILON14?[0,0]:r<t&&r/t<p.CesiumMath.EPSILON14||(r=-e/a)<0?[]:[-(t=Math.sqrt(r)),t]};var g={};function s(a,t,e,r){var n=t/3,i=e/3,s=r,o=(d=a)*i,u=n*s;if((e=4*(m=d*i-(M=n*n))*(t=n*s-(h=i*i))-(a=d*s-n*i)*a)<0){var c=(c=(f=(C=-((r=o*h<=M*u?-2*n*(l=m)+(c=d)*a:-(c=s)*a+2*i*(l=t))<0?-1:1)*Math.abs(c)*Math.sqrt(-e))-r)/2)<0?-Math.pow(-c,1/3):Math.pow(c,1/3),C=f===C?-c:-l/c,C=l<=0?c+C:-r/(c*c+C*C+l);return o*h<=M*u?[(C-n)/d]:[-s/(C+i)]}var l=m,o=-2*n*m+d*a,h=t,M=-s*a+2*i*t,u=Math.sqrt(e),m=Math.sqrt(3)/2,a=Math.abs(Math.atan2(d*u,-o)/3),d=(o=2*n<(f=(C=2*Math.sqrt(-l))*(t=Math.cos(a)))+(e=C*(-t/2-m*Math.sin(a)))?f-n:e-n)/(l=d),a=Math.abs(Math.atan2(s*u,-M)/3),f=(s=-s)/(a=(f=(C=2*Math.sqrt(-h))*(t=Math.cos(a)))+(e=C*(-t/2-m*Math.sin(a)))<2*i?f+i:e+i);return d<=(a=(i*(e=-o*a-l*s)-o*s*n)/(-n*e+l*a*i))?d<=f?a<=f?[d,a,f]:[d,f,a]:[f,d,a]:d<=f?[a,d,f]:a<=f?[a,f,d]:[f,a,d]}g.computeDiscriminant=function(a,t,e,r){var n=t*t,i=e*e;return 18*a*t*e*r+n*i-a*a*27*(r*r)-4*(a*i*e+n*t*r)},g.computeRealRoots=function(a,t,e,r){var n;if(0===a)return R.computeRealRoots(t,e,r);if(0!==t)return 0===e?0===r?(i=-t/a)<0?[i,0,0]:[0,0,i]:s(a,t,0,r):0===r?0===(n=R.computeRealRoots(a,t,e)).length?[0]:n[1]<=0?[n[0],n[1],0]:0<=n[0]?[0,n[0],n[1]]:[n[0],0,n[1]]:s(a,t,e,r);if(0!==e)return 0===r?0===(n=R.computeRealRoots(a,0,e)).Length?[0]:[n[0],0,n[1]]:s(a,0,e,r);if(0===r)return[0,0,0];var i=(i=-r/a)<0?-Math.pow(-i,1/3):Math.pow(i,1/3);return[i,i,i]};var S={};function i(a,t,e,r){var n=a*a,i=t-3*n/8,s=e-t*a/2+n*a/8,r=r-e*a/4+t*n/16-3*n*n/256;if(0<(e=g.computeRealRoots(1,2*i,i*i-4*r,-s*s)).length){if(t=-a/4,n=e[e.length-1],Math.abs(n)<p.CesiumMath.EPSILON14){if(2===(a=R.computeRealRoots(1,i,r)).length){var e=a[0],o=a[1];if(0<=e&&0<=o)return r=Math.sqrt(e),[t-(a=Math.sqrt(o)),t-r,t+r,t+a];if(0<=e&&o<0)return[t-(u=Math.sqrt(e)),t+u];if(e<0&&0<=o)return[t-(u=Math.sqrt(o)),t+u]}return[]}if(0<n){var u=(i+n-s/(o=Math.sqrt(n)))/2,s=(i+n+s/o)/2,u=R.computeRealRoots(1,o,u),s=R.computeRealRoots(1,-o,s);return 0!==u.length?(u[0]+=t,u[1]+=t,0!==s.length?(s[0]+=t,s[1]+=t,u[1]<=s[0]?[u[0],u[1],s[0],s[1]]:s[1]<=u[0]?[s[0],s[1],u[0],u[1]]:u[0]>=s[0]&&u[1]<=s[1]?[s[0],u[0],u[1],s[1]]:s[0]>=u[0]&&s[1]<=u[1]?[u[0],s[0],s[1],u[1]]:u[0]>s[0]&&u[0]<s[1]?[s[0],u[0],s[1],u[1]]:[u[0],s[0],u[1],s[1]]):u):0!==s.length?(s[0]+=t,s[1]+=t,s):[]}}return[]}function o(a,t,e,r){var n=-2*t,i=e*a+t*t-4*r,s=(h=a*a)*r-e*t*a+e*e;if(0<(l=g.computeRealRoots(1,n,i,s)).length){var o,u,c,C=l[0],s=a/2,l=(n=t-C)/2,t=(i=n*n)-4*r,n=i+4*Math.abs(r),i=h-4*C,h=h+4*Math.abs(C),M=C<0||t*h<i*n?(o=(i=Math.sqrt(i))/2,0===i?0:(a*l-e)/i):(o=0===(M=Math.sqrt(t))?0:(a*l-e)/M,M/2);0==s&&0===o?c=u=0:p.CesiumMath.sign(s)===p.CesiumMath.sign(o)?c=C/(u=s+o):u=C/(c=s-o),0==l&&0===M?d=m=0:p.CesiumMath.sign(l)===p.CesiumMath.sign(M)?d=r/(m=l+M):m=r/(d=l-M);var m=R.computeRealRoots(1,u,m),d=R.computeRealRoots(1,c,d);if(0!==m.length)return 0!==d.length?m[1]<=d[0]?[m[0],m[1],d[0],d[1]]:d[1]<=m[0]?[d[0],d[1],m[0],m[1]]:m[0]>=d[0]&&m[1]<=d[1]?[d[0],m[0],m[1],d[1]]:d[0]>=m[0]&&d[1]<=m[1]?[m[0],d[0],d[1],m[1]]:m[0]>d[0]&&m[0]<d[1]?[d[0],m[0],d[1],m[1]]:[m[0],d[0],m[1],d[1]]:m;if(0!==d.length)return d}return[]}function e(a,t){t=v.Cartesian3.clone(f.defaultValue(t,v.Cartesian3.ZERO)),v.Cartesian3.equals(t,v.Cartesian3.ZERO)||v.Cartesian3.normalize(t,t),this.origin=v.Cartesian3.clone(f.defaultValue(a,v.Cartesian3.ZERO)),this.direction=t}S.computeDiscriminant=function(a,t,e,r,n){var i=a*a,s=t*t,o=s*t,u=e*e,c=u*e,C=r*r,l=C*r,h=n*n;return s*u*C-4*o*l-4*a*c*C+18*a*t*e*l-27*i*C*C+i*a*256*(h*n)+n*(18*o*e*r-4*s*c+16*a*u*u-80*a*t*u*r-6*a*s*C+144*i*e*C)+h*(144*a*s*e-27*s*s-128*i*u-192*i*t*r)},S.computeRealRoots=function(a,t,e,r,n){if(Math.abs(a)<p.CesiumMath.EPSILON15)return g.computeRealRoots(t,e,r,n);t/=a,e/=a,r/=a,n/=a,a=t<0?1:0;switch(a+=e<0?a+1:a,a+=r<0?a+1:a,a+=n<0?a+1:a){case 0:return i(t,e,r,n);case 1:case 2:return o(t,e,r,n);case 3:case 4:return i(t,e,r,n);case 5:return o(t,e,r,n);case 6:case 7:return i(t,e,r,n);case 8:return o(t,e,r,n);case 9:case 10:return i(t,e,r,n);case 11:return o(t,e,r,n);case 12:case 13:case 14:case 15:return i(t,e,r,n);default:return}},e.clone=function(a,t){if(f.defined(a))return f.defined(t)?(t.origin=v.Cartesian3.clone(a.origin),t.direction=v.Cartesian3.clone(a.direction),t):new e(a.origin,a.direction)},e.getPoint=function(a,t,e){return f.defined(e)||(e=new v.Cartesian3),e=v.Cartesian3.multiplyByScalar(a.direction,t,e),v.Cartesian3.add(a.origin,e,e)};var C={rayPlane:function(a,t,e){f.defined(e)||(e=new v.Cartesian3);var r=a.origin,n=a.direction,i=t.normal,a=v.Cartesian3.dot(i,n);if(!(Math.abs(a)<p.CesiumMath.EPSILON15||(a=(-t.distance-v.Cartesian3.dot(i,r))/a)<0))return e=v.Cartesian3.multiplyByScalar(n,a,e),v.Cartesian3.add(r,e,e)}},M=new v.Cartesian3,m=new v.Cartesian3,d=new v.Cartesian3,O=new v.Cartesian3,x=new v.Cartesian3;C.rayTriangleParametric=function(a,t,e,r,n){n=f.defaultValue(n,!1);var i,s,o,u=a.origin,c=a.direction,C=v.Cartesian3.subtract(e,t,M),a=v.Cartesian3.subtract(r,t,m),e=v.Cartesian3.cross(c,a,d),r=v.Cartesian3.dot(C,e);if(n){if(r<p.CesiumMath.EPSILON6)return;if(h=v.Cartesian3.subtract(u,t,O),(l=v.Cartesian3.dot(h,e))<0||r<l)return;if(i=v.Cartesian3.cross(h,C,x),(s=v.Cartesian3.dot(c,i))<0||r<l+s)return;o=v.Cartesian3.dot(a,i)/r}else{if(Math.abs(r)<p.CesiumMath.EPSILON6)return;var l,r=1/r,h=v.Cartesian3.subtract(u,t,O);if((l=v.Cartesian3.dot(h,e)*r)<0||1<l)return;if(i=v.Cartesian3.cross(h,C,x),(s=v.Cartesian3.dot(c,i)*r)<0||1<l+s)return;o=v.Cartesian3.dot(a,i)*r}return o},C.rayTriangle=function(a,t,e,r,n,i){if(n=C.rayTriangleParametric(a,t,e,r,n),f.defined(n)&&!(n<0))return f.defined(i)||(i=new v.Cartesian3),v.Cartesian3.multiplyByScalar(a.direction,n,i),v.Cartesian3.add(a.origin,i,i)};var u=new e;C.lineSegmentTriangle=function(a,t,e,r,n,i,s){var o=u;if(v.Cartesian3.clone(a,o.origin),v.Cartesian3.subtract(t,a,o.direction),v.Cartesian3.normalize(o.direction,o.direction),i=C.rayTriangleParametric(o,e,r,n,i),!(!f.defined(i)||i<0||i>v.Cartesian3.distance(a,t)))return f.defined(s)||(s=new v.Cartesian3),v.Cartesian3.multiplyByScalar(o.direction,i,s),v.Cartesian3.add(o.origin,s,s)};var c={root0:0,root1:0};function l(a,t,e){f.defined(e)||(e=new w.Interval);var r=a.origin,n=a.direction,a=t.center,t=t.radius*t.radius,a=v.Cartesian3.subtract(r,a,d),t=function(a,t,e,r){if(!((i=t*t-4*a*e)<0)){if(0<i){var n=1/(2*a),i=(-t+(e=Math.sqrt(i)))*n;return i<(n=(-t-e)*n)?(r.root0=i,r.root1=n):(r.root0=n,r.root1=i),r}if(0!=(a=-t/(2*a)))return r.root0=r.root1=a,r}}(v.Cartesian3.dot(n,n),2*v.Cartesian3.dot(n,a),v.Cartesian3.magnitudeSquared(a)-t,c);if(f.defined(t))return e.start=t.root0,e.stop=t.root1,e}C.raySphere=function(a,t,e){if(e=l(a,t,e),f.defined(e)&&!(e.stop<0))return e.start=Math.max(e.start,0),e};var h=new e;C.lineSegmentSphere=function(a,t,e,r){var n=h;if(v.Cartesian3.clone(a,n.origin),t=v.Cartesian3.subtract(t,a,n.direction),a=v.Cartesian3.magnitude(t),v.Cartesian3.normalize(t,t),r=l(n,e,r),!(!f.defined(r)||r.stop<0||r.start>a))return r.start=Math.max(r.start,0),r.stop=Math.min(r.stop,a),r};var y=new v.Cartesian3,P=new v.Cartesian3;function b(a,t,e){var r=a+t;return p.CesiumMath.sign(a)!==p.CesiumMath.sign(t)&&Math.abs(r/Math.max(Math.abs(a),Math.abs(t)))<e?0:r}C.rayEllipsoid=function(a,t){var e,r,n=t.oneOverRadii,i=v.Cartesian3.multiplyComponents(n,a.origin,y),t=v.Cartesian3.multiplyComponents(n,a.direction,P),n=v.Cartesian3.magnitudeSquared(i),a=v.Cartesian3.dot(i,t);if(1<n){if(0<=a)return;var s,o,u=n-1;if((i=a*a)<(o=(s=v.Cartesian3.magnitudeSquared(t))*u))return;if(o<i){e=a*a-o;var c=(r=-a+Math.sqrt(e))/s;return c<(i=u/r)?new w.Interval(c,i):{start:i,stop:c}}return c=Math.sqrt(u/s),new w.Interval(c,c)}return n<1?(u=n-1,e=a*a-(o=(s=v.Cartesian3.magnitudeSquared(t))*u),r=-a+Math.sqrt(e),new w.Interval(0,r/s)):a<0?(s=v.Cartesian3.magnitudeSquared(t),new w.Interval(0,-a/s)):void 0};var N=new v.Cartesian3,q=new v.Cartesian3,L=new v.Cartesian3,I=new v.Cartesian3,E=new v.Cartesian3,z=new w.Matrix3,T=new w.Matrix3,U=new w.Matrix3,W=new w.Matrix3,B=new w.Matrix3,V=new w.Matrix3,Z=new w.Matrix3,A=new v.Cartesian3,D=new v.Cartesian3,k=new v.Cartographic;C.grazingAltitudeLocation=function(a,t){var e=a.origin,r=a.direction;if(!v.Cartesian3.equals(e,v.Cartesian3.ZERO)){var n=t.geodeticSurfaceNormal(e,N);if(0<=v.Cartesian3.dot(r,n))return e}var i=f.defined(this.rayEllipsoid(a,t)),s=t.transformPositionToScaledSpace(r,N),n=v.Cartesian3.normalize(s,s),a=v.Cartesian3.mostOrthogonalAxis(s,I),s=v.Cartesian3.normalize(v.Cartesian3.cross(a,n,q),q),a=v.Cartesian3.normalize(v.Cartesian3.cross(n,s,L),L),o=z;o[0]=n.x,o[1]=n.y,o[2]=n.z,o[3]=s.x,o[4]=s.y,o[5]=s.z,o[6]=a.x,o[7]=a.y,o[8]=a.z;var n=w.Matrix3.transpose(o,T),u=w.Matrix3.fromScale(t.radii,U),s=w.Matrix3.fromScale(t.oneOverRadii,W);(a=B)[0]=0,a[1]=-r.z,a[2]=r.y,a[3]=r.z,a[4]=0,a[5]=-r.x,a[6]=-r.y,a[7]=r.x,a[8]=0;var c,s=w.Matrix3.multiply(w.Matrix3.multiply(n,s,V),a,V),a=w.Matrix3.multiply(w.Matrix3.multiply(s,u,Z),o,Z),s=w.Matrix3.multiplyByVector(s,e,E),C=function(a,t){var e,r=a[w.Matrix3.COLUMN1ROW1]-a[w.Matrix3.COLUMN2ROW2],n=+(0*b(a[w.Matrix3.COLUMN1ROW0],a[w.Matrix3.COLUMN0ROW1],p.CesiumMath.EPSILON15)+t.y),i=0*a[w.Matrix3.COLUMN0ROW0]+ +a[w.Matrix3.COLUMN2ROW2]+0*t.x,s=+b(a[w.Matrix3.COLUMN2ROW1],a[w.Matrix3.COLUMN1ROW2],p.CesiumMath.EPSILON15),o=+(0*b(a[w.Matrix3.COLUMN2ROW0],a[w.Matrix3.COLUMN0ROW2])+t.z),u=[];if(0==o&&0==s){if(0===(e=R.computeRealRoots(r,n,i)).length)return u;var c=e[0],C=Math.sqrt(Math.max(1-c*c,0));return u.push(new v.Cartesian3(0,+c,-C)),u.push(new v.Cartesian3(0,+c,+C)),2===e.length&&(l=e[1],h=Math.sqrt(Math.max(1-l*l,0)),u.push(new v.Cartesian3(0,+l,-h)),u.push(new v.Cartesian3(0,+l,+h))),u}var l=r*r+(c=s*s),h=2*(n*r+(C=o*s)),c=2*i*r+n*n-c+(t=o*o),C=2*(i*n-C),t=i*i-t;if(0==l&&0==h&&0==c&&0==C)return u;var M=(e=S.computeRealRoots(l,h,c,C,t)).length;if(0===M)return u;for(var m=0;m<M;++m){var d=e[m],f=d*d,g=Math.max(1-f,0),g=Math.sqrt(g);(f=(f=p.CesiumMath.sign(r)===p.CesiumMath.sign(i)?b(r*f+i,n*d,p.CesiumMath.EPSILON12):p.CesiumMath.sign(i)===p.CesiumMath.sign(n*d)?b(r*f,n*d+i,p.CesiumMath.EPSILON12):b(r*f+n*d,i,p.CesiumMath.EPSILON12))*b(s*d,o,p.CesiumMath.EPSILON15))<0?u.push(new v.Cartesian3(0,+d,+g)):0<f?u.push(new v.Cartesian3(0,+d,-g)):0!==g?(u.push(new v.Cartesian3(0,+d,-g)),u.push(new v.Cartesian3(0,+d,+g)),++m):u.push(new v.Cartesian3(0,+d,+g))}return u}(a,v.Cartesian3.negate(s,N)),l=C.length;if(0<l){for(var h=v.Cartesian3.clone(v.Cartesian3.ZERO,D),M=Number.NEGATIVE_INFINITY,m=0;m<l;++m){c=w.Matrix3.multiplyByVector(u,w.Matrix3.multiplyByVector(o,C[m],A),A);var d=v.Cartesian3.normalize(v.Cartesian3.subtract(c,e,I),I);M<(d=v.Cartesian3.dot(d,r))&&(M=d,h=v.Cartesian3.clone(c,h))}return a=t.cartesianToCartographic(h,k),M=p.CesiumMath.clamp(M,0,1),s=v.Cartesian3.magnitude(v.Cartesian3.subtract(h,e,I))*Math.sqrt(1-M*M),s=i?-s:s,a.height=s,t.cartographicToCartesian(a,new v.Cartesian3)}};var F=new v.Cartesian3;C.lineSegmentPlane=function(a,t,e,r){f.defined(r)||(r=new v.Cartesian3);var n=v.Cartesian3.subtract(t,a,F),i=e.normal,t=v.Cartesian3.dot(i,n);if(!(Math.abs(t)<p.CesiumMath.EPSILON6||(i=v.Cartesian3.dot(i,a),(t=-(e.distance+i)/t)<0||1<t)))return v.Cartesian3.multiplyByScalar(n,t,r),v.Cartesian3.add(a,r,r),r},C.trianglePlaneIntersection=function(a,t,e,r){var n,i,s=r.normal,o=r.distance,u=v.Cartesian3.dot(s,a)+o<0,c=v.Cartesian3.dot(s,t)+o<0,s=v.Cartesian3.dot(s,e)+o<0,o=0;return o+=u?1:0,o+=c?1:0,1!=(o+=s?1:0)&&2!=o||(n=new v.Cartesian3,i=new v.Cartesian3),1==o?u?(C.lineSegmentPlane(a,t,r,n),C.lineSegmentPlane(a,e,r,i),{positions:[a,t,e,n,i],indices:[0,3,4,1,2,4,1,4,3]}):c?(C.lineSegmentPlane(t,e,r,n),C.lineSegmentPlane(t,a,r,i),{positions:[a,t,e,n,i],indices:[1,3,4,2,0,4,2,4,3]}):s?(C.lineSegmentPlane(e,a,r,n),C.lineSegmentPlane(e,t,r,i),{positions:[a,t,e,n,i],indices:[2,3,4,0,1,4,0,4,3]}):void 0:2==o?u?c?s?void 0:(C.lineSegmentPlane(a,e,r,n),C.lineSegmentPlane(t,e,r,i),{positions:[a,t,e,n,i],indices:[0,1,4,0,4,3,2,3,4]}):(C.lineSegmentPlane(e,t,r,n),C.lineSegmentPlane(a,t,r,i),{positions:[a,t,e,n,i],indices:[2,0,4,2,4,3,1,3,4]}):(C.lineSegmentPlane(t,a,r,n),C.lineSegmentPlane(e,a,r,i),{positions:[a,t,e,n,i],indices:[1,2,4,1,4,3,0,3,4]}):void 0},a.IntersectionTests=C,a.Ray=e});