define(["exports","./when-54c2dc71","./Check-6c0211bc","./Math-fc8cecf5","./Cartesian2-bddc1162","./Transforms-6f81ad4c","./ComponentDatatype-6d99a1ee","./GeometryAttribute-700c1da0","./AttributeCompression-9fc99391","./EncodedCartesian3-4df2eabb","./IndexDatatype-53503fee","./IntersectionTests-7f3bcd5c","./Plane-b6058d9b"],function(e,R,t,V,F,L,w,S,A,d,P,z,a){"use strict";var g=new F.Cartesian3,T=new F.Cartesian3,x=new F.Cartesian3,s={calculateACMR:function(e){var t=(e=R.defaultValue(e,R.defaultValue.EMPTY_OBJECT)).indices,r=e.maximumIndex,a=R.defaultValue(e.cacheSize,24),i=t.length;if(!R.defined(r))for(var n=r=0,s=t[n];n<i;)r<s&&(r=s),s=t[++n];for(var o=[],u=0;u<r+1;u++)o[u]=0;for(var p=a+1,d=0;d<i;++d)p-o[t[d]]>a&&(o[t[d]]=p,++p);return(p-a+1)/(i/3)}};s.tipsify=function(e){var t=(e=R.defaultValue(e,R.defaultValue.EMPTY_OBJECT)).indices,r=e.maximumIndex,a=R.defaultValue(e.cacheSize,24);var e=t.length,i=0,n=0,s=t[n],o=e;if(R.defined(r))i=r+1;else{for(;n<o;)i<s&&(i=s),s=t[++n];if(-1===i)return 0;++i}for(var u=[],p=0;p<i;p++)u[p]={numLiveTriangles:0,timeStamp:0,vertexTriangles:[]};for(var d=n=0;n<o;)u[t[n]].vertexTriangles.push(d),++u[t[n]].numLiveTriangles,u[t[n+1]].vertexTriangles.push(d),++u[t[n+1]].numLiveTriangles,u[t[n+2]].vertexTriangles.push(d),++u[t[n+2]].numLiveTriangles,++d,n+=3;for(var l,y,f,c=0,v=a+1,m=1,C=[],h=[],b=0,g=[],A=e/3,T=[],p=0;p<A;p++)T[p]=!1;for(;-1!==c;){C=[],f=(l=u[c]).vertexTriangles.length;for(var x=0;x<f;++x)if(!T[d=l.vertexTriangles[x]]){T[d]=!0,n=d+d+d;for(var P=0;P<3;++P)y=t[n],C.push(y),h.push(y),g[b]=y,++b,--(y=u[y]).numLiveTriangles,v-y.timeStamp>a&&(y.timeStamp=v,++v),++n}c=function(e,t,r,a,i,n){for(var s,o=-1,u=-1,p=0;p<t.length;){var d=t[p];r[d].numLiveTriangles&&(s=0,a-r[d].timeStamp+2*r[d].numLiveTriangles<=e&&(s=a-r[d].timeStamp),(u<s||-1===u)&&(u=s,o=d)),++p}return-1===o?function(e,t,r){for(;1<=t.length;){var a=t[t.length-1];if(t.splice(t.length-1,1),0<e[a].numLiveTriangles)return a}for(;m<r;){if(0<e[m].numLiveTriangles)return++m-1;++m}return-1}(r,i,n):o}(a,C,u,v,h,i)}return g};var r={};function o(e,t,r,a,i){e[t++]=r,e[t++]=a,e[t++]=a,e[t++]=i,e[t++]=i,e[t]=r}function c(e){var t,r,a={};for(t in e)e.hasOwnProperty(t)&&R.defined(e[t])&&R.defined(e[t].values)&&(r=e[t],a[t]=new S.GeometryAttribute({componentDatatype:r.componentDatatype,componentsPerAttribute:r.componentsPerAttribute,normalize:r.normalize,values:[]}));return a}r.toWireframe=function(e){var t=e.indices;if(R.defined(t)){switch(e.primitiveType){case S.PrimitiveType.TRIANGLES:e.indices=function(e){for(var t=e.length,r=t/3*6,a=P.IndexDatatype.createTypedArray(t,r),i=0,n=0;n<t;n+=3,i+=6)o(a,i,e[n],e[n+1],e[n+2]);return a}(t);break;case S.PrimitiveType.TRIANGLE_STRIP:e.indices=function(e){var t=e.length;if(3<=t){var r=6*(t-2),a=P.IndexDatatype.createTypedArray(t,r);o(a,0,e[0],e[1],e[2]);for(var i=6,n=3;n<t;++n,i+=6)o(a,i,e[n-1],e[n],e[n-2]);return a}return new Uint16Array}(t);break;case S.PrimitiveType.TRIANGLE_FAN:e.indices=function(e){if(0<e.length){for(var t=e.length-1,r=6*(t-1),a=P.IndexDatatype.createTypedArray(t,r),i=e[0],n=0,s=1;s<t;++s,n+=6)o(a,n,i,e[s],e[s+1]);return a}return new Uint16Array}(t)}e.primitiveType=S.PrimitiveType.LINES}return e},r.createLineSegmentsForVectors=function(e,t,r){t=R.defaultValue(t,"normal"),r=R.defaultValue(r,1e4);for(var a,i=e.attributes.position.values,n=e.attributes[t].values,s=i.length,o=new Float64Array(2*s),u=0,p=0;p<s;p+=3)o[u++]=i[p],o[u++]=i[p+1],o[u++]=i[p+2],o[u++]=i[p]+n[p]*r,o[u++]=i[p+1]+n[p+1]*r,o[u++]=i[p+2]+n[p+2]*r;return e=e.boundingSphere,R.defined(e)&&(a=new L.BoundingSphere(e.center,e.radius+r)),new S.Geometry({attributes:{position:new S.GeometryAttribute({componentDatatype:w.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:o})},primitiveType:S.PrimitiveType.LINES,boundingSphere:a})},r.createAttributeLocations=function(e){for(var t,r=["position","positionHigh","positionLow","position3DHigh","position3DLow","position2DHigh","position2DLow","pickColor","normal","st","tangent","bitangent","extrudeDirection","compressedAttributes"],a=e.attributes,i={},n=0,s=r.length,o=0;o<s;++o){var u=r[o];R.defined(a[u])&&(i[u]=n++)}for(t in a)a.hasOwnProperty(t)&&!R.defined(i[t])&&(i[t]=n++);return i},r.reorderForPreVertexCache=function(e){var t=S.Geometry.computeNumberOfVertices(e),r=e.indices;if(R.defined(r)){for(var a=new Int32Array(t),i=0;i<t;i++)a[i]=-1;for(var n,s=r,o=s.length,u=P.IndexDatatype.createTypedArray(t,o),p=0,d=0,l=0;p<o;)-1!==(n=a[s[p]])?u[d]=n:(a[n=s[p]]=l,u[d]=l,++l),++p,++d;e.indices=u;var y,f=e.attributes;for(y in f)if(f.hasOwnProperty(y)&&R.defined(f[y])&&R.defined(f[y].values)){for(var c=f[y],v=c.values,m=0,C=c.componentsPerAttribute,h=w.ComponentDatatype.createTypedArray(c.componentDatatype,l*C);m<t;){var b=a[m];if(-1!==b)for(var g=0;g<C;g++)h[C*b+g]=v[C*m+g];++m}c.values=h}}return e},r.reorderForPostVertexCache=function(e,t){var r=e.indices;if(e.primitiveType===S.PrimitiveType.TRIANGLES&&R.defined(r)){for(var a=r.length,i=0,n=0;n<a;n++)r[n]>i&&(i=r[n]);e.indices=s.tipsify({indices:r,maximumIndex:i,cacheSize:t})}return e},r.fitToUnsignedShortIndices=function(e){var t=[],r=S.Geometry.computeNumberOfVertices(e);if(R.defined(e.indices)&&r>=V.CesiumMath.SIXTY_FOUR_KILOBYTES){var a,i=[],n=[],s=0,o=c(e.attributes),u=e.indices,p=u.length;e.primitiveType===S.PrimitiveType.TRIANGLES?a=3:e.primitiveType===S.PrimitiveType.LINES?a=2:e.primitiveType===S.PrimitiveType.POINTS&&(a=1);for(var d=0;d<p;d+=a){for(var l=0;l<a;++l){var y=u[d+l],f=i[y];R.defined(f)||(f=s++,i[y]=f,function(e,t,r){for(var a in t)if(t.hasOwnProperty(a)&&R.defined(t[a])&&R.defined(t[a].values))for(var i=t[a],n=0;n<i.componentsPerAttribute;++n)e[a].values.push(i.values[r*i.componentsPerAttribute+n])}(o,e.attributes,y)),n.push(f)}s+a>=V.CesiumMath.SIXTY_FOUR_KILOBYTES&&(t.push(new S.Geometry({attributes:o,indices:n,primitiveType:e.primitiveType,boundingSphere:e.boundingSphere,boundingSphereCV:e.boundingSphereCV})),i=[],n=[],s=0,o=c(e.attributes))}0!==n.length&&t.push(new S.Geometry({attributes:o,indices:n,primitiveType:e.primitiveType,boundingSphere:e.boundingSphere,boundingSphereCV:e.boundingSphereCV}))}else t.push(e);return t};var y=new F.Cartesian3,f=new F.Cartographic;r.projectTo2D=function(e,t,r,a,i){for(var n=e.attributes[t],s=(i=R.defined(i)?i:new L.GeographicProjection).ellipsoid,o=n.values,u=new Float64Array(o.length),p=0,d=0;d<o.length;d+=3){var l=F.Cartesian3.fromArray(o,d,y),l=s.cartesianToCartographic(l,f),l=i.project(l,y);u[p++]=l.x,u[p++]=l.y,u[p++]=l.z}return e.attributes[r]=n,e.attributes[a]=new S.GeometryAttribute({componentDatatype:w.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:u}),delete e.attributes[t],e};var l={high:0,low:0};r.encodeAttribute=function(e,t,r,a){for(var i=e.attributes[t],n=i.values,s=n.length,o=new Float32Array(s),u=new Float32Array(s),p=0;p<s;++p)d.EncodedCartesian3.encode(n[p],l),o[p]=l.high,u[p]=l.low;return i=i.componentsPerAttribute,e.attributes[r]=new S.GeometryAttribute({componentDatatype:w.ComponentDatatype.FLOAT,componentsPerAttribute:i,values:o}),e.attributes[a]=new S.GeometryAttribute({componentDatatype:w.ComponentDatatype.FLOAT,componentsPerAttribute:i,values:u}),delete e.attributes[t],e};var n=new F.Cartesian3;function i(e,t){if(R.defined(t))for(var r=t.values,a=r.length,i=0;i<a;i+=3)F.Cartesian3.unpack(r,i,n),L.Matrix4.multiplyByPoint(e,n,n),F.Cartesian3.pack(n,r,i)}function u(e,t){if(R.defined(t))for(var r=t.values,a=r.length,i=0;i<a;i+=3)F.Cartesian3.unpack(r,i,n),L.Matrix3.multiplyByVector(e,n,n),n=F.Cartesian3.normalize(n,n),F.Cartesian3.pack(n,r,i)}var p=new L.Matrix4,v=new L.Matrix3;r.transformToWorldCoordinates=function(e){var t=e.modelMatrix;if(L.Matrix4.equals(t,L.Matrix4.IDENTITY))return e;var r=e.geometry.attributes;return i(t,r.position),i(t,r.prevPosition),i(t,r.nextPosition),(R.defined(r.normal)||R.defined(r.tangent)||R.defined(r.bitangent))&&(L.Matrix4.inverse(t,p),L.Matrix4.transpose(p,p),L.Matrix4.getMatrix3(p,v),u(v,r.normal),u(v,r.tangent),u(v,r.bitangent)),r=e.geometry.boundingSphere,R.defined(r)&&(e.geometry.boundingSphere=L.BoundingSphere.transform(r,t,r)),e.modelMatrix=L.Matrix4.clone(L.Matrix4.IDENTITY),e};var I=new F.Cartesian3;function m(e,t){var r,a,i,n,s,o=e.length,u=(e[0].modelMatrix,R.defined(e[0][t].indices)),p=e[0][t].primitiveType,d=function(e,t){var r,a=e.length,i={},n=e[0][t].attributes;for(r in n)if(n.hasOwnProperty(r)&&R.defined(n[r])&&R.defined(n[r].values)){for(var s=n[r],o=s.values.length,u=!0,p=1;p<a;++p){var d=e[p][t].attributes[r];if(!R.defined(d)||s.componentDatatype!==d.componentDatatype||s.componentsPerAttribute!==d.componentsPerAttribute||s.normalize!==d.normalize){u=!1;break}o+=d.values.length}u&&(i[r]=new S.GeometryAttribute({componentDatatype:s.componentDatatype,componentsPerAttribute:s.componentsPerAttribute,normalize:s.normalize,values:w.ComponentDatatype.createTypedArray(s.componentDatatype,o)}))}return i}(e,t);for(r in d)if(d.hasOwnProperty(r))for(i=d[r].values,y=b=0;y<o;++y)for(s=(n=e[y][t].attributes[r].values).length,a=0;a<s;++a)i[b++]=n[a];if(u){for(var l=0,y=0;y<o;++y)l+=e[y][t].indices.length;for(var f=S.Geometry.computeNumberOfVertices(new S.Geometry({attributes:d,primitiveType:S.PrimitiveType.POINTS})),c=P.IndexDatatype.createTypedArray(f,l),v=0,m=0,y=0;y<o;++y){for(var C=e[y][t].indices,h=C.length,b=0;b<h;++b)c[v++]=m+C[b];m+=S.Geometry.computeNumberOfVertices(e[y][t])}f=c}var g,A=new F.Cartesian3,T=0;for(y=0;y<o;++y){if(g=e[y][t].boundingSphere,!R.defined(g)){A=void 0;break}F.Cartesian3.add(g.center,A,A)}if(R.defined(A))for(F.Cartesian3.divideByScalar(A,o,A),y=0;y<o;++y){g=e[y][t].boundingSphere;var x=F.Cartesian3.magnitude(F.Cartesian3.subtract(g.center,A,I))+g.radius;T<x&&(T=x)}return new S.Geometry({attributes:d,indices:f,primitiveType:p,boundingSphere:R.defined(A)?new L.BoundingSphere(A,T):void 0})}r.combineInstances=function(e){for(var t=[],r=[],a=e.length,i=0;i<a;++i){var n=e[i];R.defined(n.geometry)?t.push(n):R.defined(n.westHemisphereGeometry)&&R.defined(n.eastHemisphereGeometry)&&r.push(n)}var s=[];return 0<t.length&&s.push(m(t,"geometry")),0<r.length&&(s.push(m(r,"westHemisphereGeometry")),s.push(m(r,"eastHemisphereGeometry"))),s};var O=new F.Cartesian3,E=new F.Cartesian3,N=new F.Cartesian3,D=new F.Cartesian3;r.computeNormal=function(e){for(var t=e.indices,r=e.attributes,a=r.position.values,i=r.position.values.length/3,n=t.length,s=new Array(i),o=new Array(n/3),u=new Array(n),p=0;p<i;p++)s[p]={indexOffset:0,count:0,currentCount:0};for(var d=0,p=0;p<n;p+=3){var l=t[p],y=t[p+1],f=t[p+2],c=3*l,v=3*y,m=3*f;E.x=a[c],E.y=a[1+c],E.z=a[2+c],N.x=a[v],N.y=a[1+v],N.z=a[2+v],D.x=a[m],D.y=a[1+m],D.z=a[2+m],s[l].count++,s[y].count++,s[f].count++,F.Cartesian3.subtract(N,E,N),F.Cartesian3.subtract(D,E,D),o[d]=F.Cartesian3.cross(N,D,new F.Cartesian3),d++}var C=0;for(p=0;p<i;p++)s[p].indexOffset+=C,C+=s[p].count;for(p=d=0;p<n;p+=3)u[(g=s[t[p]]).indexOffset+g.currentCount]=d,g.currentCount++,u[(g=s[t[p+1]]).indexOffset+g.currentCount]=d,g.currentCount++,u[(g=s[t[p+2]]).indexOffset+g.currentCount]=d,g.currentCount++,d++;var h=new Float32Array(3*i);for(p=0;p<i;p++){var b=3*p,g=s[p];if(F.Cartesian3.clone(F.Cartesian3.ZERO,O),0<g.count){for(d=0;d<g.count;d++)F.Cartesian3.add(O,o[u[g.indexOffset+d]],O);F.Cartesian3.equalsEpsilon(F.Cartesian3.ZERO,O,V.CesiumMath.EPSILON10)&&F.Cartesian3.clone(o[u[g.indexOffset]],O)}F.Cartesian3.equalsEpsilon(F.Cartesian3.ZERO,O,V.CesiumMath.EPSILON10)&&(O.z=1),F.Cartesian3.normalize(O,O),h[b]=O.x,h[1+b]=O.y,h[2+b]=O.z}return e.attributes.normal=new S.GeometryAttribute({componentDatatype:w.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:h}),e};var M=new F.Cartesian3,G=new F.Cartesian3,B=new F.Cartesian3;r.computeTangentAndBitangent=function(e){e.attributes;for(var t=e.indices,r=e.attributes.position.values,a=e.attributes.normal.values,i=e.attributes.st.values,n=e.attributes.position.values.length/3,s=t.length,o=new Array(3*n),u=0;u<o.length;u++)o[u]=0;for(u=0;u<s;u+=3){var p,d=t[u],l=3*(h=t[u+1]),y=3*(b=t[u+2]),f=2*d,c=2*h,v=2*b,m=r[p=3*d],C=r[p+1],h=r[p+2],b=i[f],d=i[1+f],f=i[1+c]-d,d=i[1+v]-d,b=1/((i[c]-b)*d-(i[v]-b)*f),m=(d*(r[l]-m)-f*(r[y]-m))*b,C=(d*(r[l+1]-C)-f*(r[y+1]-C))*b,b=(d*(r[l+2]-h)-f*(r[y+2]-h))*b;o[p]+=m,o[p+1]+=C,o[p+2]+=b,o[l]+=m,o[l+1]+=C,o[l+2]+=b,o[y]+=m,o[y+1]+=C,o[y+2]+=b}for(var g=new Float32Array(3*n),A=new Float32Array(3*n),u=0;u<n;u++){l=1+(p=3*u),y=p+2;var T=F.Cartesian3.fromArray(a,p,M),x=F.Cartesian3.fromArray(o,p,B),P=F.Cartesian3.dot(T,x);F.Cartesian3.multiplyByScalar(T,P,G),F.Cartesian3.normalize(F.Cartesian3.subtract(x,G,x),x),g[p]=x.x,g[l]=x.y,g[y]=x.z,F.Cartesian3.normalize(F.Cartesian3.cross(T,x,x),x),A[p]=x.x,A[l]=x.y,A[y]=x.z}return e.attributes.tangent=new S.GeometryAttribute({componentDatatype:w.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:g}),e.attributes.bitangent=new S.GeometryAttribute({componentDatatype:w.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:A}),e};var k=new F.Cartesian2,_=new F.Cartesian3,q=new F.Cartesian3,U=new F.Cartesian3,Y=new F.Cartesian2;function Z(e,t){Math.abs(e.y)<V.CesiumMath.EPSILON6&&(e.y=t?-V.CesiumMath.EPSILON6:V.CesiumMath.EPSILON6)}r.compressVertices=function(e){var t=e.attributes.extrudeDirection;if(R.defined(t)){for(var r=t.values,a=r.length/3,i=new Float32Array(2*a),n=0,s=0;s<a;++s)F.Cartesian3.fromArray(r,3*s,_),F.Cartesian3.equals(_,F.Cartesian3.ZERO)?n+=2:(Y=A.AttributeCompression.octEncodeInRange(_,65535,Y),i[n++]=Y.x,i[n++]=Y.y);return e.attributes.compressedAttributes=new S.GeometryAttribute({componentDatatype:w.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:i}),delete e.attributes.extrudeDirection,e}var o=e.attributes.normal,u=e.attributes.st,p=R.defined(o),d=R.defined(u);if(!p&&!d)return e;var l,y,f,c,v=e.attributes.tangent,t=e.attributes.bitangent,m=R.defined(v),C=R.defined(t);p&&(l=o.values),d&&(y=u.values),m&&(f=v.values),C&&(c=t.values),v=a=(p?l:y).length/(p?3:2),t=d&&p?2:1,v*=t+=m||C?1:0;for(var h=new Float32Array(v),b=0,s=0;s<a;++s){d&&(F.Cartesian2.fromArray(y,2*s,k),h[b++]=A.AttributeCompression.compressTextureCoordinates(k));var g=3*s;p&&R.defined(f)&&R.defined(c)?(F.Cartesian3.fromArray(l,g,_),F.Cartesian3.fromArray(f,g,q),F.Cartesian3.fromArray(c,g,U),A.AttributeCompression.octPack(_,q,U,k),h[b++]=k.x,h[b++]=k.y):(p&&(F.Cartesian3.fromArray(l,g,_),h[b++]=A.AttributeCompression.octEncodeFloat(_)),m&&(F.Cartesian3.fromArray(f,g,_),h[b++]=A.AttributeCompression.octEncodeFloat(_)),C&&(F.Cartesian3.fromArray(c,g,_),h[b++]=A.AttributeCompression.octEncodeFloat(_)))}return e.attributes.compressedAttributes=new S.GeometryAttribute({componentDatatype:w.ComponentDatatype.FLOAT,componentsPerAttribute:t,values:h}),p&&delete e.attributes.normal,d&&delete e.attributes.st,C&&delete e.attributes.bitangent,m&&delete e.attributes.tangent,e};var C=new F.Cartesian3;function H(e,t,r,a){F.Cartesian3.add(e,F.Cartesian3.multiplyByScalar(F.Cartesian3.subtract(t,e,C),e.y/(e.y-t.y),C),r),F.Cartesian3.clone(r,a),Z(r,!0),Z(a,!1)}var W=new F.Cartesian3,X=new F.Cartesian3,j=new F.Cartesian3,J=new F.Cartesian3,K={positions:new Array(7),indices:new Array(9)};function h(e,t){var r,a=e.attributes;if(0!==a.position.values.length){for(var i in a)a.hasOwnProperty(i)&&R.defined(a[i])&&R.defined(a[i].values)&&((r=a[i]).values=w.ComponentDatatype.createTypedArray(r.componentDatatype,r.values));var n=S.Geometry.computeNumberOfVertices(e);return e.indices=P.IndexDatatype.createTypedArray(n,e.indices),t&&(e.boundingSphere=L.BoundingSphere.fromVertices(a.position.values)),e}}function Q(e){var t,r,a=e.attributes,i={};for(t in a)a.hasOwnProperty(t)&&R.defined(a[t])&&R.defined(a[t].values)&&(r=a[t],i[t]=new S.GeometryAttribute({componentDatatype:r.componentDatatype,componentsPerAttribute:r.componentsPerAttribute,normalize:r.normalize,values:[]}));return new S.Geometry({attributes:i,indices:[],primitiveType:e.primitiveType})}function $(e,t,r){var a=R.defined(e.geometry.boundingSphere);t=h(t,a),r=h(r,a),R.defined(r)&&!R.defined(t)?e.geometry=r:!R.defined(r)&&R.defined(t)?e.geometry=t:(e.westHemisphereGeometry=t,e.eastHemisphereGeometry=r,e.geometry=void 0)}function b(u,p){var d=new u,l=new u,y=new u;return function(e,t,r,a,i,n,s,o){e=u.fromArray(i,e*p,d),t=u.fromArray(i,t*p,l),r=u.fromArray(i,r*p,y),u.multiplyByScalar(e,a.x,e),u.multiplyByScalar(t,a.y,t),u.multiplyByScalar(r,a.z,r),e=u.add(e,t,e),u.add(e,r,e),o&&u.normalize(e,e),u.pack(e,n,s*p)}}var ee=b(L.Cartesian4,4),te=b(F.Cartesian3,3),re=b(F.Cartesian2,2),ae=function(e,t,r,a,i,n,s){e=i[e]*a.x,t=i[t]*a.y,a=i[r]*a.z,n[s]=e+t+a>V.CesiumMath.EPSILON6?1:0},ie=new F.Cartesian3,ne=new F.Cartesian3,se=new F.Cartesian3,oe=new F.Cartesian3;function ue(e,t,r,a,i,n,s,o,u,p,d,l,y,f,c,v){if(R.defined(n)||R.defined(s)||R.defined(o)||R.defined(u)||R.defined(p)||0!==f){var m,C=function(e,t,r,a,i){var n,s,o,u,p,d,l;if(R.defined(i)||(i=new F.Cartesian3),R.defined(t.z)){if(F.Cartesian3.equalsEpsilon(e,t,V.CesiumMath.EPSILON14))return F.Cartesian3.clone(F.Cartesian3.UNIT_X,i);if(F.Cartesian3.equalsEpsilon(e,r,V.CesiumMath.EPSILON14))return F.Cartesian3.clone(F.Cartesian3.UNIT_Y,i);if(F.Cartesian3.equalsEpsilon(e,a,V.CesiumMath.EPSILON14))return F.Cartesian3.clone(F.Cartesian3.UNIT_Z,i);n=F.Cartesian3.subtract(r,t,g),s=F.Cartesian3.subtract(a,t,T),o=F.Cartesian3.subtract(e,t,x),u=F.Cartesian3.dot(n,n),y=F.Cartesian3.dot(n,s),p=F.Cartesian3.dot(n,o),d=F.Cartesian3.dot(s,s),l=F.Cartesian3.dot(s,o)}else{if(F.Cartesian2.equalsEpsilon(e,t,V.CesiumMath.EPSILON14))return F.Cartesian3.clone(F.Cartesian3.UNIT_X,i);if(F.Cartesian2.equalsEpsilon(e,r,V.CesiumMath.EPSILON14))return F.Cartesian3.clone(F.Cartesian3.UNIT_Y,i);if(F.Cartesian2.equalsEpsilon(e,a,V.CesiumMath.EPSILON14))return F.Cartesian3.clone(F.Cartesian3.UNIT_Z,i);n=F.Cartesian2.subtract(r,t,g),s=F.Cartesian2.subtract(a,t,T),o=F.Cartesian2.subtract(e,t,x),u=F.Cartesian2.dot(n,n),y=F.Cartesian2.dot(n,s),p=F.Cartesian2.dot(n,o),d=F.Cartesian2.dot(s,s),l=F.Cartesian2.dot(s,o)}i.y=d*p-y*l,i.z=u*l-y*p;var y=u*d-y*y;return 0!==i.y&&(i.y/=y),0!==i.z&&(i.z/=y),i.x=1-i.y-i.z,i}(a,F.Cartesian3.fromArray(i,3*e,ie),F.Cartesian3.fromArray(i,3*t,ne),F.Cartesian3.fromArray(i,3*r,se),oe);if(R.defined(n)&&te(e,t,r,C,n,l.normal.values,v,!0),R.defined(p)&&(i=F.Cartesian3.fromArray(p,3*e,ie),n=F.Cartesian3.fromArray(p,3*t,ne),p=F.Cartesian3.fromArray(p,3*r,se),F.Cartesian3.multiplyByScalar(i,C.x,i),F.Cartesian3.multiplyByScalar(n,C.y,n),F.Cartesian3.multiplyByScalar(p,C.z,p),F.Cartesian3.equals(i,F.Cartesian3.ZERO)&&F.Cartesian3.equals(n,F.Cartesian3.ZERO)&&F.Cartesian3.equals(p,F.Cartesian3.ZERO)?((m=ie).x=0,m.y=0,m.z=0):(m=F.Cartesian3.add(i,n,i),F.Cartesian3.add(m,p,m),F.Cartesian3.normalize(m,m)),F.Cartesian3.pack(m,l.extrudeDirection.values,3*v)),R.defined(d)&&ae(e,t,r,C,d,l.applyOffset.values,v),R.defined(s)&&te(e,t,r,C,s,l.tangent.values,v,!0),R.defined(o)&&te(e,t,r,C,o,l.bitangent.values,v,!0),R.defined(u)&&re(e,t,r,C,u,l.st.values,v),0<f)for(var h=0;h<f;h++){var b=y[h];!function(e,t,r,a,i,n,s){var o=n.componentsPerAttribute,n=n.values,s=s.values;switch(o){case 4:ee(e,t,r,a,n,s,i,!1);break;case 3:te(e,t,r,a,n,s,i,!1);break;case 2:re(e,t,r,a,n,s,i,!1);break;default:s[i]=n[e]*a.x+n[t]*a.y+n[r]*a.z}}(e,t,r,C,v,c[b],l[b])}}}function pe(e,t,r,a,i,n){var s=e.position.values.length/3;return-1===i?(e.position.values.push(n.x,n.y,n.z),t.push(s),s):-1===(i=r[a=a[i]])?(r[a]=s,e.position.values.push(n.x,n.y,n.z),t.push(s),s):(t.push(i),i)}var de={position:!0,normal:!0,bitangent:!0,tangent:!0,st:!0,extrudeDirection:!0,applyOffset:!0};function le(e){var t,r=e.geometry,a=r.attributes,i=a.position.values,n=R.defined(a.normal)?a.normal.values:void 0,s=R.defined(a.bitangent)?a.bitangent.values:void 0,o=R.defined(a.tangent)?a.tangent.values:void 0,u=R.defined(a.st)?a.st.values:void 0,p=R.defined(a.extrudeDirection)?a.extrudeDirection.values:void 0,d=R.defined(a.applyOffset)?a.applyOffset.values:void 0,l=r.indices,y=[];for(t in a)a.hasOwnProperty(t)&&!de[t]&&R.defined(a[t])&&y.push(t);var f,c,v=y.length,m=Q(r),C=Q(r),h=[];h.length=i.length/3;var b=[];for(b.length=i.length/3,A=0;A<h.length;++A)h[A]=-1,b[A]=-1;for(var g=l.length,A=0;A<g;A+=3){var T=l[A],x=l[A+1],P=l[A+2],w=F.Cartesian3.fromArray(i,3*T),S=F.Cartesian3.fromArray(i,3*x),I=F.Cartesian3.fromArray(i,3*P),O=function(e,t,r){if(!(0<=e.x||0<=t.x||0<=r.x)){!function(e,t,r){if(0!==e.y&&0!==t.y&&0!==r.y)return Z(e,e.y<0),Z(t,t.y<0),Z(r,r.y<0);var a=Math.abs(e.y),i=Math.abs(t.y),n=Math.abs(r.y);Z(e,i=(i=i<a?n<a?V.CesiumMath.sign(e.y):V.CesiumMath.sign(r.y):n<i?V.CesiumMath.sign(t.y):V.CesiumMath.sign(r.y))<0),Z(t,i),Z(r,i)}(e,t,r);var a=e.y<0,i=t.y<0,n=r.y<0,s=0;s+=a?1:0,s+=i?1:0,s+=n?1:0;var o=K.indices;return 1==s?(o[1]=3,o[2]=4,o[5]=6,o[7]=6,o[8]=5,a?(H(e,t,W,j),H(e,r,X,J),o[0]=0,o[3]=1,o[4]=2,o[6]=1):i?(H(t,r,W,j),H(t,e,X,J),o[0]=1,o[3]=2,o[4]=0,o[6]=2):n&&(H(r,e,W,j),H(r,t,X,J),o[0]=2,o[3]=0,o[4]=1,o[6]=0)):2==s&&(o[2]=4,o[4]=4,o[5]=3,o[7]=5,o[8]=6,a?i?n||(H(r,e,W,j),H(r,t,X,J),o[0]=0,o[1]=1,o[3]=0,o[6]=2):(H(t,r,W,j),H(t,e,X,J),o[0]=2,o[1]=0,o[3]=2,o[6]=1):(H(e,t,W,j),H(e,r,X,J),o[0]=1,o[1]=2,o[3]=1,o[6]=0)),(o=K.positions)[0]=e,o[1]=t,o[2]=r,o.length=3,1!=s&&2!=s||(o[3]=W,o[4]=X,o[5]=j,o[6]=J,o.length=7),K}}(w,S,I);if(R.defined(O)&&3<O.positions.length)for(var E=O.positions,N=O.indices,L=N.length,z=0;z<L;++z){var D=N[z],M=E[D],G=M.y<0?(f=C.attributes,c=C.indices,h):(f=m.attributes,c=m.indices,b);ue(T,x,P,M,i,n,o,s,u,p,d,f,y,v,a,pe(f,c,G,l,D<3?A+D:-1,M))}else R.defined(O)&&(w=O.positions[0],S=O.positions[1],I=O.positions[2]),G=w.y<0?(f=C.attributes,c=C.indices,h):(f=m.attributes,c=m.indices,b),ue(T,x,P,w,i,n,o,s,u,p,d,f,y,v,a,pe(f,c,G,l,A,w)),ue(T,x,P,S,i,n,o,s,u,p,d,f,y,v,a,pe(f,c,G,l,A+1,S)),ue(T,x,P,I,i,n,o,s,u,p,d,f,y,v,a,pe(f,c,G,l,A+2,I))}$(e,C,m)}var ye=a.Plane.fromPointNormal(F.Cartesian3.ZERO,F.Cartesian3.UNIT_Y),fe=new F.Cartesian3,ce=new F.Cartesian3;function ve(e,t,r,a,i,n,s){R.defined(s)&&(a=F.Cartesian3.fromArray(a,3*e,ie),F.Cartesian3.equalsEpsilon(a,r,V.CesiumMath.EPSILON10)?n.applyOffset.values[i]=s[e]:n.applyOffset.values[i]=s[t])}function me(e){var t,r=e.geometry,a=r.attributes,i=a.position.values,n=R.defined(a.applyOffset)?a.applyOffset.values:void 0,s=r.indices,o=Q(r),u=Q(r),p=s.length,d=[];d.length=i.length/3;var l=[];for(l.length=i.length/3,t=0;t<d.length;++t)d[t]=-1,l[t]=-1;for(t=0;t<p;t+=2){var y=s[t],f=s[t+1],c=F.Cartesian3.fromArray(i,3*y,ie),v=F.Cartesian3.fromArray(i,3*f,ne);Math.abs(c.y)<V.CesiumMath.EPSILON6&&(c.y<0?c.y=-V.CesiumMath.EPSILON6:c.y=V.CesiumMath.EPSILON6),Math.abs(v.y)<V.CesiumMath.EPSILON6&&(v.y<0?v.y=-V.CesiumMath.EPSILON6:v.y=V.CesiumMath.EPSILON6);var m,C,h,b,g=o.attributes,A=o.indices,T=l,x=u.attributes,P=u.indices,w=d,S=z.IntersectionTests.lineSegmentPlane(c,v,ye,se);R.defined(S)?(m=F.Cartesian3.multiplyByScalar(F.Cartesian3.UNIT_Y,5*V.CesiumMath.EPSILON9,fe),c.y<0&&(F.Cartesian3.negate(m,m),g=u.attributes,A=u.indices,T=d,x=o.attributes,P=o.indices,w=l),C=F.Cartesian3.add(S,m,ce),ve(y,f,c,i,pe(g,A,T,s,t,c),g,n),ve(y,f,C,i,pe(g,A,T,s,-1,C),g,n),F.Cartesian3.negate(m,m),F.Cartesian3.add(S,m,C),ve(y,f,C,i,pe(x,P,w,s,-1,C),x,n),ve(y,f,v,i,pe(x,P,w,s,t+1,v),x,n)):(x=c.y<0?(h=u.attributes,b=u.indices,d):(h=o.attributes,b=o.indices,l),ve(y,f,c,i,pe(h,b,x,s,t,c),h,n),ve(y,f,v,i,pe(h,b,x,s,t+1,v),h,n))}$(e,u,o)}var Ce=new F.Cartesian2,he=new F.Cartesian2,be=new F.Cartesian3,ge=new F.Cartesian3,Ae=new F.Cartesian3,Te=new F.Cartesian3,xe=new F.Cartesian3,Pe=new F.Cartesian3,we=new L.Cartesian4;function Se(e){for(var t=(e=e.attributes).position.values,r=e.prevPosition.values,a=e.nextPosition.values,i=t.length,n=0;n<i;n+=3){var s,o=F.Cartesian3.unpack(t,n,be);0<o.x||(s=F.Cartesian3.unpack(r,n,ge),(o.y<0&&0<s.y||0<o.y&&s.y<0)&&(0<n-3?(r[n]=t[n-3],r[n+1]=t[n-2],r[n+2]=t[n-1]):F.Cartesian3.pack(o,r,n)),s=F.Cartesian3.unpack(a,n,Ae),(o.y<0&&0<s.y||0<o.y&&s.y<0)&&(n+3<i?(a[n]=t[n+3],a[n+1]=t[n+4],a[n+2]=t[n+5]):F.Cartesian3.pack(o,a,n)))}}var Ie=5*V.CesiumMath.EPSILON9,Oe=V.CesiumMath.EPSILON6;r.splitLongitude=function(e){var t=e.geometry,r=t.boundingSphere;if(R.defined(r)&&(0<r.center.x-r.radius||L.BoundingSphere.intersectPlane(r,a.Plane.ORIGIN_ZX_PLANE)!==L.Intersect.INTERSECTING))return e;if(t.geometryType!==S.GeometryType.NONE)switch(t.geometryType){case S.GeometryType.POLYLINES:!function(e){for(var t=e.geometry,r=t.attributes,a=r.position.values,i=r.prevPosition.values,n=r.nextPosition.values,s=r.expandAndWidth.values,o=R.defined(r.st)?r.st.values:void 0,u=R.defined(r.color)?r.color.values:void 0,p=Q(t),d=Q(t),l=!1,y=a.length/3,f=0;f<y;f+=4){var c=f,v=f+2,m=F.Cartesian3.fromArray(a,3*c,be),C=F.Cartesian3.fromArray(a,3*v,ge);if(Math.abs(m.y)<Oe)for(m.y=Oe*(C.y<0?-1:1),a[3*f+1]=m.y,a[3*(f+1)+1]=m.y,O=3*c;O<3*c+12;O+=3)i[O]=a[3*f],i[O+1]=a[3*f+1],i[O+2]=a[3*f+2];if(Math.abs(C.y)<Oe)for(C.y=Oe*(m.y<0?-1:1),a[3*(f+2)+1]=C.y,a[3*(f+3)+1]=C.y,O=3*c;O<3*c+12;O+=3)n[O]=a[3*(f+2)],n[O+1]=a[3*(f+2)+1],n[O+2]=a[3*(f+2)+2];var h=p.attributes,b=p.indices,g=d.attributes,A=d.indices,T=z.IntersectionTests.lineSegmentPlane(m,C,ye,Te);if(R.defined(T)){l=!0;var x=F.Cartesian3.multiplyByScalar(F.Cartesian3.UNIT_Y,Ie,xe);m.y<0&&(F.Cartesian3.negate(x,x),h=d.attributes,b=d.indices,g=p.attributes,A=p.indices);var P=F.Cartesian3.add(T,x,Pe);h.position.values.push(m.x,m.y,m.z,m.x,m.y,m.z),h.position.values.push(P.x,P.y,P.z),h.position.values.push(P.x,P.y,P.z),h.prevPosition.values.push(i[3*c],i[3*c+1],i[3*c+2]),h.prevPosition.values.push(i[3*c+3],i[3*c+4],i[3*c+5]),h.prevPosition.values.push(m.x,m.y,m.z,m.x,m.y,m.z),h.nextPosition.values.push(P.x,P.y,P.z),h.nextPosition.values.push(P.x,P.y,P.z),h.nextPosition.values.push(P.x,P.y,P.z),h.nextPosition.values.push(P.x,P.y,P.z),F.Cartesian3.negate(x,x),F.Cartesian3.add(T,x,P),g.position.values.push(P.x,P.y,P.z),g.position.values.push(P.x,P.y,P.z),g.position.values.push(C.x,C.y,C.z,C.x,C.y,C.z),g.prevPosition.values.push(P.x,P.y,P.z),g.prevPosition.values.push(P.x,P.y,P.z),g.prevPosition.values.push(P.x,P.y,P.z),g.prevPosition.values.push(P.x,P.y,P.z),g.nextPosition.values.push(C.x,C.y,C.z,C.x,C.y,C.z),g.nextPosition.values.push(n[3*v],n[3*v+1],n[3*v+2]),g.nextPosition.values.push(n[3*v+3],n[3*v+4],n[3*v+5]);var w=F.Cartesian2.fromArray(s,2*c,Ce),S=Math.abs(w.y);if(h.expandAndWidth.values.push(-1,S,1,S),h.expandAndWidth.values.push(-1,-S,1,-S),g.expandAndWidth.values.push(-1,S,1,S),g.expandAndWidth.values.push(-1,-S,1,-S),x=F.Cartesian3.magnitudeSquared(F.Cartesian3.subtract(T,m,Ae)),x/=F.Cartesian3.magnitudeSquared(F.Cartesian3.subtract(C,m,Ae)),R.defined(u)){for(var P=L.Cartesian4.fromArray(u,4*c,we),I=L.Cartesian4.fromArray(u,4*v,we),w=V.CesiumMath.lerp(P.x,I.x,x),S=V.CesiumMath.lerp(P.y,I.y,x),T=V.CesiumMath.lerp(P.z,I.z,x),I=V.CesiumMath.lerp(P.w,I.w,x),O=4*c;O<4*c+8;++O)h.color.values.push(u[O]);for(h.color.values.push(w,S,T,I),h.color.values.push(w,S,T,I),g.color.values.push(w,S,T,I),g.color.values.push(w,S,T,I),O=4*v;O<4*v+8;++O)g.color.values.push(u[O])}if(R.defined(o)){for(var I=F.Cartesian2.fromArray(o,2*c,Ce),E=F.Cartesian2.fromArray(o,2*(f+3),he),x=V.CesiumMath.lerp(I.x,E.x,x),O=2*c;O<2*c+4;++O)h.st.values.push(o[O]);for(h.st.values.push(x,I.y),h.st.values.push(x,E.y),g.st.values.push(x,I.y),g.st.values.push(x,E.y),O=2*v;O<2*v+4;++O)g.st.values.push(o[O])}E=h.position.values.length/3-4,b.push(E,E+2,E+1),b.push(E+1,E+2,E+3),E=g.position.values.length/3-4,A.push(E,E+2,E+1),A.push(E+1,E+2,E+3)}else{var N,A=m.y<0?(N=d.attributes,d.indices):(N=p.attributes,p.indices);for(N.position.values.push(m.x,m.y,m.z),N.position.values.push(m.x,m.y,m.z),N.position.values.push(C.x,C.y,C.z),N.position.values.push(C.x,C.y,C.z),O=3*f;O<3*f+12;++O)N.prevPosition.values.push(i[O]),N.nextPosition.values.push(n[O]);for(O=2*f;O<2*f+8;++O)N.expandAndWidth.values.push(s[O]),R.defined(o)&&N.st.values.push(o[O]);if(R.defined(u))for(O=4*f;O<4*f+16;++O)N.color.values.push(u[O]);E=N.position.values.length/3-4,A.push(E,E+2,E+1),A.push(E+1,E+2,E+3)}}l&&(Se(d),Se(p)),$(e,d,p)}(e);break;case S.GeometryType.TRIANGLES:le(e);break;case S.GeometryType.LINES:me(e)}else(function(e){switch(e.primitiveType){case S.PrimitiveType.TRIANGLE_FAN:return function(e){var t=S.Geometry.computeNumberOfVertices(e),r=P.IndexDatatype.createTypedArray(t,3*(t-2));r[0]=1,r[1]=0,r[2]=2;for(var a=3,i=3;i<t;++i)r[a++]=i-1,r[a++]=0,r[a++]=i;e.indices=r,e.primitiveType=S.PrimitiveType.TRIANGLES}(e);case S.PrimitiveType.TRIANGLE_STRIP:return function(e){var t=S.Geometry.computeNumberOfVertices(e),r=P.IndexDatatype.createTypedArray(t,3*(t-2));r[0]=0,r[1]=1,r[2]=2,3<t&&(r[3]=0,r[4]=2,r[5]=3);for(var a=6,i=3;i<t-1;i+=2)r[a++]=i,r[a++]=i-1,r[a++]=i+1,i+2<t&&(r[a++]=i,r[a++]=i+1,r[a++]=i+2);e.indices=r,e.primitiveType=S.PrimitiveType.TRIANGLES}(e);case S.PrimitiveType.TRIANGLES:return function(e){if(R.defined(e.indices))return;for(var t=S.Geometry.computeNumberOfVertices(e),r=P.IndexDatatype.createTypedArray(t,t),a=0;a<t;++a)r[a]=a;e.indices=r}(e);case S.PrimitiveType.LINE_STRIP:return function(e){var t=S.Geometry.computeNumberOfVertices(e),r=P.IndexDatatype.createTypedArray(t,2*(t-1));r[0]=0,r[1]=1;for(var a=2,i=2;i<t;++i)r[a++]=i-1,r[a++]=i;e.indices=r,e.primitiveType=S.PrimitiveType.LINES}(e);case S.PrimitiveType.LINE_LOOP:return function(e){var t=S.Geometry.computeNumberOfVertices(e),r=P.IndexDatatype.createTypedArray(t,2*t);r[0]=0,r[1]=1;for(var a=2,i=2;i<t;++i)r[a++]=i-1,r[a++]=i;r[a++]=t-1,r[a]=0,e.indices=r,e.primitiveType=S.PrimitiveType.LINES}(e);case S.PrimitiveType.LINES:return function(e){if(R.defined(e.indices))return;for(var t=S.Geometry.computeNumberOfVertices(e),r=P.IndexDatatype.createTypedArray(t,t),a=0;a<t;++a)r[a]=a;e.indices=r}(e)}})(t),t.primitiveType===S.PrimitiveType.TRIANGLES?le(e):t.primitiveType===S.PrimitiveType.LINES&&me(e);return e},e.GeometryPipeline=r});