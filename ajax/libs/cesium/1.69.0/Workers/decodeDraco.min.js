define(["./when-b43ff45e","./Check-d404a0fe","./Math-336da716","./RuntimeError-bf10f3d5","./WebGLConstants-56de22c0","./ComponentDatatype-8956ad9a","./IndexDatatype-c5295474","./createTaskProcessorWorker"],function(d,e,t,f,r,c,y,n){"use strict";var A;function m(e,t,r){var u,n=e.num_points(),o=r.num_components(),a=new A.AttributeQuantizationTransform;if(a.InitFromAttribute(r)){for(var i=new Array(o),s=0;s<o;++s)i[s]=a.min_value(s);u={quantizationBits:a.quantization_bits(),minValues:i,range:a.range(),octEncoded:!1}}A.destroy(a),(a=new A.AttributeOctahedronTransform).InitFromAttribute(r)&&(u={quantizationBits:a.quantization_bits(),octEncoded:!0}),A.destroy(a);n*=o,t=(d.defined(u)?function(e,t,r,n){var o,a;u.quantizationBits<=8?(a=new A.DracoUInt8Array,o=new Uint8Array(n),t.GetAttributeUInt8ForAllPoints(e,r,a)):(a=new A.DracoUInt16Array,o=new Uint16Array(n),t.GetAttributeUInt16ForAllPoints(e,r,a));for(var i=0;i<n;++i)o[i]=a.GetValue(i);return A.destroy(a),o}:function(e,t,r,n){var o,a;switch(r.data_type()){case 1:case 11:a=new A.DracoInt8Array,o=new Int8Array(n),t.GetAttributeInt8ForAllPoints(e,r,a);break;case 2:a=new A.DracoUInt8Array,o=new Uint8Array(n),t.GetAttributeUInt8ForAllPoints(e,r,a);break;case 3:a=new A.DracoInt16Array,o=new Int16Array(n),t.GetAttributeInt16ForAllPoints(e,r,a);break;case 4:a=new A.DracoUInt16Array,o=new Uint16Array(n),t.GetAttributeUInt16ForAllPoints(e,r,a);break;case 5:case 7:a=new A.DracoInt32Array,o=new Int32Array(n),t.GetAttributeInt32ForAllPoints(e,r,a);break;case 6:case 8:a=new A.DracoUInt32Array,o=new Uint32Array(n),t.GetAttributeUInt32ForAllPoints(e,r,a);break;case 9:case 10:a=new A.DracoFloat32Array,o=new Float32Array(n),t.GetAttributeFloatForAllPoints(e,r,a)}for(var i=0;i<n;++i)o[i]=a.GetValue(i);return A.destroy(a),o})(e,t,r,n),n=c.ComponentDatatype.fromTypedArray(t);return{array:t,data:{componentsPerAttribute:o,componentDatatype:n,byteOffset:r.byte_offset(),byteStride:c.ComponentDatatype.getSizeInBytes(n)*o,normalized:r.normalized(),quantization:u}}}function o(e){return(d.defined(e.primitive)?function(e){var t=new A.Decoder,r=["POSITION","NORMAL","COLOR","TEX_COORD"];if(e.dequantizeInShader)for(var n=0;n<r.length;++n)t.SkipAttributeTransform(A[r[n]]);var o=e.bufferView,a=new A.DecoderBuffer;if(a.Init(e.array,o.byteLength),t.GetEncodedGeometryType(a)!==A.TRIANGULAR_MESH)throw new f.RuntimeError("Unsupported draco mesh geometry type.");var i=new A.Mesh;if(!(o=t.DecodeBufferToMesh(a,i)).ok()||0===i.ptr)throw new f.RuntimeError("Error decoding draco mesh geometry: "+o.error_msg());A.destroy(a);var u,s,d={},c=e.compressedAttributes;for(u in c)c.hasOwnProperty(u)&&(s=c[u],s=t.GetAttributeByUniqueId(i,s),d[u]=m(i,t,s));return e={indexArray:function(e,t){for(var r=e.num_points(),n=e.num_faces(),o=new A.DracoInt32Array,a=3*n,i=y.IndexDatatype.createTypedArray(r,a),u=0,s=0;s<n;++s)t.GetFaceFromMesh(e,s,o),i[u+0]=o.GetValue(0),i[u+1]=o.GetValue(1),i[u+2]=o.GetValue(2),u+=3;return A.destroy(o),{typedArray:i,numberOfIndices:a}}(i,t),attributeData:d},A.destroy(i),A.destroy(t),e}:function(e){var t=new A.Decoder;e.dequantizeInShader&&(t.SkipAttributeTransform(A.POSITION),t.SkipAttributeTransform(A.NORMAL));var r=new A.DecoderBuffer;if(r.Init(e.buffer,e.buffer.length),t.GetEncodedGeometryType(r)!==A.POINT_CLOUD)throw new f.RuntimeError("Draco geometry type must be POINT_CLOUD.");var n=new A.PointCloud,o=t.DecodeBufferToPointCloud(r,n);if(!o.ok()||0===n.ptr)throw new f.RuntimeError("Error decoding draco point cloud: "+o.error_msg());A.destroy(r);var a,i,u={},s=e.properties;for(a in s)s.hasOwnProperty(a)&&(i=s[a],i=t.GetAttributeByUniqueId(n,i),u[a]=m(n,t,i));return A.destroy(n),A.destroy(t),u})(e)}function a(e){A=e,self.onmessage=n(o),self.postMessage(!0)}return function(e){var t=e.data.webAssemblyConfig;if(d.defined(t))return require([t.modulePath],function(e){d.defined(t.wasmBinaryFile)?(d.defined(e)||(e=self.DracoDecoderModule),e(t).then(function(e){a(e)})):a(e())})}});