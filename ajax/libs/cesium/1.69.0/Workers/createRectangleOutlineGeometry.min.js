define(["./when-b43ff45e","./Check-d404a0fe","./Math-336da716","./Cartesian2-3c21ddb9","./Transforms-ffcbad88","./RuntimeError-bf10f3d5","./WebGLConstants-56de22c0","./ComponentDatatype-8956ad9a","./GeometryAttribute-c9800e88","./GeometryAttributes-fbf888b4","./IndexDatatype-c5295474","./GeometryOffsetAttribute-9f7392ac","./EllipsoidRhumbLine-6daaa4d2","./PolygonPipeline-b2950861","./RectangleGeometryLibrary-a5bc12cb"],function(s,e,d,p,f,t,i,m,_,v,E,g,a,h,A){"use strict";var y=new f.BoundingSphere,b=new f.BoundingSphere,G=new p.Cartesian3,R=new p.Rectangle;function P(e,t){var i=e._ellipsoid,a=t.height,r=t.width,n=t.northCap,o=t.southCap,l=a,u=2,s=0,e=4;n&&(--u,--l,s+=1,e-=2),o&&(--u,--l,s+=1,e-=2),s+=u*r+2*l-e;var d,p=new Float64Array(3*s),c=0,f=0,g=G;if(n)A.RectangleGeometryLibrary.computePosition(t,i,!1,f,0,g),p[c++]=g.x,p[c++]=g.y,p[c++]=g.z;else for(d=0;d<r;d++)A.RectangleGeometryLibrary.computePosition(t,i,!1,f,d,g),p[c++]=g.x,p[c++]=g.y,p[c++]=g.z;for(d=r-1,f=1;f<a;f++)A.RectangleGeometryLibrary.computePosition(t,i,!1,f,d,g),p[c++]=g.x,p[c++]=g.y,p[c++]=g.z;if(f=a-1,!o)for(d=r-2;0<=d;d--)A.RectangleGeometryLibrary.computePosition(t,i,!1,f,d,g),p[c++]=g.x,p[c++]=g.y,p[c++]=g.z;for(d=0,f=a-2;0<f;f--)A.RectangleGeometryLibrary.computePosition(t,i,!1,f,d,g),p[c++]=g.x,p[c++]=g.y,p[c++]=g.z;for(var o=p.length/3*2,h=E.IndexDatatype.createTypedArray(p.length/3,o),y=0,b=0;b<p.length/3-1;b++)h[y++]=b,h[y++]=b+1;h[y++]=p.length/3-1,h[y++]=0;o=new _.Geometry({attributes:new v.GeometryAttributes,primitiveType:_.PrimitiveType.LINES});return o.attributes.position=new _.GeometryAttribute({componentDatatype:m.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:p}),o.indices=h,o}function c(e){var t=(e=s.defaultValue(e,s.defaultValue.EMPTY_OBJECT)).rectangle,i=s.defaultValue(e.granularity,d.CesiumMath.RADIANS_PER_DEGREE),a=s.defaultValue(e.ellipsoid,p.Ellipsoid.WGS84),r=s.defaultValue(e.rotation,0),n=s.defaultValue(e.height,0),o=s.defaultValue(e.extrudedHeight,n);this._rectangle=p.Rectangle.clone(t),this._granularity=i,this._ellipsoid=a,this._surfaceHeight=Math.max(n,o),this._rotation=r,this._extrudedHeight=Math.min(n,o),this._offsetAttribute=e.offsetAttribute,this._workerName="createRectangleOutlineGeometry"}c.packedLength=p.Rectangle.packedLength+p.Ellipsoid.packedLength+5,c.pack=function(e,t,i){return i=s.defaultValue(i,0),p.Rectangle.pack(e._rectangle,t,i),i+=p.Rectangle.packedLength,p.Ellipsoid.pack(e._ellipsoid,t,i),i+=p.Ellipsoid.packedLength,t[i++]=e._granularity,t[i++]=e._surfaceHeight,t[i++]=e._rotation,t[i++]=e._extrudedHeight,t[i]=s.defaultValue(e._offsetAttribute,-1),t};var w=new p.Rectangle,L=p.Ellipsoid.clone(p.Ellipsoid.UNIT_SPHERE),C={rectangle:w,ellipsoid:L,granularity:void 0,height:void 0,rotation:void 0,extrudedHeight:void 0,offsetAttribute:void 0};c.unpack=function(e,t,i){t=s.defaultValue(t,0);var a=p.Rectangle.unpack(e,t,w);t+=p.Rectangle.packedLength;var r=p.Ellipsoid.unpack(e,t,L);t+=p.Ellipsoid.packedLength;var n=e[t++],o=e[t++],l=e[t++],u=e[t++],t=e[t];return s.defined(i)?(i._rectangle=p.Rectangle.clone(a,i._rectangle),i._ellipsoid=p.Ellipsoid.clone(r,i._ellipsoid),i._surfaceHeight=o,i._rotation=l,i._extrudedHeight=u,i._offsetAttribute=-1===t?void 0:t,i):(C.granularity=n,C.height=o,C.rotation=l,C.extrudedHeight=u,C.offsetAttribute=-1===t?void 0:t,new c(C))};var D=new p.Cartographic;return c.createGeometry=function(c){var e=c._rectangle,t=c._ellipsoid,i=A.RectangleGeometryLibrary.computeOptions(e,c._granularity,c._rotation,0,R,D);if(!d.CesiumMath.equalsEpsilon(e.north,e.south,d.CesiumMath.EPSILON10)&&!d.CesiumMath.equalsEpsilon(e.east,e.west,d.CesiumMath.EPSILON10)){var a,r,n,o,l=c._surfaceHeight,u=c._extrudedHeight;return o=d.CesiumMath.equalsEpsilon(l,u,0,d.CesiumMath.EPSILON2)?((n=P(c,i)).attributes.position.values=h.PolygonPipeline.scaleToGeodeticHeight(n.attributes.position.values,l,t,!1),s.defined(c._offsetAttribute)&&(r=n.attributes.position.values.length,a=new Uint8Array(r/3),r=c._offsetAttribute===g.GeometryOffsetAttribute.NONE?0:1,g.arrayFill(a,r),n.attributes.applyOffset=new _.GeometryAttribute({componentDatatype:m.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:a})),f.BoundingSphere.fromRectangle3D(e,t,l)):(n=function(e){var t=c._surfaceHeight,i=c._extrudedHeight,a=c._ellipsoid,r=i,n=t,o=P(c,e),l=e.height,i=e.width,t=h.PolygonPipeline.scaleToGeodeticHeight(o.attributes.position.values,n,a,!1),u=t.length,n=new Float64Array(2*u);n.set(t);r=h.PolygonPipeline.scaleToGeodeticHeight(o.attributes.position.values,r,a);n.set(r,u),o.attributes.position.values=n;a=e.northCap,r=e.southCap,e=4;a&&--e,r&&--e;for(var e=2*(n.length/3+e),s=E.IndexDatatype.createTypedArray(n.length/3,e),u=n.length/6,d=0,p=0;p<u-1;p++)s[d++]=p,s[d++]=p+1,s[d++]=p+u,s[d++]=p+u+1;return s[d++]=u-1,s[d++]=0,s[d++]=u+u-1,s[d++]=u,s[d++]=0,s[d++]=u,l=a?l-1:(a=i-1,s[d++]=a,s[d++]=a+u,i+l-2),s[d++]=l,s[d++]=l+u,r||(l=i+l-1,s[d++]=l,s[d]=l+u),o.indices=s,o}(i),s.defined(c._offsetAttribute)&&(i=n.attributes.position.values.length/3,o=new Uint8Array(i),o=c._offsetAttribute===g.GeometryOffsetAttribute.TOP?g.arrayFill(o,1,0,i/2):(r=c._offsetAttribute===g.GeometryOffsetAttribute.NONE?0:1,g.arrayFill(o,r)),n.attributes.applyOffset=new _.GeometryAttribute({componentDatatype:m.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:o})),l=f.BoundingSphere.fromRectangle3D(e,t,l,b),o=f.BoundingSphere.fromRectangle3D(e,t,u,y),f.BoundingSphere.union(l,o)),new _.Geometry({attributes:n.attributes,indices:n.indices,primitiveType:_.PrimitiveType.LINES,boundingSphere:o,offsetAttribute:c._offsetAttribute})}},function(e,t){return s.defined(t)&&(e=c.unpack(e,t)),e._ellipsoid=p.Ellipsoid.clone(e._ellipsoid),e._rectangle=p.Rectangle.clone(e._rectangle),c.createGeometry(e)}});