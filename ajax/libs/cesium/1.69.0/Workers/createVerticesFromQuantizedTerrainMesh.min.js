define(["./when-b43ff45e","./Check-d404a0fe","./Math-336da716","./Cartesian2-3c21ddb9","./Transforms-ffcbad88","./RuntimeError-bf10f3d5","./WebGLConstants-56de22c0","./ComponentDatatype-8956ad9a","./AttributeCompression-2ec18651","./IndexDatatype-c5295474","./IntersectionTests-e522b831","./Plane-56dc8a69","./WebMercatorProjection-069c36ba","./createTaskProcessorWorker","./EllipsoidTangentPlane-0c88eccf","./OrientedBoundingBox-2239d753","./TerrainEncoding-749587ba"],function(ie,e,oe,ae,se,t,r,n,de,ce,i,o,ue,a,he,le,Ie){"use strict";function me(){e.DeveloperError.throwInstantiationError()}Object.defineProperties(me.prototype,{errorEvent:{get:e.DeveloperError.throwInstantiationError},credit:{get:e.DeveloperError.throwInstantiationError},tilingScheme:{get:e.DeveloperError.throwInstantiationError},ready:{get:e.DeveloperError.throwInstantiationError},readyPromise:{get:e.DeveloperError.throwInstantiationError},hasWaterMask:{get:e.DeveloperError.throwInstantiationError},hasVertexNormals:{get:e.DeveloperError.throwInstantiationError},availability:{get:e.DeveloperError.throwInstantiationError}});var s=[];me.getRegularGridIndices=function(e,t){var r=s[e];ie.defined(r)||(s[e]=r=[]);var n=r[t];return ie.defined(n)||m(e,t,n=e*t<oe.CesiumMath.SIXTY_FOUR_KILOBYTES?r[t]=new Uint16Array((e-1)*(t-1)*6):r[t]=new Uint32Array((e-1)*(t-1)*6),0),n};var d=[];me.getRegularGridIndicesAndEdgeIndices=function(e,t){var r=d[e];ie.defined(r)||(d[e]=r=[]);var n,i,o,a,s=r[t];return ie.defined(s)||(n=me.getRegularGridIndices(e,t),i=(a=I(e,t)).westIndicesSouthToNorth,o=a.southIndicesEastToWest,e=a.eastIndicesNorthToSouth,a=a.northIndicesWestToEast,s=r[t]={indices:n,westIndicesSouthToNorth:i,southIndicesEastToWest:o,eastIndicesNorthToSouth:e,northIndicesWestToEast:a}),s};var l=[];function I(e,t){for(var r=new Array(t),n=new Array(e),i=new Array(t),o=new Array(e),a=0;a<e;++a)n[o[a]=a]=e*t-1-a;for(a=0;a<t;++a)i[a]=(a+1)*e-1,r[a]=(t-a-1)*e;return{westIndicesSouthToNorth:r,southIndicesEastToWest:n,eastIndicesNorthToSouth:i,northIndicesWestToEast:o}}function m(e,t,r,n){for(var i=0,o=0;o<t-1;++o){for(var a=0;a<e-1;++a){var s=i+e,d=s+1,c=i+1;r[n++]=i,r[n++]=s,r[n++]=c,r[n++]=c,r[n++]=s,r[n++]=d,++i}++i}}function c(e,t,r,n){for(var i=e[0],o=e.length,a=1;a<o;++a){var s=e[a];r[n++]=i,r[n++]=s,r[n++]=t,r[n++]=t,r[n++]=s,r[n++]=t+1,i=s,++t}return n}me.getRegularGridAndSkirtIndicesAndEdgeIndices=function(e,t){var r=l[e];ie.defined(r)||(l[e]=r=[]);var n,i,o,a,s,d,c,u,h=r[t];return ie.defined(h)||(o=(n=e*t)+(d=2*e+2*t),u=(i=(e-1)*(t-1)*6)+6*Math.max(0,d-4),a=(c=I(e,t)).westIndicesSouthToNorth,s=c.southIndicesEastToWest,d=c.eastIndicesNorthToSouth,c=c.northIndicesWestToEast,m(e,t,u=ce.IndexDatatype.createTypedArray(o,u),0),me.addSkirtIndices(a,s,d,c,n,u,i),h=r[t]={indices:u,westIndicesSouthToNorth:a,southIndicesEastToWest:s,eastIndicesNorthToSouth:d,northIndicesWestToEast:c,indexCountWithoutSkirts:i}),h},me.addSkirtIndices=function(e,t,r,n,i,o,a){a=c(e,i=i,o,a),a=c(t,i+=e.length,o,a),a=c(r,i+=t.length,o,a),c(n,i+=r.length,o,a)},me.heightmapTerrainQuality=.25,me.getEstimatedLevelZeroGeometricErrorForAHeightmap=function(e,t,r){return 2*e.maximumRadius*Math.PI*me.heightmapTerrainQuality/(t*r)},me.prototype.requestTileGeometry=e.DeveloperError.throwInstantiationError,me.prototype.getLevelMaximumGeometricError=e.DeveloperError.throwInstantiationError,me.prototype.getTileDataAvailable=e.DeveloperError.throwInstantiationError,me.prototype.loadTileDataAvailability=e.DeveloperError.throwInstantiationError;var ge=32767,Te=new ae.Cartesian3,pe=new ae.Cartesian3,Ee=new ae.Cartesian3,fe=new ae.Cartographic,ye=new ae.Cartesian2,ve=new ae.Cartesian3,Ne=new se.Matrix4,we=new se.Matrix4;function xe(e,t,r,n,i,o,a,s,d){var c=Number.POSITIVE_INFINITY,u=i.north,h=i.south,l=i.east,I=i.west;l<I&&(l+=oe.CesiumMath.TWO_PI);for(var m=e.length,g=0;g<m;++g){var T=e[g],p=r[T],T=n[T];fe.longitude=oe.CesiumMath.lerp(I,l,T.x),fe.latitude=oe.CesiumMath.lerp(h,u,T.y),fe.height=p-t;p=o.cartographicToCartesian(fe,Te);se.Matrix4.multiplyByPoint(a,p,p),ae.Cartesian3.minimumByComponent(p,s,s),ae.Cartesian3.maximumByComponent(p,d,d),c=Math.min(c,fe.height)}return c}function Me(e,t,r,n,i,o,a,s,d,c,u,h,l,I,m){var g=ie.defined(a),T=d.north,p=d.south,E=d.east,f=d.west;E<f&&(E+=oe.CesiumMath.TWO_PI);for(var y=r.length,v=0;v<y;++v){var N=r[v],w=i[N],x=o[N];fe.longitude=oe.CesiumMath.lerp(f,E,x.x)+I,fe.latitude=oe.CesiumMath.lerp(p,T,x.y)+m,fe.height=w-c;var M,C,b=s.cartographicToCartesian(fe,Te);g&&(C=2*N,ye.x=a[C],ye.y=a[1+C],1!==u&&(w=de.AttributeCompression.octDecode(ye.x,ye.y,ve),N=se.Transforms.eastNorthUpToFixedFrame(Te,s,we),C=se.Matrix4.inverseTransformation(N,Ne),se.Matrix4.multiplyByPointAsVector(C,w,w),w.z*=u,ae.Cartesian3.normalize(w,w),se.Matrix4.multiplyByPointAsVector(N,w,w),ae.Cartesian3.normalize(w,w),de.AttributeCompression.octEncode(w,ye))),n.hasWebMercatorT&&(M=(ue.WebMercatorProjection.geodeticLatitudeToMercatorAngle(fe.latitude)-h)*l),t=n.encode(e,t,b,x,fe.height,ye,M)}}function Ce(e,t){var r;return"function"==typeof e.slice&&"function"!=typeof(r=e.slice()).sort&&(r=void 0),ie.defined(r)||(r=Array.prototype.slice.call(e)),r.sort(t),r}return a(function(e,t){var r,n,i=e.quantizedVertices,o=i.length/3,a=e.octEncodedNormals,s=e.westIndices.length+e.eastIndices.length+e.southIndices.length+e.northIndices.length,d=e.includeWebMercatorT,c=ae.Rectangle.clone(e.rectangle),u=c.west,h=c.south,l=c.east,I=c.north,m=ae.Ellipsoid.clone(e.ellipsoid),g=e.exaggeration,T=e.minimumHeight*g,p=e.maximumHeight*g,E=e.relativeToCenter,f=se.Transforms.eastNorthUpToFixedFrame(E,m),y=se.Matrix4.inverseTransformation(f,new se.Matrix4);d&&(r=ue.WebMercatorProjection.geodeticLatitudeToMercatorAngle(h),n=1/(ue.WebMercatorProjection.geodeticLatitudeToMercatorAngle(I)-r));var v=i.subarray(0,o),N=i.subarray(o,2*o),w=i.subarray(2*o,3*o),x=ie.defined(a),M=new Array(o),C=new Array(o),b=new Array(o),S=d?new Array(o):[],A=pe;A.x=Number.POSITIVE_INFINITY,A.y=Number.POSITIVE_INFINITY,A.z=Number.POSITIVE_INFINITY;var P=Ee;P.x=Number.NEGATIVE_INFINITY,P.y=Number.NEGATIVE_INFINITY,P.z=Number.NEGATIVE_INFINITY;for(var W=Number.POSITIVE_INFINITY,D=Number.NEGATIVE_INFINITY,B=Number.POSITIVE_INFINITY,F=Number.NEGATIVE_INFINITY,k=0;k<o;++k){var V=v[k],_=N[k],H=V/ge,O=_/ge,V=oe.CesiumMath.lerp(T,p,w[k]/ge);fe.longitude=oe.CesiumMath.lerp(u,l,H),fe.latitude=oe.CesiumMath.lerp(h,I,O),fe.height=V,W=Math.min(fe.longitude,W),D=Math.max(fe.longitude,D),B=Math.min(fe.latitude,B),F=Math.max(fe.latitude,F);_=m.cartographicToCartesian(fe);M[k]=new ae.Cartesian2(H,O),C[k]=V,b[k]=_,d&&(S[k]=(ue.WebMercatorProjection.geodeticLatitudeToMercatorAngle(fe.latitude)-r)*n),se.Matrix4.multiplyByPoint(y,_,Te),ae.Cartesian3.minimumByComponent(Te,A,A),ae.Cartesian3.maximumByComponent(Te,P,P)}var G,Y,z,R=Ce(e.westIndices,function(e,t){return M[e].y-M[t].y}),L=Ce(e.eastIndices,function(e,t){return M[t].y-M[e].y}),U=Ce(e.southIndices,function(e,t){return M[t].x-M[e].x}),j=Ce(e.northIndices,function(e,t){return M[e].x-M[t].x});1!==g&&(Y=se.BoundingSphere.fromPoints(b),G=le.OrientedBoundingBox.fromRectangle(c,T,p,m)),(1!==g||T<0)&&(z=new Ie.EllipsoidalOccluder(m).computeHorizonCullingPointPossiblyUnderEllipsoid(E,b,T));var q=T,q=Math.min(q,xe(e.westIndices,e.westSkirtHeight,C,M,c,m,y,A,P));q=Math.min(q,xe(e.southIndices,e.southSkirtHeight,C,M,c,m,y,A,P)),q=Math.min(q,xe(e.eastIndices,e.eastSkirtHeight,C,M,c,m,y,A,P)),q=Math.min(q,xe(e.northIndices,e.northSkirtHeight,C,M,c,m,y,A,P));for(var Q,K,X,Z=new he.AxisAlignedBoundingBox(A,P,E),J=new Ie.TerrainEncoding(Z,q,p,f,x,d),$=J.getStride(),ee=new Float32Array(o*$+s*$),te=0,re=0;re<o;++re)x&&(X=2*re,ye.x=a[X],ye.y=a[1+X],1!==g&&(Q=de.AttributeCompression.octDecode(ye.x,ye.y,ve),K=se.Transforms.eastNorthUpToFixedFrame(b[re],m,we),X=se.Matrix4.inverseTransformation(K,Ne),se.Matrix4.multiplyByPointAsVector(X,Q,Q),Q.z*=g,ae.Cartesian3.normalize(Q,Q),se.Matrix4.multiplyByPointAsVector(K,Q,Q),ae.Cartesian3.normalize(Q,Q),de.AttributeCompression.octEncode(Q,ye))),te=J.encode(ee,te,b[re],M[re],C[re],ye,S[re]);var ne=Math.max(0,2*(s-4)),i=e.indices.length+3*ne,Z=ce.IndexDatatype.createTypedArray(o+s,i);Z.set(e.indices,0);q=1e-4*(D-W),f=1e-4*(F-B),ne=-q,s=q,i=f,q=-f;return Me(ee,f=o*$,R,J,C,M,a,m,c,e.westSkirtHeight,g,r,n,ne,0),Me(ee,f+=e.westIndices.length*$,U,J,C,M,a,m,c,e.southSkirtHeight,g,r,n,0,q),Me(ee,f+=e.southIndices.length*$,L,J,C,M,a,m,c,e.eastSkirtHeight,g,r,n,s,0),Me(ee,f+=e.eastIndices.length*$,j,J,C,M,a,m,c,e.northSkirtHeight,g,r,n,0,i),me.addSkirtIndices(R,U,L,j,o,Z,e.indices.length),t.push(ee.buffer,Z.buffer),{vertices:ee.buffer,indices:Z.buffer,westIndicesSouthToNorth:R,southIndicesEastToWest:U,eastIndicesNorthToSouth:L,northIndicesWestToEast:j,vertexStride:$,center:E,minimumHeight:T,maximumHeight:p,boundingSphere:Y,orientedBoundingBox:G,occludeePointInScaledSpace:z,encoding:J,indexCountWithoutSkirts:e.indices.length}})});