define(["./when-b43ff45e","./Check-d404a0fe","./Math-336da716","./Cartesian2-3c21ddb9","./Transforms-ffcbad88","./RuntimeError-bf10f3d5","./WebGLConstants-56de22c0","./ComponentDatatype-8956ad9a","./GeometryAttribute-c9800e88","./GeometryAttributes-fbf888b4","./IndexDatatype-c5295474","./IntersectionTests-e522b831","./Plane-56dc8a69","./GeometryOffsetAttribute-9f7392ac","./arrayRemoveDuplicates-a7dee4b8","./EllipsoidTangentPlane-0c88eccf","./EllipsoidRhumbLine-6daaa4d2","./PolygonPipeline-b2950861","./PolylineVolumeGeometryLibrary-ff75c3ae","./EllipsoidGeodesic-acfd9e4b","./PolylinePipeline-1c467caa","./CorridorGeometryLibrary-b3b4d039"],function(M,e,u,R,p,t,i,B,U,F,Y,r,o,v,f,a,n,A,q,s,l,W){"use strict";var J=new R.Cartesian3,j=new R.Cartesian3,z=new R.Cartesian3;function _(e,t){var i,r,o=[],a=e.positions,n=e.corners,s=e.endPositions,l=new F.GeometryAttributes,d=0,u=0,p=0;for(L=0;L<a.length;L+=2)d+=r=a[L].length-3,p+=r/3*4,u+=a[L+1].length-3;for(d+=3,u+=3,L=0;L<n.length;L++){i=n[L];var f=n[L].leftPositions;M.defined(f)?d+=r=f.length:u+=r=n[L].rightPositions.length,p+=r/3*2}var h,y=M.defined(s);y&&(d+=h=s[0].length-3,u+=h,p+=4*(h/=3));var c,g,b,m,v,A,e=d+u,_=new Float64Array(e),E=0,C=e-1,G=h/2,T=Y.IndexDatatype.createTypedArray(e/3,p+4),P=0;if(T[P++]=E/3,T[P++]=(C-2)/3,y){o.push(E/3),A=J,v=j;for(var w=s[0],L=0;L<G;L++)A=R.Cartesian3.fromArray(w,3*(G-1-L),A),v=R.Cartesian3.fromArray(w,3*(G+L),v),W.CorridorGeometryLibrary.addAttribute(_,v,E),W.CorridorGeometryLibrary.addAttribute(_,A,void 0,C),m=1+(g=E/3),b=(c=(C-2)/3)-1,T[P++]=c,T[P++]=b,T[P++]=g,T[P++]=m,E+=3,C-=3}var D=0,k=a[D++],N=a[D++];for(_.set(k,E),_.set(N,C-N.length+1),r=N.length-3,o.push(E/3,(C-2)/3),L=0;L<r;L+=3)m=1+(g=E/3),b=(c=(C-2)/3)-1,T[P++]=c,T[P++]=b,T[P++]=g,T[P++]=m,E+=3,C-=3;for(L=0;L<n.length;L++){var O,V,x=(i=n[L]).leftPositions,H=i.rightPositions,I=z;if(M.defined(x)){for(C-=3,V=b,o.push(m),O=0;O<x.length/3;O++)I=R.Cartesian3.fromArray(x,3*O,I),T[P++]=V-O-1,T[P++]=V-O,W.CorridorGeometryLibrary.addAttribute(_,I,void 0,C),C-=3;o.push(V-Math.floor(x.length/6)),t===q.CornerType.BEVELED&&o.push((C-2)/3+1),E+=3}else{for(E+=3,V=m,o.push(b),O=0;O<H.length/3;O++)I=R.Cartesian3.fromArray(H,3*O,I),T[P++]=V+O,T[P++]=V+O+1,W.CorridorGeometryLibrary.addAttribute(_,I,E),E+=3;o.push(V+Math.floor(H.length/6)),t===q.CornerType.BEVELED&&o.push(E/3-1),C-=3}for(k=a[D++],N=a[D++],k.splice(0,3),N.splice(N.length-3,3),_.set(k,E),_.set(N,C-N.length+1),r=N.length-3,O=0;O<N.length;O+=3)g=(m=E/3)-1,c=1+(b=(C-2)/3),T[P++]=c,T[P++]=b,T[P++]=g,T[P++]=m,E+=3,C-=3;E-=3,C+=3,o.push(E/3,(C-2)/3)}if(y){E+=3,C-=3,A=J,v=j;var S=s[1];for(L=0;L<G;L++)A=R.Cartesian3.fromArray(S,3*(h-L-1),A),v=R.Cartesian3.fromArray(S,3*L,v),W.CorridorGeometryLibrary.addAttribute(_,A,void 0,C),W.CorridorGeometryLibrary.addAttribute(_,v,E),g=(m=E/3)-1,c=1+(b=(C-2)/3),T[P++]=c,T[P++]=b,T[P++]=g,T[P++]=m,E+=3,C-=3;o.push(E/3)}else o.push(E/3,(C-2)/3);return T[P++]=E/3,T[P++]=(C-2)/3,l.position=new U.GeometryAttribute({componentDatatype:B.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:_}),{attributes:l,indices:T,wallIndices:o}}function h(e){var t=(e=M.defaultValue(e,M.defaultValue.EMPTY_OBJECT)).positions,i=e.width,r=M.defaultValue(e.height,0),o=M.defaultValue(e.extrudedHeight,r);this._positions=t,this._ellipsoid=R.Ellipsoid.clone(M.defaultValue(e.ellipsoid,R.Ellipsoid.WGS84)),this._width=i,this._height=Math.max(r,o),this._extrudedHeight=Math.min(r,o),this._cornerType=M.defaultValue(e.cornerType,q.CornerType.ROUNDED),this._granularity=M.defaultValue(e.granularity,u.CesiumMath.RADIANS_PER_DEGREE),this._offsetAttribute=e.offsetAttribute,this._workerName="createCorridorOutlineGeometry",this.packedLength=1+t.length*R.Cartesian3.packedLength+R.Ellipsoid.packedLength+6}h.pack=function(e,t,i){i=M.defaultValue(i,0);var r=e._positions,o=r.length;t[i++]=o;for(var a=0;a<o;++a,i+=R.Cartesian3.packedLength)R.Cartesian3.pack(r[a],t,i);return R.Ellipsoid.pack(e._ellipsoid,t,i),i+=R.Ellipsoid.packedLength,t[i++]=e._width,t[i++]=e._height,t[i++]=e._extrudedHeight,t[i++]=e._cornerType,t[i++]=e._granularity,t[i]=M.defaultValue(e._offsetAttribute,-1),t};var y=R.Ellipsoid.clone(R.Ellipsoid.UNIT_SPHERE),c={positions:void 0,ellipsoid:y,width:void 0,height:void 0,extrudedHeight:void 0,cornerType:void 0,granularity:void 0,offsetAttribute:void 0};return h.unpack=function(e,t,i){t=M.defaultValue(t,0);for(var r=e[t++],o=new Array(r),a=0;a<r;++a,t+=R.Cartesian3.packedLength)o[a]=R.Cartesian3.unpack(e,t);var n=R.Ellipsoid.unpack(e,t,y);t+=R.Ellipsoid.packedLength;var s=e[t++],l=e[t++],d=e[t++],u=e[t++],p=e[t++],f=e[t];return M.defined(i)?(i._positions=o,i._ellipsoid=R.Ellipsoid.clone(n,i._ellipsoid),i._width=s,i._height=l,i._extrudedHeight=d,i._cornerType=u,i._granularity=p,i._offsetAttribute=-1===f?void 0:f,i):(c.positions=o,c.width=s,c.height=l,c.extrudedHeight=d,c.cornerType=u,c.granularity=p,c.offsetAttribute=-1===f?void 0:f,new h(c))},h.createGeometry=function(e){var t=e._positions,i=e._width,r=e._ellipsoid,t=function(e,t){for(var i=0;i<e.length;i++)e[i]=t.scaleToGeodeticSurface(e[i],e[i]);return e}(t,r),o=f.arrayRemoveDuplicates(t,R.Cartesian3.equalsEpsilon);if(!(o.length<2||i<=0)){var a,n=e._height,s=e._extrudedHeight,t=!u.CesiumMath.equalsEpsilon(n,s,0,u.CesiumMath.EPSILON2),i={ellipsoid:r,positions:o,width:i,cornerType:e._cornerType,granularity:e._granularity,saveAttributes:!1};t?(i.height=n,i.extrudedHeight=s,i.offsetAttribute=e._offsetAttribute,a=function(e){var t=e.ellipsoid,i=_(W.CorridorGeometryLibrary.computePositions(e),e.cornerType),r=i.wallIndices,o=e.height,a=e.extrudedHeight,n=i.attributes,s=i.indices,l=(d=n.position.values).length;(u=new Float64Array(l)).set(d);var i=new Float64Array(2*l),d=A.PolygonPipeline.scaleToGeodeticHeight(d,o,t),u=A.PolygonPipeline.scaleToGeodeticHeight(u,a,t);i.set(d),i.set(u,l),n.position.values=i,l/=3,M.defined(e.offsetAttribute)&&(u=new Uint8Array(2*l),u=e.offsetAttribute===v.GeometryOffsetAttribute.TOP?v.arrayFill(u,1,0,l):(e=e.offsetAttribute===v.GeometryOffsetAttribute.NONE?0:1,v.arrayFill(u,e)),n.applyOffset=new U.GeometryAttribute({componentDatatype:B.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:u}));var p=s.length,f=Y.IndexDatatype.createTypedArray(i.length/3,2*(p+r.length));f.set(s);for(var h,y,c=p,g=0;g<p;g+=2){var b=s[g],m=s[g+1];f[c++]=b+l,f[c++]=m+l}for(g=0;g<r.length;g++)y=(h=r[g])+l,f[c++]=h,f[c++]=y;return{attributes:n,indices:f}}(i)):((a=_(W.CorridorGeometryLibrary.computePositions(i),i.cornerType)).attributes.position.values=A.PolygonPipeline.scaleToGeodeticHeight(a.attributes.position.values,n,r),M.defined(e._offsetAttribute)&&(l=a.attributes.position.values.length,d=new Uint8Array(l/3),l=e._offsetAttribute===v.GeometryOffsetAttribute.NONE?0:1,v.arrayFill(d,l),a.attributes.applyOffset=new U.GeometryAttribute({componentDatatype:B.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:d})));var l=a.attributes,d=p.BoundingSphere.fromVertices(l.position.values,void 0,3);return new U.Geometry({attributes:l,indices:a.indices,primitiveType:U.PrimitiveType.LINES,boundingSphere:d,offsetAttribute:e._offsetAttribute})}},function(e,t){return M.defined(t)&&(e=h.unpack(e,t)),e._ellipsoid=R.Ellipsoid.clone(e._ellipsoid),h.createGeometry(e)}});