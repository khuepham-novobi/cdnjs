define(["./when-b43ff45e","./Check-d404a0fe","./Math-336da716","./Cartesian2-3c21ddb9","./Transforms-ffcbad88","./RuntimeError-bf10f3d5","./WebGLConstants-56de22c0","./ComponentDatatype-8956ad9a","./AttributeCompression-2ec18651","./IntersectionTests-e522b831","./Plane-56dc8a69","./WebMercatorProjection-069c36ba","./createTaskProcessorWorker","./EllipsoidTangentPlane-0c88eccf","./OrientedBoundingBox-2239d753","./TerrainEncoding-749587ba"],function(Tt,t,ft,Ct,Mt,vt,e,i,n,a,r,Nt,o,xt,bt,St){"use strict";var wt=Uint16Array.BYTES_PER_ELEMENT,Pt=Int32Array.BYTES_PER_ELEMENT,Bt=Uint32Array.BYTES_PER_ELEMENT,yt=Float32Array.BYTES_PER_ELEMENT,At=Float64Array.BYTES_PER_ELEMENT;function Rt(t,e,i){i=Tt.defaultValue(i,ft.CesiumMath);for(var n=t.length,a=0;a<n;++a)if(i.equalsEpsilon(t[a],e,ft.CesiumMath.EPSILON12))return a;return-1}var _t=new Ct.Cartographic,Wt=new Ct.Cartesian3,Ft=new Ct.Cartesian3,Ot=new Ct.Cartesian3,Yt=new Mt.Matrix4;function kt(t,e,i,n,a,r,o,s,u,h){for(var c=o.length,d=0;d<c;++d){var g=o[d],l=g.cartographic,m=g.index,p=t.length,I=l.longitude,E=l.latitude,E=ft.CesiumMath.clamp(E,-ft.CesiumMath.PI_OVER_TWO,ft.CesiumMath.PI_OVER_TWO),l=l.height-r.skirtHeight;r.hMin=Math.min(r.hMin,l),Ct.Cartographic.fromRadians(I,E,l,_t),u&&(_t.longitude+=s),u?d===c-1?_t.latitude+=h:0===d&&(_t.latitude-=h):_t.latitude+=s;E=r.ellipsoid.cartographicToCartesian(_t);t.push(E),e.push(l),i.push(Ct.Cartesian2.clone(i[m])),0<n.length&&n.push(n[m]),Mt.Matrix4.multiplyByPoint(r.toENU,E,Wt);l=r.minimum,E=r.maximum;Ct.Cartesian3.minimumByComponent(Wt,l,l),Ct.Cartesian3.maximumByComponent(Wt,E,E);E=r.lastBorderPoint;Tt.defined(E)&&(E=E.index,a.push(E,p-1,p,p,m,E)),r.lastBorderPoint=g}}return o(function(t,e){t.ellipsoid=Ct.Ellipsoid.clone(t.ellipsoid),t.rectangle=Ct.Rectangle.clone(t.rectangle);var i=function(t,e,i,n,a,r,o,s,u,h){var c,d,g,l,m,p,I,E=Tt.defined(n)?(c=n.west,d=n.south,g=n.east,l=n.north,m=n.width,n.height):(c=ft.CesiumMath.toRadians(a.west),d=ft.CesiumMath.toRadians(a.south),g=ft.CesiumMath.toRadians(a.east),l=ft.CesiumMath.toRadians(a.north),m=ft.CesiumMath.toRadians(n.width),ft.CesiumMath.toRadians(n.height)),T=[d,l],f=[c,g],C=Mt.Transforms.eastNorthUpToFixedFrame(e,i),M=Mt.Matrix4.inverseTransformation(C,Yt);s&&(p=Nt.WebMercatorProjection.geodeticLatitudeToMercatorAngle(d),I=1/(Nt.WebMercatorProjection.geodeticLatitudeToMercatorAngle(l)-p));var v=new DataView(t),N=Number.POSITIVE_INFINITY,x=Number.NEGATIVE_INFINITY,b=Ft;b.x=Number.POSITIVE_INFINITY,b.y=Number.POSITIVE_INFINITY,b.z=Number.POSITIVE_INFINITY;var S=Ot;S.x=Number.NEGATIVE_INFINITY,S.y=Number.NEGATIVE_INFINITY,S.z=Number.NEGATIVE_INFINITY;for(var w=0,P=0,B=0,y=0;y<4;++y){var A=w,R=v.getUint32(A,!0);A+=Bt;var _=ft.CesiumMath.toRadians(180*v.getFloat64(A,!0));A+=At,-1===Rt(f,_)&&f.push(_);_=ft.CesiumMath.toRadians(180*v.getFloat64(A,!0));A+=At,-1===Rt(T,_)&&T.push(_),A+=2*At;_=v.getInt32(A,!0);A+=Pt,P+=_,B+=3*v.getInt32(A,!0),w+=R+Bt}var W=[],F=[],O=new Array(P),Y=new Array(P),k=new Array(P),U=s?new Array(P):[],V=new Array(B),H=[],L=[],D=[],G=[],j=0,z=0;for(y=w=0;y<4;++y){R=v.getUint32(w,!0);var q=w+=Bt,J=ft.CesiumMath.toRadians(180*v.getFloat64(w,!0));w+=At;var K=ft.CesiumMath.toRadians(180*v.getFloat64(w,!0));w+=At;var Q=ft.CesiumMath.toRadians(180*v.getFloat64(w,!0)),X=.5*Q;w+=At;var Z=ft.CesiumMath.toRadians(180*v.getFloat64(w,!0)),$=.5*Z;w+=At;var tt=v.getInt32(w,!0);w+=Pt;var et=v.getInt32(w,!0);w+=Pt,w+=Pt;for(var it=new Array(tt),nt=0;nt<tt;++nt){var at=J+v.getUint8(w++)*Q;_t.longitude=at;var rt=K+v.getUint8(w++)*Z;_t.latitude=rt;var ot=v.getFloat32(w,!0);if(w+=yt,0!==ot&&ot<h&&(ot*=-Math.pow(2,u)),ot*=6371010*r,_t.height=ot,-1!==Rt(f,at)||-1!==Rt(T,rt)){var st=Rt(W,_t,Ct.Cartographic);if(-1!==st){it[nt]=F[st];continue}W.push(Ct.Cartographic.clone(_t)),F.push(j)}it[nt]=j,Math.abs(at-c)<X?H.push({index:j,cartographic:Ct.Cartographic.clone(_t)}):Math.abs(at-g)<X?D.push({index:j,cartographic:Ct.Cartographic.clone(_t)}):Math.abs(rt-d)<$?L.push({index:j,cartographic:Ct.Cartographic.clone(_t)}):Math.abs(rt-l)<$&&G.push({index:j,cartographic:Ct.Cartographic.clone(_t)}),N=Math.min(ot,N),x=Math.max(ot,x),k[j]=ot;ot=i.cartographicToCartesian(_t);O[j]=ot,s&&(U[j]=(Nt.WebMercatorProjection.geodeticLatitudeToMercatorAngle(rt)-p)*I),Mt.Matrix4.multiplyByPoint(M,ot,Wt),Ct.Cartesian3.minimumByComponent(Wt,b,b),Ct.Cartesian3.maximumByComponent(Wt,S,S);at=(at-c)/(g-c),at=ft.CesiumMath.clamp(at,0,1),rt=(rt-d)/(l-d),rt=ft.CesiumMath.clamp(rt,0,1);Y[j]=new Ct.Cartesian2(at,rt),++j}for(var ut=3*et,ht=0;ht<ut;++ht,++z)V[z]=it[v.getUint16(w,!0)],w+=wt;if(R!==w-q)throw new vt.RuntimeError("Invalid terrain tile.")}O.length=j,Y.length=j,k.length=j,s&&(U.length=j);var ct=j,a=z,t={hMin:N,lastBorderPoint:void 0,skirtHeight:o,toENU:M,ellipsoid:i,minimum:b,maximum:S};H.sort(function(t,e){return e.cartographic.latitude-t.cartographic.latitude}),L.sort(function(t,e){return t.cartographic.longitude-e.cartographic.longitude}),D.sort(function(t,e){return t.cartographic.latitude-e.cartographic.latitude}),G.sort(function(t,e){return e.cartographic.longitude-t.cartographic.longitude});o=1e-5;kt(O,k,Y,U,V,t,H,-o*m,!0,-o*E),kt(O,k,Y,U,V,t,L,-o*E,!1),kt(O,k,Y,U,V,t,D,o*m,!0,o*E),kt(O,k,Y,U,V,t,G,o*E,!1),0<H.length&&0<G.length&&(gt=H[0].index,lt=G[G.length-1].index,E=O.length-1,V.push(lt,E,ct,ct,gt,lt)),P=O.length;var dt,gt=Mt.BoundingSphere.fromPoints(O);Tt.defined(n)&&(dt=bt.OrientedBoundingBox.fromRectangle(n,N,x,i));for(var lt=new St.EllipsoidalOccluder(i).computeHorizonCullingPointPossiblyUnderEllipsoid(e,O,N),n=new xt.AxisAlignedBoundingBox(b,S,e),mt=new St.TerrainEncoding(n,t.hMin,x,C,!1,s),pt=new Float32Array(P*mt.getStride()),It=0,Et=0;Et<P;++Et)It=mt.encode(pt,It,O[Et],Y[Et],k[Et],void 0,U[Et]);e=H.map(function(t){return t.index}).reverse(),n=L.map(function(t){return t.index}).reverse(),t=D.map(function(t){return t.index}).reverse(),C=G.map(function(t){return t.index}).reverse();return n.unshift(t[t.length-1]),n.push(e[0]),C.unshift(e[e.length-1]),C.push(t[0]),{vertices:pt,indices:new Uint16Array(V),maximumHeight:x,minimumHeight:N,encoding:mt,boundingSphere3D:gt,orientedBoundingBox:dt,occludeePointInScaledSpace:lt,vertexCountWithoutSkirts:ct,indexCountWithoutSkirts:a,westIndicesSouthToNorth:e,southIndicesEastToWest:n,eastIndicesNorthToSouth:t,northIndicesWestToEast:C}}(t.buffer,t.relativeToCenter,t.ellipsoid,t.rectangle,t.nativeRectangle,t.exaggeration,t.skirtHeight,t.includeWebMercatorT,t.negativeAltitudeExponentBias,t.negativeElevationThreshold),n=i.vertices;e.push(n.buffer);t=i.indices;return e.push(t.buffer),{vertices:n.buffer,indices:t.buffer,numberOfAttributes:i.encoding.getStride(),minimumHeight:i.minimumHeight,maximumHeight:i.maximumHeight,boundingSphere3D:i.boundingSphere3D,orientedBoundingBox:i.orientedBoundingBox,occludeePointInScaledSpace:i.occludeePointInScaledSpace,encoding:i.encoding,vertexCountWithoutSkirts:i.vertexCountWithoutSkirts,indexCountWithoutSkirts:i.indexCountWithoutSkirts,westIndicesSouthToNorth:i.westIndicesSouthToNorth,southIndicesEastToWest:i.southIndicesEastToWest,eastIndicesNorthToSouth:i.eastIndicesNorthToSouth,northIndicesWestToEast:i.northIndicesWestToEast}})});