define(["./when-b43ff45e","./Check-d404a0fe","./Math-336da716","./Cartesian2-3c21ddb9","./Transforms-ffcbad88","./RuntimeError-bf10f3d5","./WebGLConstants-56de22c0","./ComponentDatatype-8956ad9a","./AttributeCompression-2ec18651","./IndexDatatype-c5295474","./IntersectionTests-e522b831","./Plane-56dc8a69","./createTaskProcessorWorker","./EllipsoidTangentPlane-0c88eccf","./OrientedBoundingBox-2239d753","./TerrainEncoding-749587ba"],function(g,e,oe,ae,pe,t,i,n,s,de,r,h,u,o,fe,le){"use strict";var ce=function(e,t,i,n,s,r){var h,u,o;g.defined(r)?r.length=0:r=[],o=t?(h=i<e,u=n<e,s<e):(h=e<i,u=e<n,e<s);var a,p,d,f,l,c,t=h+u+o;return 1===t?h?(a=(e-i)/(n-i),p=(e-i)/(s-i),r.push(1),r.push(2),1!==p&&(r.push(-1),r.push(0),r.push(2),r.push(p)),1!==a&&(r.push(-1),r.push(0),r.push(1),r.push(a))):u?(d=(e-n)/(s-n),f=(e-n)/(i-n),r.push(2),r.push(0),1!==f&&(r.push(-1),r.push(1),r.push(0),r.push(f)),1!==d&&(r.push(-1),r.push(1),r.push(2),r.push(d))):o&&(l=(e-s)/(i-s),c=(e-s)/(n-s),r.push(0),r.push(1),1!==c&&(r.push(-1),r.push(2),r.push(1),r.push(c)),1!==l&&(r.push(-1),r.push(2),r.push(0),r.push(l))):2===t?h||i===e?u||n===e?o||s===e||(p=(e-i)/(s-i),d=(e-n)/(s-n),r.push(2),r.push(-1),r.push(0),r.push(2),r.push(p),r.push(-1),r.push(1),r.push(2),r.push(d)):(c=(e-s)/(n-s),a=(e-i)/(n-i),r.push(1),r.push(-1),r.push(2),r.push(1),r.push(c),r.push(-1),r.push(0),r.push(1),r.push(a)):(f=(e-n)/(i-n),l=(e-s)/(i-s),r.push(0),r.push(-1),r.push(1),r.push(0),r.push(f),r.push(-1),r.push(2),r.push(0),r.push(l)):3!==t&&(r.push(0),r.push(1),r.push(2)),r},ge=32767,me=16383,xe=[],we=[],Ce=[],ve=new ae.Cartographic,Be=new ae.Cartesian3,ye=[],Ie=[],be=[],ze=[],Me=[],Ne=new ae.Cartesian3,Ve=new pe.BoundingSphere,Ae=new fe.OrientedBoundingBox,Ee=new ae.Cartesian2,Re=new ae.Cartesian3;function He(){this.vertexBuffer=void 0,this.index=void 0,this.first=void 0,this.second=void 0,this.ratio=void 0}He.prototype.clone=function(e){return g.defined(e)||(e=new He),e.uBuffer=this.uBuffer,e.vBuffer=this.vBuffer,e.heightBuffer=this.heightBuffer,e.normalBuffer=this.normalBuffer,e.index=this.index,e.first=this.first,e.second=this.second,e.ratio=this.ratio,e},He.prototype.initializeIndexed=function(e,t,i,n,s){this.uBuffer=e,this.vBuffer=t,this.heightBuffer=i,this.normalBuffer=n,this.index=s,this.first=void 0,this.second=void 0,this.ratio=void 0},He.prototype.initializeFromClipResult=function(e,t,i){var n=t+1;return-1!==e[t]?i[e[t]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=i[e[n]],++n,this.second=i[e[n]],++n,this.ratio=e[n],++n),n},He.prototype.getKey=function(){return this.isIndexed()?this.index:JSON.stringify({first:this.first.getKey(),second:this.second.getKey(),ratio:this.ratio})},He.prototype.isIndexed=function(){return g.defined(this.index)},He.prototype.getH=function(){return g.defined(this.index)?this.heightBuffer[this.index]:oe.CesiumMath.lerp(this.first.getH(),this.second.getH(),this.ratio)},He.prototype.getU=function(){return g.defined(this.index)?this.uBuffer[this.index]:oe.CesiumMath.lerp(this.first.getU(),this.second.getU(),this.ratio)},He.prototype.getV=function(){return g.defined(this.index)?this.vBuffer[this.index]:oe.CesiumMath.lerp(this.first.getV(),this.second.getV(),this.ratio)};var a=new ae.Cartesian2,p=-1,d=[new ae.Cartesian3,new ae.Cartesian3],f=[new ae.Cartesian3,new ae.Cartesian3];function l(e,t){var i=d[++p],n=f[p],i=s.AttributeCompression.octDecode(e.first.getNormalX(),e.first.getNormalY(),i),n=s.AttributeCompression.octDecode(e.second.getNormalX(),e.second.getNormalY(),n);return Be=ae.Cartesian3.lerp(i,n,e.ratio,Be),ae.Cartesian3.normalize(Be,Be),s.AttributeCompression.octEncode(Be,t),--p,t}He.prototype.getNormalX=function(){return g.defined(this.index)?this.normalBuffer[2*this.index]:(a=l(this,a)).x},He.prototype.getNormalY=function(){return g.defined(this.index)?this.normalBuffer[2*this.index+1]:(a=l(this,a)).y};var m=[];function Te(e,t,i,n,s,r,h,u,o){if(0!==h.length){for(var a=0,p=0;p<h.length;)p=m[a++].initializeFromClipResult(h,p,u);for(var d=0;d<a;++d){var f,l,c=m[d];c.isIndexed()?(c.newIndex=r[c.index],c.uBuffer=e,c.vBuffer=t,c.heightBuffer=i,o&&(c.normalBuffer=n)):(f=c.getKey(),g.defined(r[f])?c.newIndex=r[f]:(l=e.length,e.push(c.getU()),t.push(c.getV()),i.push(c.getH()),o&&(n.push(c.getNormalX()),n.push(c.getNormalY())),c.newIndex=l,r[f]=l))}3===a?(s.push(m[0].newIndex),s.push(m[1].newIndex),s.push(m[2].newIndex)):4===a&&(s.push(m[0].newIndex),s.push(m[1].newIndex),s.push(m[2].newIndex),s.push(m[0].newIndex),s.push(m[2].newIndex),s.push(m[3].newIndex))}}return m.push(new He),m.push(new He),m.push(new He),m.push(new He),u(function(e,t){var i=e.isEastChild,n=e.isNorthChild,s=i?me:0,r=i?ge:me,h=n?me:0,u=n?ge:me,o=ye,a=Ie,p=be,d=Me;o.length=0,a.length=0,p.length=0,d.length=0;var f=ze;f.length=0;for(var l={},c=e.vertices,g=(g=e.indices).subarray(0,e.indexCountWithoutSkirts),m=le.TerrainEncoding.clone(e.encoding),x=m.hasVertexNormals,w=e.exaggeration,C=0,v=e.vertexCountWithoutSkirts,B=e.minimumHeight,y=e.maximumHeight,I=new Array(v),b=new Array(v),z=new Array(v),M=x?new Array(2*v):void 0,N=re=0;re<v;++re,N+=2){var V=m.decodeTextureCoordinates(c,re,Ee),A=m.decodeHeight(c,re)/w,E=oe.CesiumMath.clamp(V.x*ge|0,0,ge),R=oe.CesiumMath.clamp(V.y*ge|0,0,ge);z[re]=oe.CesiumMath.clamp((A-B)/(y-B)*ge|0,0,ge),E<20&&(E=0),R<20&&(R=0),ge-E<20&&(E=ge),ge-R<20&&(R=ge),I[re]=E,b[re]=R,x&&(V=m.getOctEncodedNormal(c,re,Re),M[N]=V.x,M[N+1]=V.y),(i&&me<=E||!i&&E<=me)&&(n&&me<=R||!n&&R<=me)&&(l[re]=C,o.push(E),a.push(R),p.push(z[re]),x&&(d.push(M[N]),d.push(M[N+1])),++C)}var H=[];H.push(new He),H.push(new He),H.push(new He);var T=[];for(T.push(new He),T.push(new He),T.push(new He),re=0;re<g.length;re+=3){var O=g[re],U=g[re+1],F=g[re+2],P=I[O],S=I[U],k=I[F];H[0].initializeIndexed(I,b,z,M,O),H[1].initializeIndexed(I,b,z,M,U),H[2].initializeIndexed(I,b,z,M,F);S=ce(me,i,P,S,k,xe);(k=0)>=S.length||(k=T[0].initializeFromClipResult(S,k,H))>=S.length||(k=T[1].initializeFromClipResult(S,k,H))>=S.length||(k=T[2].initializeFromClipResult(S,k,H),Te(o,a,p,d,f,l,ce(me,n,T[0].getV(),T[1].getV(),T[2].getV(),we),T,x),k<S.length&&(T[2].clone(T[1]),T[2].initializeFromClipResult(S,k,H),Te(o,a,p,d,f,l,ce(me,n,T[0].getV(),T[1].getV(),T[2].getV(),we),T,x)))}var D=i?-ge:0,W=n?-ge:0,X=[],K=[],Y=[],L=[],_=Number.MAX_VALUE,G=-_,J=Ce;J.length=0;var Z=ae.Ellipsoid.clone(e.ellipsoid),j=ae.Rectangle.clone(e.childRectangle),q=j.north,Q=j.south,$=j.east,ee=j.west;for($<ee&&($+=oe.CesiumMath.TWO_PI),re=0;re<o.length;++re)E=(E=Math.round(o[re]))<=s?(X.push(re),0):r<=E?(Y.push(re),ge):2*E+D,o[re]=E,R=(R=Math.round(a[re]))<=h?(K.push(re),0):u<=R?(L.push(re),ge):2*R+W,a[re]=R,(A=oe.CesiumMath.lerp(B,y,p[re]/ge))<_&&(_=A),G<A&&(G=A),p[re]=A,ve.longitude=oe.CesiumMath.lerp(ee,$,E/ge),ve.latitude=oe.CesiumMath.lerp(Q,q,R/ge),ve.height=A,Z.cartographicToCartesian(ve,Be),J.push(Be.x),J.push(Be.y),J.push(Be.z);for(var te=pe.BoundingSphere.fromVertices(J,ae.Cartesian3.ZERO,3,Ve),ie=fe.OrientedBoundingBox.fromRectangle(j,_,G,Z,Ae),e=new le.EllipsoidalOccluder(Z).computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(te.center,J,3,te.center,_,Ne),ne=G-_,se=new Uint16Array(o.length+a.length+p.length),re=0;re<o.length;++re)se[re]=o[re];var he=o.length;for(re=0;re<a.length;++re)se[he+re]=a[re];for(he+=a.length,re=0;re<p.length;++re)se[he+re]=ge*(p[re]-_)/ne;var ue,j=de.IndexDatatype.createTypedArray(o.length,f);return x?(ue=new Uint8Array(d),t.push(se.buffer,j.buffer,ue.buffer),ue=ue.buffer):t.push(se.buffer,j.buffer),{vertices:se.buffer,encodedNormals:ue,indices:j.buffer,minimumHeight:_,maximumHeight:G,westIndices:X,southIndices:K,eastIndices:Y,northIndices:L,boundingSphere:te,orientedBoundingBox:ie,horizonOcclusionPoint:e}})});