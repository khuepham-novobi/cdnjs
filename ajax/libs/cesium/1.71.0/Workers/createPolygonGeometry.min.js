define(["./when-54c2dc71","./Check-6c0211bc","./Math-fc8cecf5","./Cartesian2-bddc1162","./Transforms-ec27f304","./RuntimeError-2109023a","./WebGLConstants-76bb35d1","./ComponentDatatype-6d99a1ee","./GeometryAttribute-44fb48f1","./GeometryAttributes-4fcfcf40","./AttributeCompression-9fc99391","./GeometryPipeline-b49b2e59","./EncodedCartesian3-e9c71cf0","./IndexDatatype-53503fee","./IntersectionTests-2626c9e9","./Plane-231f1723","./GeometryOffsetAttribute-7350d9af","./VertexFormat-7572c785","./GeometryInstance-11f9a3bd","./arrayRemoveDuplicates-ebc732b0","./BoundingRectangle-8de79d83","./EllipsoidTangentPlane-ed172748","./ArcType-dc1c5aee","./EllipsoidRhumbLine-c704bf4c","./PolygonPipeline-ff364b47","./PolygonGeometryLibrary-29b9a52e","./EllipsoidGeodesic-30fae80b"],function(R,e,M,S,B,t,r,k,z,o,a,A,i,E,n,s,W,f,G,l,u,O,p,c,V,F,y){"use strict";var Y=new S.Cartographic,U=new S.Cartographic,D=new u.BoundingRectangle,j=new S.Cartesian3,Q=new S.Cartesian3,q=new S.Cartesian3,K=new S.Cartesian3,Z=new S.Cartesian3,J=new S.Cartesian3,X=new S.Cartesian3,$=new S.Cartesian3,ee=new S.Cartesian3,te=new S.Cartesian2,re=new S.Cartesian2,oe=new S.Cartesian3,ae=new B.Quaternion,ie=new B.Matrix3,ne=new B.Matrix3;function L(e){var t=e.vertexFormat,r=e.geometry,o=e.shadowVolume,a=r.attributes.position.values,i=a.length,n=e.wall,s=e.top||n,l=e.bottom||n;if(t.st||t.normal||t.tangent||t.bitangent||o){var u=e.boundingRectangle,c=e.tangentPlane,p=e.ellipsoid,y=e.stRotation,m=e.perPositionHeight,g=te;g.x=u.x,g.y=u.y;var d,h=t.st?new Float32Array(i/3*2):void 0;t.normal&&(d=m&&s&&!n?r.attributes.normal.values:new Float32Array(i));var f,b=t.tangent?new Float32Array(i):void 0,_=t.bitangent?new Float32Array(i):void 0,v=o?new Float32Array(i):void 0,P=0,C=0,w=Q,x=q,T=K,I=!0,A=ie,E=ne,E=0!==y?(f=B.Quaternion.fromAxisAngle(c._plane.normal,y,ae),A=B.Matrix3.fromQuaternion(f,A),f=B.Quaternion.fromAxisAngle(c._plane.normal,-y,ae),B.Matrix3.fromQuaternion(f,E)):(A=B.Matrix3.clone(B.Matrix3.IDENTITY,A),B.Matrix3.clone(B.Matrix3.IDENTITY,E)),G=0,O=0;s&&l&&(G=i/2,O=i/3,i/=2);for(var V=0;V<i;V+=3){var F,D,L,N,H=S.Cartesian3.fromArray(a,V,oe);t.st&&(F=B.Matrix3.multiplyByVector(A,H,j),F=p.scaleToGeodeticSurface(F,F),D=c.projectPointOntoPlane(F,re),S.Cartesian2.subtract(D,g,D),L=M.CesiumMath.clamp(D.x/u.width,0,1),N=M.CesiumMath.clamp(D.y/u.height,0,1),l&&(h[P+O]=L,h[P+1+O]=N),s&&(h[P]=L,h[P+1]=N),P+=2),(t.normal||t.tangent||t.bitangent||o)&&(F=C+1,D=C+2,n?(V+3<i&&(L=S.Cartesian3.fromArray(a,V+3,Z),I&&(N=S.Cartesian3.fromArray(a,V+i,J),m&&function(e,t,r){var o=r.cartesianToCartographic(H,Y).height,a=r.cartesianToCartographic(e,U);a.height=o,r.cartographicToCartesian(a,e);e=r.cartesianToCartographic(t,U);e.height=o-100,r.cartographicToCartesian(e,t)}(L,N,p),S.Cartesian3.subtract(L,H,L),S.Cartesian3.subtract(N,H,N),w=S.Cartesian3.normalize(S.Cartesian3.cross(N,L,w),w),I=!1),S.Cartesian3.equalsEpsilon(L,H,M.CesiumMath.EPSILON10)&&(I=!0)),(t.tangent||t.bitangent)&&(T=p.geodeticSurfaceNormal(H,T),t.tangent&&(x=S.Cartesian3.normalize(S.Cartesian3.cross(T,w,x),x)))):(w=p.geodeticSurfaceNormal(H,w),(t.tangent||t.bitangent)&&(m&&(X=S.Cartesian3.fromArray(d,C,X),$=S.Cartesian3.cross(S.Cartesian3.UNIT_Z,X,$),$=S.Cartesian3.normalize(B.Matrix3.multiplyByVector(E,$,$),$),t.bitangent&&(ee=S.Cartesian3.normalize(S.Cartesian3.cross(X,$,ee),ee))),x=S.Cartesian3.cross(S.Cartesian3.UNIT_Z,w,x),x=S.Cartesian3.normalize(B.Matrix3.multiplyByVector(E,x,x),x),t.bitangent&&(T=S.Cartesian3.normalize(S.Cartesian3.cross(w,x,T),T)))),t.normal&&(e.wall?(d[C+G]=w.x,d[F+G]=w.y,d[D+G]=w.z):l&&(d[C+G]=-w.x,d[F+G]=-w.y,d[D+G]=-w.z),(s&&!m||n)&&(d[C]=w.x,d[F]=w.y,d[D]=w.z)),o&&(n&&(w=p.geodeticSurfaceNormal(H,w)),v[C+G]=-w.x,v[F+G]=-w.y,v[D+G]=-w.z),t.tangent&&(e.wall?(b[C+G]=x.x,b[F+G]=x.y,b[D+G]=x.z):l&&(b[C+G]=-x.x,b[F+G]=-x.y,b[D+G]=-x.z),s&&(m?(b[C]=$.x,b[F]=$.y,b[D]=$.z):(b[C]=x.x,b[F]=x.y,b[D]=x.z))),t.bitangent&&(l&&(_[C+G]=T.x,_[F+G]=T.y,_[D+G]=T.z),s&&(m?(_[C]=ee.x,_[F]=ee.y,_[D]=ee.z):(_[C]=T.x,_[F]=T.y,_[D]=T.z))),C+=3)}t.st&&(r.attributes.st=new z.GeometryAttribute({componentDatatype:k.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:h})),t.normal&&(r.attributes.normal=new z.GeometryAttribute({componentDatatype:k.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:d})),t.tangent&&(r.attributes.tangent=new z.GeometryAttribute({componentDatatype:k.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:b})),t.bitangent&&(r.attributes.bitangent=new z.GeometryAttribute({componentDatatype:k.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:_})),o&&(r.attributes.extrudeDirection=new z.GeometryAttribute({componentDatatype:k.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:v}))}return e.extrude&&R.defined(e.offsetAttribute)&&(y=a.length/3,f=new Uint8Array(y),e.offsetAttribute===W.GeometryOffsetAttribute.TOP?s&&l||n?f=W.arrayFill(f,1,0,y/2):s&&(f=W.arrayFill(f,1)):(y=e.offsetAttribute===W.GeometryOffsetAttribute.NONE?0:1,f=W.arrayFill(f,y)),r.attributes.applyOffset=new z.GeometryAttribute({componentDatatype:k.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:f})),r}var m=new S.Cartographic,g=new S.Cartographic,d={westOverIDL:0,eastOverIDL:0},h=new y.EllipsoidGeodesic;function b(e,t,r,o,a){if(a=R.defaultValue(a,new S.Rectangle),!R.defined(e)||e.length<3)return a.west=0,a.north=0,a.south=0,a.east=0,a;if(r===p.ArcType.RHUMB)return S.Rectangle.fromCartesianArray(e,t,a);h.ellipsoid.equals(t)||(h=new y.EllipsoidGeodesic(void 0,void 0,t)),a.west=Number.POSITIVE_INFINITY,a.east=Number.NEGATIVE_INFINITY,a.south=Number.POSITIVE_INFINITY,a.north=Number.NEGATIVE_INFINITY,d.westOverIDL=Number.POSITIVE_INFINITY,d.eastOverIDL=Number.NEGATIVE_INFINITY;for(var i,n=1/M.CesiumMath.chordLength(o,t.maximumRadius),s=e.length,l=t.cartesianToCartographic(e[0],g),u=m,c=1;c<s;c++)i=u,u=l,l=t.cartesianToCartographic(e[c],i),h.setEndPoints(u,l),v(h,n,a,d);return i=u,u=l,l=t.cartesianToCartographic(e[0],i),h.setEndPoints(u,l),v(h,n,a,d),a.east-a.west>d.eastOverIDL-d.westOverIDL&&(a.west=d.westOverIDL,a.east=d.eastOverIDL,a.east>M.CesiumMath.PI&&(a.east=a.east-M.CesiumMath.TWO_PI),a.west>M.CesiumMath.PI&&(a.west=a.west-M.CesiumMath.TWO_PI)),a}var _=new S.Cartographic;function v(e,t,r,o){for(var a=e.surfaceDistance,i=Math.ceil(a*t),n=0<i?a/(i-1):Number.POSITIVE_INFINITY,s=0,l=0;l<i;l++){var u=e.interpolateUsingSurfaceDistance(s,_);s+=n;var c=u.longitude,u=u.latitude;r.west=Math.min(r.west,c),r.east=Math.max(r.east,c),r.south=Math.min(r.south,u),r.north=Math.max(r.north,u);c=0<=c?c:c+M.CesiumMath.TWO_PI;o.westOverIDL=Math.min(o.westOverIDL,c),o.eastOverIDL=Math.max(o.eastOverIDL,c)}}var N=[];function P(e){var t,r=e.polygonHierarchy,o=R.defaultValue(e.vertexFormat,f.VertexFormat.DEFAULT),a=R.defaultValue(e.ellipsoid,S.Ellipsoid.WGS84),i=R.defaultValue(e.granularity,M.CesiumMath.RADIANS_PER_DEGREE),n=R.defaultValue(e.stRotation,0),s=R.defaultValue(e.perPositionHeight,!1),l=s&&R.defined(e.extrudedHeight),u=R.defaultValue(e.height,0),c=R.defaultValue(e.extrudedHeight,u);l||(t=Math.max(u,c),c=Math.min(u,c),u=t),this._vertexFormat=f.VertexFormat.clone(o),this._ellipsoid=S.Ellipsoid.clone(a),this._granularity=i,this._stRotation=n,this._height=u,this._extrudedHeight=c,this._closeTop=R.defaultValue(e.closeTop,!0),this._closeBottom=R.defaultValue(e.closeBottom,!0),this._polygonHierarchy=r,this._perPositionHeight=s,this._perPositionHeightExtrude=l,this._shadowVolume=R.defaultValue(e.shadowVolume,!1),this._workerName="createPolygonGeometry",this._offsetAttribute=e.offsetAttribute,this._arcType=R.defaultValue(e.arcType,p.ArcType.GEODESIC),this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0,this.packedLength=F.PolygonGeometryLibrary.computeHierarchyPackedLength(r)+S.Ellipsoid.packedLength+f.VertexFormat.packedLength+12}P.fromPositions=function(e){return new P({polygonHierarchy:{positions:(e=R.defaultValue(e,R.defaultValue.EMPTY_OBJECT)).positions},height:e.height,extrudedHeight:e.extrudedHeight,vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid,granularity:e.granularity,perPositionHeight:e.perPositionHeight,closeTop:e.closeTop,closeBottom:e.closeBottom,offsetAttribute:e.offsetAttribute,arcType:e.arcType})},P.pack=function(e,t,r){return r=R.defaultValue(r,0),r=F.PolygonGeometryLibrary.packPolygonHierarchy(e._polygonHierarchy,t,r),S.Ellipsoid.pack(e._ellipsoid,t,r),r+=S.Ellipsoid.packedLength,f.VertexFormat.pack(e._vertexFormat,t,r),r+=f.VertexFormat.packedLength,t[r++]=e._height,t[r++]=e._extrudedHeight,t[r++]=e._granularity,t[r++]=e._stRotation,t[r++]=e._perPositionHeightExtrude?1:0,t[r++]=e._perPositionHeight?1:0,t[r++]=e._closeTop?1:0,t[r++]=e._closeBottom?1:0,t[r++]=e._shadowVolume?1:0,t[r++]=R.defaultValue(e._offsetAttribute,-1),t[r++]=e._arcType,t[r]=e.packedLength,t};var C=S.Ellipsoid.clone(S.Ellipsoid.UNIT_SPHERE),w=new f.VertexFormat,x={polygonHierarchy:{}};return P.unpack=function(e,t,r){t=R.defaultValue(t,0);var o=F.PolygonGeometryLibrary.unpackPolygonHierarchy(e,t);t=o.startingIndex,delete o.startingIndex;var a=S.Ellipsoid.unpack(e,t,C);t+=S.Ellipsoid.packedLength;var i=f.VertexFormat.unpack(e,t,w);t+=f.VertexFormat.packedLength;var n=e[t++],s=e[t++],l=e[t++],u=e[t++],c=1===e[t++],p=1===e[t++],y=1===e[t++],m=1===e[t++],g=1===e[t++],d=e[t++],h=e[t++],t=e[t];return R.defined(r)||(r=new P(x)),r._polygonHierarchy=o,r._ellipsoid=S.Ellipsoid.clone(a,r._ellipsoid),r._vertexFormat=f.VertexFormat.clone(i,r._vertexFormat),r._height=n,r._extrudedHeight=s,r._granularity=l,r._stRotation=u,r._perPositionHeightExtrude=c,r._perPositionHeight=p,r._closeTop=y,r._closeBottom=m,r._shadowVolume=g,r._offsetAttribute=-1===d?void 0:d,r._arcType=h,r.packedLength=t,r},P.computeRectangle=function(e,t){var r=R.defaultValue(e.granularity,M.CesiumMath.RADIANS_PER_DEGREE),o=R.defaultValue(e.arcType,p.ArcType.GEODESIC),a=e.polygonHierarchy,e=R.defaultValue(e.ellipsoid,S.Ellipsoid.WGS84);return b(a.positions,e,o,r,t)},P.createGeometry=function(e){var t=e._vertexFormat,r=e._ellipsoid,o=e._granularity,a=e._stRotation,i=e._polygonHierarchy,n=e._perPositionHeight,s=e._closeTop,l=e._closeBottom,u=e._arcType,c=i.positions;if(!(c.length<3)){var p=O.EllipsoidTangentPlane.fromPoints(c,r),i=F.PolygonGeometryLibrary.polygonsFromHierarchy(i,p.projectPointsOntoPlane.bind(p),!n,r),y=i.hierarchy,m=i.polygons;if(0!==y.length){c=y[0].outerRing;var g,c=F.PolygonGeometryLibrary.computeBoundingRectangle(p.plane.normal,p.projectPointOntoPlane.bind(p),c,a,D),d=[],h=e._height,f=e._extrudedHeight,b={perPositionHeight:n,vertexFormat:t,geometry:void 0,tangentPlane:p,boundingRectangle:c,ellipsoid:r,stRotation:a,bottom:!1,top:!0,wall:!1,extrude:!1,arcType:u};if(e._perPositionHeightExtrude||!M.CesiumMath.equalsEpsilon(h,f,0,M.CesiumMath.EPSILON2))for(b.extrude=!0,b.top=s,b.bottom=l,b.shadowVolume=e._shadowVolume,b.offsetAttribute=e._offsetAttribute,g=0;g<m.length;g++){var _,v=function(e,t,r,o,a,i,n,s,l){var u={walls:[]};if(i||n){var c=F.PolygonGeometryLibrary.createGeometryFromPositions(e,t,r,a,s,l),t=c.attributes.position.values,p=c.indices;if(i&&n){var y,i=t.concat(t),m=i.length/3;(y=E.IndexDatatype.createTypedArray(m,2*p.length)).set(p);for(var g=p.length,d=m/2,h=0;h<g;h+=3){var f=y[h]+d,b=y[h+1]+d,_=y[h+2]+d;y[h+g]=_,y[h+1+g]=b,y[h+2+g]=f}c.attributes.position.values=i,a&&s.normal&&(s=c.attributes.normal.values,c.attributes.normal.values=new Float32Array(i.length),c.attributes.normal.values.set(s)),c.indices=y}else if(n){for(m=t.length/3,y=E.IndexDatatype.createTypedArray(m,p.length),h=0;h<p.length;h+=3)y[h]=p[h+2],y[h+1]=p[h+1],y[h+2]=p[h];c.indices=y}u.topAndBottom=new G.GeometryInstance({geometry:c})}var c=o.outerRing,v=O.EllipsoidTangentPlane.fromPoints(c,e).projectPointsOntoPlane(c,N);V.PolygonPipeline.computeWindingOrder2D(v)===V.WindingOrder.CLOCKWISE&&(c=c.slice().reverse());var P=F.PolygonGeometryLibrary.computeWallGeometry(c,e,r,a,l);u.walls.push(new G.GeometryInstance({geometry:P}));for(var C=o.holes,h=0;h<C.length;h++){var w=C[h],v=O.EllipsoidTangentPlane.fromPoints(w,e).projectPointsOntoPlane(w,N);V.PolygonPipeline.computeWindingOrder2D(v)===V.WindingOrder.COUNTER_CLOCKWISE&&(w=w.slice().reverse()),P=F.PolygonGeometryLibrary.computeWallGeometry(w,e,r,a,l),u.walls.push(new G.GeometryInstance({geometry:P}))}return u}(r,m[g],o,y[g],n,s,l,t,u);s&&l?(_=v.topAndBottom,b.geometry=F.PolygonGeometryLibrary.scaleToGeodeticHeightExtruded(_.geometry,h,f,r,n)):s?((_=v.topAndBottom).geometry.attributes.position.values=V.PolygonPipeline.scaleToGeodeticHeight(_.geometry.attributes.position.values,h,r,!n),b.geometry=_.geometry):l&&((_=v.topAndBottom).geometry.attributes.position.values=V.PolygonPipeline.scaleToGeodeticHeight(_.geometry.attributes.position.values,f,r,!0),b.geometry=_.geometry),(s||l)&&(b.wall=!1,_.geometry=L(b),d.push(_));var P=v.walls;b.wall=!0;for(var C=0;C<P.length;C++){var w=P[C];b.geometry=F.PolygonGeometryLibrary.scaleToGeodeticHeightExtruded(w.geometry,h,f,r,n),w.geometry=L(b),d.push(w)}}else for(g=0;g<m.length;g++){var x,T,I=new G.GeometryInstance({geometry:F.PolygonGeometryLibrary.createGeometryFromPositions(r,m[g],o,n,t,u)});I.geometry.attributes.position.values=V.PolygonPipeline.scaleToGeodeticHeight(I.geometry.attributes.position.values,h,r,!n),b.geometry=I.geometry,I.geometry=L(b),R.defined(e._offsetAttribute)&&(T=I.geometry.attributes.position.values.length,x=new Uint8Array(T/3),T=e._offsetAttribute===W.GeometryOffsetAttribute.NONE?0:1,W.arrayFill(x,T),I.geometry.attributes.applyOffset=new z.GeometryAttribute({componentDatatype:k.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:x})),d.push(I)}p=A.GeometryPipeline.combineInstances(d)[0];p.attributes.position.values=new Float64Array(p.attributes.position.values),p.indices=E.IndexDatatype.createTypedArray(p.attributes.position.values.length/3,p.indices);c=p.attributes,a=B.BoundingSphere.fromVertices(c.position.values);return t.position||delete c.position,new z.Geometry({attributes:c,indices:p.indices,primitiveType:p.primitiveType,boundingSphere:a,offsetAttribute:e._offsetAttribute})}}},P.createShadowVolume=function(e,t,r){var o=e._granularity,a=e._ellipsoid,t=t(o,a),r=r(o,a);return new P({polygonHierarchy:e._polygonHierarchy,ellipsoid:a,stRotation:e._stRotation,granularity:o,perPositionHeight:!1,extrudedHeight:t,height:r,vertexFormat:f.VertexFormat.POSITION_ONLY,shadowVolume:!0,arcType:e._arcType})},Object.defineProperties(P.prototype,{rectangle:{get:function(){var e;return R.defined(this._rectangle)||(e=this._polygonHierarchy.positions,this._rectangle=b(e,this._ellipsoid,this._arcType,this._granularity)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return R.defined(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(e){var t=-e._stRotation;if(0==t)return[0,0,0,1,1,0];var r=e._ellipsoid,o=e._polygonHierarchy.positions,e=e.rectangle;return z.Geometry._textureCoordinateRotationPoints(o,t,r,e)}(this)),this._textureCoordinateRotationPoints}}}),function(e,t){return R.defined(t)&&(e=P.unpack(e,t)),e._ellipsoid=S.Ellipsoid.clone(e._ellipsoid),P.createGeometry(e)}});